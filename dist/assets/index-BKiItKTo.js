const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-zDtqfCc8.js","assets/react-vendor-Wi5MNz69.js"])))=>i.map(i=>d[i]);
var zu=Object.defineProperty;var Wu=(t,r,s)=>r in t?zu(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var Hi=(t,r,s)=>Wu(t,typeof r!="symbol"?r+"":r,s);import{r as h,a as ua,b as zn,g as Vu,c as rt,R as et,d as Hu}from"./react-vendor-Wi5MNz69.js";import{R as Qe,L as ue,U as Je,S as ll,M as cl,X as qe,A as Be,a as Dr,b as _t,c as dl,P as Yu,d as Gu,e as Ku,T as is,C as ul,f as Wn,g as gt,h as Ae,i as ot,j as Qs,k as Vt,l as Sr,m as ha,H as Ju,n as or,o as De,p as xt,q as Xu,F as hl,r as st,D as Pt,B as zt,s as Vn,E as os,t as ml,u as ma,v as pt,I as Nt,w as Er,x as gl,y as Hn,z as Qu,G as zs,J as Yi,K as gn,N as Yn,O as Zu,Q as Gn,V as Kn,W as eh,Y as Ua,Z as fl,_ as xl,$ as th,a0 as rh,a1 as sh,a2 as fn,a3 as pl,a4 as ah,a5 as nh,a6 as yl,a7 as Jn,a8 as Xn,a9 as bl,aa as ih,ab as oh,ac as lh,ad as ch,ae as wr,af as dh,ag as uh,ah as hh,ai as mh,aj as gh,ak as fh,al as Ba,am as xh,an as ph,ao as yh}from"./ui-vendor-BQbxnJff.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var vl={exports:{}},ga={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bh=h,vh=Symbol.for("react.element"),wh=Symbol.for("react.fragment"),kh=Object.prototype.hasOwnProperty,jh=bh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Nh={key:!0,ref:!0,__self:!0,__source:!0};function wl(t,r,s){var a,n={},i=null,o=null;s!==void 0&&(i=""+s),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(o=r.ref);for(a in r)kh.call(r,a)&&!Nh.hasOwnProperty(a)&&(n[a]=r[a]);if(t&&t.defaultProps)for(a in r=t.defaultProps,r)n[a]===void 0&&(n[a]=r[a]);return{$$typeof:vh,type:t,key:i,ref:o,props:n,_owner:jh.current}}ga.Fragment=wh;ga.jsx=wl;ga.jsxs=wl;vl.exports=ga;var e=vl.exports,kl,Gi=ua;kl=Gi.createRoot,Gi.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ls(){return ls=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},ls.apply(this,arguments)}var qt;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(qt||(qt={}));const Ki="popstate";function _h(t){t===void 0&&(t={});function r(a,n){let{pathname:i,search:o,hash:l}=a.location;return xn("",{pathname:i,search:o,hash:l},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function s(a,n){return typeof n=="string"?n:Zs(n)}return Eh(r,s,null,t)}function Ie(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function jl(t,r){if(!t){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function Sh(){return Math.random().toString(36).substr(2,8)}function Ji(t,r){return{usr:t.state,key:t.key,idx:r}}function xn(t,r,s,a){return s===void 0&&(s=null),ls({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof r=="string"?Rr(r):r,{state:s,key:r&&r.key||a||Sh()})}function Zs(t){let{pathname:r="/",search:s="",hash:a=""}=t;return s&&s!=="?"&&(r+=s.charAt(0)==="?"?s:"?"+s),a&&a!=="#"&&(r+=a.charAt(0)==="#"?a:"#"+a),r}function Rr(t){let r={};if(t){let s=t.indexOf("#");s>=0&&(r.hash=t.substr(s),t=t.substr(0,s));let a=t.indexOf("?");a>=0&&(r.search=t.substr(a),t=t.substr(0,a)),t&&(r.pathname=t)}return r}function Eh(t,r,s,a){a===void 0&&(a={});let{window:n=document.defaultView,v5Compat:i=!1}=a,o=n.history,l=qt.Pop,c=null,u=d();u==null&&(u=0,o.replaceState(ls({},o.state,{idx:u}),""));function d(){return(o.state||{idx:null}).idx}function m(){l=qt.Pop;let y=d(),v=y==null?null:y-u;u=y,c&&c({action:l,location:f.location,delta:v})}function g(y,v){l=qt.Push;let w=xn(f.location,y,v);u=d()+1;let j=Ji(w,u),b=f.createHref(w);try{o.pushState(j,"",b)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;n.location.assign(b)}i&&c&&c({action:l,location:f.location,delta:1})}function x(y,v){l=qt.Replace;let w=xn(f.location,y,v);u=d();let j=Ji(w,u),b=f.createHref(w);o.replaceState(j,"",b),i&&c&&c({action:l,location:f.location,delta:0})}function p(y){let v=n.location.origin!=="null"?n.location.origin:n.location.href,w=typeof y=="string"?y:Zs(y);return w=w.replace(/ $/,"%20"),Ie(v,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,v)}let f={get action(){return l},get location(){return t(n,o)},listen(y){if(c)throw new Error("A history only accepts one active listener");return n.addEventListener(Ki,m),c=y,()=>{n.removeEventListener(Ki,m),c=null}},createHref(y){return r(n,y)},createURL:p,encodeLocation(y){let v=p(y);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:g,replace:x,go(y){return o.go(y)}};return f}var Xi;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Xi||(Xi={}));function Ch(t,r,s){return s===void 0&&(s="/"),Ph(t,r,s)}function Ph(t,r,s,a){let n=typeof r=="string"?Rr(r):r,i=Qn(n.pathname||"/",s);if(i==null)return null;let o=Nl(t);Th(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let u=qh(i);l=Fh(o[c],u)}return l}function Nl(t,r,s,a){r===void 0&&(r=[]),s===void 0&&(s=[]),a===void 0&&(a="");let n=(i,o,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};c.relativePath.startsWith("/")&&(Ie(c.relativePath.startsWith(a),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(a.length));let u=Wt([a,c.relativePath]),d=s.concat(c);i.children&&i.children.length>0&&(Ie(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),Nl(i.children,r,d,u)),!(i.path==null&&!i.index)&&r.push({path:u,score:Lh(u,i.index),routesMeta:d})};return t.forEach((i,o)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))n(i,o);else for(let c of _l(i.path))n(i,o,c)}),r}function _l(t){let r=t.split("/");if(r.length===0)return[];let[s,...a]=r,n=s.endsWith("?"),i=s.replace(/\?$/,"");if(a.length===0)return n?[i,""]:[i];let o=_l(a.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),n&&l.push(...o),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function Th(t){t.sort((r,s)=>r.score!==s.score?s.score-r.score:$h(r.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}const Dh=/^:[\w-]+$/,Rh=3,Ah=2,Mh=1,Oh=10,Ih=-2,Qi=t=>t==="*";function Lh(t,r){let s=t.split("/"),a=s.length;return s.some(Qi)&&(a+=Ih),r&&(a+=Ah),s.filter(n=>!Qi(n)).reduce((n,i)=>n+(Dh.test(i)?Rh:i===""?Mh:Oh),a)}function $h(t,r){return t.length===r.length&&t.slice(0,-1).every((a,n)=>a===r[n])?t[t.length-1]-r[r.length-1]:0}function Fh(t,r,s){let{routesMeta:a}=t,n={},i="/",o=[];for(let l=0;l<a.length;++l){let c=a[l],u=l===a.length-1,d=i==="/"?r:r.slice(i.length)||"/",m=Uh({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),g=c.route;if(!m)return null;Object.assign(n,m.params),o.push({params:n,pathname:Wt([i,m.pathname]),pathnameBase:Hh(Wt([i,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(i=Wt([i,m.pathnameBase]))}return o}function Uh(t,r){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[s,a]=Bh(t.path,t.caseSensitive,t.end),n=r.match(s);if(!n)return null;let i=n[0],o=i.replace(/(.)\/+$/,"$1"),l=n.slice(1);return{params:a.reduce((u,d,m)=>{let{paramName:g,isOptional:x}=d;if(g==="*"){let f=l[m]||"";o=i.slice(0,i.length-f.length).replace(/(.)\/+$/,"$1")}const p=l[m];return x&&!p?u[g]=void 0:u[g]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function Bh(t,r,s){r===void 0&&(r=!1),s===void 0&&(s=!0),jl(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let a=[],n="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(a.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(a.push({paramName:"*"}),n+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?n+="\\/*$":t!==""&&t!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,r?void 0:"i"),a]}function qh(t){try{return t.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return jl(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),t}}function Qn(t,r){if(r==="/")return t;if(!t.toLowerCase().startsWith(r.toLowerCase()))return null;let s=r.endsWith("/")?r.length-1:r.length,a=t.charAt(s);return a&&a!=="/"?null:t.slice(s)||"/"}function zh(t,r){r===void 0&&(r="/");let{pathname:s,search:a="",hash:n=""}=typeof t=="string"?Rr(t):t;return{pathname:s?s.startsWith("/")?s:Wh(s,r):r,search:Yh(a),hash:Gh(n)}}function Wh(t,r){let s=r.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?s.length>1&&s.pop():n!=="."&&s.push(n)}),s.length>1?s.join("/"):"/"}function qa(t,r,s,a){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Vh(t){return t.filter((r,s)=>s===0||r.route.path&&r.route.path.length>0)}function Zn(t,r){let s=Vh(t);return r?s.map((a,n)=>n===s.length-1?a.pathname:a.pathnameBase):s.map(a=>a.pathnameBase)}function ei(t,r,s,a){a===void 0&&(a=!1);let n;typeof t=="string"?n=Rr(t):(n=ls({},t),Ie(!n.pathname||!n.pathname.includes("?"),qa("?","pathname","search",n)),Ie(!n.pathname||!n.pathname.includes("#"),qa("#","pathname","hash",n)),Ie(!n.search||!n.search.includes("#"),qa("#","search","hash",n)));let i=t===""||n.pathname==="",o=i?"/":n.pathname,l;if(o==null)l=s;else{let m=r.length-1;if(!a&&o.startsWith("..")){let g=o.split("/");for(;g[0]==="..";)g.shift(),m-=1;n.pathname=g.join("/")}l=m>=0?r[m]:"/"}let c=zh(n,l),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&s.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const Wt=t=>t.join("/").replace(/\/\/+/g,"/"),Hh=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Yh=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Gh=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Kh(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Sl=["post","put","patch","delete"];new Set(Sl);const Jh=["get",...Sl];new Set(Jh);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cs(){return cs=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},cs.apply(this,arguments)}const ti=h.createContext(null),Xh=h.createContext(null),Kt=h.createContext(null),fa=h.createContext(null),Jt=h.createContext({outlet:null,matches:[],isDataRoute:!1}),El=h.createContext(null);function Qh(t,r){let{relative:s}=r===void 0?{}:r;Ar()||Ie(!1);let{basename:a,navigator:n}=h.useContext(Kt),{hash:i,pathname:o,search:l}=Pl(t,{relative:s}),c=o;return a!=="/"&&(c=o==="/"?a:Wt([a,o])),n.createHref({pathname:c,search:l,hash:i})}function Ar(){return h.useContext(fa)!=null}function vt(){return Ar()||Ie(!1),h.useContext(fa).location}function Cl(t){h.useContext(Kt).static||h.useLayoutEffect(t)}function Xt(){let{isDataRoute:t}=h.useContext(Jt);return t?um():Zh()}function Zh(){Ar()||Ie(!1);let t=h.useContext(ti),{basename:r,future:s,navigator:a}=h.useContext(Kt),{matches:n}=h.useContext(Jt),{pathname:i}=vt(),o=JSON.stringify(Zn(n,s.v7_relativeSplatPath)),l=h.useRef(!1);return Cl(()=>{l.current=!0}),h.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){a.go(u);return}let m=ei(u,JSON.parse(o),i,d.relative==="path");t==null&&r!=="/"&&(m.pathname=m.pathname==="/"?r:Wt([r,m.pathname])),(d.replace?a.replace:a.push)(m,d.state,d)},[r,a,o,i,t])}function Pl(t,r){let{relative:s}=r===void 0?{}:r,{future:a}=h.useContext(Kt),{matches:n}=h.useContext(Jt),{pathname:i}=vt(),o=JSON.stringify(Zn(n,a.v7_relativeSplatPath));return h.useMemo(()=>ei(t,JSON.parse(o),i,s==="path"),[t,o,i,s])}function em(t,r){return tm(t,r)}function tm(t,r,s,a){Ar()||Ie(!1);let{navigator:n,static:i}=h.useContext(Kt),{matches:o}=h.useContext(Jt),l=o[o.length-1],c=l?l.params:{};l&&l.pathname;let u=l?l.pathnameBase:"/";l&&l.route;let d=vt(),m;if(r){var g;let v=typeof r=="string"?Rr(r):r;u==="/"||(g=v.pathname)!=null&&g.startsWith(u)||Ie(!1),m=v}else m=d;let x=m.pathname||"/",p=x;if(u!=="/"){let v=u.replace(/^\//,"").split("/");p="/"+x.replace(/^\//,"").split("/").slice(v.length).join("/")}let f=Ch(t,{pathname:p}),y=im(f&&f.map(v=>Object.assign({},v,{params:Object.assign({},c,v.params),pathname:Wt([u,n.encodeLocation?n.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?u:Wt([u,n.encodeLocation?n.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,s,a);return r&&y?h.createElement(fa.Provider,{value:{location:cs({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:qt.Pop}},y):y}function rm(){let t=dm(),r=Kh(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),s=t instanceof Error?t.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return h.createElement(h.Fragment,null,h.createElement("h2",null,"Unexpected Application Error!"),h.createElement("h3",{style:{fontStyle:"italic"}},r),s?h.createElement("pre",{style:n},s):null,null)}const sm=h.createElement(rm,null);class am extends h.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,s){return s.location!==r.location||s.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:s.error,location:s.location,revalidation:r.revalidation||s.revalidation}}componentDidCatch(r,s){console.error("React Router caught the following error during render",r,s)}render(){return this.state.error!==void 0?h.createElement(Jt.Provider,{value:this.props.routeContext},h.createElement(El.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function nm(t){let{routeContext:r,match:s,children:a}=t,n=h.useContext(ti);return n&&n.static&&n.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=s.route.id),h.createElement(Jt.Provider,{value:r},a)}function im(t,r,s,a){var n;if(r===void 0&&(r=[]),s===void 0&&(s=null),a===void 0&&(a=null),t==null){var i;if(!s)return null;if(s.errors)t=s.matches;else if((i=a)!=null&&i.v7_partialHydration&&r.length===0&&!s.initialized&&s.matches.length>0)t=s.matches;else return null}let o=t,l=(n=s)==null?void 0:n.errors;if(l!=null){let d=o.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);d>=0||Ie(!1),o=o.slice(0,Math.min(o.length,d+1))}let c=!1,u=-1;if(s&&a&&a.v7_partialHydration)for(let d=0;d<o.length;d++){let m=o[d];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(u=d),m.route.id){let{loaderData:g,errors:x}=s,p=m.route.loader&&g[m.route.id]===void 0&&(!x||x[m.route.id]===void 0);if(m.route.lazy||p){c=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((d,m,g)=>{let x,p=!1,f=null,y=null;s&&(x=l&&m.route.id?l[m.route.id]:void 0,f=m.route.errorElement||sm,c&&(u<0&&g===0?(hm("route-fallback"),p=!0,y=null):u===g&&(p=!0,y=m.route.hydrateFallbackElement||null)));let v=r.concat(o.slice(0,g+1)),w=()=>{let j;return x?j=f:p?j=y:m.route.Component?j=h.createElement(m.route.Component,null):m.route.element?j=m.route.element:j=d,h.createElement(nm,{match:m,routeContext:{outlet:d,matches:v,isDataRoute:s!=null},children:j})};return s&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?h.createElement(am,{location:s.location,revalidation:s.revalidation,component:f,error:x,children:w(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):w()},null)}var Tl=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Tl||{}),Dl=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Dl||{});function om(t){let r=h.useContext(ti);return r||Ie(!1),r}function lm(t){let r=h.useContext(Xh);return r||Ie(!1),r}function cm(t){let r=h.useContext(Jt);return r||Ie(!1),r}function Rl(t){let r=cm(),s=r.matches[r.matches.length-1];return s.route.id||Ie(!1),s.route.id}function dm(){var t;let r=h.useContext(El),s=lm(),a=Rl();return r!==void 0?r:(t=s.errors)==null?void 0:t[a]}function um(){let{router:t}=om(Tl.UseNavigateStable),r=Rl(Dl.UseNavigateStable),s=h.useRef(!1);return Cl(()=>{s.current=!0}),h.useCallback(function(n,i){i===void 0&&(i={}),s.current&&(typeof n=="number"?t.navigate(n):t.navigate(n,cs({fromRouteId:r},i)))},[t,r])}const Zi={};function hm(t,r,s){Zi[t]||(Zi[t]=!0)}function mm(t,r){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function es(t){let{to:r,replace:s,state:a,relative:n}=t;Ar()||Ie(!1);let{future:i,static:o}=h.useContext(Kt),{matches:l}=h.useContext(Jt),{pathname:c}=vt(),u=Xt(),d=ei(r,Zn(l,i.v7_relativeSplatPath),c,n==="path"),m=JSON.stringify(d);return h.useEffect(()=>u(JSON.parse(m),{replace:s,state:a,relative:n}),[u,m,n,s,a]),null}function Oe(t){Ie(!1)}function gm(t){let{basename:r="/",children:s=null,location:a,navigationType:n=qt.Pop,navigator:i,static:o=!1,future:l}=t;Ar()&&Ie(!1);let c=r.replace(/^\/*/,"/"),u=h.useMemo(()=>({basename:c,navigator:i,static:o,future:cs({v7_relativeSplatPath:!1},l)}),[c,l,i,o]);typeof a=="string"&&(a=Rr(a));let{pathname:d="/",search:m="",hash:g="",state:x=null,key:p="default"}=a,f=h.useMemo(()=>{let y=Qn(d,c);return y==null?null:{location:{pathname:y,search:m,hash:g,state:x,key:p},navigationType:n}},[c,d,m,g,x,p,n]);return f==null?null:h.createElement(Kt.Provider,{value:u},h.createElement(fa.Provider,{children:s,value:f}))}function ri(t){let{children:r,location:s}=t;return em(pn(r),s)}new Promise(()=>{});function pn(t,r){r===void 0&&(r=[]);let s=[];return h.Children.forEach(t,(a,n)=>{if(!h.isValidElement(a))return;let i=[...r,n];if(a.type===h.Fragment){s.push.apply(s,pn(a.props.children,i));return}a.type!==Oe&&Ie(!1),!a.props.index||!a.props.children||Ie(!1);let o={id:a.props.id||i.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(o.children=pn(a.props.children,i)),s.push(o)}),s}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yn(){return yn=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},yn.apply(this,arguments)}function fm(t,r){if(t==null)return{};var s={},a=Object.keys(t),n,i;for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(s[n]=t[n]);return s}function xm(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function pm(t,r){return t.button===0&&(!r||r==="_self")&&!xm(t)}const ym=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],bm="6";try{window.__reactRouterVersion=bm}catch{}const vm="startTransition",eo=zn[vm];function wm(t){let{basename:r,children:s,future:a,window:n}=t,i=h.useRef();i.current==null&&(i.current=_h({window:n,v5Compat:!0}));let o=i.current,[l,c]=h.useState({action:o.action,location:o.location}),{v7_startTransition:u}=a||{},d=h.useCallback(m=>{u&&eo?eo(()=>c(m)):c(m)},[c,u]);return h.useLayoutEffect(()=>o.listen(d),[o,d]),h.useEffect(()=>mm(a),[a]),h.createElement(gm,{basename:r,children:s,location:l.location,navigationType:l.action,navigator:o,future:a})}const km=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",jm=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lt=h.forwardRef(function(r,s){let{onClick:a,relative:n,reloadDocument:i,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:m}=r,g=fm(r,ym),{basename:x}=h.useContext(Kt),p,f=!1;if(typeof u=="string"&&jm.test(u)&&(p=u,km))try{let j=new URL(window.location.href),b=u.startsWith("//")?new URL(j.protocol+u):new URL(u),k=Qn(b.pathname,x);b.origin===j.origin&&k!=null?u=k+b.search+b.hash:f=!0}catch{}let y=Qh(u,{relative:n}),v=Nm(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:n,viewTransition:m});function w(j){a&&a(j),j.defaultPrevented||v(j)}return h.createElement("a",yn({},g,{href:p||y,onClick:f||i?a:w,ref:s,target:c}))});var to;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(to||(to={}));var ro;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(ro||(ro={}));function Nm(t,r){let{target:s,replace:a,state:n,preventScrollReset:i,relative:o,viewTransition:l}=r===void 0?{}:r,c=Xt(),u=vt(),d=Pl(t,{relative:o});return h.useCallback(m=>{if(pm(m,s)){m.preventDefault();let g=a!==void 0?a:Zs(u)===Zs(d);c(t,{replace:g,state:n,preventScrollReset:i,relative:o,viewTransition:l})}},[u,c,d,a,n,s,t,i,o,l])}const _m="modulepreload",Sm=function(t){return"/"+t},so={},Cr=function(r,s,a){let n=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(s.map(c=>{if(c=Sm(c),c in so)return;so[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":_m,u||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),u)return new Promise((g,x)=>{m.addEventListener("load",g),m.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return r().catch(i)})},Em=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...s)=>Cr(async()=>{const{default:a}=await Promise.resolve().then(()=>Mr);return{default:a}},void 0).then(({default:a})=>a(...s)):r=fetch,(...s)=>r(...s)};class si extends Error{constructor(r,s="FunctionsError",a){super(r),this.name=s,this.context=a}}class Cm extends si{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class Pm extends si{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class Tm extends si{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}var bn;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(bn||(bn={}));var Dm=function(t,r,s,a){function n(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(a.next(d))}catch(m){o(m)}}function c(d){try{u(a.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((a=a.apply(t,r||[])).next())})};class Rm{constructor(r,{headers:s={},customFetch:a,region:n=bn.Any}={}){this.url=r,this.headers=s,this.region=n,this.fetch=Em(a)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r,s={}){var a;return Dm(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=s;let l={},{region:c}=s;c||(c=this.region),c&&c!=="any"&&(l["x-region"]=c);let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(l["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(l["Content-Type"]="application/json",u=JSON.stringify(o)));const d=yield this.fetch(`${this.url}/${r}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:u}).catch(p=>{throw new Cm(p)}),m=d.headers.get("x-relay-error");if(m&&m==="true")throw new Pm(d);if(!d.ok)throw new Tm(d);let g=((a=d.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),x;return g==="application/json"?x=yield d.json():g==="application/octet-stream"?x=yield d.blob():g==="text/event-stream"?x=d:g==="multipart/form-data"?x=yield d.formData():x=yield d.text(),{data:x,error:null}}catch(n){return{data:null,error:n}}})}}var He={},ai={},xa={},ps={},pa={},ya={},Am=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Pr=Am();const Mm=Pr.fetch,Al=Pr.fetch.bind(Pr),Ml=Pr.Headers,Om=Pr.Request,Im=Pr.Response,Mr=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ml,Request:Om,Response:Im,default:Al,fetch:Mm},Symbol.toStringTag,{value:"Module"})),Lm=Vu(Mr);var ba={};Object.defineProperty(ba,"__esModule",{value:!0});let $m=class extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}};ba.default=$m;var Ol=rt&&rt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ya,"__esModule",{value:!0});const Fm=Ol(Lm),Um=Ol(ba);let Bm=class{constructor(r){this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=r.headers,this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=r.shouldThrowOnError,this.signal=r.signal,this.isMaybeSingle=r.isMaybeSingle,r.fetch?this.fetch=r.fetch:typeof fetch>"u"?this.fetch=Fm.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,s){return this.headers=Object.assign({},this.headers),this.headers[r]=s,this}then(r,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let n=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,c;let u=null,d=null,m=null,g=i.status,x=i.statusText;if(i.ok){if(this.method!=="HEAD"){const v=await i.text();v===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=v:d=JSON.parse(v))}const f=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),y=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");f&&y&&y.length>1&&(m=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(u={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,m=null,g=406,x="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const f=await i.text();try{u=JSON.parse(f),Array.isArray(u)&&i.status===404&&(d=[],u=null,g=200,x="OK")}catch{i.status===404&&f===""?(g=204,x="No Content"):u={message:f}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,g=200,x="OK"),u&&this.shouldThrowOnError)throw new Um.default(u)}return{error:u,data:d,count:m,status:g,statusText:x}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,l,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(r,s)}returns(){return this}overrideTypes(){return this}};ya.default=Bm;var qm=rt&&rt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(pa,"__esModule",{value:!0});const zm=qm(ya);let Wm=class extends zm.default{select(r){let s=!1;const a=(r??"*").split("").map(n=>/\s/.test(n)&&!s?"":(n==='"'&&(s=!s),n)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(r,{ascending:s=!0,nullsFirst:a,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${r}.${s?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:s,referencedTable:a=s}={}){const n=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(n,`${r}`),this}range(r,s,{foreignTable:a,referencedTable:n=a}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${r}`),this.url.searchParams.set(o,`${s-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:r=!1,verbose:s=!1,settings:a=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var l;const c=[r?"analyze":null,s?"verbose":null,a?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`,o==="json"?this:this}rollback(){var r;return((r=this.headers.Prefer)!==null&&r!==void 0?r:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};pa.default=Wm;var Vm=rt&&rt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ps,"__esModule",{value:!0});const Hm=Vm(pa);let Ym=class extends Hm.default{eq(r,s){return this.url.searchParams.append(r,`eq.${s}`),this}neq(r,s){return this.url.searchParams.append(r,`neq.${s}`),this}gt(r,s){return this.url.searchParams.append(r,`gt.${s}`),this}gte(r,s){return this.url.searchParams.append(r,`gte.${s}`),this}lt(r,s){return this.url.searchParams.append(r,`lt.${s}`),this}lte(r,s){return this.url.searchParams.append(r,`lte.${s}`),this}like(r,s){return this.url.searchParams.append(r,`like.${s}`),this}likeAllOf(r,s){return this.url.searchParams.append(r,`like(all).{${s.join(",")}}`),this}likeAnyOf(r,s){return this.url.searchParams.append(r,`like(any).{${s.join(",")}}`),this}ilike(r,s){return this.url.searchParams.append(r,`ilike.${s}`),this}ilikeAllOf(r,s){return this.url.searchParams.append(r,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(r,s){return this.url.searchParams.append(r,`ilike(any).{${s.join(",")}}`),this}is(r,s){return this.url.searchParams.append(r,`is.${s}`),this}in(r,s){const a=Array.from(new Set(s)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(r,`in.(${a})`),this}contains(r,s){return typeof s=="string"?this.url.searchParams.append(r,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(r,`cs.{${s.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(s)}`),this}containedBy(r,s){return typeof s=="string"?this.url.searchParams.append(r,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(r,`cd.{${s.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(s)}`),this}rangeGt(r,s){return this.url.searchParams.append(r,`sr.${s}`),this}rangeGte(r,s){return this.url.searchParams.append(r,`nxl.${s}`),this}rangeLt(r,s){return this.url.searchParams.append(r,`sl.${s}`),this}rangeLte(r,s){return this.url.searchParams.append(r,`nxr.${s}`),this}rangeAdjacent(r,s){return this.url.searchParams.append(r,`adj.${s}`),this}overlaps(r,s){return typeof s=="string"?this.url.searchParams.append(r,`ov.${s}`):this.url.searchParams.append(r,`ov.{${s.join(",")}}`),this}textSearch(r,s,{config:a,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=a===void 0?"":`(${a})`;return this.url.searchParams.append(r,`${i}fts${o}.${s}`),this}match(r){return Object.entries(r).forEach(([s,a])=>{this.url.searchParams.append(s,`eq.${a}`)}),this}not(r,s,a){return this.url.searchParams.append(r,`not.${s}.${a}`),this}or(r,{foreignTable:s,referencedTable:a=s}={}){const n=a?`${a}.or`:"or";return this.url.searchParams.append(n,`(${r})`),this}filter(r,s,a){return this.url.searchParams.append(r,`${s}.${a}`),this}};ps.default=Ym;var Gm=rt&&rt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(xa,"__esModule",{value:!0});const zr=Gm(ps);let Km=class{constructor(r,{headers:s={},schema:a,fetch:n}){this.url=r,this.headers=s,this.schema=a,this.fetch=n}select(r,{head:s=!1,count:a}={}){const n=s?"HEAD":"GET";let i=!1;const o=(r??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),a&&(this.headers.Prefer=`count=${a}`),new zr.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(r,{count:s,defaultToNull:a=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),s&&i.push(`count=${s}`),a||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(r)){const o=r.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new zr.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}upsert(r,{onConflict:s,ignoreDuplicates:a=!1,count:n,defaultToNull:i=!0}={}){const o="POST",l=[`resolution=${a?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(r)){const c=r.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new zr.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}update(r,{count:s}={}){const a="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),s&&n.push(`count=${s}`),this.headers.Prefer=n.join(","),new zr.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}delete({count:r}={}){const s="DELETE",a=[];return r&&a.push(`count=${r}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new zr.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};xa.default=Km;var va={},wa={};Object.defineProperty(wa,"__esModule",{value:!0});wa.version=void 0;wa.version="0.0.0-automated";Object.defineProperty(va,"__esModule",{value:!0});va.DEFAULT_HEADERS=void 0;const Jm=wa;va.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Jm.version}`};var Il=rt&&rt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ai,"__esModule",{value:!0});const Xm=Il(xa),Qm=Il(ps),Zm=va;let e0=class Ll{constructor(r,{headers:s={},schema:a,fetch:n}={}){this.url=r,this.headers=Object.assign(Object.assign({},Zm.DEFAULT_HEADERS),s),this.schemaName=a,this.fetch=n}from(r){const s=new URL(`${this.url}/${r}`);return new Xm.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(r){return new Ll(this.url,{headers:this.headers,schema:r,fetch:this.fetch})}rpc(r,s={},{head:a=!1,get:n=!1,count:i}={}){let o;const l=new URL(`${this.url}/rpc/${r}`);let c;a||n?(o=a?"HEAD":"GET",Object.entries(s).filter(([d,m])=>m!==void 0).map(([d,m])=>[d,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([d,m])=>{l.searchParams.append(d,m)})):(o="POST",c=s);const u=Object.assign({},this.headers);return i&&(u.Prefer=`count=${i}`),new Qm.default({method:o,url:l,headers:u,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};ai.default=e0;var Or=rt&&rt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(He,"__esModule",{value:!0});He.PostgrestError=He.PostgrestBuilder=He.PostgrestTransformBuilder=He.PostgrestFilterBuilder=He.PostgrestQueryBuilder=He.PostgrestClient=void 0;const $l=Or(ai);He.PostgrestClient=$l.default;const Fl=Or(xa);He.PostgrestQueryBuilder=Fl.default;const Ul=Or(ps);He.PostgrestFilterBuilder=Ul.default;const Bl=Or(pa);He.PostgrestTransformBuilder=Bl.default;const ql=Or(ya);He.PostgrestBuilder=ql.default;const zl=Or(ba);He.PostgrestError=zl.default;var t0=He.default={PostgrestClient:$l.default,PostgrestQueryBuilder:Fl.default,PostgrestFilterBuilder:Ul.default,PostgrestTransformBuilder:Bl.default,PostgrestBuilder:ql.default,PostgrestError:zl.default};const{PostgrestClient:r0,PostgrestQueryBuilder:xj,PostgrestFilterBuilder:pj,PostgrestTransformBuilder:yj,PostgrestBuilder:bj,PostgrestError:vj}=t0,s0="2.11.2",a0={"X-Client-Info":`realtime-js/${s0}`},n0="1.0.0",Wl=1e4,i0=1e3;var kr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(kr||(kr={}));var Ge;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Ge||(Ge={}));var nt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(nt||(nt={}));var vn;(function(t){t.websocket="websocket"})(vn||(vn={}));var ir;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(ir||(ir={}));class o0{constructor(){this.HEADER_LENGTH=1}decode(r,s){return r.constructor===ArrayBuffer?s(this._binaryDecode(r)):s(typeof r=="string"?JSON.parse(r):{})}_binaryDecode(r){const s=new DataView(r),a=new TextDecoder;return this._decodeBroadcast(r,s,a)}_decodeBroadcast(r,s,a){const n=s.getUint8(1),i=s.getUint8(2);let o=this.HEADER_LENGTH+2;const l=a.decode(r.slice(o,o+n));o=o+n;const c=a.decode(r.slice(o,o+i));o=o+i;const u=JSON.parse(a.decode(r.slice(o,r.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class Vl{constructor(r,s){this.callback=r,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ee;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ee||(Ee={}));const ao=(t,r,s={})=>{var a;const n=(a=s.skipTypes)!==null&&a!==void 0?a:[];return Object.keys(r).reduce((i,o)=>(i[o]=l0(o,t,r,n),i),{})},l0=(t,r,s,a)=>{const n=r.find(l=>l.name===t),i=n==null?void 0:n.type,o=s[t];return i&&!a.includes(i)?Hl(i,o):wn(o)},Hl=(t,r)=>{if(t.charAt(0)==="_"){const s=t.slice(1,t.length);return h0(r,s)}switch(t){case Ee.bool:return c0(r);case Ee.float4:case Ee.float8:case Ee.int2:case Ee.int4:case Ee.int8:case Ee.numeric:case Ee.oid:return d0(r);case Ee.json:case Ee.jsonb:return u0(r);case Ee.timestamp:return m0(r);case Ee.abstime:case Ee.date:case Ee.daterange:case Ee.int4range:case Ee.int8range:case Ee.money:case Ee.reltime:case Ee.text:case Ee.time:case Ee.timestamptz:case Ee.timetz:case Ee.tsrange:case Ee.tstzrange:return wn(r);default:return wn(r)}},wn=t=>t,c0=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},d0=t=>{if(typeof t=="string"){const r=parseFloat(t);if(!Number.isNaN(r))return r}return t},u0=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(r){return console.log(`JSON parse error: ${r}`),t}return t},h0=(t,r)=>{if(typeof t!="string")return t;const s=t.length-1,a=t[s];if(t[0]==="{"&&a==="}"){let i;const o=t.slice(1,s);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>Hl(r,l))}return t},m0=t=>typeof t=="string"?t.replace(" ","T"):t,Yl=t=>{let r=t;return r=r.replace(/^ws/i,"http"),r=r.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),r.replace(/\/+$/,"")};class za{constructor(r,s,a={},n=Wl){this.channel=r,this.event=s,this.payload=a,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,s){var a;return this._hasReceived(r)&&s((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:r,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const r=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},r),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(r,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:s}){this.recHooks.filter(a=>a.status===r).forEach(a=>a.callback(s))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}var no;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(no||(no={}));class ts{constructor(r,s){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ts.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=ts.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(a.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ts.syncDiff(this.state,n,i,o),l())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,s,a,n){const i=this.cloneDeep(r),o=this.transformState(s),l={},c={};return this.map(i,(u,d)=>{o[u]||(c[u]=d)}),this.map(o,(u,d)=>{const m=i[u];if(m){const g=d.map(y=>y.presence_ref),x=m.map(y=>y.presence_ref),p=d.filter(y=>x.indexOf(y.presence_ref)<0),f=m.filter(y=>g.indexOf(y.presence_ref)<0);p.length>0&&(l[u]=p),f.length>0&&(c[u]=f)}else l[u]=d}),this.syncDiff(i,{joins:l,leaves:c},a,n)}static syncDiff(r,s,a,n){const{joins:i,leaves:o}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return a||(a=()=>{}),n||(n=()=>{}),this.map(i,(l,c)=>{var u;const d=(u=r[l])!==null&&u!==void 0?u:[];if(r[l]=this.cloneDeep(c),d.length>0){const m=r[l].map(x=>x.presence_ref),g=d.filter(x=>m.indexOf(x.presence_ref)<0);r[l].unshift(...g)}a(l,d,c)}),this.map(o,(l,c)=>{let u=r[l];if(!u)return;const d=c.map(m=>m.presence_ref);u=u.filter(m=>d.indexOf(m.presence_ref)<0),r[l]=u,n(l,u,c),u.length===0&&delete r[l]}),r}static map(r,s){return Object.getOwnPropertyNames(r).map(a=>s(a,r[a]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((s,a)=>{const n=r[a];return"metas"in n?s[a]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):s[a]=n,s},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var io;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(io||(io={}));var oo;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(oo||(oo={}));var jt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(jt||(jt={}));class ni{constructor(r,s={config:{}},a){this.topic=r,this.params=s,this.socket=a,this.bindings={},this.state=Ge.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new za(this,nt.join,this.params,this.timeout),this.rejoinTimer=new Vl(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ge.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ge.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=Ge.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ge.errored,this.rejoinTimer.scheduleTimeout())}),this._on(nt.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new ts(this),this.broadcastEndpointURL=Yl(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(r,s=this.timeout){var a,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:l}}=this.params;this._onError(d=>r==null?void 0:r(jt.CHANNEL_ERROR,d)),this._onClose(()=>r==null?void 0:r(jt.CLOSED));const c={},u={broadcast:i,presence:o,postgres_changes:(n=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(d=>d.filter))!==null&&n!==void 0?n:[],private:l};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:d})=>{var m;if(this.socket.setAuth(),d===void 0){r==null||r(jt.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,x=(m=g==null?void 0:g.length)!==null&&m!==void 0?m:0,p=[];for(let f=0;f<x;f++){const y=g[f],{filter:{event:v,schema:w,table:j,filter:b}}=y,k=d&&d[f];if(k&&k.event===v&&k.schema===w&&k.table===j&&k.filter===b)p.push(Object.assign(Object.assign({},y),{id:k.id}));else{this.unsubscribe(),r==null||r(jt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,r&&r(jt.SUBSCRIBED);return}}).receive("error",d=>{r==null||r(jt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{r==null||r(jt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(r,s={}){return await this.send({type:"presence",event:"track",payload:r},s.timeout||this.timeout)}async untrack(r={}){return await this.send({type:"presence",event:"untrack"},r)}on(r,s,a){return this._on(r,s,a)}async send(r,s={}){var a,n;if(!this._canPush()&&r.type==="broadcast"){const{event:i,payload:o}=r,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=s.timeout)!==null&&a!==void 0?a:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const u=this._push(r.type,r,s.timeout||this.timeout);r.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=Ge.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(nt.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(a=>{const n=new za(this,nt.leave,{},r);n.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(r,s,a){const n=new AbortController,i=setTimeout(()=>n.abort(),a),o=await this.socket.fetch(r,Object.assign(Object.assign({},s),{signal:n.signal}));return clearTimeout(i),o}_push(r,s,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new za(this,r,s,a);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(r,s,a){return s}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,s,a){var n,i;const o=r.toLocaleLowerCase(),{close:l,error:c,leave:u,join:d}=nt;if(a&&[l,c,u,d].indexOf(o)>=0&&a!==this._joinRef())return;let g=this._onMessage(o,s,a);if(s&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(x=>{var p,f,y;return((p=x.filter)===null||p===void 0?void 0:p.event)==="*"||((y=(f=x.filter)===null||f===void 0?void 0:f.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===o}).map(x=>x.callback(g,a)):(i=this.bindings[o])===null||i===void 0||i.filter(x=>{var p,f,y,v,w,j;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in x){const b=x.id,k=(p=x.filter)===null||p===void 0?void 0:p.event;return b&&((f=s.ids)===null||f===void 0?void 0:f.includes(b))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((y=s.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const b=(w=(v=x==null?void 0:x.filter)===null||v===void 0?void 0:v.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return b==="*"||b===((j=s==null?void 0:s.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return x.type.toLocaleLowerCase()===o}).map(x=>{if(typeof g=="object"&&"ids"in g){const p=g.data,{schema:f,table:y,commit_timestamp:v,type:w,errors:j}=p;g=Object.assign(Object.assign({},{schema:f,table:y,commit_timestamp:v,eventType:w,new:{},old:{},errors:j}),this._getPayloadRecords(p))}x.callback(g,a)})}_isClosed(){return this.state===Ge.closed}_isJoined(){return this.state===Ge.joined}_isJoining(){return this.state===Ge.joining}_isLeaving(){return this.state===Ge.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,s,a){const n=r.toLocaleLowerCase(),i={type:n,filter:s,callback:a};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(r,s){const a=r.toLocaleLowerCase();return this.bindings[a]=this.bindings[a].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===a&&ni.isEqual(n.filter,s))}),this}static isEqual(r,s){if(Object.keys(r).length!==Object.keys(s).length)return!1;for(const a in r)if(r[a]!==s[a])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(nt.close,{},r)}_onError(r){this._on(nt.error,{},s=>r(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ge.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const s={new:{},old:{}};return(r.type==="INSERT"||r.type==="UPDATE")&&(s.new=ao(r.columns,r.record)),(r.type==="UPDATE"||r.type==="DELETE")&&(s.old=ao(r.columns,r.old_record)),s}}const g0=()=>{},f0=typeof WebSocket<"u",x0=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class p0{constructor(r,s){var a;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=a0,this.params={},this.timeout=Wl,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=g0,this.conn=null,this.sendBuffer=[],this.serializer=new o0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...l)=>Cr(async()=>{const{default:c}=await Promise.resolve().then(()=>Mr);return{default:c}},void 0).then(({default:c})=>c(...l)):o=fetch,(...l)=>o(...l)},this.endPoint=`${r}/${vn.websocket}`,this.httpEndpoint=Yl(r),s!=null&&s.transport?this.transport=s.transport:this.transport=null,s!=null&&s.params&&(this.params=s.params),s!=null&&s.headers&&(this.headers=Object.assign(Object.assign({},this.headers),s.headers)),s!=null&&s.timeout&&(this.timeout=s.timeout),s!=null&&s.logger&&(this.logger=s.logger),s!=null&&s.heartbeatIntervalMs&&(this.heartbeatIntervalMs=s.heartbeatIntervalMs);const n=(a=s==null?void 0:s.params)===null||a===void 0?void 0:a.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=s!=null&&s.reconnectAfterMs?s.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=s!=null&&s.encode?s.encode:(i,o)=>o(JSON.stringify(i)),this.decode=s!=null&&s.decode?s.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Vl(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(s==null?void 0:s.fetch),s!=null&&s.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(s==null?void 0:s.worker)||!1,this.workerUrl=s==null?void 0:s.workerUrl}this.accessToken=(s==null?void 0:s.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(f0){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new y0(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Cr(async()=>{const{default:r}=await import("./browser-zDtqfCc8.js").then(s=>s.b);return{default:r}},__vite__mapDeps([0,1])).then(({default:r})=>{this.conn=new r(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:n0}))}disconnect(r,s){this.conn&&(this.conn.onclose=function(){},r?this.conn.close(r,s??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(r){const s=await r.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const r=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.disconnect(),r}log(r,s,a){this.logger(r,s,a)}connectionState(){switch(this.conn&&this.conn.readyState){case kr.connecting:return ir.Connecting;case kr.open:return ir.Open;case kr.closing:return ir.Closing;default:return ir.Closed}}isConnected(){return this.connectionState()===ir.Open}channel(r,s={config:{}}){const a=new ni(`realtime:${r}`,s,this);return this.channels.push(a),a}push(r){const{topic:s,event:a,payload:n,ref:i}=r,o=()=>{this.encode(r,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${s} ${a} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(r=null){let s=r||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(s){let a=null;try{a=JSON.parse(atob(s.split(".")[1]))}catch{}if(a&&a.exp&&!(Math.floor(Date.now()/1e3)-a.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`);this.accessTokenValue=s,this.channels.forEach(n=>{s&&n.updateJoinPayload({access_token:s}),n.joinedOnce&&n._isJoined()&&n._push(nt.access_token,{access_token:s})})}}async sendHeartbeat(){var r;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(r=this.conn)===null||r===void 0||r.close(i0,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_makeRef(){let r=this.ref+1;return r===this.ref?this.ref=0:this.ref=r,this.ref.toString()}_leaveOpenTopic(r){let s=this.channels.find(a=>a.topic===r&&(a._isJoined()||a._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${r}"`),s.unsubscribe())}_remove(r){this.channels=this.channels.filter(s=>s._joinRef()!==r._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r))}_onConnMessage(r){this.decode(r.data,s=>{let{topic:a,event:n,payload:i,ref:o}=s;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${a} ${n} ${o&&"("+o+")"||""}`,i),this.channels.filter(l=>l._isMember(a)).forEach(l=>l._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(l=>l(s))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const r=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(r),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(r=>r())}_onConnClose(r){this.log("transport","close",r),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(s=>s(r))}_onConnError(r){this.log("transport",r.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(s=>s(r))}_triggerChanError(){this.channels.forEach(r=>r._trigger(nt.error))}_appendParams(r,s){if(Object.keys(s).length===0)return r;const a=r.match(/\?/)?"&":"?",n=new URLSearchParams(s);return`${r}${a}${n}`}_workerObjectUrl(r){let s;if(r)s=r;else{const a=new Blob([x0],{type:"application/javascript"});s=URL.createObjectURL(a)}return s}}class y0{constructor(r,s,a){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=kr.connecting,this.send=()=>{},this.url=null,this.url=r,this.close=a.close}}class ii extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function $e(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class b0 extends ii{constructor(r,s){super(r),this.name="StorageApiError",this.status=s}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class kn extends ii{constructor(r,s){super(r),this.name="StorageUnknownError",this.originalError=s}}var v0=function(t,r,s,a){function n(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(a.next(d))}catch(m){o(m)}}function c(d){try{u(a.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((a=a.apply(t,r||[])).next())})};const Gl=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...s)=>Cr(async()=>{const{default:a}=await Promise.resolve().then(()=>Mr);return{default:a}},void 0).then(({default:a})=>a(...s)):r=fetch,(...s)=>r(...s)},w0=()=>v0(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Cr(()=>Promise.resolve().then(()=>Mr),void 0)).Response:Response}),jn=t=>{if(Array.isArray(t))return t.map(s=>jn(s));if(typeof t=="function"||t!==Object(t))return t;const r={};return Object.entries(t).forEach(([s,a])=>{const n=s.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));r[n]=jn(a)}),r};var cr=function(t,r,s,a){function n(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(a.next(d))}catch(m){o(m)}}function c(d){try{u(a.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((a=a.apply(t,r||[])).next())})};const Wa=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),k0=(t,r,s)=>cr(void 0,void 0,void 0,function*(){const a=yield w0();t instanceof a&&!(s!=null&&s.noResolveJson)?t.json().then(n=>{r(new b0(Wa(n),t.status||500))}).catch(n=>{r(new kn(Wa(n),n))}):r(new kn(Wa(t),t))}),j0=(t,r,s,a)=>{const n={method:t,headers:(r==null?void 0:r.headers)||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},r==null?void 0:r.headers),a&&(n.body=JSON.stringify(a)),Object.assign(Object.assign({},n),s))};function ys(t,r,s,a,n,i){return cr(this,void 0,void 0,function*(){return new Promise((o,l)=>{t(s,j0(r,a,n,i)).then(c=>{if(!c.ok)throw c;return a!=null&&a.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>k0(c,l,a))})})}function ea(t,r,s,a){return cr(this,void 0,void 0,function*(){return ys(t,"GET",r,s,a)})}function Ut(t,r,s,a,n){return cr(this,void 0,void 0,function*(){return ys(t,"POST",r,a,n,s)})}function N0(t,r,s,a,n){return cr(this,void 0,void 0,function*(){return ys(t,"PUT",r,a,n,s)})}function _0(t,r,s,a){return cr(this,void 0,void 0,function*(){return ys(t,"HEAD",r,Object.assign(Object.assign({},s),{noResolveJson:!0}),a)})}function Kl(t,r,s,a,n){return cr(this,void 0,void 0,function*(){return ys(t,"DELETE",r,a,n,s)})}var Ve=function(t,r,s,a){function n(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(a.next(d))}catch(m){o(m)}}function c(d){try{u(a.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((a=a.apply(t,r||[])).next())})};const S0={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},lo={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class E0{constructor(r,s={},a,n){this.url=r,this.headers=s,this.bucketId=a,this.fetch=Gl(n)}uploadOrUpdate(r,s,a,n){return Ve(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},lo),n);let l=Object.assign(Object.assign({},this.headers),r==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&a instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",a)):typeof FormData<"u"&&a instanceof FormData?(i=a,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=a,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(l=Object.assign(Object.assign({},l),n.headers));const u=this._removeEmptyFolders(s),d=this._getFinalPath(u),m=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:r,body:i,headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{})),g=yield m.json();return m.ok?{data:{path:u,id:g.Id,fullPath:g.Key},error:null}:{data:null,error:g}}catch(i){if($e(i))return{data:null,error:i};throw i}})}upload(r,s,a){return Ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,s,a)})}uploadToSignedUrl(r,s,a,n){return Ve(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(r),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",s);try{let c;const u=Object.assign({upsert:lo.upsert},n),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&a instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",a)):typeof FormData<"u"&&a instanceof FormData?(c=a,c.append("cacheControl",u.cacheControl)):(c=a,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const m=yield this.fetch(l.toString(),{method:"PUT",body:c,headers:d}),g=yield m.json();return m.ok?{data:{path:i,fullPath:g.Key},error:null}:{data:null,error:g}}catch(c){if($e(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(r,s){return Ve(this,void 0,void 0,function*(){try{let a=this._getFinalPath(r);const n=Object.assign({},this.headers);s!=null&&s.upsert&&(n["x-upsert"]="true");const i=yield Ut(this.fetch,`${this.url}/object/upload/sign/${a}`,{},{headers:n}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new ii("No token returned by API");return{data:{signedUrl:o.toString(),path:r,token:l},error:null}}catch(a){if($e(a))return{data:null,error:a};throw a}})}update(r,s,a){return Ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,s,a)})}move(r,s,a){return Ve(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:s,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers}),error:null}}catch(n){if($e(n))return{data:null,error:n};throw n}})}copy(r,s,a){return Ve(this,void 0,void 0,function*(){try{return{data:{path:(yield Ut(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:s,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if($e(n))return{data:null,error:n};throw n}})}createSignedUrl(r,s,a){return Ve(this,void 0,void 0,function*(){try{let n=this._getFinalPath(r),i=yield Ut(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:s},a!=null&&a.transform?{transform:a.transform}:{}),{headers:this.headers});const o=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if($e(n))return{data:null,error:n};throw n}})}createSignedUrls(r,s,a){return Ve(this,void 0,void 0,function*(){try{const n=yield Ut(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:r},{headers:this.headers}),i=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if($e(n))return{data:null,error:n};throw n}})}download(r,s){return Ve(this,void 0,void 0,function*(){const n=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(r);return{data:yield(yield ea(this.fetch,`${this.url}/${n}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if($e(l))return{data:null,error:l};throw l}})}info(r){return Ve(this,void 0,void 0,function*(){const s=this._getFinalPath(r);try{const a=yield ea(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:jn(a),error:null}}catch(a){if($e(a))return{data:null,error:a};throw a}})}exists(r){return Ve(this,void 0,void 0,function*(){const s=this._getFinalPath(r);try{return yield _0(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if($e(a)&&a instanceof kn){const n=a.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:a}}throw a}})}getPublicUrl(r,s){const a=this._getFinalPath(r),n=[],i=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";i!==""&&n.push(i);const l=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&n.push(c);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${a}${u}`)}}}remove(r){return Ve(this,void 0,void 0,function*(){try{return{data:yield Kl(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(s){if($e(s))return{data:null,error:s};throw s}})}list(r,s,a){return Ve(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},S0),s),{prefix:r||""});return{data:yield Ut(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},a),error:null}}catch(n){if($e(n))return{data:null,error:n};throw n}})}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const s=[];return r.width&&s.push(`width=${r.width}`),r.height&&s.push(`height=${r.height}`),r.resize&&s.push(`resize=${r.resize}`),r.format&&s.push(`format=${r.format}`),r.quality&&s.push(`quality=${r.quality}`),s.join("&")}}const C0="2.7.1",P0={"X-Client-Info":`storage-js/${C0}`};var hr=function(t,r,s,a){function n(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(a.next(d))}catch(m){o(m)}}function c(d){try{u(a.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((a=a.apply(t,r||[])).next())})};class T0{constructor(r,s={},a){this.url=r,this.headers=Object.assign(Object.assign({},P0),s),this.fetch=Gl(a)}listBuckets(){return hr(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if($e(r))return{data:null,error:r};throw r}})}getBucket(r){return hr(this,void 0,void 0,function*(){try{return{data:yield ea(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(s){if($e(s))return{data:null,error:s};throw s}})}createBucket(r,s={public:!1}){return hr(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/bucket`,{id:r,name:r,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if($e(a))return{data:null,error:a};throw a}})}updateBucket(r,s){return hr(this,void 0,void 0,function*(){try{return{data:yield N0(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if($e(a))return{data:null,error:a};throw a}})}emptyBucket(r){return hr(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(s){if($e(s))return{data:null,error:s};throw s}})}deleteBucket(r){return hr(this,void 0,void 0,function*(){try{return{data:yield Kl(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(s){if($e(s))return{data:null,error:s};throw s}})}}class D0 extends T0{constructor(r,s={},a){super(r,s,a)}from(r){return new E0(this.url,this.headers,r,this.fetch)}}const R0="2.49.4";let Xr="";typeof Deno<"u"?Xr="deno":typeof document<"u"?Xr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Xr="react-native":Xr="node";const A0={"X-Client-Info":`supabase-js-${Xr}/${R0}`},M0={headers:A0},O0={schema:"public"},I0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},L0={};var $0=function(t,r,s,a){function n(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(a.next(d))}catch(m){o(m)}}function c(d){try{u(a.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((a=a.apply(t,r||[])).next())})};const F0=t=>{let r;return t?r=t:typeof fetch>"u"?r=Al:r=fetch,(...s)=>r(...s)},U0=()=>typeof Headers>"u"?Ml:Headers,B0=(t,r,s)=>{const a=F0(s),n=U0();return(i,o)=>$0(void 0,void 0,void 0,function*(){var l;const c=(l=yield r())!==null&&l!==void 0?l:t;let u=new n(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),a(i,Object.assign(Object.assign({},o),{headers:u}))})};var q0=function(t,r,s,a){function n(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(a.next(d))}catch(m){o(m)}}function c(d){try{u(a.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((a=a.apply(t,r||[])).next())})};function z0(t){return t.replace(/\/$/,"")}function W0(t,r){const{db:s,auth:a,realtime:n,global:i}=t,{db:o,auth:l,realtime:c,global:u}=r,d={db:Object.assign(Object.assign({},o),s),auth:Object.assign(Object.assign({},l),a),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},u),i),accessToken:()=>q0(this,void 0,void 0,function*(){return""})};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}const Jl="2.69.1",br=30*1e3,Nn=3,Va=Nn*br,V0="http://localhost:9999",H0="supabase.auth.token",Y0={"X-Client-Info":`gotrue-js/${Jl}`},_n="X-Supabase-Api-Version",Xl={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},G0=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,K0=6e5;class oi extends Error{constructor(r,s,a){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=a}}function be(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class J0 extends oi{constructor(r,s,a){super(r,s,a),this.name="AuthApiError",this.status=s,this.code=a}}function X0(t){return be(t)&&t.name==="AuthApiError"}class Ql extends oi{constructor(r,s){super(r),this.name="AuthUnknownError",this.originalError=s}}class Qt extends oi{constructor(r,s,a,n){super(r,a,n),this.name=s,this.status=a}}class Lt extends Qt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Q0(t){return be(t)&&t.name==="AuthSessionMissingError"}class Ha extends Qt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ss extends Qt{constructor(r){super(r,"AuthInvalidCredentialsError",400,void 0)}}class Es extends Qt{constructor(r,s=null){super(r,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Z0(t){return be(t)&&t.name==="AuthImplicitGrantRedirectError"}class co extends Qt{constructor(r,s=null){super(r,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Sn extends Qt{constructor(r,s){super(r,"AuthRetryableFetchError",s,void 0)}}function Ya(t){return be(t)&&t.name==="AuthRetryableFetchError"}class uo extends Qt{constructor(r,s,a){super(r,"AuthWeakPasswordError",s,"weak_password"),this.reasons=a}}class rs extends Qt{constructor(r){super(r,"AuthInvalidJwtError",400,"invalid_jwt")}}const ho="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),mo=` 	
\r=`.split(""),eg=(()=>{const t=new Array(128);for(let r=0;r<t.length;r+=1)t[r]=-1;for(let r=0;r<mo.length;r+=1)t[mo[r].charCodeAt(0)]=-2;for(let r=0;r<ho.length;r+=1)t[ho[r].charCodeAt(0)]=r;return t})();function Zl(t,r,s){const a=eg[t];if(a>-1)for(r.queue=r.queue<<6|a,r.queuedBits+=6;r.queuedBits>=8;)s(r.queue>>r.queuedBits-8&255),r.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function go(t){const r=[],s=o=>{r.push(String.fromCodePoint(o))},a={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{sg(o,a,s)};for(let o=0;o<t.length;o+=1)Zl(t.charCodeAt(o),n,i);return r.join("")}function tg(t,r){if(t<=127){r(t);return}else if(t<=2047){r(192|t>>6),r(128|t&63);return}else if(t<=65535){r(224|t>>12),r(128|t>>6&63),r(128|t&63);return}else if(t<=1114111){r(240|t>>18),r(128|t>>12&63),r(128|t>>6&63),r(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function rg(t,r){for(let s=0;s<t.length;s+=1){let a=t.charCodeAt(s);if(a>55295&&a<=56319){const n=(a-55296)*1024&65535;a=(t.charCodeAt(s+1)-56320&65535|n)+65536,s+=1}tg(a,r)}}function sg(t,r,s){if(r.utf8seq===0){if(t<=127){s(t);return}for(let a=1;a<6;a+=1)if(!(t>>7-a&1)){r.utf8seq=a;break}if(r.utf8seq===2)r.codepoint=t&31;else if(r.utf8seq===3)r.codepoint=t&15;else if(r.utf8seq===4)r.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");r.utf8seq-=1}else if(r.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");r.codepoint=r.codepoint<<6|t&63,r.utf8seq-=1,r.utf8seq===0&&s(r.codepoint)}}function ag(t){const r=[],s={queue:0,queuedBits:0},a=n=>{r.push(n)};for(let n=0;n<t.length;n+=1)Zl(t.charCodeAt(n),s,a);return new Uint8Array(r)}function ng(t){const r=[];return rg(t,s=>r.push(s)),new Uint8Array(r)}function ig(t){return Math.round(Date.now()/1e3)+t}function og(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const r=Math.random()*16|0;return(t=="x"?r:r&3|8).toString(16)})}const ht=()=>typeof window<"u"&&typeof document<"u",rr={tested:!1,writable:!1},ss=()=>{if(!ht())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(rr.tested)return rr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),rr.tested=!0,rr.writable=!0}catch{rr.tested=!0,rr.writable=!1}return rr.writable};function lg(t){const r={},s=new URL(t);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((n,i)=>{r[i]=n})}catch{}return s.searchParams.forEach((a,n)=>{r[n]=a}),r}const ec=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...s)=>Cr(async()=>{const{default:a}=await Promise.resolve().then(()=>Mr);return{default:a}},void 0).then(({default:a})=>a(...s)):r=fetch,(...s)=>r(...s)},cg=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",tc=async(t,r,s)=>{await t.setItem(r,JSON.stringify(s))},Cs=async(t,r)=>{const s=await t.getItem(r);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Ps=async(t,r)=>{await t.removeItem(r)};class ka{constructor(){this.promise=new ka.promiseConstructor((r,s)=>{this.resolve=r,this.reject=s})}}ka.promiseConstructor=Promise;function Ga(t){const r=t.split(".");if(r.length!==3)throw new rs("Invalid JWT structure");for(let a=0;a<r.length;a++)if(!G0.test(r[a]))throw new rs("JWT not in base64url format");return{header:JSON.parse(go(r[0])),payload:JSON.parse(go(r[1])),signature:ag(r[2]),raw:{header:r[0],payload:r[1]}}}async function dg(t){return await new Promise(r=>{setTimeout(()=>r(null),t)})}function ug(t,r){return new Promise((a,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!r(i,null,o)){a(o);return}}catch(o){if(!r(i,o)){n(o);return}}})()})}function hg(t){return("0"+t.toString(16)).substr(-2)}function mg(){const r=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=s.length;let n="";for(let i=0;i<56;i++)n+=s.charAt(Math.floor(Math.random()*a));return n}return crypto.getRandomValues(r),Array.from(r,hg).join("")}async function gg(t){const s=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",s),n=new Uint8Array(a);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function fg(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const s=await gg(t);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function mr(t,r,s=!1){const a=mg();let n=a;s&&(n+="/PASSWORD_RECOVERY"),await tc(t,`${r}-code-verifier`,n);const i=await fg(a);return[i,a===i?"plain":"s256"]}const xg=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function pg(t){const r=t.headers.get(_n);if(!r||!r.match(xg))return null;try{return new Date(`${r}T00:00:00.0Z`)}catch{return null}}function yg(t){if(!t)throw new Error("Missing exp claim");const r=Math.floor(Date.now()/1e3);if(t<=r)throw new Error("JWT has expired")}function bg(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var vg=function(t,r){var s={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&r.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)r.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(s[a[n]]=t[a[n]]);return s};const sr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),wg=[502,503,504];async function fo(t){var r;if(!cg(t))throw new Sn(sr(t),0);if(wg.includes(t.status))throw new Sn(sr(t),t.status);let s;try{s=await t.json()}catch(i){throw new Ql(sr(i),i)}let a;const n=pg(t);if(n&&n.getTime()>=Xl["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?a=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(a=s.error_code),a){if(a==="weak_password")throw new uo(sr(s),t.status,((r=s.weak_password)===null||r===void 0?void 0:r.reasons)||[]);if(a==="session_not_found")throw new Lt}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new uo(sr(s),t.status,s.weak_password.reasons);throw new J0(sr(s),t.status||500,a)}const kg=(t,r,s,a)=>{const n={method:t,headers:(r==null?void 0:r.headers)||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},r==null?void 0:r.headers),n.body=JSON.stringify(a),Object.assign(Object.assign({},n),s))};async function ve(t,r,s,a){var n;const i=Object.assign({},a==null?void 0:a.headers);i[_n]||(i[_n]=Xl["2024-01-01"].name),a!=null&&a.jwt&&(i.Authorization=`Bearer ${a.jwt}`);const o=(n=a==null?void 0:a.query)!==null&&n!==void 0?n:{};a!=null&&a.redirectTo&&(o.redirect_to=a.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await jg(t,r,s+l,{headers:i,noResolveJson:a==null?void 0:a.noResolveJson},{},a==null?void 0:a.body);return a!=null&&a.xform?a==null?void 0:a.xform(c):{data:Object.assign({},c),error:null}}async function jg(t,r,s,a,n,i){const o=kg(r,a,n,i);let l;try{l=await t(s,Object.assign({},o))}catch(c){throw console.error(c),new Sn(sr(c),0)}if(l.ok||await fo(l),a!=null&&a.noResolveJson)return l;try{return await l.json()}catch(c){await fo(c)}}function $t(t){var r;let s=null;Eg(t)&&(s=Object.assign({},t),t.expires_at||(s.expires_at=ig(t.expires_in)));const a=(r=t.user)!==null&&r!==void 0?r:t;return{data:{session:s,user:a},error:null}}function xo(t){const r=$t(t);return!r.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0)&&(r.data.weak_password=t.weak_password),r}function Bt(t){var r;return{data:{user:(r=t.user)!==null&&r!==void 0?r:t},error:null}}function Ng(t){return{data:t,error:null}}function _g(t){const{action_link:r,email_otp:s,hashed_token:a,redirect_to:n,verification_type:i}=t,o=vg(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:r,email_otp:s,hashed_token:a,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function Sg(t){return t}function Eg(t){return t.access_token&&t.refresh_token&&t.expires_in}var Cg=function(t,r){var s={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&r.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)r.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(s[a[n]]=t[a[n]]);return s};class Pg{constructor({url:r="",headers:s={},fetch:a}){this.url=r,this.headers=s,this.fetch=ec(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(r,s="global"){try{return await ve(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(a){if(be(a))return{data:null,error:a};throw a}}async inviteUserByEmail(r,s={}){try{return await ve(this.fetch,"POST",`${this.url}/invite`,{body:{email:r,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Bt})}catch(a){if(be(a))return{data:{user:null},error:a};throw a}}async generateLink(r){try{const{options:s}=r,a=Cg(r,["options"]),n=Object.assign(Object.assign({},a),s);return"newEmail"in a&&(n.new_email=a==null?void 0:a.newEmail,delete n.newEmail),await ve(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:_g,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(be(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(r){try{return await ve(this.fetch,"POST",`${this.url}/admin/users`,{body:r,headers:this.headers,xform:Bt})}catch(s){if(be(s))return{data:{user:null},error:s};throw s}}async listUsers(r){var s,a,n,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await ve(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=r==null?void 0:r.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(i=(n=r==null?void 0:r.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Sg});if(d.error)throw d.error;const m=await d.json(),g=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,x=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return x.length>0&&(x.forEach(p=>{const f=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(p.split(";")[1].split("=")[1]);u[`${y}Page`]=f}),u.total=parseInt(g)),{data:Object.assign(Object.assign({},m),u),error:null}}catch(u){if(be(u))return{data:{users:[]},error:u};throw u}}async getUserById(r){try{return await ve(this.fetch,"GET",`${this.url}/admin/users/${r}`,{headers:this.headers,xform:Bt})}catch(s){if(be(s))return{data:{user:null},error:s};throw s}}async updateUserById(r,s){try{return await ve(this.fetch,"PUT",`${this.url}/admin/users/${r}`,{body:s,headers:this.headers,xform:Bt})}catch(a){if(be(a))return{data:{user:null},error:a};throw a}}async deleteUser(r,s=!1){try{return await ve(this.fetch,"DELETE",`${this.url}/admin/users/${r}`,{headers:this.headers,body:{should_soft_delete:s},xform:Bt})}catch(a){if(be(a))return{data:{user:null},error:a};throw a}}async _listFactors(r){try{const{data:s,error:a}=await ve(this.fetch,"GET",`${this.url}/admin/users/${r.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:s,error:a}}catch(s){if(be(s))return{data:null,error:s};throw s}}async _deleteFactor(r){try{return{data:await ve(this.fetch,"DELETE",`${this.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:this.headers}),error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}}}const Tg={getItem:t=>ss()?globalThis.localStorage.getItem(t):null,setItem:(t,r)=>{ss()&&globalThis.localStorage.setItem(t,r)},removeItem:t=>{ss()&&globalThis.localStorage.removeItem(t)}};function po(t={}){return{getItem:r=>t[r]||null,setItem:(r,s)=>{t[r]=s},removeItem:r=>{delete t[r]}}}function Dg(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const gr={debug:!!(globalThis&&ss()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class rc extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}class Rg extends rc{}async function Ag(t,r,s){gr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,r);const a=new globalThis.AbortController;return r>0&&setTimeout(()=>{a.abort(),gr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},r),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,r===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async n=>{if(n){gr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return await s()}finally{gr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}}else{if(r===0)throw gr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Rg(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(gr.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}Dg();const Mg={url:V0,storageKey:H0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Y0,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function yo(t,r,s){return await s()}class ds{constructor(r){var s,a;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ds.nextInstanceID,ds.nextInstanceID+=1,this.instanceID>0&&ht()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Mg),r);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Pg({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=ec(n.fetch),this.lock=n.lock||yo,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:ht()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=Ag:this.lock=yo,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:ss()?this.storage=Tg:(this.memoryStorage={},this.storage=po(this.memoryStorage)):(this.memoryStorage={},this.storage=po(this.memoryStorage)),ht()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...r){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Jl}) ${new Date().toISOString()}`,...r),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var r;try{const s=lg(window.location.href);let a="none";if(this._isImplicitGrantCallback(s)?a="implicit":await this._isPKCECallback(s)&&(a="pkce"),ht()&&this.detectSessionInUrl&&a!=="none"){const{data:n,error:i}=await this._getSessionFromURL(s,a);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Z0(i)){const c=(r=i.details)===null||r===void 0?void 0:r.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return be(s)?{error:s}:{error:new Ql("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(r){var s,a,n;try{const i=await ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(s=r==null?void 0:r.options)===null||s===void 0?void 0:s.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(n=r==null?void 0:r.options)===null||n===void 0?void 0:n.captchaToken}},xform:$t}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(be(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(r){var s,a,n;try{let i;if("email"in r){const{email:d,password:m,options:g}=r;let x=null,p=null;this.flowType==="pkce"&&([x,p]=await mr(this.storage,this.storageKey)),i=await ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:d,password:m,data:(s=g==null?void 0:g.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:x,code_challenge_method:p},xform:$t})}else if("phone"in r){const{phone:d,password:m,options:g}=r;i=await ve(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:m,data:(a=g==null?void 0:g.data)!==null&&a!==void 0?a:{},channel:(n=g==null?void 0:g.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:$t})}else throw new Ss("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(be(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(r){try{let s;if("email"in r){const{email:i,password:o,options:l}=r;s=await ve(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:xo})}else if("phone"in r){const{phone:i,password:o,options:l}=r;s=await ve(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:xo})}else throw new Ss("You must provide either an email or phone number and a password");const{data:a,error:n}=s;return n?{data:{user:null,session:null},error:n}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new Ha}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:n})}catch(s){if(be(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(r){var s,a,n,i;return await this._handleProviderSignIn(r.provider,{redirectTo:(s=r.options)===null||s===void 0?void 0:s.redirectTo,scopes:(a=r.options)===null||a===void 0?void 0:a.scopes,queryParams:(n=r.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=r.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(r){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(r))}async _exchangeCodeForSession(r){const s=await Cs(this.storage,`${this.storageKey}-code-verifier`),[a,n]=(s??"").split("/");try{const{data:i,error:o}=await ve(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:r,code_verifier:a},xform:$t});if(await Ps(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ha}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(be(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(r){try{const{options:s,provider:a,token:n,access_token:i,nonce:o}=r,l=await ve(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:$t}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Ha}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(s){if(be(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(r){var s,a,n,i,o;try{if("email"in r){const{email:l,options:c}=r;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await mr(this.storage,this.storageKey));const{error:m}=await ve(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(a=c==null?void 0:c.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in r){const{phone:l,options:c}=r,{data:u,error:d}=await ve(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new Ss("You must provide either an email or phone number.")}catch(l){if(be(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(r){var s,a;try{let n,i;"options"in r&&(n=(s=r.options)===null||s===void 0?void 0:s.redirectTo,i=(a=r.options)===null||a===void 0?void 0:a.captchaToken);const{data:o,error:l}=await ve(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},r),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:$t});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(r.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(n){if(be(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(r){var s,a,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await mr(this.storage,this.storageKey)),await ve(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in r?{provider_id:r.providerId}:null),"domain"in r?{domain:r.domain}:null),{redirect_to:(a=(s=r.options)===null||s===void 0?void 0:s.redirectTo)!==null&&a!==void 0?a:void 0}),!((n=r==null?void 0:r.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:r.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Ng})}catch(i){if(be(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async r=>{const{data:{session:s},error:a}=r;if(a)throw a;if(!s)throw new Lt;const{error:n}=await ve(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:n}})}catch(r){if(be(r))return{data:{user:null,session:null},error:r};throw r}}async resend(r){try{const s=`${this.url}/resend`;if("email"in r){const{email:a,type:n,options:i}=r,{error:o}=await ve(this.fetch,"POST",s,{headers:this.headers,body:{email:a,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in r){const{phone:a,type:n,options:i}=r,{data:o,error:l}=await ve(this.fetch,"POST",s,{headers:this.headers,body:{phone:a,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new Ss("You must provide either an email or phone number and a type")}catch(s){if(be(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(r,s){this._debug("#_acquireLock","begin",r);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await a,await s()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,r,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=s();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(r){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await r(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let r=null;const s=await Cs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?r=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!r)return{data:{session:null},error:null};const a=r.expires_at?r.expires_at*1e3-Date.now()<Va:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",r.expires_at),!a){if(this.storage.isServer){let o=this.suppressGetSessionWarning;r=new Proxy(r,{get:(c,u,d)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:r},error:null}}const{session:n,error:i}=await this._callRefreshToken(r.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(r){return r?await this._getUser(r):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(r){try{return r?await ve(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:r,xform:Bt}):await this._useSession(async s=>{var a,n,i;const{data:o,error:l}=s;if(l)throw l;return!(!((a=o.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Lt}:await ve(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Bt})})}catch(s){if(be(s))return Q0(s)&&(await this._removeSession(),await Ps(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(r,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(r,s))}async _updateUser(r,s={}){try{return await this._useSession(async a=>{const{data:n,error:i}=a;if(i)throw i;if(!n.session)throw new Lt;const o=n.session;let l=null,c=null;this.flowType==="pkce"&&r.email!=null&&([l,c]=await mr(this.storage,this.storageKey));const{data:u,error:d}=await ve(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},r),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Bt});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(a){if(be(a))return{data:{user:null},error:a};throw a}}async setSession(r){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(r))}async _setSession(r){try{if(!r.access_token||!r.refresh_token)throw new Lt;const s=Date.now()/1e3;let a=s,n=!0,i=null;const{payload:o}=Ga(r.access_token);if(o.exp&&(a=o.exp,n=a<=s),n){const{session:l,error:c}=await this._callRefreshToken(r.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(r.access_token);if(c)throw c;i={access_token:r.access_token,refresh_token:r.refresh_token,user:l.user,token_type:"bearer",expires_in:a-s,expires_at:a},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(s){if(be(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(r){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(r))}async _refreshSession(r){try{return await this._useSession(async s=>{var a;if(!r){const{data:o,error:l}=s;if(l)throw l;r=(a=o.session)!==null&&a!==void 0?a:void 0}if(!(r!=null&&r.refresh_token))throw new Lt;const{session:n,error:i}=await this._callRefreshToken(r.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(be(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(r,s){try{if(!ht())throw new Es("No browser detected.");if(r.error||r.error_description||r.error_code)throw new Es(r.error_description||"Error in URL with unspecified error_description",{error:r.error||"unspecified_error",code:r.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new co("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Es("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!r.code)throw new co("No code detected.");const{data:w,error:j}=await this._exchangeCodeForSession(r.code);if(j)throw j;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=r;if(!i||!l||!o||!u)throw new Es("No session defined in URL");const d=Math.round(Date.now()/1e3),m=parseInt(l);let g=d+m;c&&(g=parseInt(c));const x=g-d;x*1e3<=br&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${x}s, should have been closer to ${m}s`);const p=g-m;d-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,g,d):d-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,g,d);const{data:f,error:y}=await this._getUser(i);if(y)throw y;const v={provider_token:a,provider_refresh_token:n,access_token:i,expires_in:m,expires_at:g,refresh_token:o,token_type:u,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:r.type},error:null}}catch(a){if(be(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(r){return!!(r.access_token||r.error_description)}async _isPKCECallback(r){const s=await Cs(this.storage,`${this.storageKey}-code-verifier`);return!!(r.code&&s)}async signOut(r={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(r))}async _signOut({scope:r}={scope:"global"}){return await this._useSession(async s=>{var a;const{data:n,error:i}=s;if(i)return{error:i};const o=(a=n.session)===null||a===void 0?void 0:a.access_token;if(o){const{error:l}=await this.admin.signOut(o,r);if(l&&!(X0(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return r!=="others"&&(await this._removeSession(),await Ps(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(r){const s=og(),a={id:s,callback:r,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:a}}}async _emitInitialSession(r){return await this._useSession(async s=>{var a,n;try{const{data:{session:i},error:o}=s;if(o)throw o;await((a=this.stateChangeEmitters.get(r))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",r,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(r))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",r,"error",i),console.error(i)}})}async resetPasswordForEmail(r,s={}){let a=null,n=null;this.flowType==="pkce"&&([a,n]=await mr(this.storage,this.storageKey,!0));try{return await ve(this.fetch,"POST",`${this.url}/recover`,{body:{email:r,code_challenge:a,code_challenge_method:n,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(i){if(be(i))return{data:null,error:i};throw i}}async getUserIdentities(){var r;try{const{data:s,error:a}=await this.getUser();if(a)throw a;return{data:{identities:(r=s.user.identities)!==null&&r!==void 0?r:[]},error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}}async linkIdentity(r){var s;try{const{data:a,error:n}=await this._useSession(async i=>{var o,l,c,u,d;const{data:m,error:g}=i;if(g)throw g;const x=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,r.provider,{redirectTo:(o=r.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=r.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=r.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await ve(this.fetch,"GET",x,{headers:this.headers,jwt:(d=(u=m.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return ht()&&!(!((s=r.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(a==null?void 0:a.url),{data:{provider:r.provider,url:a==null?void 0:a.url},error:null}}catch(a){if(be(a))return{data:{provider:r.provider,url:null},error:a};throw a}}async unlinkIdentity(r){try{return await this._useSession(async s=>{var a,n;const{data:i,error:o}=s;if(o)throw o;return await ve(this.fetch,"DELETE",`${this.url}/user/identities/${r.identity_id}`,{headers:this.headers,jwt:(n=(a=i.session)===null||a===void 0?void 0:a.access_token)!==null&&n!==void 0?n:void 0})})}catch(s){if(be(s))return{data:null,error:s};throw s}}async _refreshAccessToken(r){const s=`#_refreshAccessToken(${r.substring(0,5)}...)`;this._debug(s,"begin");try{const a=Date.now();return await ug(async n=>(n>0&&await dg(200*Math.pow(2,n-1)),this._debug(s,"refreshing attempt",n),await ve(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:r},headers:this.headers,xform:$t})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Ya(i)&&Date.now()+o-a<br})}catch(a){if(this._debug(s,"error",a),be(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(s,"end")}}_isValidSession(r){return typeof r=="object"&&r!==null&&"access_token"in r&&"refresh_token"in r&&"expires_at"in r}async _handleProviderSignIn(r,s){const a=await this._getUrlForProvider(`${this.url}/authorize`,r,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",r,"options",s,"url",a),ht()&&!s.skipBrowserRedirect&&window.location.assign(a),{data:{provider:r,url:a},error:null}}async _recoverAndRefresh(){var r;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const a=await Cs(this.storage,this.storageKey);if(this._debug(s,"session from storage",a),!this._isValidSession(a)){this._debug(s,"session is not valid"),a!==null&&await this._removeSession();return}const n=((r=a.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Va;if(this._debug(s,`session has${n?"":" not"} expired with margin of ${Va}s`),n){if(this.autoRefreshToken&&a.refresh_token){const{error:i}=await this._callRefreshToken(a.refresh_token);i&&(console.error(i),Ya(i)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(s,"error",a),console.error(a);return}finally{this._debug(s,"end")}}async _callRefreshToken(r){var s,a;if(!r)throw new Lt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${r.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new ka;const{data:i,error:o}=await this._refreshAccessToken(r);if(o)throw o;if(!i.session)throw new Lt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),be(i)){const o={session:null,error:i};return Ya(i)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(o),o}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(r,s,a=!0){const n=`#_notifyAllSubscribers(${r})`;this._debug(n,"begin",s,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:r,session:s});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(r,s)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(r){this._debug("#_saveSession()",r),this.suppressGetSessionWarning=!0,await tc(this.storage,this.storageKey,r)}async _removeSession(){this._debug("#_removeSession()"),await Ps(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const r=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{r&&ht()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",r)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const r=setInterval(()=>this._autoRefreshTokenTick(),br);this.autoRefreshTicker=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const r=this.autoRefreshTicker;this.autoRefreshTicker=null,r&&clearInterval(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const r=Date.now();try{return await this._useSession(async s=>{const{data:{session:a}}=s;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((a.expires_at*1e3-r)/br);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${br}ms, refresh threshold is ${Nn} ticks`),n<=Nn&&await this._callRefreshToken(a.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(r){if(r.isAcquireTimeout||r instanceof rc)this._debug("auto refresh token tick lock not available");else throw r}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ht()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(r){console.error("_handleVisibilityChange",r)}}async _onVisibilityChanged(r){const s=`#_onVisibilityChanged(${r})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),r||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(r,s,a){const n=[`provider=${encodeURIComponent(s)}`];if(a!=null&&a.redirectTo&&n.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a!=null&&a.scopes&&n.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[i,o]=await mr(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(l.toString())}if(a!=null&&a.queryParams){const i=new URLSearchParams(a.queryParams);n.push(i.toString())}return a!=null&&a.skipBrowserRedirect&&n.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${r}?${n.join("&")}`}async _unenroll(r){try{return await this._useSession(async s=>{var a;const{data:n,error:i}=s;return i?{data:null,error:i}:await ve(this.fetch,"DELETE",`${this.url}/factors/${r.factorId}`,{headers:this.headers,jwt:(a=n==null?void 0:n.session)===null||a===void 0?void 0:a.access_token})})}catch(s){if(be(s))return{data:null,error:s};throw s}}async _enroll(r){try{return await this._useSession(async s=>{var a,n;const{data:i,error:o}=s;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:r.friendlyName,factor_type:r.factorType},r.factorType==="phone"?{phone:r.phone}:{issuer:r.issuer}),{data:c,error:u}=await ve(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(a=i==null?void 0:i.session)===null||a===void 0?void 0:a.access_token});return u?{data:null,error:u}:(r.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(be(s))return{data:null,error:s};throw s}}async _verify(r){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var a;const{data:n,error:i}=s;if(i)return{data:null,error:i};const{data:o,error:l}=await ve(this.fetch,"POST",`${this.url}/factors/${r.factorId}/verify`,{body:{code:r.code,challenge_id:r.challengeId},headers:this.headers,jwt:(a=n==null?void 0:n.session)===null||a===void 0?void 0:a.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(s){if(be(s))return{data:null,error:s};throw s}})}async _challenge(r){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var a;const{data:n,error:i}=s;return i?{data:null,error:i}:await ve(this.fetch,"POST",`${this.url}/factors/${r.factorId}/challenge`,{body:{channel:r.channel},headers:this.headers,jwt:(a=n==null?void 0:n.session)===null||a===void 0?void 0:a.access_token})})}catch(s){if(be(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(r){const{data:s,error:a}=await this._challenge({factorId:r.factorId});return a?{data:null,error:a}:await this._verify({factorId:r.factorId,challengeId:s.id,code:r.code})}async _listFactors(){const{data:{user:r},error:s}=await this.getUser();if(s)return{data:null,error:s};const a=(r==null?void 0:r.factors)||[],n=a.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=a.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:a,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async r=>{var s,a;const{data:{session:n},error:i}=r;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Ga(n.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((a=(s=n.user.factors)===null||s===void 0?void 0:s.filter(m=>m.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(c="aal2");const d=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(r,s={keys:[]}){let a=s.keys.find(o=>o.kid===r);if(a||(a=this.jwks.keys.find(o=>o.kid===r),a&&this.jwks_cached_at+K0>Date.now()))return a;const{data:n,error:i}=await ve(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new rs("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),a=n.keys.find(o=>o.kid===r),!a)throw new rs("No matching signing key found in JWKS");return a}async getClaims(r,s={keys:[]}){try{let a=r;if(!a){const{data:x,error:p}=await this.getSession();if(p||!x.session)return{data:null,error:p};a=x.session.access_token}const{header:n,payload:i,signature:o,raw:{header:l,payload:c}}=Ga(a);if(yg(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:x}=await this.getUser(a);if(x)throw x;return{data:{claims:i,header:n,signature:o},error:null}}const u=bg(n.alg),d=await this.fetchJwk(n.kid,s),m=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,m,o,ng(`${l}.${c}`)))throw new rs("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(a){if(be(a))return{data:null,error:a};throw a}}}ds.nextInstanceID=0;const Og=ds;class Ig extends Og{constructor(r){super(r)}}var Lg=function(t,r,s,a){function n(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(a.next(d))}catch(m){o(m)}}function c(d){try{u(a.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):n(d.value).then(l,c)}u((a=a.apply(t,r||[])).next())})};class $g{constructor(r,s,a){var n,i,o;if(this.supabaseUrl=r,this.supabaseKey=s,!r)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const l=z0(r);this.realtimeUrl=`${l}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${l}/auth/v1`,this.storageUrl=`${l}/storage/v1`,this.functionsUrl=`${l}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,u={db:O0,realtime:L0,auth:Object.assign(Object.assign({},I0),{storageKey:c}),global:M0},d=W0(a??{},u);this.storageKey=(n=d.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(m,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=B0(s,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new r0(`${l}/rest/v1`,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new Rm(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new D0(this.storageUrl,this.headers,this.fetch)}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,s={},a={}){return this.rest.rpc(r,s,a)}channel(r,s={config:{}}){return this.realtime.channel(r,s)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var r,s;return Lg(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:a}=yield this.auth.getSession();return(s=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:null})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:s,detectSessionInUrl:a,storage:n,storageKey:i,flowType:o,lock:l,debug:c},u,d){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ig({url:this.authUrl,headers:Object.assign(Object.assign({},m),u),storageKey:i,autoRefreshToken:r,persistSession:s,detectSessionInUrl:a,storage:n,flowType:o,lock:l,debug:c,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(r){return new p0(this.realtimeUrl,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},r==null?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,a)=>{this._handleTokenChanged(s,"CLIENT",a==null?void 0:a.access_token)})}_handleTokenChanged(r,s,a){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==a?this.changedAccessToken=a:r==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Fg=(t,r,s)=>new $g(t,r,s),Ug="https://phcqdnzuicgmlhkmnpxc.supabase.co",Bg="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBoY3Fkbnp1aWNnbWxoa21ucHhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxMjYyMzgsImV4cCI6MjA1OTcwMjIzOH0.1k7T17BSx7lvIcOLG2_qxNXpcb7FpvvoEkJUO97_HYI",U=Fg(Ug,Bg),sc=h.createContext(void 0),Wr=async(t,r=3,s=1e3)=>{var i,o,l,c;let a=0,n=s;for(;;)try{return await t()}catch(u){if((i=u.message)!=null&&i.includes("refresh_token_not_found")||(l=(o=u.error)==null?void 0:o.message)!=null&&l.includes("refresh_token_not_found")||u.error==="invalid_grant"||u.statusText==="Bad Request"&&u.status===400)throw console.warn("Invalid refresh token detected, forcing sign out"),u;if(((c=u.message)!=null&&c.includes("rate_limit")||u.status===429)&&a<r)a++,console.log(`Retry ${a}/${r} after ${n}ms delay`),await new Promise(d=>setTimeout(d,n)),n*=2;else throw u}},qg=({children:t})=>{const[r,s]=h.useState(null),[a,n]=h.useState(null),[i,o]=h.useState(null),[l,c]=h.useState(!0),u=h.useRef(!1),d=h.useRef(!1),m=h.useRef(!1),g=h.useRef(!1),x=async I=>{var C;try{const{data:A,error:B}=await U.from("users").select("*").eq("id",I).single();return B?B.code==="PGRST116"||(C=B.message)!=null&&C.includes("no rows")?(console.warn("No user data found for user ID:",I),null):(console.error("Error fetching user data:",B),null):(o(A),A)}catch(A){return console.error("Unexpected error fetching user data:",A),null}},p=async()=>{console.log("Handling signed out state..."),s(null),n(null),o(null);try{await U.auth.signOut()}catch(I){console.error("Error during cleanup signOut:",I)}},f=async()=>{var I,C,A;if(g.current){console.log("Session refresh already in progress, skipping");return}try{g.current=!0,console.log("Refreshing session...");const{data:{session:B}}=await U.auth.getSession();if(!B){console.log("No current session to refresh"),await p();return}try{const{data:D}=await Wr(async()=>await U.auth.refreshSession(),2,1e3),L=D.session;L?(console.log("Session refreshed successfully"),s(L),n(L.user),L.user&&await x(L.user.id)):(console.log("No session returned from refresh"),await p())}catch(D){console.error("Error refreshing session:",D),((I=D.message)!=null&&I.includes("refresh_token_not_found")||(A=(C=D.error)==null?void 0:C.message)!=null&&A.includes("refresh_token_not_found")||D.error==="invalid_grant"||D.statusText==="Bad Request"&&D.status===400)&&(console.warn("Invalid refresh token, signing out user"),await p())}}catch(B){console.error("Error in refreshSession:",B)}finally{g.current=!1}},y=async()=>{if(!m.current){m.current=!0;try{const C=new URLSearchParams(window.location.search).get("token");if(!C)return;console.log("Found token in URL, attempting to sign in..."),c(!0);const{data:A,error:B}=await U.auth.setSession({access_token:C,refresh_token:""});if(B){console.error("Error signing in with token:",B);return}A.session&&(console.log("Successfully signed in with token"),s(A.session),n(A.session.user),A.session.user&&await x(A.session.user.id));const D=new URL(window.location.href);D.searchParams.delete("token"),window.history.replaceState({},document.title,D.toString())}catch(I){console.error("Unexpected error in token auth:",I)}finally{c(!1)}}};h.useEffect(()=>{(async()=>{var C,A,B;try{await y();const{data:{session:D}}=await U.auth.getSession();if(D!=null&&D.user){s(D),n(D.user);const L=await x(D.user.id);if(L!=null&&L.user_role)try{const{data:N}=await Wr(async()=>await U.auth.refreshSession(),2);N.session&&s(N.session)}catch(N){console.error("Error refreshing session during init:",N),((C=N.message)!=null&&C.includes("refresh_token_not_found")||(B=(A=N.error)==null?void 0:A.message)!=null&&B.includes("refresh_token_not_found")||N.error==="invalid_grant"||N.statusText==="Bad Request"&&N.status===400)&&(console.warn("Invalid refresh token during init, signing out user"),await p())}}}catch(D){console.error("Error initializing auth:",D)}finally{c(!1),u.current=!0}})()},[]),h.useEffect(()=>{if(!u.current||d.current)return;const{data:{subscription:I}}=U.auth.onAuthStateChange(async(C,A)=>{var B,D,L;if(console.log("Auth state change:",C),C==="SIGNED_OUT"||C==="USER_DELETED")await p();else if(A!=null&&A.user&&(s(A),n(A.user),!i||C==="SIGNED_IN"||C==="USER_UPDATED")){const N=await x(A.user.id);if(N!=null&&N.user_role)try{const{data:O}=await Wr(async()=>await U.auth.refreshSession());O.session&&s(O.session)}catch(O){console.error("Error refreshing session after auth change:",O),((B=O.message)!=null&&B.includes("refresh_token_not_found")||(L=(D=O.error)==null?void 0:D.message)!=null&&L.includes("refresh_token_not_found")||O.error==="invalid_grant"||O.statusText==="Bad Request"&&O.status===400)&&(console.warn("Invalid refresh token after auth change, signing out user"),await p())}}c(!1)});return d.current=!0,()=>{I.unsubscribe(),d.current=!1}},[i]);const k={session:r,user:a,userData:i,loading:l,signUp:async(I,C,A,B,D)=>{try{c(!0),console.log("Signup with invite code:",D);let L=null;if(D){const{data:z,error:W}=await U.from("invite_links").select("*").eq("code",D).eq("status","active").single();if(W)throw console.error("Error validating invite code:",W),new Error("Invalid or expired invite code");if(z.expires_at&&new Date(z.expires_at)<new Date)throw await U.from("invite_links").update({status:"expired"}).eq("id",z.id),new Error("This invite link has expired");L=z,console.log("Valid invite data:",L)}const N={name:A.trim(),phone:B?B.trim():null};D&&(N.invite=D.trim()),console.log("Signup metadata being sent:",N);const{data:O,error:E}=await U.auth.signUp({email:I.trim(),password:C,options:{data:N}});if(E)throw console.error("Supabase signup error:",E),E;if(!O.user)throw new Error("User creation failed");if(D&&L&&O.user)try{const z=O.user.id;console.log("Updating invite link status for new user:",z),await U.auth.signOut();const{error:W}=await U.from("invite_links").update({status:"used",used_at:new Date().toISOString(),used_by:z}).eq("id",L.id).eq("status","active");if(W?console.error("Error updating invite link status:",W):console.log("Successfully updated invite link status"),await U.auth.signInWithPassword({email:I.trim(),password:C}),L.role){console.log("Setting user role from invite:",L.role);const{error:V}=await U.from("users").update({user_role:L.role}).eq("id",z);V?console.error("Error updating user role:",V):console.log("Successfully updated user role")}}catch(z){console.error("Unexpected error updating invite status:",z)}return{error:null,data:O}}catch(L){return console.error("Sign up error:",L),{error:L}}finally{c(!1)}},signIn:async(I,C)=>{var A,B,D;try{c(!0);const{data:L,error:N}=await U.auth.signInWithPassword({email:I,password:C});if(N)throw N;if(L.session){s(L.session),n(L.session.user);const O=await x(L.session.user.id);if(O!=null&&O.user_role)try{const{data:E}=await Wr(async()=>await U.auth.refreshSession());E.session&&s(E.session)}catch(E){if(console.error("Error refreshing session after sign in:",E),(A=E.message)!=null&&A.includes("refresh_token_not_found")||(D=(B=E.error)==null?void 0:B.message)!=null&&D.includes("refresh_token_not_found")||E.error==="invalid_grant"||E.statusText==="Bad Request"&&E.status===400)throw console.warn("Invalid refresh token after sign in, signing out user"),await p(),new Error("Session refresh failed. Please try signing in again.")}}return{error:null,session:L.session}}catch(L){return console.error("Sign in error:",L),{error:L,session:null}}finally{c(!1)}},signOut:async()=>{try{c(!0),await p()}catch(I){console.error("Error signing out:",I)}finally{c(!1)}},updateUserData:async I=>{var C,A,B;if(!a)return{error:new Error("User not authenticated"),data:null};try{const{data:D,error:L}=await U.from("users").update(I).eq("id",a.id).select().single();if(L)throw L;if(o(D),"user_role"in I)try{const{data:N}=await Wr(async()=>await U.auth.refreshSession());N.session&&s(N.session)}catch(N){if(console.error("Error refreshing session after user data update:",N),(C=N.message)!=null&&C.includes("refresh_token_not_found")||(B=(A=N.error)==null?void 0:A.message)!=null&&B.includes("refresh_token_not_found")||N.error==="invalid_grant"||N.statusText==="Bad Request"&&N.status===400)throw console.warn("Invalid refresh token after user data update, signing out user"),await p(),new Error("Session refresh failed. Please sign in again.")}return{error:null,data:D}}catch(D){return console.error("Error updating user data:",D),{error:D,data:null}}},refreshSession:f};return e.jsx(sc.Provider,{value:k,children:t})},je=()=>{const t=h.useContext(sc);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},ac=h.createContext(void 0),zg=({children:t})=>{const[r,s]=h.useState(()=>{if(typeof window>"u")return"light";const n=localStorage.getItem("theme");return n==="light"||n==="dark"?n:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"});h.useEffect(()=>{if(typeof window>"u")return;localStorage.setItem("theme",r);const n=document.documentElement;n.classList.remove("light","dark"),r==="dark"&&n.classList.add("dark"),console.log("Theme updated to:",r,"Dark class present:",n.classList.contains("dark"))},[r]);const a=()=>{const n=r==="light"?"dark":"light";s(n),localStorage.setItem("theme",n);const i=document.documentElement;i.classList.remove("light","dark"),n==="dark"&&i.classList.add("dark"),console.log("Theme toggled to:",n)};return e.jsx(ac.Provider,{value:{theme:r,toggleTheme:a},children:t})},ja=()=>{const t=h.useContext(ac);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t},Na=({hideSignIn:t=!1})=>{const[r,s]=h.useState(!1),[a,n]=h.useState(!1),i=Xt(),o=vt(),{user:l,userData:c,loading:u,signOut:d}=je(),{theme:m}=ja(),g=()=>{const f=o.pathname;return f.startsWith("/admin")?"Admin Portal":f.startsWith("/partner")?"Driver Portal":""},x=async()=>{try{await d(),s(!1),i("/login")}catch(f){console.error("Error during logout:",f),s(!1),i("/login")}},p=()=>{n(!0),window.location.reload()};return h.useEffect(()=>{const f=y=>{const v=y.target;r&&!v.closest("#user-menu-button")&&!v.closest("#user-menu")&&s(!1)};return document.addEventListener("click",f),()=>{document.removeEventListener("click",f)}},[r]),e.jsx("header",{className:"fixed top-0 left-0 right-0 bg-white dark:bg-gray-800 shadow-md z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-20",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>i((c==null?void 0:c.user_role)==="admin"?"/admin":"/partner"),className:"flex items-center focus:outline-none h-[70px] py-[4px]",children:[e.jsx("div",{className:"block dark:hidden h-full",children:e.jsxs("picture",{className:"h-full w-auto",children:[e.jsx("source",{srcSet:"https://i.imghippo.com/files/cDgm3025PmI.webp",type:"image/webp"}),e.jsx("img",{src:"https://i.imgur.com/991MInn.png",alt:"Royal Transfer EU Logo",className:"h-full w-auto object-contain"})]})}),e.jsx("div",{className:"hidden dark:block h-full",children:e.jsxs("picture",{className:"h-full w-auto",children:[e.jsx("source",{srcSet:"https://i.imghippo.com/files/SUQ5630UJo.webp",type:"image/webp"}),e.jsx("img",{src:"https://i.imghippo.com/files/SUQ5630UJo.webp",alt:"Royal Transfer EU Logo",className:"h-full w-auto object-contain"})]})})]}),c&&e.jsx("div",{className:"hidden md:block text-gray-700 dark:text-gray-200",children:e.jsx("span",{className:"font-semibold",children:g()})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[l&&e.jsx("button",{onClick:p,disabled:a,className:"flex items-center justify-center h-10 w-10 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"Refresh",children:e.jsx(Qe,{className:`h-5 w-5 ${a?"animate-spin":""}`})}),!t&&(u?e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-blue-600 animate-spin"})}):l?e.jsxs("div",{className:"relative",children:[e.jsx("button",{id:"user-menu-button",onClick:()=>s(!r),className:"flex items-center justify-center h-10 w-10 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:e.jsx(Je,{className:"h-5 w-5"})}),r&&e.jsxs("div",{id:"user-menu",className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-10 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"px-4 py-2 text-sm font-medium text-gray-900 dark:text-gray-100 border-b dark:border-gray-700",children:[(c==null?void 0:c.name)||"User",(c==null?void 0:c.user_role)&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:c.user_role})]}),(c==null?void 0:c.user_role)==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pt-1 pb-1 px-3 text-xs font-medium text-gray-500 dark:text-gray-400",children:"Switch Portal"}),e.jsx("button",{onClick:()=>i("/admin"),className:`block w-full text-left px-4 py-2 text-sm ${o.pathname.startsWith("/admin")?"bg-gray-100 dark:bg-gray-700 text-blue-600 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:"Admin Portal"}),e.jsx("button",{onClick:()=>i("/partner"),className:`block w-full text-left px-4 py-2 text-sm ${o.pathname.startsWith("/partner")?"bg-gray-100 dark:bg-gray-700 text-blue-600 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:"Driver Portal"}),e.jsx("div",{className:"my-1 border-t dark:border-gray-700"})]}),e.jsx("button",{onClick:x,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Sign out"})]})]}):e.jsx("button",{onClick:()=>i("/login"),className:"hidden md:inline-flex border border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-500 px-[calc(1.5rem-1px)] py-[calc(0.5rem-1px)] rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/30 transition-all duration-300 box-border",children:"Sign In"}))]})]})})})},_a=({className:t=""})=>{const{theme:r,toggleTheme:s}=ja(),a=n=>{n.preventDefault(),n.stopPropagation(),console.log("Toggle clicked, current theme:",r),s()};return e.jsxs("button",{onClick:a,type:"button",className:`p-2 rounded-md transition-colors ${r==="dark"?"bg-gray-700 text-yellow-300 hover:bg-gray-600":"bg-gray-100 text-gray-800 hover:bg-gray-200"} ${t}`,"aria-label":r==="dark"?"Switch to light mode":"Switch to dark mode",title:r==="dark"?"Switch to light mode":"Switch to dark mode",children:[r==="dark"?e.jsx(ll,{className:"h-5 w-5"}):e.jsx(cl,{className:"h-5 w-5"}),e.jsxs("span",{className:"sr-only",children:[r==="dark"?"Light":"Dark"," mode"]})]})},Wg=3;let Ka=0;function Vg(){return Ka=(Ka+1)%Number.MAX_VALUE,Ka.toString()}const Hg=new Map,bo=(t,r)=>{Hg.has(t)},Yg=(t,r)=>{switch(r.type){case"ADD_TOAST":return{...t,toasts:[r.toast,...t.toasts].slice(0,Wg)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(s=>s.id===r.toast.id?{...s,...r.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=r;return s?bo(s):t.toasts.forEach(a=>{bo(a.id)}),{...t,toasts:t.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return r.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(s=>s.id!==r.toastId)}}},Ws=[];let Vs={toasts:[]};function Hs(t){Vs=Yg(Vs,t),Ws.forEach(r=>{r(Vs)})}function En({...t}){const r=Vg(),s=n=>Hs({type:"UPDATE_TOAST",toast:{...n,id:r}}),a=()=>Hs({type:"DISMISS_TOAST",toastId:r});return Hs({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:n=>{n||a()}}}),{id:r,dismiss:a,update:s}}function Pe(){const[t,r]=h.useState(Vs);return h.useEffect(()=>(Ws.push(r),()=>{const s=Ws.indexOf(r);s>-1&&Ws.splice(s,1)}),[t]),{...t,toast:En,dismiss:s=>Hs({type:"DISMISS_TOAST",toastId:s})}}function xe(t,r,{checkForDefaultPrevented:s=!0}={}){return function(n){if(t==null||t(n),s===!1||!n.defaultPrevented)return r==null?void 0:r(n)}}function vo(t,r){if(typeof t=="function")return t(r);t!=null&&(t.current=r)}function Sa(...t){return r=>{let s=!1;const a=t.map(n=>{const i=vo(n,r);return!s&&typeof i=="function"&&(s=!0),i});if(s)return()=>{for(let n=0;n<a.length;n++){const i=a[n];typeof i=="function"?i():vo(t[n],null)}}}}function ze(...t){return h.useCallback(Sa(...t),t)}function Ir(t,r=[]){let s=[];function a(i,o){const l=h.createContext(o),c=s.length;s=[...s,o];const u=m=>{var v;const{scope:g,children:x,...p}=m,f=((v=g==null?void 0:g[t])==null?void 0:v[c])||l,y=h.useMemo(()=>p,Object.values(p));return e.jsx(f.Provider,{value:y,children:x})};u.displayName=i+"Provider";function d(m,g){var f;const x=((f=g==null?void 0:g[t])==null?void 0:f[c])||l,p=h.useContext(x);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${m}\` must be used within \`${i}\``)}return[u,d]}const n=()=>{const i=s.map(o=>h.createContext(o));return function(l){const c=(l==null?void 0:l[t])||i;return h.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return n.scopeName=t,[a,Gg(n,...r)]}function Gg(...t){const r=t[0];if(t.length===1)return r;const s=()=>{const a=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const o=a.reduce((l,{useScope:c,scopeName:u})=>{const m=c(i)[`__scope${u}`];return{...l,...m}},{});return h.useMemo(()=>({[`__scope${r.scopeName}`]:o}),[o])}};return s.scopeName=r.scopeName,s}function ta(t){const r=Kg(t),s=h.forwardRef((a,n)=>{const{children:i,...o}=a,l=h.Children.toArray(i),c=l.find(Xg);if(c){const u=c.props.children,d=l.map(m=>m===c?h.Children.count(u)>1?h.Children.only(null):h.isValidElement(u)?u.props.children:null:m);return e.jsx(r,{...o,ref:n,children:h.isValidElement(u)?h.cloneElement(u,void 0,d):null})}return e.jsx(r,{...o,ref:n,children:i})});return s.displayName=`${t}.Slot`,s}function Kg(t){const r=h.forwardRef((s,a)=>{const{children:n,...i}=s;if(h.isValidElement(n)){const o=Zg(n),l=Qg(i,n.props);return n.type!==h.Fragment&&(l.ref=a?Sa(a,o):o),h.cloneElement(n,l)}return h.Children.count(n)>1?h.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var Jg=Symbol("radix.slottable");function Xg(t){return h.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Jg}function Qg(t,r){const s={...r};for(const a in r){const n=t[a],i=r[a];/^on[A-Z]/.test(a)?n&&i?s[a]=(...l)=>{i(...l),n(...l)}:n&&(s[a]=n):a==="style"?s[a]={...n,...i}:a==="className"&&(s[a]=[n,i].filter(Boolean).join(" "))}return{...t,...s}}function Zg(t){var a,n;let r=(a=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:a.get,s=r&&"isReactWarning"in r&&r.isReactWarning;return s?t.ref:(r=(n=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}function li(t){const r=t+"CollectionProvider",[s,a]=Ir(r),[n,i]=s(r,{collectionRef:{current:null},itemMap:new Map}),o=f=>{const{scope:y,children:v}=f,w=et.useRef(null),j=et.useRef(new Map).current;return e.jsx(n,{scope:y,itemMap:j,collectionRef:w,children:v})};o.displayName=r;const l=t+"CollectionSlot",c=ta(l),u=et.forwardRef((f,y)=>{const{scope:v,children:w}=f,j=i(l,v),b=ze(y,j.collectionRef);return e.jsx(c,{ref:b,children:w})});u.displayName=l;const d=t+"CollectionItemSlot",m="data-radix-collection-item",g=ta(d),x=et.forwardRef((f,y)=>{const{scope:v,children:w,...j}=f,b=et.useRef(null),k=ze(y,b),I=i(d,v);return et.useEffect(()=>(I.itemMap.set(b,{ref:b,...j}),()=>void I.itemMap.delete(b))),e.jsx(g,{[m]:"",ref:k,children:w})});x.displayName=d;function p(f){const y=i(t+"CollectionConsumer",f);return et.useCallback(()=>{const w=y.collectionRef.current;if(!w)return[];const j=Array.from(w.querySelectorAll(`[${m}]`));return Array.from(y.itemMap.values()).sort((I,C)=>j.indexOf(I.ref.current)-j.indexOf(C.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:o,Slot:u,ItemSlot:x},p,a]}var ef=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Me=ef.reduce((t,r)=>{const s=ta(`Primitive.${r}`),a=h.forwardRef((n,i)=>{const{asChild:o,...l}=n,c=o?s:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(c,{...l,ref:i})});return a.displayName=`Primitive.${r}`,{...t,[r]:a}},{});function ci(t,r){t&&ua.flushSync(()=>t.dispatchEvent(r))}function Ze(t){const r=h.useRef(t);return h.useEffect(()=>{r.current=t}),h.useMemo(()=>(...s)=>{var a;return(a=r.current)==null?void 0:a.call(r,...s)},[])}function tf(t,r=globalThis==null?void 0:globalThis.document){const s=Ze(t);h.useEffect(()=>{const a=n=>{n.key==="Escape"&&s(n)};return r.addEventListener("keydown",a,{capture:!0}),()=>r.removeEventListener("keydown",a,{capture:!0})},[s,r])}var rf="DismissableLayer",Cn="dismissableLayer.update",sf="dismissableLayer.pointerDownOutside",af="dismissableLayer.focusOutside",wo,nc=h.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),di=h.forwardRef((t,r)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:a,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:l,...c}=t,u=h.useContext(nc),[d,m]=h.useState(null),g=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,x]=h.useState({}),p=ze(r,C=>m(C)),f=Array.from(u.layers),[y]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),v=f.indexOf(y),w=d?f.indexOf(d):-1,j=u.layersWithOutsidePointerEventsDisabled.size>0,b=w>=v,k=of(C=>{const A=C.target,B=[...u.branches].some(D=>D.contains(A));!b||B||(n==null||n(C),o==null||o(C),C.defaultPrevented||l==null||l())},g),I=lf(C=>{const A=C.target;[...u.branches].some(D=>D.contains(A))||(i==null||i(C),o==null||o(C),C.defaultPrevented||l==null||l())},g);return tf(C=>{w===u.layers.size-1&&(a==null||a(C),!C.defaultPrevented&&l&&(C.preventDefault(),l()))},g),h.useEffect(()=>{if(d)return s&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(wo=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),ko(),()=>{s&&u.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=wo)}},[d,g,s,u]),h.useEffect(()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),ko())},[d,u]),h.useEffect(()=>{const C=()=>x({});return document.addEventListener(Cn,C),()=>document.removeEventListener(Cn,C)},[]),e.jsx(Me.div,{...c,ref:p,style:{pointerEvents:j?b?"auto":"none":void 0,...t.style},onFocusCapture:xe(t.onFocusCapture,I.onFocusCapture),onBlurCapture:xe(t.onBlurCapture,I.onBlurCapture),onPointerDownCapture:xe(t.onPointerDownCapture,k.onPointerDownCapture)})});di.displayName=rf;var nf="DismissableLayerBranch",ic=h.forwardRef((t,r)=>{const s=h.useContext(nc),a=h.useRef(null),n=ze(r,a);return h.useEffect(()=>{const i=a.current;if(i)return s.branches.add(i),()=>{s.branches.delete(i)}},[s.branches]),e.jsx(Me.div,{...t,ref:n})});ic.displayName=nf;function of(t,r=globalThis==null?void 0:globalThis.document){const s=Ze(t),a=h.useRef(!1),n=h.useRef(()=>{});return h.useEffect(()=>{const i=l=>{if(l.target&&!a.current){let c=function(){oc(sf,s,u,{discrete:!0})};const u={originalEvent:l};l.pointerType==="touch"?(r.removeEventListener("click",n.current),n.current=c,r.addEventListener("click",n.current,{once:!0})):c()}else r.removeEventListener("click",n.current);a.current=!1},o=window.setTimeout(()=>{r.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),r.removeEventListener("pointerdown",i),r.removeEventListener("click",n.current)}},[r,s]),{onPointerDownCapture:()=>a.current=!0}}function lf(t,r=globalThis==null?void 0:globalThis.document){const s=Ze(t),a=h.useRef(!1);return h.useEffect(()=>{const n=i=>{i.target&&!a.current&&oc(af,s,{originalEvent:i},{discrete:!1})};return r.addEventListener("focusin",n),()=>r.removeEventListener("focusin",n)},[r,s]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function ko(){const t=new CustomEvent(Cn);document.dispatchEvent(t)}function oc(t,r,s,{discrete:a}){const n=s.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:s});r&&n.addEventListener(t,r,{once:!0}),a?ci(n,i):n.dispatchEvent(i)}var cf=di,df=ic,St=globalThis!=null&&globalThis.document?h.useLayoutEffect:()=>{},uf="Portal",ui=h.forwardRef((t,r)=>{var l;const{container:s,...a}=t,[n,i]=h.useState(!1);St(()=>i(!0),[]);const o=s||n&&((l=globalThis==null?void 0:globalThis.document)==null?void 0:l.body);return o?Hu.createPortal(e.jsx(Me.div,{...a,ref:r}),o):null});ui.displayName=uf;function hf(t,r){return h.useReducer((s,a)=>r[s][a]??s,t)}var Lr=t=>{const{present:r,children:s}=t,a=mf(r),n=typeof s=="function"?s({present:a.isPresent}):h.Children.only(s),i=ze(a.ref,gf(n));return typeof s=="function"||a.isPresent?h.cloneElement(n,{ref:i}):null};Lr.displayName="Presence";function mf(t){const[r,s]=h.useState(),a=h.useRef(null),n=h.useRef(t),i=h.useRef("none"),o=t?"mounted":"unmounted",[l,c]=hf(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return h.useEffect(()=>{const u=Ts(a.current);i.current=l==="mounted"?u:"none"},[l]),St(()=>{const u=a.current,d=n.current;if(d!==t){const g=i.current,x=Ts(u);t?c("MOUNT"):x==="none"||(u==null?void 0:u.display)==="none"?c("UNMOUNT"):c(d&&g!==x?"ANIMATION_OUT":"UNMOUNT"),n.current=t}},[t,c]),St(()=>{if(r){let u;const d=r.ownerDocument.defaultView??window,m=x=>{const f=Ts(a.current).includes(x.animationName);if(x.target===r&&f&&(c("ANIMATION_END"),!n.current)){const y=r.style.animationFillMode;r.style.animationFillMode="forwards",u=d.setTimeout(()=>{r.style.animationFillMode==="forwards"&&(r.style.animationFillMode=y)})}},g=x=>{x.target===r&&(i.current=Ts(a.current))};return r.addEventListener("animationstart",g),r.addEventListener("animationcancel",m),r.addEventListener("animationend",m),()=>{d.clearTimeout(u),r.removeEventListener("animationstart",g),r.removeEventListener("animationcancel",m),r.removeEventListener("animationend",m)}}else c("ANIMATION_END")},[r,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:h.useCallback(u=>{a.current=u?getComputedStyle(u):null,s(u)},[])}}function Ts(t){return(t==null?void 0:t.animationName)||"none"}function gf(t){var a,n;let r=(a=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:a.get,s=r&&"isReactWarning"in r&&r.isReactWarning;return s?t.ref:(r=(n=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:n.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var ff=zn[" useInsertionEffect ".trim().toString()]||St;function hi({prop:t,defaultProp:r,onChange:s=()=>{},caller:a}){const[n,i,o]=xf({defaultProp:r,onChange:s}),l=t!==void 0,c=l?t:n;{const d=h.useRef(t!==void 0);h.useEffect(()=>{const m=d.current;m!==l&&console.warn(`${a} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=l},[l,a])}const u=h.useCallback(d=>{var m;if(l){const g=pf(d)?d(t):d;g!==t&&((m=o.current)==null||m.call(o,g))}else i(d)},[l,t,i,o]);return[c,u]}function xf({defaultProp:t,onChange:r}){const[s,a]=h.useState(t),n=h.useRef(s),i=h.useRef(r);return ff(()=>{i.current=r},[r]),h.useEffect(()=>{var o;n.current!==s&&((o=i.current)==null||o.call(i,s),n.current=s)},[s,n]),[s,a,i]}function pf(t){return typeof t=="function"}var yf=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),bf="VisuallyHidden",mi=h.forwardRef((t,r)=>e.jsx(Me.span,{...t,ref:r,style:{...yf,...t.style}}));mi.displayName=bf;var gi="ToastProvider",[fi,vf,wf]=li("Toast"),[lc,wj]=Ir("Toast",[wf]),[kf,Ea]=lc(gi),cc=t=>{const{__scopeToast:r,label:s="Notification",duration:a=5e3,swipeDirection:n="right",swipeThreshold:i=50,children:o}=t,[l,c]=h.useState(null),[u,d]=h.useState(0),m=h.useRef(!1),g=h.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${gi}\`. Expected non-empty \`string\`.`),e.jsx(fi.Provider,{scope:r,children:e.jsx(kf,{scope:r,label:s,duration:a,swipeDirection:n,swipeThreshold:i,toastCount:u,viewport:l,onViewportChange:c,onToastAdd:h.useCallback(()=>d(x=>x+1),[]),onToastRemove:h.useCallback(()=>d(x=>x-1),[]),isFocusedToastEscapeKeyDownRef:m,isClosePausedRef:g,children:o})})};cc.displayName=gi;var dc="ToastViewport",jf=["F8"],Pn="toast.viewportPause",Tn="toast.viewportResume",uc=h.forwardRef((t,r)=>{const{__scopeToast:s,hotkey:a=jf,label:n="Notifications ({hotkey})",...i}=t,o=Ea(dc,s),l=vf(s),c=h.useRef(null),u=h.useRef(null),d=h.useRef(null),m=h.useRef(null),g=ze(r,m,o.onViewportChange),x=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=o.toastCount>0;h.useEffect(()=>{const y=v=>{var j;a.length!==0&&a.every(b=>v[b]||v.code===b)&&((j=m.current)==null||j.focus())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[a]),h.useEffect(()=>{const y=c.current,v=m.current;if(p&&y&&v){const w=()=>{if(!o.isClosePausedRef.current){const I=new CustomEvent(Pn);v.dispatchEvent(I),o.isClosePausedRef.current=!0}},j=()=>{if(o.isClosePausedRef.current){const I=new CustomEvent(Tn);v.dispatchEvent(I),o.isClosePausedRef.current=!1}},b=I=>{!y.contains(I.relatedTarget)&&j()},k=()=>{y.contains(document.activeElement)||j()};return y.addEventListener("focusin",w),y.addEventListener("focusout",b),y.addEventListener("pointermove",w),y.addEventListener("pointerleave",k),window.addEventListener("blur",w),window.addEventListener("focus",j),()=>{y.removeEventListener("focusin",w),y.removeEventListener("focusout",b),y.removeEventListener("pointermove",w),y.removeEventListener("pointerleave",k),window.removeEventListener("blur",w),window.removeEventListener("focus",j)}}},[p,o.isClosePausedRef]);const f=h.useCallback(({tabbingDirection:y})=>{const w=l().map(j=>{const b=j.ref.current,k=[b,...If(b)];return y==="forwards"?k:k.reverse()});return(y==="forwards"?w.reverse():w).flat()},[l]);return h.useEffect(()=>{const y=m.current;if(y){const v=w=>{var k,I,C;const j=w.altKey||w.ctrlKey||w.metaKey;if(w.key==="Tab"&&!j){const A=document.activeElement,B=w.shiftKey;if(w.target===y&&B){(k=u.current)==null||k.focus();return}const N=f({tabbingDirection:B?"backwards":"forwards"}),O=N.findIndex(E=>E===A);Ja(N.slice(O+1))?w.preventDefault():B?(I=u.current)==null||I.focus():(C=d.current)==null||C.focus()}};return y.addEventListener("keydown",v),()=>y.removeEventListener("keydown",v)}},[l,f]),e.jsxs(df,{ref:c,role:"region","aria-label":n.replace("{hotkey}",x),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&e.jsx(Dn,{ref:u,onFocusFromOutsideViewport:()=>{const y=f({tabbingDirection:"forwards"});Ja(y)}}),e.jsx(fi.Slot,{scope:s,children:e.jsx(Me.ol,{tabIndex:-1,...i,ref:g})}),p&&e.jsx(Dn,{ref:d,onFocusFromOutsideViewport:()=>{const y=f({tabbingDirection:"backwards"});Ja(y)}})]})});uc.displayName=dc;var hc="ToastFocusProxy",Dn=h.forwardRef((t,r)=>{const{__scopeToast:s,onFocusFromOutsideViewport:a,...n}=t,i=Ea(hc,s);return e.jsx(mi,{"aria-hidden":!0,tabIndex:0,...n,ref:r,style:{position:"fixed"},onFocus:o=>{var u;const l=o.relatedTarget;!((u=i.viewport)!=null&&u.contains(l))&&a()}})});Dn.displayName=hc;var bs="Toast",Nf="toast.swipeStart",_f="toast.swipeMove",Sf="toast.swipeCancel",Ef="toast.swipeEnd",mc=h.forwardRef((t,r)=>{const{forceMount:s,open:a,defaultOpen:n,onOpenChange:i,...o}=t,[l,c]=hi({prop:a,defaultProp:n??!0,onChange:i,caller:bs});return e.jsx(Lr,{present:s||l,children:e.jsx(Tf,{open:l,...o,ref:r,onClose:()=>c(!1),onPause:Ze(t.onPause),onResume:Ze(t.onResume),onSwipeStart:xe(t.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:xe(t.onSwipeMove,u=>{const{x:d,y:m}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${m}px`)}),onSwipeCancel:xe(t.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:xe(t.onSwipeEnd,u=>{const{x:d,y:m}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${m}px`),c(!1)})})})});mc.displayName=bs;var[Cf,Pf]=lc(bs,{onClose(){}}),Tf=h.forwardRef((t,r)=>{const{__scopeToast:s,type:a="foreground",duration:n,open:i,onClose:o,onEscapeKeyDown:l,onPause:c,onResume:u,onSwipeStart:d,onSwipeMove:m,onSwipeCancel:g,onSwipeEnd:x,...p}=t,f=Ea(bs,s),[y,v]=h.useState(null),w=ze(r,E=>v(E)),j=h.useRef(null),b=h.useRef(null),k=n||f.duration,I=h.useRef(0),C=h.useRef(k),A=h.useRef(0),{onToastAdd:B,onToastRemove:D}=f,L=Ze(()=>{var z;(y==null?void 0:y.contains(document.activeElement))&&((z=f.viewport)==null||z.focus()),o()}),N=h.useCallback(E=>{!E||E===1/0||(window.clearTimeout(A.current),I.current=new Date().getTime(),A.current=window.setTimeout(L,E))},[L]);h.useEffect(()=>{const E=f.viewport;if(E){const z=()=>{N(C.current),u==null||u()},W=()=>{const V=new Date().getTime()-I.current;C.current=C.current-V,window.clearTimeout(A.current),c==null||c()};return E.addEventListener(Pn,W),E.addEventListener(Tn,z),()=>{E.removeEventListener(Pn,W),E.removeEventListener(Tn,z)}}},[f.viewport,k,c,u,N]),h.useEffect(()=>{i&&!f.isClosePausedRef.current&&N(k)},[i,k,f.isClosePausedRef,N]),h.useEffect(()=>(B(),()=>D()),[B,D]);const O=h.useMemo(()=>y?vc(y):null,[y]);return f.viewport?e.jsxs(e.Fragment,{children:[O&&e.jsx(Df,{__scopeToast:s,role:"status","aria-live":a==="foreground"?"assertive":"polite","aria-atomic":!0,children:O}),e.jsx(Cf,{scope:s,onClose:L,children:ua.createPortal(e.jsx(fi.ItemSlot,{scope:s,children:e.jsx(cf,{asChild:!0,onEscapeKeyDown:xe(l,()=>{f.isFocusedToastEscapeKeyDownRef.current||L(),f.isFocusedToastEscapeKeyDownRef.current=!1}),children:e.jsx(Me.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":f.swipeDirection,...p,ref:w,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:xe(t.onKeyDown,E=>{E.key==="Escape"&&(l==null||l(E.nativeEvent),E.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,L()))}),onPointerDown:xe(t.onPointerDown,E=>{E.button===0&&(j.current={x:E.clientX,y:E.clientY})}),onPointerMove:xe(t.onPointerMove,E=>{if(!j.current)return;const z=E.clientX-j.current.x,W=E.clientY-j.current.y,V=!!b.current,F=["left","right"].includes(f.swipeDirection),S=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,H=F?S(0,z):0,ee=F?0:S(0,W),se=E.pointerType==="touch"?10:2,R={x:H,y:ee},Y={originalEvent:E,delta:R};V?(b.current=R,Ds(_f,m,Y,{discrete:!1})):jo(R,f.swipeDirection,se)?(b.current=R,Ds(Nf,d,Y,{discrete:!1}),E.target.setPointerCapture(E.pointerId)):(Math.abs(z)>se||Math.abs(W)>se)&&(j.current=null)}),onPointerUp:xe(t.onPointerUp,E=>{const z=b.current,W=E.target;if(W.hasPointerCapture(E.pointerId)&&W.releasePointerCapture(E.pointerId),b.current=null,j.current=null,z){const V=E.currentTarget,F={originalEvent:E,delta:z};jo(z,f.swipeDirection,f.swipeThreshold)?Ds(Ef,x,F,{discrete:!0}):Ds(Sf,g,F,{discrete:!0}),V.addEventListener("click",S=>S.preventDefault(),{once:!0})}})})})}),f.viewport)})]}):null}),Df=t=>{const{__scopeToast:r,children:s,...a}=t,n=Ea(bs,r),[i,o]=h.useState(!1),[l,c]=h.useState(!1);return Mf(()=>o(!0)),h.useEffect(()=>{const u=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(u)},[]),l?null:e.jsx(ui,{asChild:!0,children:e.jsx(mi,{...a,children:i&&e.jsxs(e.Fragment,{children:[n.label," ",s]})})})},Rf="ToastTitle",gc=h.forwardRef((t,r)=>{const{__scopeToast:s,...a}=t;return e.jsx(Me.div,{...a,ref:r})});gc.displayName=Rf;var Af="ToastDescription",fc=h.forwardRef((t,r)=>{const{__scopeToast:s,...a}=t;return e.jsx(Me.div,{...a,ref:r})});fc.displayName=Af;var xc="ToastAction",pc=h.forwardRef((t,r)=>{const{altText:s,...a}=t;return s.trim()?e.jsx(bc,{altText:s,asChild:!0,children:e.jsx(xi,{...a,ref:r})}):(console.error(`Invalid prop \`altText\` supplied to \`${xc}\`. Expected non-empty \`string\`.`),null)});pc.displayName=xc;var yc="ToastClose",xi=h.forwardRef((t,r)=>{const{__scopeToast:s,...a}=t,n=Pf(yc,s);return e.jsx(bc,{asChild:!0,children:e.jsx(Me.button,{type:"button",...a,ref:r,onClick:xe(t.onClick,n.onClose)})})});xi.displayName=yc;var bc=h.forwardRef((t,r)=>{const{__scopeToast:s,altText:a,...n}=t;return e.jsx(Me.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,...n,ref:r})});function vc(t){const r=[];return Array.from(t.childNodes).forEach(a=>{if(a.nodeType===a.TEXT_NODE&&a.textContent&&r.push(a.textContent),Of(a)){const n=a.ariaHidden||a.hidden||a.style.display==="none",i=a.dataset.radixToastAnnounceExclude==="";if(!n)if(i){const o=a.dataset.radixToastAnnounceAlt;o&&r.push(o)}else r.push(...vc(a))}}),r}function Ds(t,r,s,{discrete:a}){const n=s.originalEvent.currentTarget,i=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:s});r&&n.addEventListener(t,r,{once:!0}),a?ci(n,i):n.dispatchEvent(i)}var jo=(t,r,s=0)=>{const a=Math.abs(t.x),n=Math.abs(t.y),i=a>n;return r==="left"||r==="right"?i&&a>s:!i&&n>s};function Mf(t=()=>{}){const r=Ze(t);St(()=>{let s=0,a=0;return s=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(r)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(a)}},[r])}function Of(t){return t.nodeType===t.ELEMENT_NODE}function If(t){const r=[],s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const n=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||n?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)r.push(s.currentNode);return r}function Ja(t){const r=document.activeElement;return t.some(s=>s===r?!0:(s.focus(),document.activeElement!==r))}var Lf=cc,wc=uc,kc=mc,jc=gc,Nc=fc,_c=pc,Sc=xi;function Ec(t){var r,s,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(r=0;r<n;r++)t[r]&&(s=Ec(t[r]))&&(a&&(a+=" "),a+=s)}else for(s in t)t[s]&&(a&&(a+=" "),a+=s);return a}function Cc(){for(var t,r,s=0,a="",n=arguments.length;s<n;s++)(t=arguments[s])&&(r=Ec(t))&&(a&&(a+=" "),a+=r);return a}const No=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,_o=Cc,$f=(t,r)=>s=>{var a;if((r==null?void 0:r.variants)==null)return _o(t,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:n,defaultVariants:i}=r,o=Object.keys(n).map(u=>{const d=s==null?void 0:s[u],m=i==null?void 0:i[u];if(d===null)return null;const g=No(d)||No(m);return n[u][g]}),l=s&&Object.entries(s).reduce((u,d)=>{let[m,g]=d;return g===void 0||(u[m]=g),u},{}),c=r==null||(a=r.compoundVariants)===null||a===void 0?void 0:a.reduce((u,d)=>{let{class:m,className:g,...x}=d;return Object.entries(x).every(p=>{let[f,y]=p;return Array.isArray(y)?y.includes({...i,...l}[f]):{...i,...l}[f]===y})?[...u,m,g]:u},[]);return _o(t,o,c,s==null?void 0:s.class,s==null?void 0:s.className)},pi="-",Ff=t=>{const r=Bf(t),{conflictingClassGroups:s,conflictingClassGroupModifiers:a}=t;return{getClassGroupId:o=>{const l=o.split(pi);return l[0]===""&&l.length!==1&&l.shift(),Pc(l,r)||Uf(o)},getConflictingClassGroupIds:(o,l)=>{const c=s[o]||[];return l&&a[o]?[...c,...a[o]]:c}}},Pc=(t,r)=>{var o;if(t.length===0)return r.classGroupId;const s=t[0],a=r.nextPart.get(s),n=a?Pc(t.slice(1),a):void 0;if(n)return n;if(r.validators.length===0)return;const i=t.join(pi);return(o=r.validators.find(({validator:l})=>l(i)))==null?void 0:o.classGroupId},So=/^\[(.+)\]$/,Uf=t=>{if(So.test(t)){const r=So.exec(t)[1],s=r==null?void 0:r.substring(0,r.indexOf(":"));if(s)return"arbitrary.."+s}},Bf=t=>{const{theme:r,prefix:s}=t,a={nextPart:new Map,validators:[]};return zf(Object.entries(t.classGroups),s).forEach(([i,o])=>{Rn(o,a,i,r)}),a},Rn=(t,r,s,a)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?r:Eo(r,n);i.classGroupId=s;return}if(typeof n=="function"){if(qf(n)){Rn(n(a),r,s,a);return}r.validators.push({validator:n,classGroupId:s});return}Object.entries(n).forEach(([i,o])=>{Rn(o,Eo(r,i),s,a)})})},Eo=(t,r)=>{let s=t;return r.split(pi).forEach(a=>{s.nextPart.has(a)||s.nextPart.set(a,{nextPart:new Map,validators:[]}),s=s.nextPart.get(a)}),s},qf=t=>t.isThemeGetter,zf=(t,r)=>r?t.map(([s,a])=>{const n=a.map(i=>typeof i=="string"?r+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,l])=>[r+o,l])):i);return[s,n]}):t,Wf=t=>{if(t<1)return{get:()=>{},set:()=>{}};let r=0,s=new Map,a=new Map;const n=(i,o)=>{s.set(i,o),r++,r>t&&(r=0,a=s,s=new Map)};return{get(i){let o=s.get(i);if(o!==void 0)return o;if((o=a.get(i))!==void 0)return n(i,o),o},set(i,o){s.has(i)?s.set(i,o):n(i,o)}}},Tc="!",Vf=t=>{const{separator:r,experimentalParseClassName:s}=t,a=r.length===1,n=r[0],i=r.length,o=l=>{const c=[];let u=0,d=0,m;for(let y=0;y<l.length;y++){let v=l[y];if(u===0){if(v===n&&(a||l.slice(y,y+i)===r)){c.push(l.slice(d,y)),d=y+i;continue}if(v==="/"){m=y;continue}}v==="["?u++:v==="]"&&u--}const g=c.length===0?l:l.substring(d),x=g.startsWith(Tc),p=x?g.substring(1):g,f=m&&m>d?m-d:void 0;return{modifiers:c,hasImportantModifier:x,baseClassName:p,maybePostfixModifierPosition:f}};return s?l=>s({className:l,parseClassName:o}):o},Hf=t=>{if(t.length<=1)return t;const r=[];let s=[];return t.forEach(a=>{a[0]==="["?(r.push(...s.sort(),a),s=[]):s.push(a)}),r.push(...s.sort()),r},Yf=t=>({cache:Wf(t.cacheSize),parseClassName:Vf(t),...Ff(t)}),Gf=/\s+/,Kf=(t,r)=>{const{parseClassName:s,getClassGroupId:a,getConflictingClassGroupIds:n}=r,i=[],o=t.trim().split(Gf);let l="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{modifiers:d,hasImportantModifier:m,baseClassName:g,maybePostfixModifierPosition:x}=s(u);let p=!!x,f=a(p?g.substring(0,x):g);if(!f){if(!p){l=u+(l.length>0?" "+l:l);continue}if(f=a(g),!f){l=u+(l.length>0?" "+l:l);continue}p=!1}const y=Hf(d).join(":"),v=m?y+Tc:y,w=v+f;if(i.includes(w))continue;i.push(w);const j=n(f,p);for(let b=0;b<j.length;++b){const k=j[b];i.push(v+k)}l=u+(l.length>0?" "+l:l)}return l};function Jf(){let t=0,r,s,a="";for(;t<arguments.length;)(r=arguments[t++])&&(s=Dc(r))&&(a&&(a+=" "),a+=s);return a}const Dc=t=>{if(typeof t=="string")return t;let r,s="";for(let a=0;a<t.length;a++)t[a]&&(r=Dc(t[a]))&&(s&&(s+=" "),s+=r);return s};function Xf(t,...r){let s,a,n,i=o;function o(c){const u=r.reduce((d,m)=>m(d),t());return s=Yf(u),a=s.cache.get,n=s.cache.set,i=l,l(c)}function l(c){const u=a(c);if(u)return u;const d=Kf(c,s);return n(c,d),d}return function(){return i(Jf.apply(null,arguments))}}const Ce=t=>{const r=s=>s[t]||[];return r.isThemeGetter=!0,r},Rc=/^\[(?:([a-z-]+):)?(.+)\]$/i,Qf=/^\d+\/\d+$/,Zf=new Set(["px","full","screen"]),ex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,tx=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,rx=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,sx=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,ax=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,kt=t=>jr(t)||Zf.has(t)||Qf.test(t),At=t=>$r(t,"length",hx),jr=t=>!!t&&!Number.isNaN(Number(t)),Xa=t=>$r(t,"number",jr),Vr=t=>!!t&&Number.isInteger(Number(t)),nx=t=>t.endsWith("%")&&jr(t.slice(0,-1)),ye=t=>Rc.test(t),Mt=t=>ex.test(t),ix=new Set(["length","size","percentage"]),ox=t=>$r(t,ix,Ac),lx=t=>$r(t,"position",Ac),cx=new Set(["image","url"]),dx=t=>$r(t,cx,gx),ux=t=>$r(t,"",mx),Hr=()=>!0,$r=(t,r,s)=>{const a=Rc.exec(t);return a?a[1]?typeof r=="string"?a[1]===r:r.has(a[1]):s(a[2]):!1},hx=t=>tx.test(t)&&!rx.test(t),Ac=()=>!1,mx=t=>sx.test(t),gx=t=>ax.test(t),fx=()=>{const t=Ce("colors"),r=Ce("spacing"),s=Ce("blur"),a=Ce("brightness"),n=Ce("borderColor"),i=Ce("borderRadius"),o=Ce("borderSpacing"),l=Ce("borderWidth"),c=Ce("contrast"),u=Ce("grayscale"),d=Ce("hueRotate"),m=Ce("invert"),g=Ce("gap"),x=Ce("gradientColorStops"),p=Ce("gradientColorStopPositions"),f=Ce("inset"),y=Ce("margin"),v=Ce("opacity"),w=Ce("padding"),j=Ce("saturate"),b=Ce("scale"),k=Ce("sepia"),I=Ce("skew"),C=Ce("space"),A=Ce("translate"),B=()=>["auto","contain","none"],D=()=>["auto","hidden","clip","visible","scroll"],L=()=>["auto",ye,r],N=()=>[ye,r],O=()=>["",kt,At],E=()=>["auto",jr,ye],z=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],W=()=>["solid","dashed","dotted","double","none"],V=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>["start","end","center","between","around","evenly","stretch"],S=()=>["","0",ye],H=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ee=()=>[jr,ye];return{cacheSize:500,separator:":",theme:{colors:[Hr],spacing:[kt,At],blur:["none","",Mt,ye],brightness:ee(),borderColor:[t],borderRadius:["none","","full",Mt,ye],borderSpacing:N(),borderWidth:O(),contrast:ee(),grayscale:S(),hueRotate:ee(),invert:S(),gap:N(),gradientColorStops:[t],gradientColorStopPositions:[nx,At],inset:L(),margin:L(),opacity:ee(),padding:N(),saturate:ee(),scale:ee(),sepia:S(),skew:ee(),space:N(),translate:N()},classGroups:{aspect:[{aspect:["auto","square","video",ye]}],container:["container"],columns:[{columns:[Mt]}],"break-after":[{"break-after":H()}],"break-before":[{"break-before":H()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...z(),ye]}],overflow:[{overflow:D()}],"overflow-x":[{"overflow-x":D()}],"overflow-y":[{"overflow-y":D()}],overscroll:[{overscroll:B()}],"overscroll-x":[{"overscroll-x":B()}],"overscroll-y":[{"overscroll-y":B()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[f]}],"inset-x":[{"inset-x":[f]}],"inset-y":[{"inset-y":[f]}],start:[{start:[f]}],end:[{end:[f]}],top:[{top:[f]}],right:[{right:[f]}],bottom:[{bottom:[f]}],left:[{left:[f]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Vr,ye]}],basis:[{basis:L()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ye]}],grow:[{grow:S()}],shrink:[{shrink:S()}],order:[{order:["first","last","none",Vr,ye]}],"grid-cols":[{"grid-cols":[Hr]}],"col-start-end":[{col:["auto",{span:["full",Vr,ye]},ye]}],"col-start":[{"col-start":E()}],"col-end":[{"col-end":E()}],"grid-rows":[{"grid-rows":[Hr]}],"row-start-end":[{row:["auto",{span:[Vr,ye]},ye]}],"row-start":[{"row-start":E()}],"row-end":[{"row-end":E()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ye]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ye]}],gap:[{gap:[g]}],"gap-x":[{"gap-x":[g]}],"gap-y":[{"gap-y":[g]}],"justify-content":[{justify:["normal",...F()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...F(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...F(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[w]}],px:[{px:[w]}],py:[{py:[w]}],ps:[{ps:[w]}],pe:[{pe:[w]}],pt:[{pt:[w]}],pr:[{pr:[w]}],pb:[{pb:[w]}],pl:[{pl:[w]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ye,r]}],"min-w":[{"min-w":[ye,r,"min","max","fit"]}],"max-w":[{"max-w":[ye,r,"none","full","min","max","fit","prose",{screen:[Mt]},Mt]}],h:[{h:[ye,r,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ye,r,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ye,r,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ye,r,"auto","min","max","fit"]}],"font-size":[{text:["base",Mt,At]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Xa]}],"font-family":[{font:[Hr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ye]}],"line-clamp":[{"line-clamp":["none",jr,Xa]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",kt,ye]}],"list-image":[{"list-image":["none",ye]}],"list-style-type":[{list:["none","disc","decimal",ye]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...W(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",kt,At]}],"underline-offset":[{"underline-offset":["auto",kt,ye]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:N()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ye]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ye]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...z(),lx]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",ox]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},dx]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[x]}],"gradient-via":[{via:[x]}],"gradient-to":[{to:[x]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[...W(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:W()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...W()]}],"outline-offset":[{"outline-offset":[kt,ye]}],"outline-w":[{outline:[kt,At]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:O()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[kt,At]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Mt,ux]}],"shadow-color":[{shadow:[Hr]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":[...V(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":V()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[a]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Mt,ye]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[m]}],saturate:[{saturate:[j]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[m]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[j]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ye]}],duration:[{duration:ee()}],ease:[{ease:["linear","in","out","in-out",ye]}],delay:[{delay:ee()}],animate:[{animate:["none","spin","ping","pulse","bounce",ye]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[Vr,ye]}],"translate-x":[{"translate-x":[A]}],"translate-y":[{"translate-y":[A]}],"skew-x":[{"skew-x":[I]}],"skew-y":[{"skew-y":[I]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ye]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ye]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":N()}],"scroll-mx":[{"scroll-mx":N()}],"scroll-my":[{"scroll-my":N()}],"scroll-ms":[{"scroll-ms":N()}],"scroll-me":[{"scroll-me":N()}],"scroll-mt":[{"scroll-mt":N()}],"scroll-mr":[{"scroll-mr":N()}],"scroll-mb":[{"scroll-mb":N()}],"scroll-ml":[{"scroll-ml":N()}],"scroll-p":[{"scroll-p":N()}],"scroll-px":[{"scroll-px":N()}],"scroll-py":[{"scroll-py":N()}],"scroll-ps":[{"scroll-ps":N()}],"scroll-pe":[{"scroll-pe":N()}],"scroll-pt":[{"scroll-pt":N()}],"scroll-pr":[{"scroll-pr":N()}],"scroll-pb":[{"scroll-pb":N()}],"scroll-pl":[{"scroll-pl":N()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ye]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[kt,At,Xa]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},xx=Xf(fx);function Ye(...t){return xx(Cc(t))}const px=Lf,Mc=h.forwardRef(({className:t,...r},s)=>e.jsx(wc,{ref:s,className:Ye("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...r}));Mc.displayName=wc.displayName;const yx=$f("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-white dark:bg-gray-800 dark:border-gray-700",success:"border-green-200 bg-green-50 dark:bg-green-900/50 dark:border-green-800 text-green-900 dark:text-green-100",destructive:"destructive group border-red-200 bg-red-50 dark:bg-red-900/50 dark:border-red-800 text-red-900 dark:text-red-100"}},defaultVariants:{variant:"default"}}),Oc=h.forwardRef(({className:t,variant:r,...s},a)=>e.jsx(kc,{ref:a,className:Ye(yx({variant:r}),t),...s}));Oc.displayName=kc.displayName;const vr=h.forwardRef(({className:t,...r},s)=>e.jsx(_c,{ref:s,className:Ye("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive dark:border-gray-700 dark:hover:bg-gray-700",t),...r}));vr.displayName=_c.displayName;const Ic=h.forwardRef(({className:t,...r},s)=>e.jsx(Sc,{ref:s,className:Ye("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600 dark:text-gray-400 dark:hover:text-gray-200",t),"toast-close":"",...r,children:e.jsx(qe,{className:"h-4 w-4"})}));Ic.displayName=Sc.displayName;const Lc=h.forwardRef(({className:t,...r},s)=>e.jsx(jc,{ref:s,className:Ye("text-sm font-semibold",t),...r}));Lc.displayName=jc.displayName;const $c=h.forwardRef(({className:t,...r},s)=>e.jsx(Nc,{ref:s,className:Ye("text-sm opacity-90",t),...r}));$c.displayName=Nc.displayName;function Ca(){const{toasts:t}=Pe();return e.jsxs(px,{children:[t.map(function({id:r,title:s,description:a,action:n,...i}){return e.jsxs(Oc,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(Lc,{children:s}),a&&e.jsx($c,{children:a})]}),n,e.jsx(Ic,{})]},r)}),e.jsx(Mc,{})]})}const bx=()=>{const[t,r]=h.useState({email:"",password:""}),[s,a]=h.useState(null),[n,i]=h.useState(!1),o=Xt(),l=vt(),{signIn:c,user:u,userData:d}=je();h.useEffect(()=>{u&&d&&(d.user_role==="admin"||d.user_role==="support"||d.user_role==="partner"?o("/admin",{replace:!0}):d.user_role==="customer"&&(En({title:"Customer Account Detected",description:"This portal is for admin and partner access only. Redirecting to customer portal...",variant:"destructive"}),setTimeout(()=>{window.location.href="https://royaltransfer.eu/customer-signup"},3e3)))},[u,d,o]),h.useEffect(()=>{const x=l.state;x!=null&&x.message&&(En({title:"Notice",description:x.message}),o(l.pathname,{replace:!0,state:{}}))},[l,o]);const m=async x=>{if(x.preventDefault(),a(null),!t.email||!t.password){a("Please enter both email and password");return}i(!0);try{const{error:p,session:f}=await c(t.email,t.password);if(p)throw p}catch(p){console.error("Login error:",p),a(p.message||"Failed to sign in. Please check your credentials.")}finally{i(!1)}},g=x=>{const{name:p,value:f}=x.target;r(y=>({...y,[p]:f}))};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col",children:[e.jsx(Na,{hideSignIn:!0}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4 py-12",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(_a,{})}),e.jsx("h2",{className:"text-2xl font-bold text-center mb-6 dark:text-white",children:"Admin Portal Login"}),e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-300 mb-8",children:"Access the administrative area of Royal Transfer EU"}),s&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300 p-3 rounded-md mb-6 text-sm flex items-start",children:[e.jsx(Be,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"ml-2",children:s})]}),e.jsxs("form",{onSubmit:m,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:t.email,onChange:g,className:"w-full px-4 py-2 border border-gray-200 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password"}),e.jsx("input",{type:"password",id:"password",name:"password",value:t.password,onChange:g,className:"w-full px-4 py-2 border border-gray-200 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition-all duration-300 flex items-center justify-center",children:n?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-5 h-5 mr-2 animate-spin"}),"Signing in..."]}):"Sign In"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("a",{href:"https://royaltransfer.eu/",className:"inline-flex items-center text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(Dr,{className:"w-4 h-4 mr-2"}),"Back to main site"]})})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("a",{href:"https://royaltransfer.eu/contact",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:"Need Help? Contact Support"})})]})}),e.jsx(Ca,{})]})};var vx=h.createContext(void 0);function Fc(t){const r=h.useContext(vx);return t||r||"ltr"}var Qa=0;function wx(){h.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Co()),document.body.insertAdjacentElement("beforeend",t[1]??Co()),Qa++,()=>{Qa===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),Qa--}},[])}function Co(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Za="focusScope.autoFocusOnMount",en="focusScope.autoFocusOnUnmount",Po={bubbles:!1,cancelable:!0},kx="FocusScope",Uc=h.forwardRef((t,r)=>{const{loop:s=!1,trapped:a=!1,onMountAutoFocus:n,onUnmountAutoFocus:i,...o}=t,[l,c]=h.useState(null),u=Ze(n),d=Ze(i),m=h.useRef(null),g=ze(r,f=>c(f)),x=h.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;h.useEffect(()=>{if(a){let f=function(j){if(x.paused||!l)return;const b=j.target;l.contains(b)?m.current=b:Ft(m.current,{select:!0})},y=function(j){if(x.paused||!l)return;const b=j.relatedTarget;b!==null&&(l.contains(b)||Ft(m.current,{select:!0}))},v=function(j){if(document.activeElement===document.body)for(const k of j)k.removedNodes.length>0&&Ft(l)};document.addEventListener("focusin",f),document.addEventListener("focusout",y);const w=new MutationObserver(v);return l&&w.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",f),document.removeEventListener("focusout",y),w.disconnect()}}},[a,l,x.paused]),h.useEffect(()=>{if(l){Do.add(x);const f=document.activeElement;if(!l.contains(f)){const v=new CustomEvent(Za,Po);l.addEventListener(Za,u),l.dispatchEvent(v),v.defaultPrevented||(jx(Cx(Bc(l)),{select:!0}),document.activeElement===f&&Ft(l))}return()=>{l.removeEventListener(Za,u),setTimeout(()=>{const v=new CustomEvent(en,Po);l.addEventListener(en,d),l.dispatchEvent(v),v.defaultPrevented||Ft(f??document.body,{select:!0}),l.removeEventListener(en,d),Do.remove(x)},0)}}},[l,u,d,x]);const p=h.useCallback(f=>{if(!s&&!a||x.paused)return;const y=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,v=document.activeElement;if(y&&v){const w=f.currentTarget,[j,b]=Nx(w);j&&b?!f.shiftKey&&v===b?(f.preventDefault(),s&&Ft(j,{select:!0})):f.shiftKey&&v===j&&(f.preventDefault(),s&&Ft(b,{select:!0})):v===w&&f.preventDefault()}},[s,a,x.paused]);return e.jsx(Me.div,{tabIndex:-1,...o,ref:g,onKeyDown:p})});Uc.displayName=kx;function jx(t,{select:r=!1}={}){const s=document.activeElement;for(const a of t)if(Ft(a,{select:r}),document.activeElement!==s)return}function Nx(t){const r=Bc(t),s=To(r,t),a=To(r.reverse(),t);return[s,a]}function Bc(t){const r=[],s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const n=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||n?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)r.push(s.currentNode);return r}function To(t,r){for(const s of t)if(!_x(s,{upTo:r}))return s}function _x(t,{upTo:r}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(r!==void 0&&t===r)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Sx(t){return t instanceof HTMLInputElement&&"select"in t}function Ft(t,{select:r=!1}={}){if(t&&t.focus){const s=document.activeElement;t.focus({preventScroll:!0}),t!==s&&Sx(t)&&r&&t.select()}}var Do=Ex();function Ex(){let t=[];return{add(r){const s=t[0];r!==s&&(s==null||s.pause()),t=Ro(t,r),t.unshift(r)},remove(r){var s;t=Ro(t,r),(s=t[0])==null||s.resume()}}}function Ro(t,r){const s=[...t],a=s.indexOf(r);return a!==-1&&s.splice(a,1),s}function Cx(t){return t.filter(r=>r.tagName!=="A")}var Px=zn[" useId ".trim().toString()]||(()=>{}),Tx=0;function An(t){const[r,s]=h.useState(Px());return St(()=>{s(a=>a??String(Tx++))},[t]),r?`radix-${r}`:""}const Dx=["top","right","bottom","left"],Ht=Math.min,Ke=Math.max,ra=Math.round,Rs=Math.floor,ft=t=>({x:t,y:t}),Rx={left:"right",right:"left",bottom:"top",top:"bottom"},Ax={start:"end",end:"start"};function Mn(t,r,s){return Ke(t,Ht(r,s))}function Et(t,r){return typeof t=="function"?t(r):t}function Ct(t){return t.split("-")[0]}function Fr(t){return t.split("-")[1]}function yi(t){return t==="x"?"y":"x"}function bi(t){return t==="y"?"height":"width"}function Yt(t){return["top","bottom"].includes(Ct(t))?"y":"x"}function vi(t){return yi(Yt(t))}function Mx(t,r,s){s===void 0&&(s=!1);const a=Fr(t),n=vi(t),i=bi(n);let o=n==="x"?a===(s?"end":"start")?"right":"left":a==="start"?"bottom":"top";return r.reference[i]>r.floating[i]&&(o=sa(o)),[o,sa(o)]}function Ox(t){const r=sa(t);return[On(t),r,On(r)]}function On(t){return t.replace(/start|end/g,r=>Ax[r])}function Ix(t,r,s){const a=["left","right"],n=["right","left"],i=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return s?r?n:a:r?a:n;case"left":case"right":return r?i:o;default:return[]}}function Lx(t,r,s,a){const n=Fr(t);let i=Ix(Ct(t),s==="start",a);return n&&(i=i.map(o=>o+"-"+n),r&&(i=i.concat(i.map(On)))),i}function sa(t){return t.replace(/left|right|bottom|top/g,r=>Rx[r])}function $x(t){return{top:0,right:0,bottom:0,left:0,...t}}function qc(t){return typeof t!="number"?$x(t):{top:t,right:t,bottom:t,left:t}}function aa(t){const{x:r,y:s,width:a,height:n}=t;return{width:a,height:n,top:s,left:r,right:r+a,bottom:s+n,x:r,y:s}}function Ao(t,r,s){let{reference:a,floating:n}=t;const i=Yt(r),o=vi(r),l=bi(o),c=Ct(r),u=i==="y",d=a.x+a.width/2-n.width/2,m=a.y+a.height/2-n.height/2,g=a[l]/2-n[l]/2;let x;switch(c){case"top":x={x:d,y:a.y-n.height};break;case"bottom":x={x:d,y:a.y+a.height};break;case"right":x={x:a.x+a.width,y:m};break;case"left":x={x:a.x-n.width,y:m};break;default:x={x:a.x,y:a.y}}switch(Fr(r)){case"start":x[o]-=g*(s&&u?-1:1);break;case"end":x[o]+=g*(s&&u?-1:1);break}return x}const Fx=async(t,r,s)=>{const{placement:a="bottom",strategy:n="absolute",middleware:i=[],platform:o}=s,l=i.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(r));let u=await o.getElementRects({reference:t,floating:r,strategy:n}),{x:d,y:m}=Ao(u,a,c),g=a,x={},p=0;for(let f=0;f<l.length;f++){const{name:y,fn:v}=l[f],{x:w,y:j,data:b,reset:k}=await v({x:d,y:m,initialPlacement:a,placement:g,strategy:n,middlewareData:x,rects:u,platform:o,elements:{reference:t,floating:r}});d=w??d,m=j??m,x={...x,[y]:{...x[y],...b}},k&&p<=50&&(p++,typeof k=="object"&&(k.placement&&(g=k.placement),k.rects&&(u=k.rects===!0?await o.getElementRects({reference:t,floating:r,strategy:n}):k.rects),{x:d,y:m}=Ao(u,g,c)),f=-1)}return{x:d,y:m,placement:g,strategy:n,middlewareData:x}};async function us(t,r){var s;r===void 0&&(r={});const{x:a,y:n,platform:i,rects:o,elements:l,strategy:c}=t,{boundary:u="clippingAncestors",rootBoundary:d="viewport",elementContext:m="floating",altBoundary:g=!1,padding:x=0}=Et(r,t),p=qc(x),y=l[g?m==="floating"?"reference":"floating":m],v=aa(await i.getClippingRect({element:(s=await(i.isElement==null?void 0:i.isElement(y)))==null||s?y:y.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(l.floating)),boundary:u,rootBoundary:d,strategy:c})),w=m==="floating"?{x:a,y:n,width:o.floating.width,height:o.floating.height}:o.reference,j=await(i.getOffsetParent==null?void 0:i.getOffsetParent(l.floating)),b=await(i.isElement==null?void 0:i.isElement(j))?await(i.getScale==null?void 0:i.getScale(j))||{x:1,y:1}:{x:1,y:1},k=aa(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:w,offsetParent:j,strategy:c}):w);return{top:(v.top-k.top+p.top)/b.y,bottom:(k.bottom-v.bottom+p.bottom)/b.y,left:(v.left-k.left+p.left)/b.x,right:(k.right-v.right+p.right)/b.x}}const Ux=t=>({name:"arrow",options:t,async fn(r){const{x:s,y:a,placement:n,rects:i,platform:o,elements:l,middlewareData:c}=r,{element:u,padding:d=0}=Et(t,r)||{};if(u==null)return{};const m=qc(d),g={x:s,y:a},x=vi(n),p=bi(x),f=await o.getDimensions(u),y=x==="y",v=y?"top":"left",w=y?"bottom":"right",j=y?"clientHeight":"clientWidth",b=i.reference[p]+i.reference[x]-g[x]-i.floating[p],k=g[x]-i.reference[x],I=await(o.getOffsetParent==null?void 0:o.getOffsetParent(u));let C=I?I[j]:0;(!C||!await(o.isElement==null?void 0:o.isElement(I)))&&(C=l.floating[j]||i.floating[p]);const A=b/2-k/2,B=C/2-f[p]/2-1,D=Ht(m[v],B),L=Ht(m[w],B),N=D,O=C-f[p]-L,E=C/2-f[p]/2+A,z=Mn(N,E,O),W=!c.arrow&&Fr(n)!=null&&E!==z&&i.reference[p]/2-(E<N?D:L)-f[p]/2<0,V=W?E<N?E-N:E-O:0;return{[x]:g[x]+V,data:{[x]:z,centerOffset:E-z-V,...W&&{alignmentOffset:V}},reset:W}}}),Bx=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(r){var s,a;const{placement:n,middlewareData:i,rects:o,initialPlacement:l,platform:c,elements:u}=r,{mainAxis:d=!0,crossAxis:m=!0,fallbackPlacements:g,fallbackStrategy:x="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:f=!0,...y}=Et(t,r);if((s=i.arrow)!=null&&s.alignmentOffset)return{};const v=Ct(n),w=Yt(l),j=Ct(l)===l,b=await(c.isRTL==null?void 0:c.isRTL(u.floating)),k=g||(j||!f?[sa(l)]:Ox(l)),I=p!=="none";!g&&I&&k.push(...Lx(l,f,p,b));const C=[l,...k],A=await us(r,y),B=[];let D=((a=i.flip)==null?void 0:a.overflows)||[];if(d&&B.push(A[v]),m){const E=Mx(n,o,b);B.push(A[E[0]],A[E[1]])}if(D=[...D,{placement:n,overflows:B}],!B.every(E=>E<=0)){var L,N;const E=(((L=i.flip)==null?void 0:L.index)||0)+1,z=C[E];if(z)return{data:{index:E,overflows:D},reset:{placement:z}};let W=(N=D.filter(V=>V.overflows[0]<=0).sort((V,F)=>V.overflows[1]-F.overflows[1])[0])==null?void 0:N.placement;if(!W)switch(x){case"bestFit":{var O;const V=(O=D.filter(F=>{if(I){const S=Yt(F.placement);return S===w||S==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(S=>S>0).reduce((S,H)=>S+H,0)]).sort((F,S)=>F[1]-S[1])[0])==null?void 0:O[0];V&&(W=V);break}case"initialPlacement":W=l;break}if(n!==W)return{reset:{placement:W}}}return{}}}};function Mo(t,r){return{top:t.top-r.height,right:t.right-r.width,bottom:t.bottom-r.height,left:t.left-r.width}}function Oo(t){return Dx.some(r=>t[r]>=0)}const qx=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(r){const{rects:s}=r,{strategy:a="referenceHidden",...n}=Et(t,r);switch(a){case"referenceHidden":{const i=await us(r,{...n,elementContext:"reference"}),o=Mo(i,s.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:Oo(o)}}}case"escaped":{const i=await us(r,{...n,altBoundary:!0}),o=Mo(i,s.floating);return{data:{escapedOffsets:o,escaped:Oo(o)}}}default:return{}}}}};async function zx(t,r){const{placement:s,platform:a,elements:n}=t,i=await(a.isRTL==null?void 0:a.isRTL(n.floating)),o=Ct(s),l=Fr(s),c=Yt(s)==="y",u=["left","top"].includes(o)?-1:1,d=i&&c?-1:1,m=Et(r,t);let{mainAxis:g,crossAxis:x,alignmentAxis:p}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return l&&typeof p=="number"&&(x=l==="end"?p*-1:p),c?{x:x*d,y:g*u}:{x:g*u,y:x*d}}const Wx=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(r){var s,a;const{x:n,y:i,placement:o,middlewareData:l}=r,c=await zx(r,t);return o===((s=l.offset)==null?void 0:s.placement)&&(a=l.arrow)!=null&&a.alignmentOffset?{}:{x:n+c.x,y:i+c.y,data:{...c,placement:o}}}}},Vx=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(r){const{x:s,y:a,placement:n}=r,{mainAxis:i=!0,crossAxis:o=!1,limiter:l={fn:y=>{let{x:v,y:w}=y;return{x:v,y:w}}},...c}=Et(t,r),u={x:s,y:a},d=await us(r,c),m=Yt(Ct(n)),g=yi(m);let x=u[g],p=u[m];if(i){const y=g==="y"?"top":"left",v=g==="y"?"bottom":"right",w=x+d[y],j=x-d[v];x=Mn(w,x,j)}if(o){const y=m==="y"?"top":"left",v=m==="y"?"bottom":"right",w=p+d[y],j=p-d[v];p=Mn(w,p,j)}const f=l.fn({...r,[g]:x,[m]:p});return{...f,data:{x:f.x-s,y:f.y-a,enabled:{[g]:i,[m]:o}}}}}},Hx=function(t){return t===void 0&&(t={}),{options:t,fn(r){const{x:s,y:a,placement:n,rects:i,middlewareData:o}=r,{offset:l=0,mainAxis:c=!0,crossAxis:u=!0}=Et(t,r),d={x:s,y:a},m=Yt(n),g=yi(m);let x=d[g],p=d[m];const f=Et(l,r),y=typeof f=="number"?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(c){const j=g==="y"?"height":"width",b=i.reference[g]-i.floating[j]+y.mainAxis,k=i.reference[g]+i.reference[j]-y.mainAxis;x<b?x=b:x>k&&(x=k)}if(u){var v,w;const j=g==="y"?"width":"height",b=["top","left"].includes(Ct(n)),k=i.reference[m]-i.floating[j]+(b&&((v=o.offset)==null?void 0:v[m])||0)+(b?0:y.crossAxis),I=i.reference[m]+i.reference[j]+(b?0:((w=o.offset)==null?void 0:w[m])||0)-(b?y.crossAxis:0);p<k?p=k:p>I&&(p=I)}return{[g]:x,[m]:p}}}},Yx=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(r){var s,a;const{placement:n,rects:i,platform:o,elements:l}=r,{apply:c=()=>{},...u}=Et(t,r),d=await us(r,u),m=Ct(n),g=Fr(n),x=Yt(n)==="y",{width:p,height:f}=i.floating;let y,v;m==="top"||m==="bottom"?(y=m,v=g===(await(o.isRTL==null?void 0:o.isRTL(l.floating))?"start":"end")?"left":"right"):(v=m,y=g==="end"?"top":"bottom");const w=f-d.top-d.bottom,j=p-d.left-d.right,b=Ht(f-d[y],w),k=Ht(p-d[v],j),I=!r.middlewareData.shift;let C=b,A=k;if((s=r.middlewareData.shift)!=null&&s.enabled.x&&(A=j),(a=r.middlewareData.shift)!=null&&a.enabled.y&&(C=w),I&&!g){const D=Ke(d.left,0),L=Ke(d.right,0),N=Ke(d.top,0),O=Ke(d.bottom,0);x?A=p-2*(D!==0||L!==0?D+L:Ke(d.left,d.right)):C=f-2*(N!==0||O!==0?N+O:Ke(d.top,d.bottom))}await c({...r,availableWidth:A,availableHeight:C});const B=await o.getDimensions(l.floating);return p!==B.width||f!==B.height?{reset:{rects:!0}}:{}}}};function Pa(){return typeof window<"u"}function Ur(t){return zc(t)?(t.nodeName||"").toLowerCase():"#document"}function Xe(t){var r;return(t==null||(r=t.ownerDocument)==null?void 0:r.defaultView)||window}function wt(t){var r;return(r=(zc(t)?t.ownerDocument:t.document)||window.document)==null?void 0:r.documentElement}function zc(t){return Pa()?t instanceof Node||t instanceof Xe(t).Node:!1}function ct(t){return Pa()?t instanceof Element||t instanceof Xe(t).Element:!1}function yt(t){return Pa()?t instanceof HTMLElement||t instanceof Xe(t).HTMLElement:!1}function Io(t){return!Pa()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Xe(t).ShadowRoot}function vs(t){const{overflow:r,overflowX:s,overflowY:a,display:n}=dt(t);return/auto|scroll|overlay|hidden|clip/.test(r+a+s)&&!["inline","contents"].includes(n)}function Gx(t){return["table","td","th"].includes(Ur(t))}function Ta(t){return[":popover-open",":modal"].some(r=>{try{return t.matches(r)}catch{return!1}})}function wi(t){const r=ki(),s=ct(t)?dt(t):t;return["transform","translate","scale","rotate","perspective"].some(a=>s[a]?s[a]!=="none":!1)||(s.containerType?s.containerType!=="normal":!1)||!r&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!r&&(s.filter?s.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(a=>(s.willChange||"").includes(a))||["paint","layout","strict","content"].some(a=>(s.contain||"").includes(a))}function Kx(t){let r=Gt(t);for(;yt(r)&&!Tr(r);){if(wi(r))return r;if(Ta(r))return null;r=Gt(r)}return null}function ki(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Tr(t){return["html","body","#document"].includes(Ur(t))}function dt(t){return Xe(t).getComputedStyle(t)}function Da(t){return ct(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Gt(t){if(Ur(t)==="html")return t;const r=t.assignedSlot||t.parentNode||Io(t)&&t.host||wt(t);return Io(r)?r.host:r}function Wc(t){const r=Gt(t);return Tr(r)?t.ownerDocument?t.ownerDocument.body:t.body:yt(r)&&vs(r)?r:Wc(r)}function hs(t,r,s){var a;r===void 0&&(r=[]),s===void 0&&(s=!0);const n=Wc(t),i=n===((a=t.ownerDocument)==null?void 0:a.body),o=Xe(n);if(i){const l=In(o);return r.concat(o,o.visualViewport||[],vs(n)?n:[],l&&s?hs(l):[])}return r.concat(n,hs(n,[],s))}function In(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Vc(t){const r=dt(t);let s=parseFloat(r.width)||0,a=parseFloat(r.height)||0;const n=yt(t),i=n?t.offsetWidth:s,o=n?t.offsetHeight:a,l=ra(s)!==i||ra(a)!==o;return l&&(s=i,a=o),{width:s,height:a,$:l}}function ji(t){return ct(t)?t:t.contextElement}function Nr(t){const r=ji(t);if(!yt(r))return ft(1);const s=r.getBoundingClientRect(),{width:a,height:n,$:i}=Vc(r);let o=(i?ra(s.width):s.width)/a,l=(i?ra(s.height):s.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!l||!Number.isFinite(l))&&(l=1),{x:o,y:l}}const Jx=ft(0);function Hc(t){const r=Xe(t);return!ki()||!r.visualViewport?Jx:{x:r.visualViewport.offsetLeft,y:r.visualViewport.offsetTop}}function Xx(t,r,s){return r===void 0&&(r=!1),!s||r&&s!==Xe(t)?!1:r}function lr(t,r,s,a){r===void 0&&(r=!1),s===void 0&&(s=!1);const n=t.getBoundingClientRect(),i=ji(t);let o=ft(1);r&&(a?ct(a)&&(o=Nr(a)):o=Nr(t));const l=Xx(i,s,a)?Hc(i):ft(0);let c=(n.left+l.x)/o.x,u=(n.top+l.y)/o.y,d=n.width/o.x,m=n.height/o.y;if(i){const g=Xe(i),x=a&&ct(a)?Xe(a):a;let p=g,f=In(p);for(;f&&a&&x!==p;){const y=Nr(f),v=f.getBoundingClientRect(),w=dt(f),j=v.left+(f.clientLeft+parseFloat(w.paddingLeft))*y.x,b=v.top+(f.clientTop+parseFloat(w.paddingTop))*y.y;c*=y.x,u*=y.y,d*=y.x,m*=y.y,c+=j,u+=b,p=Xe(f),f=In(p)}}return aa({width:d,height:m,x:c,y:u})}function Ni(t,r){const s=Da(t).scrollLeft;return r?r.left+s:lr(wt(t)).left+s}function Yc(t,r,s){s===void 0&&(s=!1);const a=t.getBoundingClientRect(),n=a.left+r.scrollLeft-(s?0:Ni(t,a)),i=a.top+r.scrollTop;return{x:n,y:i}}function Qx(t){let{elements:r,rect:s,offsetParent:a,strategy:n}=t;const i=n==="fixed",o=wt(a),l=r?Ta(r.floating):!1;if(a===o||l&&i)return s;let c={scrollLeft:0,scrollTop:0},u=ft(1);const d=ft(0),m=yt(a);if((m||!m&&!i)&&((Ur(a)!=="body"||vs(o))&&(c=Da(a)),yt(a))){const x=lr(a);u=Nr(a),d.x=x.x+a.clientLeft,d.y=x.y+a.clientTop}const g=o&&!m&&!i?Yc(o,c,!0):ft(0);return{width:s.width*u.x,height:s.height*u.y,x:s.x*u.x-c.scrollLeft*u.x+d.x+g.x,y:s.y*u.y-c.scrollTop*u.y+d.y+g.y}}function Zx(t){return Array.from(t.getClientRects())}function ep(t){const r=wt(t),s=Da(t),a=t.ownerDocument.body,n=Ke(r.scrollWidth,r.clientWidth,a.scrollWidth,a.clientWidth),i=Ke(r.scrollHeight,r.clientHeight,a.scrollHeight,a.clientHeight);let o=-s.scrollLeft+Ni(t);const l=-s.scrollTop;return dt(a).direction==="rtl"&&(o+=Ke(r.clientWidth,a.clientWidth)-n),{width:n,height:i,x:o,y:l}}function tp(t,r){const s=Xe(t),a=wt(t),n=s.visualViewport;let i=a.clientWidth,o=a.clientHeight,l=0,c=0;if(n){i=n.width,o=n.height;const u=ki();(!u||u&&r==="fixed")&&(l=n.offsetLeft,c=n.offsetTop)}return{width:i,height:o,x:l,y:c}}function rp(t,r){const s=lr(t,!0,r==="fixed"),a=s.top+t.clientTop,n=s.left+t.clientLeft,i=yt(t)?Nr(t):ft(1),o=t.clientWidth*i.x,l=t.clientHeight*i.y,c=n*i.x,u=a*i.y;return{width:o,height:l,x:c,y:u}}function Lo(t,r,s){let a;if(r==="viewport")a=tp(t,s);else if(r==="document")a=ep(wt(t));else if(ct(r))a=rp(r,s);else{const n=Hc(t);a={x:r.x-n.x,y:r.y-n.y,width:r.width,height:r.height}}return aa(a)}function Gc(t,r){const s=Gt(t);return s===r||!ct(s)||Tr(s)?!1:dt(s).position==="fixed"||Gc(s,r)}function sp(t,r){const s=r.get(t);if(s)return s;let a=hs(t,[],!1).filter(l=>ct(l)&&Ur(l)!=="body"),n=null;const i=dt(t).position==="fixed";let o=i?Gt(t):t;for(;ct(o)&&!Tr(o);){const l=dt(o),c=wi(o);!c&&l.position==="fixed"&&(n=null),(i?!c&&!n:!c&&l.position==="static"&&!!n&&["absolute","fixed"].includes(n.position)||vs(o)&&!c&&Gc(t,o))?a=a.filter(d=>d!==o):n=l,o=Gt(o)}return r.set(t,a),a}function ap(t){let{element:r,boundary:s,rootBoundary:a,strategy:n}=t;const o=[...s==="clippingAncestors"?Ta(r)?[]:sp(r,this._c):[].concat(s),a],l=o[0],c=o.reduce((u,d)=>{const m=Lo(r,d,n);return u.top=Ke(m.top,u.top),u.right=Ht(m.right,u.right),u.bottom=Ht(m.bottom,u.bottom),u.left=Ke(m.left,u.left),u},Lo(r,l,n));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function np(t){const{width:r,height:s}=Vc(t);return{width:r,height:s}}function ip(t,r,s){const a=yt(r),n=wt(r),i=s==="fixed",o=lr(t,!0,i,r);let l={scrollLeft:0,scrollTop:0};const c=ft(0);if(a||!a&&!i)if((Ur(r)!=="body"||vs(n))&&(l=Da(r)),a){const g=lr(r,!0,i,r);c.x=g.x+r.clientLeft,c.y=g.y+r.clientTop}else n&&(c.x=Ni(n));const u=n&&!a&&!i?Yc(n,l):ft(0),d=o.left+l.scrollLeft-c.x-u.x,m=o.top+l.scrollTop-c.y-u.y;return{x:d,y:m,width:o.width,height:o.height}}function tn(t){return dt(t).position==="static"}function $o(t,r){if(!yt(t)||dt(t).position==="fixed")return null;if(r)return r(t);let s=t.offsetParent;return wt(t)===s&&(s=s.ownerDocument.body),s}function Kc(t,r){const s=Xe(t);if(Ta(t))return s;if(!yt(t)){let n=Gt(t);for(;n&&!Tr(n);){if(ct(n)&&!tn(n))return n;n=Gt(n)}return s}let a=$o(t,r);for(;a&&Gx(a)&&tn(a);)a=$o(a,r);return a&&Tr(a)&&tn(a)&&!wi(a)?s:a||Kx(t)||s}const op=async function(t){const r=this.getOffsetParent||Kc,s=this.getDimensions,a=await s(t.floating);return{reference:ip(t.reference,await r(t.floating),t.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function lp(t){return dt(t).direction==="rtl"}const cp={convertOffsetParentRelativeRectToViewportRelativeRect:Qx,getDocumentElement:wt,getClippingRect:ap,getOffsetParent:Kc,getElementRects:op,getClientRects:Zx,getDimensions:np,getScale:Nr,isElement:ct,isRTL:lp};function Jc(t,r){return t.x===r.x&&t.y===r.y&&t.width===r.width&&t.height===r.height}function dp(t,r){let s=null,a;const n=wt(t);function i(){var l;clearTimeout(a),(l=s)==null||l.disconnect(),s=null}function o(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),i();const u=t.getBoundingClientRect(),{left:d,top:m,width:g,height:x}=u;if(l||r(),!g||!x)return;const p=Rs(m),f=Rs(n.clientWidth-(d+g)),y=Rs(n.clientHeight-(m+x)),v=Rs(d),j={rootMargin:-p+"px "+-f+"px "+-y+"px "+-v+"px",threshold:Ke(0,Ht(1,c))||1};let b=!0;function k(I){const C=I[0].intersectionRatio;if(C!==c){if(!b)return o();C?o(!1,C):a=setTimeout(()=>{o(!1,1e-7)},1e3)}C===1&&!Jc(u,t.getBoundingClientRect())&&o(),b=!1}try{s=new IntersectionObserver(k,{...j,root:n.ownerDocument})}catch{s=new IntersectionObserver(k,j)}s.observe(t)}return o(!0),i}function up(t,r,s,a){a===void 0&&(a={});const{ancestorScroll:n=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=a,u=ji(t),d=n||i?[...u?hs(u):[],...hs(r)]:[];d.forEach(v=>{n&&v.addEventListener("scroll",s,{passive:!0}),i&&v.addEventListener("resize",s)});const m=u&&l?dp(u,s):null;let g=-1,x=null;o&&(x=new ResizeObserver(v=>{let[w]=v;w&&w.target===u&&x&&(x.unobserve(r),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var j;(j=x)==null||j.observe(r)})),s()}),u&&!c&&x.observe(u),x.observe(r));let p,f=c?lr(t):null;c&&y();function y(){const v=lr(t);f&&!Jc(f,v)&&s(),f=v,p=requestAnimationFrame(y)}return s(),()=>{var v;d.forEach(w=>{n&&w.removeEventListener("scroll",s),i&&w.removeEventListener("resize",s)}),m==null||m(),(v=x)==null||v.disconnect(),x=null,c&&cancelAnimationFrame(p)}}const hp=Wx,mp=Vx,gp=Bx,fp=Yx,xp=qx,Fo=Ux,pp=Hx,yp=(t,r,s)=>{const a=new Map,n={platform:cp,...s},i={...n.platform,_c:a};return Fx(t,r,{...n,platform:i})};var Ys=typeof document<"u"?h.useLayoutEffect:h.useEffect;function na(t,r){if(t===r)return!0;if(typeof t!=typeof r)return!1;if(typeof t=="function"&&t.toString()===r.toString())return!0;let s,a,n;if(t&&r&&typeof t=="object"){if(Array.isArray(t)){if(s=t.length,s!==r.length)return!1;for(a=s;a--!==0;)if(!na(t[a],r[a]))return!1;return!0}if(n=Object.keys(t),s=n.length,s!==Object.keys(r).length)return!1;for(a=s;a--!==0;)if(!{}.hasOwnProperty.call(r,n[a]))return!1;for(a=s;a--!==0;){const i=n[a];if(!(i==="_owner"&&t.$$typeof)&&!na(t[i],r[i]))return!1}return!0}return t!==t&&r!==r}function Xc(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Uo(t,r){const s=Xc(t);return Math.round(r*s)/s}function rn(t){const r=h.useRef(t);return Ys(()=>{r.current=t}),r}function bp(t){t===void 0&&(t={});const{placement:r="bottom",strategy:s="absolute",middleware:a=[],platform:n,elements:{reference:i,floating:o}={},transform:l=!0,whileElementsMounted:c,open:u}=t,[d,m]=h.useState({x:0,y:0,strategy:s,placement:r,middlewareData:{},isPositioned:!1}),[g,x]=h.useState(a);na(g,a)||x(a);const[p,f]=h.useState(null),[y,v]=h.useState(null),w=h.useCallback(F=>{F!==I.current&&(I.current=F,f(F))},[]),j=h.useCallback(F=>{F!==C.current&&(C.current=F,v(F))},[]),b=i||p,k=o||y,I=h.useRef(null),C=h.useRef(null),A=h.useRef(d),B=c!=null,D=rn(c),L=rn(n),N=rn(u),O=h.useCallback(()=>{if(!I.current||!C.current)return;const F={placement:r,strategy:s,middleware:g};L.current&&(F.platform=L.current),yp(I.current,C.current,F).then(S=>{const H={...S,isPositioned:N.current!==!1};E.current&&!na(A.current,H)&&(A.current=H,ua.flushSync(()=>{m(H)}))})},[g,r,s,L,N]);Ys(()=>{u===!1&&A.current.isPositioned&&(A.current.isPositioned=!1,m(F=>({...F,isPositioned:!1})))},[u]);const E=h.useRef(!1);Ys(()=>(E.current=!0,()=>{E.current=!1}),[]),Ys(()=>{if(b&&(I.current=b),k&&(C.current=k),b&&k){if(D.current)return D.current(b,k,O);O()}},[b,k,O,D,B]);const z=h.useMemo(()=>({reference:I,floating:C,setReference:w,setFloating:j}),[w,j]),W=h.useMemo(()=>({reference:b,floating:k}),[b,k]),V=h.useMemo(()=>{const F={position:s,left:0,top:0};if(!W.floating)return F;const S=Uo(W.floating,d.x),H=Uo(W.floating,d.y);return l?{...F,transform:"translate("+S+"px, "+H+"px)",...Xc(W.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:S,top:H}},[s,l,W.floating,d.x,d.y]);return h.useMemo(()=>({...d,update:O,refs:z,elements:W,floatingStyles:V}),[d,O,z,W,V])}const vp=t=>{function r(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:t,fn(s){const{element:a,padding:n}=typeof t=="function"?t(s):t;return a&&r(a)?a.current!=null?Fo({element:a.current,padding:n}).fn(s):{}:a?Fo({element:a,padding:n}).fn(s):{}}}},wp=(t,r)=>({...hp(t),options:[t,r]}),kp=(t,r)=>({...mp(t),options:[t,r]}),jp=(t,r)=>({...pp(t),options:[t,r]}),Np=(t,r)=>({...gp(t),options:[t,r]}),_p=(t,r)=>({...fp(t),options:[t,r]}),Sp=(t,r)=>({...xp(t),options:[t,r]}),Ep=(t,r)=>({...vp(t),options:[t,r]});var Cp="Arrow",Qc=h.forwardRef((t,r)=>{const{children:s,width:a=10,height:n=5,...i}=t;return e.jsx(Me.svg,{...i,ref:r,width:a,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?s:e.jsx("polygon",{points:"0,0 30,0 15,10"})})});Qc.displayName=Cp;var Pp=Qc;function Tp(t){const[r,s]=h.useState(void 0);return St(()=>{if(t){s({width:t.offsetWidth,height:t.offsetHeight});const a=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const i=n[0];let o,l;if("borderBoxSize"in i){const c=i.borderBoxSize,u=Array.isArray(c)?c[0]:c;o=u.inlineSize,l=u.blockSize}else o=t.offsetWidth,l=t.offsetHeight;s({width:o,height:l})});return a.observe(t,{box:"border-box"}),()=>a.unobserve(t)}else s(void 0)},[t]),r}var _i="Popper",[Zc,ed]=Ir(_i),[Dp,td]=Zc(_i),rd=t=>{const{__scopePopper:r,children:s}=t,[a,n]=h.useState(null);return e.jsx(Dp,{scope:r,anchor:a,onAnchorChange:n,children:s})};rd.displayName=_i;var sd="PopperAnchor",ad=h.forwardRef((t,r)=>{const{__scopePopper:s,virtualRef:a,...n}=t,i=td(sd,s),o=h.useRef(null),l=ze(r,o);return h.useEffect(()=>{i.onAnchorChange((a==null?void 0:a.current)||o.current)}),a?null:e.jsx(Me.div,{...n,ref:l})});ad.displayName=sd;var Si="PopperContent",[Rp,Ap]=Zc(Si),nd=h.forwardRef((t,r)=>{var K,ce,ae,P,$,Z;const{__scopePopper:s,side:a="bottom",sideOffset:n=0,align:i="center",alignOffset:o=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:u=[],collisionPadding:d=0,sticky:m="partial",hideWhenDetached:g=!1,updatePositionStrategy:x="optimized",onPlaced:p,...f}=t,y=td(Si,s),[v,w]=h.useState(null),j=ze(r,ie=>w(ie)),[b,k]=h.useState(null),I=Tp(b),C=(I==null?void 0:I.width)??0,A=(I==null?void 0:I.height)??0,B=a+(i!=="center"?"-"+i:""),D=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},L=Array.isArray(u)?u:[u],N=L.length>0,O={padding:D,boundary:L.filter(Op),altBoundary:N},{refs:E,floatingStyles:z,placement:W,isPositioned:V,middlewareData:F}=bp({strategy:"fixed",placement:B,whileElementsMounted:(...ie)=>up(...ie,{animationFrame:x==="always"}),elements:{reference:y.anchor},middleware:[wp({mainAxis:n+A,alignmentAxis:o}),c&&kp({mainAxis:!0,crossAxis:!1,limiter:m==="partial"?jp():void 0,...O}),c&&Np({...O}),_p({...O,apply:({elements:ie,rects:he,availableWidth:ge,availableHeight:q})=>{const{width:oe,height:de}=he.reference,le=ie.floating.style;le.setProperty("--radix-popper-available-width",`${ge}px`),le.setProperty("--radix-popper-available-height",`${q}px`),le.setProperty("--radix-popper-anchor-width",`${oe}px`),le.setProperty("--radix-popper-anchor-height",`${de}px`)}}),b&&Ep({element:b,padding:l}),Ip({arrowWidth:C,arrowHeight:A}),g&&Sp({strategy:"referenceHidden",...O})]}),[S,H]=ld(W),ee=Ze(p);St(()=>{V&&(ee==null||ee())},[V,ee]);const se=(K=F.arrow)==null?void 0:K.x,R=(ce=F.arrow)==null?void 0:ce.y,Y=((ae=F.arrow)==null?void 0:ae.centerOffset)!==0,[te,M]=h.useState();return St(()=>{v&&M(window.getComputedStyle(v).zIndex)},[v]),e.jsx("div",{ref:E.setFloating,"data-radix-popper-content-wrapper":"",style:{...z,transform:V?z.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:te,"--radix-popper-transform-origin":[(P=F.transformOrigin)==null?void 0:P.x,($=F.transformOrigin)==null?void 0:$.y].join(" "),...((Z=F.hide)==null?void 0:Z.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:e.jsx(Rp,{scope:s,placedSide:S,onArrowChange:k,arrowX:se,arrowY:R,shouldHideArrow:Y,children:e.jsx(Me.div,{"data-side":S,"data-align":H,...f,ref:j,style:{...f.style,animation:V?void 0:"none"}})})})});nd.displayName=Si;var id="PopperArrow",Mp={top:"bottom",right:"left",bottom:"top",left:"right"},od=h.forwardRef(function(r,s){const{__scopePopper:a,...n}=r,i=Ap(id,a),o=Mp[i.placedSide];return e.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:e.jsx(Pp,{...n,ref:s,style:{...n.style,display:"block"}})})});od.displayName=id;function Op(t){return t!==null}var Ip=t=>({name:"transformOrigin",options:t,fn(r){var y,v,w;const{placement:s,rects:a,middlewareData:n}=r,o=((y=n.arrow)==null?void 0:y.centerOffset)!==0,l=o?0:t.arrowWidth,c=o?0:t.arrowHeight,[u,d]=ld(s),m={start:"0%",center:"50%",end:"100%"}[d],g=(((v=n.arrow)==null?void 0:v.x)??0)+l/2,x=(((w=n.arrow)==null?void 0:w.y)??0)+c/2;let p="",f="";return u==="bottom"?(p=o?m:`${g}px`,f=`${-c}px`):u==="top"?(p=o?m:`${g}px`,f=`${a.floating.height+c}px`):u==="right"?(p=`${-c}px`,f=o?m:`${x}px`):u==="left"&&(p=`${a.floating.width+c}px`,f=o?m:`${x}px`),{data:{x:p,y:f}}}});function ld(t){const[r,s="center"]=t.split("-");return[r,s]}var Lp=rd,$p=ad,Fp=nd,Up=od,sn="rovingFocusGroup.onEntryFocus",Bp={bubbles:!1,cancelable:!0},ws="RovingFocusGroup",[Ln,cd,qp]=li(ws),[zp,dd]=Ir(ws,[qp]),[Wp,Vp]=zp(ws),ud=h.forwardRef((t,r)=>e.jsx(Ln.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Ln.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Hp,{...t,ref:r})})}));ud.displayName=ws;var Hp=h.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:s,orientation:a,loop:n=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:u,preventScrollOnEntryFocus:d=!1,...m}=t,g=h.useRef(null),x=ze(r,g),p=Fc(i),[f,y]=hi({prop:o,defaultProp:l??null,onChange:c,caller:ws}),[v,w]=h.useState(!1),j=Ze(u),b=cd(s),k=h.useRef(!1),[I,C]=h.useState(0);return h.useEffect(()=>{const A=g.current;if(A)return A.addEventListener(sn,j),()=>A.removeEventListener(sn,j)},[j]),e.jsx(Wp,{scope:s,orientation:a,dir:p,loop:n,currentTabStopId:f,onItemFocus:h.useCallback(A=>y(A),[y]),onItemShiftTab:h.useCallback(()=>w(!0),[]),onFocusableItemAdd:h.useCallback(()=>C(A=>A+1),[]),onFocusableItemRemove:h.useCallback(()=>C(A=>A-1),[]),children:e.jsx(Me.div,{tabIndex:v||I===0?-1:0,"data-orientation":a,...m,ref:x,style:{outline:"none",...t.style},onMouseDown:xe(t.onMouseDown,()=>{k.current=!0}),onFocus:xe(t.onFocus,A=>{const B=!k.current;if(A.target===A.currentTarget&&B&&!v){const D=new CustomEvent(sn,Bp);if(A.currentTarget.dispatchEvent(D),!D.defaultPrevented){const L=b().filter(W=>W.focusable),N=L.find(W=>W.active),O=L.find(W=>W.id===f),z=[N,O,...L].filter(Boolean).map(W=>W.ref.current);gd(z,d)}}k.current=!1}),onBlur:xe(t.onBlur,()=>w(!1))})})}),hd="RovingFocusGroupItem",md=h.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:s,focusable:a=!0,active:n=!1,tabStopId:i,children:o,...l}=t,c=An(),u=i||c,d=Vp(hd,s),m=d.currentTabStopId===u,g=cd(s),{onFocusableItemAdd:x,onFocusableItemRemove:p,currentTabStopId:f}=d;return h.useEffect(()=>{if(a)return x(),()=>p()},[a,x,p]),e.jsx(Ln.ItemSlot,{scope:s,id:u,focusable:a,active:n,children:e.jsx(Me.span,{tabIndex:m?0:-1,"data-orientation":d.orientation,...l,ref:r,onMouseDown:xe(t.onMouseDown,y=>{a?d.onItemFocus(u):y.preventDefault()}),onFocus:xe(t.onFocus,()=>d.onItemFocus(u)),onKeyDown:xe(t.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){d.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const v=Kp(y,d.orientation,d.dir);if(v!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let j=g().filter(b=>b.focusable).map(b=>b.ref.current);if(v==="last")j.reverse();else if(v==="prev"||v==="next"){v==="prev"&&j.reverse();const b=j.indexOf(y.currentTarget);j=d.loop?Jp(j,b+1):j.slice(b+1)}setTimeout(()=>gd(j))}}),children:typeof o=="function"?o({isCurrentTabStop:m,hasTabStop:f!=null}):o})})});md.displayName=hd;var Yp={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Gp(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Kp(t,r,s){const a=Gp(t.key,s);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return Yp[a]}function gd(t,r=!1){const s=document.activeElement;for(const a of t)if(a===s||(a.focus({preventScroll:r}),document.activeElement!==s))return}function Jp(t,r){return t.map((s,a)=>t[(r+a)%t.length])}var Xp=ud,Qp=md,Zp=function(t){if(typeof document>"u")return null;var r=Array.isArray(t)?t[0]:t;return r.ownerDocument.body},fr=new WeakMap,As=new WeakMap,Ms={},an=0,fd=function(t){return t&&(t.host||fd(t.parentNode))},ey=function(t,r){return r.map(function(s){if(t.contains(s))return s;var a=fd(s);return a&&t.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",t,". Doing nothing"),null)}).filter(function(s){return!!s})},ty=function(t,r,s,a){var n=ey(r,Array.isArray(t)?t:[t]);Ms[s]||(Ms[s]=new WeakMap);var i=Ms[s],o=[],l=new Set,c=new Set(n),u=function(m){!m||l.has(m)||(l.add(m),u(m.parentNode))};n.forEach(u);var d=function(m){!m||c.has(m)||Array.prototype.forEach.call(m.children,function(g){if(l.has(g))d(g);else try{var x=g.getAttribute(a),p=x!==null&&x!=="false",f=(fr.get(g)||0)+1,y=(i.get(g)||0)+1;fr.set(g,f),i.set(g,y),o.push(g),f===1&&p&&As.set(g,!0),y===1&&g.setAttribute(s,"true"),p||g.setAttribute(a,"true")}catch(v){console.error("aria-hidden: cannot operate on ",g,v)}})};return d(r),l.clear(),an++,function(){o.forEach(function(m){var g=fr.get(m)-1,x=i.get(m)-1;fr.set(m,g),i.set(m,x),g||(As.has(m)||m.removeAttribute(a),As.delete(m)),x||m.removeAttribute(s)}),an--,an||(fr=new WeakMap,fr=new WeakMap,As=new WeakMap,Ms={})}},ry=function(t,r,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(t)?t:[t]),n=Zp(t);return n?(a.push.apply(a,Array.from(n.querySelectorAll("[aria-live]"))),ty(a,n,s,"aria-hidden")):function(){return null}},mt=function(){return mt=Object.assign||function(r){for(var s,a=1,n=arguments.length;a<n;a++){s=arguments[a];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])}return r},mt.apply(this,arguments)};function xd(t,r){var s={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&r.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)r.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(s[a[n]]=t[a[n]]);return s}function sy(t,r,s){if(s||arguments.length===2)for(var a=0,n=r.length,i;a<n;a++)(i||!(a in r))&&(i||(i=Array.prototype.slice.call(r,0,a)),i[a]=r[a]);return t.concat(i||Array.prototype.slice.call(r))}var Gs="right-scroll-bar-position",Ks="width-before-scroll-bar",ay="with-scroll-bars-hidden",ny="--removed-body-scroll-bar-size";function nn(t,r){return typeof t=="function"?t(r):t&&(t.current=r),t}function iy(t,r){var s=h.useState(function(){return{value:t,callback:r,facade:{get current(){return s.value},set current(a){var n=s.value;n!==a&&(s.value=a,s.callback(a,n))}}}})[0];return s.callback=r,s.facade}var oy=typeof window<"u"?h.useLayoutEffect:h.useEffect,Bo=new WeakMap;function ly(t,r){var s=iy(null,function(a){return t.forEach(function(n){return nn(n,a)})});return oy(function(){var a=Bo.get(s);if(a){var n=new Set(a),i=new Set(t),o=s.current;n.forEach(function(l){i.has(l)||nn(l,null)}),i.forEach(function(l){n.has(l)||nn(l,o)})}Bo.set(s,t)},[t]),s}function cy(t){return t}function dy(t,r){r===void 0&&(r=cy);var s=[],a=!1,n={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:t},useMedium:function(i){var o=r(i,a);return s.push(o),function(){s=s.filter(function(l){return l!==o})}},assignSyncMedium:function(i){for(a=!0;s.length;){var o=s;s=[],o.forEach(i)}s={push:function(l){return i(l)},filter:function(){return s}}},assignMedium:function(i){a=!0;var o=[];if(s.length){var l=s;s=[],l.forEach(i),o=s}var c=function(){var d=o;o=[],d.forEach(i)},u=function(){return Promise.resolve().then(c)};u(),s={push:function(d){o.push(d),u()},filter:function(d){return o=o.filter(d),s}}}};return n}function uy(t){t===void 0&&(t={});var r=dy(null);return r.options=mt({async:!0,ssr:!1},t),r}var pd=function(t){var r=t.sideCar,s=xd(t,["sideCar"]);if(!r)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=r.read();if(!a)throw new Error("Sidecar medium not found");return h.createElement(a,mt({},s))};pd.isSideCarExport=!0;function hy(t,r){return t.useMedium(r),pd}var yd=uy(),on=function(){},Ra=h.forwardRef(function(t,r){var s=h.useRef(null),a=h.useState({onScrollCapture:on,onWheelCapture:on,onTouchMoveCapture:on}),n=a[0],i=a[1],o=t.forwardProps,l=t.children,c=t.className,u=t.removeScrollBar,d=t.enabled,m=t.shards,g=t.sideCar,x=t.noIsolation,p=t.inert,f=t.allowPinchZoom,y=t.as,v=y===void 0?"div":y,w=t.gapMode,j=xd(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=g,k=ly([s,r]),I=mt(mt({},j),n);return h.createElement(h.Fragment,null,d&&h.createElement(b,{sideCar:yd,removeScrollBar:u,shards:m,noIsolation:x,inert:p,setCallbacks:i,allowPinchZoom:!!f,lockRef:s,gapMode:w}),o?h.cloneElement(h.Children.only(l),mt(mt({},I),{ref:k})):h.createElement(v,mt({},I,{className:c,ref:k}),l))});Ra.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Ra.classNames={fullWidth:Ks,zeroRight:Gs};var my=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function gy(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var r=my();return r&&t.setAttribute("nonce",r),t}function fy(t,r){t.styleSheet?t.styleSheet.cssText=r:t.appendChild(document.createTextNode(r))}function xy(t){var r=document.head||document.getElementsByTagName("head")[0];r.appendChild(t)}var py=function(){var t=0,r=null;return{add:function(s){t==0&&(r=gy())&&(fy(r,s),xy(r)),t++},remove:function(){t--,!t&&r&&(r.parentNode&&r.parentNode.removeChild(r),r=null)}}},yy=function(){var t=py();return function(r,s){h.useEffect(function(){return t.add(r),function(){t.remove()}},[r&&s])}},bd=function(){var t=yy(),r=function(s){var a=s.styles,n=s.dynamic;return t(a,n),null};return r},by={left:0,top:0,right:0,gap:0},ln=function(t){return parseInt(t||"",10)||0},vy=function(t){var r=window.getComputedStyle(document.body),s=r[t==="padding"?"paddingLeft":"marginLeft"],a=r[t==="padding"?"paddingTop":"marginTop"],n=r[t==="padding"?"paddingRight":"marginRight"];return[ln(s),ln(a),ln(n)]},wy=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return by;var r=vy(t),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:r[0],top:r[1],right:r[2],gap:Math.max(0,a-s+r[2]-r[0])}},ky=bd(),_r="data-scroll-locked",jy=function(t,r,s,a){var n=t.left,i=t.top,o=t.right,l=t.gap;return s===void 0&&(s="margin"),`
  .`.concat(ay,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(l,"px ").concat(a,`;
  }
  body[`).concat(_r,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([r&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(n,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(l,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Gs,` {
    right: `).concat(l,"px ").concat(a,`;
  }
  
  .`).concat(Ks,` {
    margin-right: `).concat(l,"px ").concat(a,`;
  }
  
  .`).concat(Gs," .").concat(Gs,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(Ks," .").concat(Ks,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(_r,`] {
    `).concat(ny,": ").concat(l,`px;
  }
`)},qo=function(){var t=parseInt(document.body.getAttribute(_r)||"0",10);return isFinite(t)?t:0},Ny=function(){h.useEffect(function(){return document.body.setAttribute(_r,(qo()+1).toString()),function(){var t=qo()-1;t<=0?document.body.removeAttribute(_r):document.body.setAttribute(_r,t.toString())}},[])},_y=function(t){var r=t.noRelative,s=t.noImportant,a=t.gapMode,n=a===void 0?"margin":a;Ny();var i=h.useMemo(function(){return wy(n)},[n]);return h.createElement(ky,{styles:jy(i,!r,n,s?"":"!important")})},$n=!1;if(typeof window<"u")try{var Os=Object.defineProperty({},"passive",{get:function(){return $n=!0,!0}});window.addEventListener("test",Os,Os),window.removeEventListener("test",Os,Os)}catch{$n=!1}var xr=$n?{passive:!1}:!1,Sy=function(t){return t.tagName==="TEXTAREA"},vd=function(t,r){if(!(t instanceof Element))return!1;var s=window.getComputedStyle(t);return s[r]!=="hidden"&&!(s.overflowY===s.overflowX&&!Sy(t)&&s[r]==="visible")},Ey=function(t){return vd(t,"overflowY")},Cy=function(t){return vd(t,"overflowX")},zo=function(t,r){var s=r.ownerDocument,a=r;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var n=wd(t,a);if(n){var i=kd(t,a),o=i[1],l=i[2];if(o>l)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},Py=function(t){var r=t.scrollTop,s=t.scrollHeight,a=t.clientHeight;return[r,s,a]},Ty=function(t){var r=t.scrollLeft,s=t.scrollWidth,a=t.clientWidth;return[r,s,a]},wd=function(t,r){return t==="v"?Ey(r):Cy(r)},kd=function(t,r){return t==="v"?Py(r):Ty(r)},Dy=function(t,r){return t==="h"&&r==="rtl"?-1:1},Ry=function(t,r,s,a,n){var i=Dy(t,window.getComputedStyle(r).direction),o=i*a,l=s.target,c=r.contains(l),u=!1,d=o>0,m=0,g=0;do{var x=kd(t,l),p=x[0],f=x[1],y=x[2],v=f-y-i*p;(p||v)&&wd(t,l)&&(m+=v,g+=p),l instanceof ShadowRoot?l=l.host:l=l.parentNode}while(!c&&l!==document.body||c&&(r.contains(l)||r===l));return(d&&Math.abs(m)<1||!d&&Math.abs(g)<1)&&(u=!0),u},Is=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Wo=function(t){return[t.deltaX,t.deltaY]},Vo=function(t){return t&&"current"in t?t.current:t},Ay=function(t,r){return t[0]===r[0]&&t[1]===r[1]},My=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Oy=0,pr=[];function Iy(t){var r=h.useRef([]),s=h.useRef([0,0]),a=h.useRef(),n=h.useState(Oy++)[0],i=h.useState(bd)[0],o=h.useRef(t);h.useEffect(function(){o.current=t},[t]),h.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(n));var f=sy([t.lockRef.current],(t.shards||[]).map(Vo),!0).filter(Boolean);return f.forEach(function(y){return y.classList.add("allow-interactivity-".concat(n))}),function(){document.body.classList.remove("block-interactivity-".concat(n)),f.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(n))})}}},[t.inert,t.lockRef.current,t.shards]);var l=h.useCallback(function(f,y){if("touches"in f&&f.touches.length===2||f.type==="wheel"&&f.ctrlKey)return!o.current.allowPinchZoom;var v=Is(f),w=s.current,j="deltaX"in f?f.deltaX:w[0]-v[0],b="deltaY"in f?f.deltaY:w[1]-v[1],k,I=f.target,C=Math.abs(j)>Math.abs(b)?"h":"v";if("touches"in f&&C==="h"&&I.type==="range")return!1;var A=zo(C,I);if(!A)return!0;if(A?k=C:(k=C==="v"?"h":"v",A=zo(C,I)),!A)return!1;if(!a.current&&"changedTouches"in f&&(j||b)&&(a.current=k),!k)return!0;var B=a.current||k;return Ry(B,y,f,B==="h"?j:b)},[]),c=h.useCallback(function(f){var y=f;if(!(!pr.length||pr[pr.length-1]!==i)){var v="deltaY"in y?Wo(y):Is(y),w=r.current.filter(function(k){return k.name===y.type&&(k.target===y.target||y.target===k.shadowParent)&&Ay(k.delta,v)})[0];if(w&&w.should){y.cancelable&&y.preventDefault();return}if(!w){var j=(o.current.shards||[]).map(Vo).filter(Boolean).filter(function(k){return k.contains(y.target)}),b=j.length>0?l(y,j[0]):!o.current.noIsolation;b&&y.cancelable&&y.preventDefault()}}},[]),u=h.useCallback(function(f,y,v,w){var j={name:f,delta:y,target:v,should:w,shadowParent:Ly(v)};r.current.push(j),setTimeout(function(){r.current=r.current.filter(function(b){return b!==j})},1)},[]),d=h.useCallback(function(f){s.current=Is(f),a.current=void 0},[]),m=h.useCallback(function(f){u(f.type,Wo(f),f.target,l(f,t.lockRef.current))},[]),g=h.useCallback(function(f){u(f.type,Is(f),f.target,l(f,t.lockRef.current))},[]);h.useEffect(function(){return pr.push(i),t.setCallbacks({onScrollCapture:m,onWheelCapture:m,onTouchMoveCapture:g}),document.addEventListener("wheel",c,xr),document.addEventListener("touchmove",c,xr),document.addEventListener("touchstart",d,xr),function(){pr=pr.filter(function(f){return f!==i}),document.removeEventListener("wheel",c,xr),document.removeEventListener("touchmove",c,xr),document.removeEventListener("touchstart",d,xr)}},[]);var x=t.removeScrollBar,p=t.inert;return h.createElement(h.Fragment,null,p?h.createElement(i,{styles:My(n)}):null,x?h.createElement(_y,{gapMode:t.gapMode}):null)}function Ly(t){for(var r=null;t!==null;)t instanceof ShadowRoot&&(r=t.host,t=t.host),t=t.parentNode;return r}const $y=hy(yd,Iy);var jd=h.forwardRef(function(t,r){return h.createElement(Ra,mt({},t,{ref:r,sideCar:$y}))});jd.classNames=Ra.classNames;var Fn=["Enter"," "],Fy=["ArrowDown","PageUp","Home"],Nd=["ArrowUp","PageDown","End"],Uy=[...Fy,...Nd],By={ltr:[...Fn,"ArrowRight"],rtl:[...Fn,"ArrowLeft"]},qy={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ks="Menu",[ms,zy,Wy]=li(ks),[dr,_d]=Ir(ks,[Wy,ed,dd]),Aa=ed(),Sd=dd(),[Vy,ur]=dr(ks),[Hy,js]=dr(ks),Ed=t=>{const{__scopeMenu:r,open:s=!1,children:a,dir:n,onOpenChange:i,modal:o=!0}=t,l=Aa(r),[c,u]=h.useState(null),d=h.useRef(!1),m=Ze(i),g=Fc(n);return h.useEffect(()=>{const x=()=>{d.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>d.current=!1;return document.addEventListener("keydown",x,{capture:!0}),()=>{document.removeEventListener("keydown",x,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),e.jsx(Lp,{...l,children:e.jsx(Vy,{scope:r,open:s,onOpenChange:m,content:c,onContentChange:u,children:e.jsx(Hy,{scope:r,onClose:h.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:d,dir:g,modal:o,children:a})})})};Ed.displayName=ks;var Yy="MenuAnchor",Ei=h.forwardRef((t,r)=>{const{__scopeMenu:s,...a}=t,n=Aa(s);return e.jsx($p,{...n,...a,ref:r})});Ei.displayName=Yy;var Ci="MenuPortal",[Gy,Cd]=dr(Ci,{forceMount:void 0}),Pd=t=>{const{__scopeMenu:r,forceMount:s,children:a,container:n}=t,i=ur(Ci,r);return e.jsx(Gy,{scope:r,forceMount:s,children:e.jsx(Lr,{present:s||i.open,children:e.jsx(ui,{asChild:!0,container:n,children:a})})})};Pd.displayName=Ci;var tt="MenuContent",[Ky,Pi]=dr(tt),Td=h.forwardRef((t,r)=>{const s=Cd(tt,t.__scopeMenu),{forceMount:a=s.forceMount,...n}=t,i=ur(tt,t.__scopeMenu),o=js(tt,t.__scopeMenu);return e.jsx(ms.Provider,{scope:t.__scopeMenu,children:e.jsx(Lr,{present:a||i.open,children:e.jsx(ms.Slot,{scope:t.__scopeMenu,children:o.modal?e.jsx(Jy,{...n,ref:r}):e.jsx(Xy,{...n,ref:r})})})})}),Jy=h.forwardRef((t,r)=>{const s=ur(tt,t.__scopeMenu),a=h.useRef(null),n=ze(r,a);return h.useEffect(()=>{const i=a.current;if(i)return ry(i)},[]),e.jsx(Ti,{...t,ref:n,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:xe(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),Xy=h.forwardRef((t,r)=>{const s=ur(tt,t.__scopeMenu);return e.jsx(Ti,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>s.onOpenChange(!1)})}),Qy=ta("MenuContent.ScrollLock"),Ti=h.forwardRef((t,r)=>{const{__scopeMenu:s,loop:a=!1,trapFocus:n,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:m,onInteractOutside:g,onDismiss:x,disableOutsideScroll:p,...f}=t,y=ur(tt,s),v=js(tt,s),w=Aa(s),j=Sd(s),b=zy(s),[k,I]=h.useState(null),C=h.useRef(null),A=ze(r,C,y.onContentChange),B=h.useRef(0),D=h.useRef(""),L=h.useRef(0),N=h.useRef(null),O=h.useRef("right"),E=h.useRef(0),z=p?jd:h.Fragment,W=p?{as:Qy,allowPinchZoom:!0}:void 0,V=S=>{var K,ce;const H=D.current+S,ee=b().filter(ae=>!ae.disabled),se=document.activeElement,R=(K=ee.find(ae=>ae.ref.current===se))==null?void 0:K.textValue,Y=ee.map(ae=>ae.textValue),te=db(Y,H,R),M=(ce=ee.find(ae=>ae.textValue===te))==null?void 0:ce.ref.current;(function ae(P){D.current=P,window.clearTimeout(B.current),P!==""&&(B.current=window.setTimeout(()=>ae(""),1e3))})(H),M&&setTimeout(()=>M.focus())};h.useEffect(()=>()=>window.clearTimeout(B.current),[]),wx();const F=h.useCallback(S=>{var ee,se;return O.current===((ee=N.current)==null?void 0:ee.side)&&hb(S,(se=N.current)==null?void 0:se.area)},[]);return e.jsx(Ky,{scope:s,searchRef:D,onItemEnter:h.useCallback(S=>{F(S)&&S.preventDefault()},[F]),onItemLeave:h.useCallback(S=>{var H;F(S)||((H=C.current)==null||H.focus(),I(null))},[F]),onTriggerLeave:h.useCallback(S=>{F(S)&&S.preventDefault()},[F]),pointerGraceTimerRef:L,onPointerGraceIntentChange:h.useCallback(S=>{N.current=S},[]),children:e.jsx(z,{...W,children:e.jsx(Uc,{asChild:!0,trapped:n,onMountAutoFocus:xe(i,S=>{var H;S.preventDefault(),(H=C.current)==null||H.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:e.jsx(di,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:m,onInteractOutside:g,onDismiss:x,children:e.jsx(Xp,{asChild:!0,...j,dir:v.dir,orientation:"vertical",loop:a,currentTabStopId:k,onCurrentTabStopIdChange:I,onEntryFocus:xe(c,S=>{v.isUsingKeyboardRef.current||S.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Fp,{role:"menu","aria-orientation":"vertical","data-state":Hd(y.open),"data-radix-menu-content":"",dir:v.dir,...w,...f,ref:A,style:{outline:"none",...f.style},onKeyDown:xe(f.onKeyDown,S=>{const ee=S.target.closest("[data-radix-menu-content]")===S.currentTarget,se=S.ctrlKey||S.altKey||S.metaKey,R=S.key.length===1;ee&&(S.key==="Tab"&&S.preventDefault(),!se&&R&&V(S.key));const Y=C.current;if(S.target!==Y||!Uy.includes(S.key))return;S.preventDefault();const M=b().filter(K=>!K.disabled).map(K=>K.ref.current);Nd.includes(S.key)&&M.reverse(),lb(M)}),onBlur:xe(t.onBlur,S=>{S.currentTarget.contains(S.target)||(window.clearTimeout(B.current),D.current="")}),onPointerMove:xe(t.onPointerMove,gs(S=>{const H=S.target,ee=E.current!==S.clientX;if(S.currentTarget.contains(H)&&ee){const se=S.clientX>E.current?"right":"left";O.current=se,E.current=S.clientX}}))})})})})})})});Td.displayName=tt;var Zy="MenuGroup",Di=h.forwardRef((t,r)=>{const{__scopeMenu:s,...a}=t;return e.jsx(Me.div,{role:"group",...a,ref:r})});Di.displayName=Zy;var eb="MenuLabel",Dd=h.forwardRef((t,r)=>{const{__scopeMenu:s,...a}=t;return e.jsx(Me.div,{...a,ref:r})});Dd.displayName=eb;var ia="MenuItem",Ho="menu.itemSelect",Ma=h.forwardRef((t,r)=>{const{disabled:s=!1,onSelect:a,...n}=t,i=h.useRef(null),o=js(ia,t.__scopeMenu),l=Pi(ia,t.__scopeMenu),c=ze(r,i),u=h.useRef(!1),d=()=>{const m=i.current;if(!s&&m){const g=new CustomEvent(Ho,{bubbles:!0,cancelable:!0});m.addEventListener(Ho,x=>a==null?void 0:a(x),{once:!0}),ci(m,g),g.defaultPrevented?u.current=!1:o.onClose()}};return e.jsx(Rd,{...n,ref:c,disabled:s,onClick:xe(t.onClick,d),onPointerDown:m=>{var g;(g=t.onPointerDown)==null||g.call(t,m),u.current=!0},onPointerUp:xe(t.onPointerUp,m=>{var g;u.current||(g=m.currentTarget)==null||g.click()}),onKeyDown:xe(t.onKeyDown,m=>{const g=l.searchRef.current!=="";s||g&&m.key===" "||Fn.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});Ma.displayName=ia;var Rd=h.forwardRef((t,r)=>{const{__scopeMenu:s,disabled:a=!1,textValue:n,...i}=t,o=Pi(ia,s),l=Sd(s),c=h.useRef(null),u=ze(r,c),[d,m]=h.useState(!1),[g,x]=h.useState("");return h.useEffect(()=>{const p=c.current;p&&x((p.textContent??"").trim())},[i.children]),e.jsx(ms.ItemSlot,{scope:s,disabled:a,textValue:n??g,children:e.jsx(Qp,{asChild:!0,...l,focusable:!a,children:e.jsx(Me.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...i,ref:u,onPointerMove:xe(t.onPointerMove,gs(p=>{a?o.onItemLeave(p):(o.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:xe(t.onPointerLeave,gs(p=>o.onItemLeave(p))),onFocus:xe(t.onFocus,()=>m(!0)),onBlur:xe(t.onBlur,()=>m(!1))})})})}),tb="MenuCheckboxItem",Ad=h.forwardRef((t,r)=>{const{checked:s=!1,onCheckedChange:a,...n}=t;return e.jsx($d,{scope:t.__scopeMenu,checked:s,children:e.jsx(Ma,{role:"menuitemcheckbox","aria-checked":oa(s)?"mixed":s,...n,ref:r,"data-state":Ai(s),onSelect:xe(n.onSelect,()=>a==null?void 0:a(oa(s)?!0:!s),{checkForDefaultPrevented:!1})})})});Ad.displayName=tb;var Md="MenuRadioGroup",[rb,sb]=dr(Md,{value:void 0,onValueChange:()=>{}}),Od=h.forwardRef((t,r)=>{const{value:s,onValueChange:a,...n}=t,i=Ze(a);return e.jsx(rb,{scope:t.__scopeMenu,value:s,onValueChange:i,children:e.jsx(Di,{...n,ref:r})})});Od.displayName=Md;var Id="MenuRadioItem",Ld=h.forwardRef((t,r)=>{const{value:s,...a}=t,n=sb(Id,t.__scopeMenu),i=s===n.value;return e.jsx($d,{scope:t.__scopeMenu,checked:i,children:e.jsx(Ma,{role:"menuitemradio","aria-checked":i,...a,ref:r,"data-state":Ai(i),onSelect:xe(a.onSelect,()=>{var o;return(o=n.onValueChange)==null?void 0:o.call(n,s)},{checkForDefaultPrevented:!1})})})});Ld.displayName=Id;var Ri="MenuItemIndicator",[$d,ab]=dr(Ri,{checked:!1}),Fd=h.forwardRef((t,r)=>{const{__scopeMenu:s,forceMount:a,...n}=t,i=ab(Ri,s);return e.jsx(Lr,{present:a||oa(i.checked)||i.checked===!0,children:e.jsx(Me.span,{...n,ref:r,"data-state":Ai(i.checked)})})});Fd.displayName=Ri;var nb="MenuSeparator",Ud=h.forwardRef((t,r)=>{const{__scopeMenu:s,...a}=t;return e.jsx(Me.div,{role:"separator","aria-orientation":"horizontal",...a,ref:r})});Ud.displayName=nb;var ib="MenuArrow",Bd=h.forwardRef((t,r)=>{const{__scopeMenu:s,...a}=t,n=Aa(s);return e.jsx(Up,{...n,...a,ref:r})});Bd.displayName=ib;var ob="MenuSub",[kj,qd]=dr(ob),Qr="MenuSubTrigger",zd=h.forwardRef((t,r)=>{const s=ur(Qr,t.__scopeMenu),a=js(Qr,t.__scopeMenu),n=qd(Qr,t.__scopeMenu),i=Pi(Qr,t.__scopeMenu),o=h.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=i,u={__scopeMenu:t.__scopeMenu},d=h.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return h.useEffect(()=>d,[d]),h.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),c(null)}},[l,c]),e.jsx(Ei,{asChild:!0,...u,children:e.jsx(Rd,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":n.contentId,"data-state":Hd(s.open),...t,ref:Sa(r,n.onTriggerChange),onClick:m=>{var g;(g=t.onClick)==null||g.call(t,m),!(t.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),s.open||s.onOpenChange(!0))},onPointerMove:xe(t.onPointerMove,gs(m=>{i.onItemEnter(m),!m.defaultPrevented&&!t.disabled&&!s.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{s.onOpenChange(!0),d()},100))})),onPointerLeave:xe(t.onPointerLeave,gs(m=>{var x,p;d();const g=(x=s.content)==null?void 0:x.getBoundingClientRect();if(g){const f=(p=s.content)==null?void 0:p.dataset.side,y=f==="right",v=y?-5:5,w=g[y?"left":"right"],j=g[y?"right":"left"];i.onPointerGraceIntentChange({area:[{x:m.clientX+v,y:m.clientY},{x:w,y:g.top},{x:j,y:g.top},{x:j,y:g.bottom},{x:w,y:g.bottom}],side:f}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(m),m.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:xe(t.onKeyDown,m=>{var x;const g=i.searchRef.current!=="";t.disabled||g&&m.key===" "||By[a.dir].includes(m.key)&&(s.onOpenChange(!0),(x=s.content)==null||x.focus(),m.preventDefault())})})})});zd.displayName=Qr;var Wd="MenuSubContent",Vd=h.forwardRef((t,r)=>{const s=Cd(tt,t.__scopeMenu),{forceMount:a=s.forceMount,...n}=t,i=ur(tt,t.__scopeMenu),o=js(tt,t.__scopeMenu),l=qd(Wd,t.__scopeMenu),c=h.useRef(null),u=ze(r,c);return e.jsx(ms.Provider,{scope:t.__scopeMenu,children:e.jsx(Lr,{present:a||i.open,children:e.jsx(ms.Slot,{scope:t.__scopeMenu,children:e.jsx(Ti,{id:l.contentId,"aria-labelledby":l.triggerId,...n,ref:u,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var m;o.isUsingKeyboardRef.current&&((m=c.current)==null||m.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:xe(t.onFocusOutside,d=>{d.target!==l.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:xe(t.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:xe(t.onKeyDown,d=>{var x;const m=d.currentTarget.contains(d.target),g=qy[o.dir].includes(d.key);m&&g&&(i.onOpenChange(!1),(x=l.trigger)==null||x.focus(),d.preventDefault())})})})})})});Vd.displayName=Wd;function Hd(t){return t?"open":"closed"}function oa(t){return t==="indeterminate"}function Ai(t){return oa(t)?"indeterminate":t?"checked":"unchecked"}function lb(t){const r=document.activeElement;for(const s of t)if(s===r||(s.focus(),document.activeElement!==r))return}function cb(t,r){return t.map((s,a)=>t[(r+a)%t.length])}function db(t,r,s){const n=r.length>1&&Array.from(r).every(u=>u===r[0])?r[0]:r,i=s?t.indexOf(s):-1;let o=cb(t,Math.max(i,0));n.length===1&&(o=o.filter(u=>u!==s));const c=o.find(u=>u.toLowerCase().startsWith(n.toLowerCase()));return c!==s?c:void 0}function ub(t,r){const{x:s,y:a}=t;let n=!1;for(let i=0,o=r.length-1;i<r.length;o=i++){const l=r[i],c=r[o],u=l.x,d=l.y,m=c.x,g=c.y;d>a!=g>a&&s<(m-u)*(a-d)/(g-d)+u&&(n=!n)}return n}function hb(t,r){if(!r)return!1;const s={x:t.clientX,y:t.clientY};return ub(s,r)}function gs(t){return r=>r.pointerType==="mouse"?t(r):void 0}var mb=Ed,gb=Ei,fb=Pd,xb=Td,pb=Di,yb=Dd,bb=Ma,vb=Ad,wb=Od,kb=Ld,jb=Fd,Nb=Ud,_b=Bd,Sb=zd,Eb=Vd,Oa="DropdownMenu",[Cb,jj]=Ir(Oa,[_d]),We=_d(),[Pb,Yd]=Cb(Oa),Gd=t=>{const{__scopeDropdownMenu:r,children:s,dir:a,open:n,defaultOpen:i,onOpenChange:o,modal:l=!0}=t,c=We(r),u=h.useRef(null),[d,m]=hi({prop:n,defaultProp:i??!1,onChange:o,caller:Oa});return e.jsx(Pb,{scope:r,triggerId:An(),triggerRef:u,contentId:An(),open:d,onOpenChange:m,onOpenToggle:h.useCallback(()=>m(g=>!g),[m]),modal:l,children:e.jsx(mb,{...c,open:d,onOpenChange:m,dir:a,modal:l,children:s})})};Gd.displayName=Oa;var Kd="DropdownMenuTrigger",Jd=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,disabled:a=!1,...n}=t,i=Yd(Kd,s),o=We(s);return e.jsx(gb,{asChild:!0,...o,children:e.jsx(Me.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...n,ref:Sa(r,i.triggerRef),onPointerDown:xe(t.onPointerDown,l=>{!a&&l.button===0&&l.ctrlKey===!1&&(i.onOpenToggle(),i.open||l.preventDefault())}),onKeyDown:xe(t.onKeyDown,l=>{a||(["Enter"," "].includes(l.key)&&i.onOpenToggle(),l.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});Jd.displayName=Kd;var Tb="DropdownMenuPortal",Xd=t=>{const{__scopeDropdownMenu:r,...s}=t,a=We(r);return e.jsx(fb,{...a,...s})};Xd.displayName=Tb;var Qd="DropdownMenuContent",Zd=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=Yd(Qd,s),i=We(s),o=h.useRef(!1);return e.jsx(xb,{id:n.contentId,"aria-labelledby":n.triggerId,...i,...a,ref:r,onCloseAutoFocus:xe(t.onCloseAutoFocus,l=>{var c;o.current||(c=n.triggerRef.current)==null||c.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:xe(t.onInteractOutside,l=>{const c=l.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,d=c.button===2||u;(!n.modal||d)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Zd.displayName=Qd;var Db="DropdownMenuGroup",Rb=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(pb,{...n,...a,ref:r})});Rb.displayName=Db;var Ab="DropdownMenuLabel",eu=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(yb,{...n,...a,ref:r})});eu.displayName=Ab;var Mb="DropdownMenuItem",tu=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(bb,{...n,...a,ref:r})});tu.displayName=Mb;var Ob="DropdownMenuCheckboxItem",ru=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(vb,{...n,...a,ref:r})});ru.displayName=Ob;var Ib="DropdownMenuRadioGroup",Lb=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(wb,{...n,...a,ref:r})});Lb.displayName=Ib;var $b="DropdownMenuRadioItem",su=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(kb,{...n,...a,ref:r})});su.displayName=$b;var Fb="DropdownMenuItemIndicator",au=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(jb,{...n,...a,ref:r})});au.displayName=Fb;var Ub="DropdownMenuSeparator",nu=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(Nb,{...n,...a,ref:r})});nu.displayName=Ub;var Bb="DropdownMenuArrow",qb=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(_b,{...n,...a,ref:r})});qb.displayName=Bb;var zb="DropdownMenuSubTrigger",iu=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(Sb,{...n,...a,ref:r})});iu.displayName=zb;var Wb="DropdownMenuSubContent",ou=h.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...a}=t,n=We(s);return e.jsx(Eb,{...n,...a,ref:r,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});ou.displayName=Wb;var Vb=Gd,Hb=Jd,Yb=Xd,lu=Zd,cu=eu,du=tu,uu=ru,hu=su,mu=au,gu=nu,fu=iu,xu=ou;function Mi(t,r){if(t==null)return{};var s={},a=Object.keys(t),n,i;for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(s[n]=t[n]);return s}var Gb=["color"],Kb=h.forwardRef(function(t,r){var s=t.color,a=s===void 0?"currentColor":s,n=Mi(t,Gb);return h.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{ref:r}),h.createElement("path",{d:"M11.4669 3.72684C11.7558 3.91574 11.8369 4.30308 11.648 4.59198L7.39799 11.092C7.29783 11.2452 7.13556 11.3467 6.95402 11.3699C6.77247 11.3931 6.58989 11.3355 6.45446 11.2124L3.70446 8.71241C3.44905 8.48022 3.43023 8.08494 3.66242 7.82953C3.89461 7.57412 4.28989 7.55529 4.5453 7.78749L6.75292 9.79441L10.6018 3.90792C10.7907 3.61902 11.178 3.53795 11.4669 3.72684Z",fill:a,fillRule:"evenodd",clipRule:"evenodd"}))}),Jb=["color"],Xb=h.forwardRef(function(t,r){var s=t.color,a=s===void 0?"currentColor":s,n=Mi(t,Jb);return h.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{ref:r}),h.createElement("path",{d:"M6.1584 3.13508C6.35985 2.94621 6.67627 2.95642 6.86514 3.15788L10.6151 7.15788C10.7954 7.3502 10.7954 7.64949 10.6151 7.84182L6.86514 11.8418C6.67627 12.0433 6.35985 12.0535 6.1584 11.8646C5.95694 11.6757 5.94673 11.3593 6.1356 11.1579L9.565 7.49985L6.1356 3.84182C5.94673 3.64036 5.95694 3.32394 6.1584 3.13508Z",fill:a,fillRule:"evenodd",clipRule:"evenodd"}))}),Qb=["color"],Zb=h.forwardRef(function(t,r){var s=t.color,a=s===void 0?"currentColor":s,n=Mi(t,Qb);return h.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n,{ref:r}),h.createElement("path",{d:"M9.875 7.5C9.875 8.81168 8.81168 9.875 7.5 9.875C6.18832 9.875 5.125 8.81168 5.125 7.5C5.125 6.18832 6.18832 5.125 7.5 5.125C8.81168 5.125 9.875 6.18832 9.875 7.5Z",fill:a}))});const pu=Vb,yu=Hb,ev=h.forwardRef(({className:t,inset:r,children:s,...a},n)=>e.jsxs(fu,{ref:n,className:Ye("flex cursor-default select-none items-center gap-2 rounded-md px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...a,children:[s,e.jsx(Xb,{className:"ml-auto text-muted-foreground/80"})]}));ev.displayName=fu.displayName;const tv=h.forwardRef(({className:t,...r},s)=>e.jsx(xu,{ref:s,className:Ye("z-50 min-w-40 overflow-hidden rounded-md border border-border bg-popover p-1 text-popover-foreground shadow-lg shadow-black/5 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r}));tv.displayName=xu.displayName;const Oi=h.forwardRef(({className:t,sideOffset:r=4,onPointerDown:s,onPointerDownOutside:a,onCloseAutoFocus:n,...i},o)=>{const l=h.useRef(!1),c=h.useCallback(m=>{l.current=!0,s==null||s(m)},[s]),u=h.useCallback(m=>{l.current=!0,a==null||a(m)},[a]),d=h.useCallback(m=>{if(n)return n(m);l.current&&(m.preventDefault(),l.current=!1)},[n]);return e.jsx(Yb,{children:e.jsx(lu,{ref:o,sideOffset:r,className:Ye("z-50 min-w-40 overflow-hidden rounded-lg border border-border bg-popover p-1 text-popover-foreground shadow-lg shadow-black/5 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),onPointerDown:c,onPointerDownOutside:u,onCloseAutoFocus:d,...i})})});Oi.displayName=lu.displayName;const it=h.forwardRef(({className:t,inset:r,...s},a)=>e.jsx(du,{ref:a,className:Ye("relative flex cursor-default select-none items-center gap-2 rounded-md px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0",r&&"pl-8",t),...s}));it.displayName=du.displayName;const rv=h.forwardRef(({className:t,children:r,checked:s,...a},n)=>e.jsxs(uu,{ref:n,className:Ye("relative flex cursor-default select-none items-center rounded-md py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:s,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(mu,{children:e.jsx(Kb,{className:"h-4 w-4"})})}),r]}));rv.displayName=uu.displayName;const sv=h.forwardRef(({className:t,children:r,...s},a)=>e.jsxs(hu,{ref:a,className:Ye("relative flex cursor-default select-none items-center rounded-md py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(mu,{children:e.jsx(Zb,{className:"h-2 w-2 fill-current"})})}),r]}));sv.displayName=hu.displayName;const av=h.forwardRef(({className:t,inset:r,...s},a)=>e.jsx(cu,{ref:a,className:Ye("px-2 py-1.5 text-xs font-medium text-muted-foreground",r&&"pl-8",t),...s}));av.displayName=cu.displayName;const fs=h.forwardRef(({className:t,...r},s)=>e.jsx(gu,{ref:s,className:Ye("-mx-1 my-1 h-px bg-border",t),...r}));fs.displayName=gu.displayName;const nv=()=>{const[t,r]=h.useState([]),[s,a]=h.useState(!0),[n,i]=h.useState(""),[o,l]=h.useState("all"),[c,u]=h.useState("all"),[d,m]=h.useState({}),[g,x]=h.useState(!1),[p,f]=h.useState(1),[y]=h.useState(20),[v,w]=h.useState(0),[j,b]=h.useState(null),[k,I]=h.useState(!1),[C,A]=h.useState(null),[B,D]=h.useState(null),[L,N]=h.useState(!1),[O,E]=h.useState(!1),{toast:z}=Pe(),{userData:W,refreshSession:V}=je(),F=h.useRef(!1);h.useEffect(()=>{(async()=>{(W==null?void 0:W.user_role)==="admin"&&!F.current&&(await V(),F.current=!0,S())})()},[W]),h.useEffect(()=>{F.current&&(W==null?void 0:W.user_role)==="admin"&&S()},[p,o,c]);const S=async()=>{a(!0);try{if((W==null?void 0:W.user_role)!=="admin")throw new Error("Admin permissions required");console.log("Fetching users with JWT claims:",U.auth.getSession());let q=U.from("users").select("*",{count:"exact"});if(n.trim()!==""&&(q=q.or(`name.ilike.%${n}%,email.ilike.%${n}%,phone.ilike.%${n}%`)),o!=="all"){const Re=o==="driver"?"partner":o;q=q.eq("user_role",Re)}c!=="all"&&(q=q.eq("is_suspended",c==="suspended"));const{count:oe,error:de}=await q;if(de)throw de;w(oe||0);const{data:le,error:fe}=await q.order("created_at",{ascending:!1}).range((p-1)*y,p*y-1);if(fe)throw console.error("Error fetching users list:",fe),fe;console.log("Fetched users:",(le==null?void 0:le.length)||0),r(le||[])}catch(q){console.error("Error in fetchUsers:",q),z({variant:"destructive",title:"Error",description:q.message||"Failed to fetch users. Please try again."})}finally{a(!1)}},H=(q,oe)=>{m(de=>({...de,[q]:{...de[q],user_role:oe}}))},ee=(q,oe)=>{A({userId:q,suspend:!oe})},se=()=>{if(!C)return;const{userId:q,suspend:oe}=C;m(de=>({...de,[q]:{...de[q],is_suspended:oe}})),A(null)},R=q=>{D(q)},Y=async()=>{if(!B)return;const q=B;E(!0);try{const{data:{session:oe}}=await U.auth.getSession();if(!oe)throw new Error("Authentication required");const le=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/delete-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${oe.access_token}`},body:JSON.stringify({userId:q})}),fe=await le.json();if(!le.ok)throw new Error(fe.error||"Failed to delete user");r(t.filter(Re=>Re.id!==q)),z({title:"User Deleted",description:fe.message||"The user has been permanently deleted."}),w(Re=>Re-1)}catch(oe){console.error("Error deleting user:",oe),z({variant:"destructive",title:"Deletion Failed",description:oe.message||"There was an error deleting this user. They may have related records."})}finally{E(!1),D(null)}},te=q=>{b(q),I(!0)},M=q=>{const{name:oe,value:de}=q.target;j&&(b({...j,[oe]:de}),m(le=>({...le,[j.id]:{...le[j.id],[oe]:de}})))},K=()=>{I(!1),b(null)},ce=()=>{k&&I(!1),N(!0)},ae=async()=>{x(!0);const q=[];let oe=!1;try{for(const[le,fe]of Object.entries(d)){const{error:Re}=await U.from("users").update(fe).eq("id",le);if(Re){console.error(`Error updating user ${le}:`,Re),oe=!0;continue}q.push(le)}r(t.map(le=>d[le.id]?{...le,...d[le.id]}:le));const de={...d};q.forEach(le=>delete de[le]),m(de),z({variant:oe?"destructive":"default",title:oe?"Partial Success":"Success",description:oe?"Some changes were saved, but others failed. Please try again.":"All changes were saved successfully."}),S()}catch(de){console.error("Error saving changes:",de),z({variant:"destructive",title:"Error",description:de.message||"Failed to save changes. Please try again."})}finally{x(!1),I(!1),N(!1)}},P=()=>{f(1),S()},$=t,Z=Object.keys(d).length>0,ie=Math.ceil(v/y),he=()=>{p<ie&&f(p+1)},ge=()=>{p>1&&f(p-1)};return s&&!t.length?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"User Management"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center space-y-4 md:space-y-0 md:space-x-4",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(_t,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400 dark:text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search name, email, phone...",value:n,onChange:q=>i(q.target.value),onKeyDown:q=>q.key==="Enter"&&P(),className:"pl-10 pr-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 w-full md:w-64"})]}),e.jsxs("select",{value:o,onChange:q=>{l(q.target.value),f(1)},className:"w-full md:w-auto px-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"driver",children:"Driver"}),e.jsx("option",{value:"support",children:"Support"})]}),e.jsxs("select",{value:c,onChange:q=>{u(q.target.value),f(1)},className:"w-full md:w-auto px-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"suspended",children:"Suspended"})]}),e.jsx("button",{onClick:P,className:"w-full md:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Search"})]})]}),s&&t.length>0&&e.jsxs("div",{className:"text-center p-4",children:[e.jsx(ue,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 animate-spin mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Refreshing..."})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:$.length>0?$.map(q=>{var oe,de,le,fe,Re,we;return e.jsxs("tr",{className:"max-h-16 h-16 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:q.name||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:q.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:q.phone||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:((oe=d[q.id])==null?void 0:oe.user_role)??q.user_role,onChange:Fe=>H(q.id,Fe.target.value),className:`text-sm border border-gray-200 dark:border-gray-700 dark:bg-gray-700 dark:text-white rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-600 ${(de=d[q.id])!=null&&de.user_role?"bg-yellow-50 dark:bg-yellow-900/30":""}`,children:[e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"partner",children:"Driver"}),e.jsx("option",{value:"support",children:"Support"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${((le=d[q.id])==null?void 0:le.is_suspended)??q.is_suspended?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300":"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300"}`,children:((fe=d[q.id])==null?void 0:fe.is_suspended)??q.is_suspended?"Suspended":"Active"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("div",{className:"relative",style:{height:"24px"},children:e.jsxs(pu,{children:[e.jsx(yu,{asChild:!0,children:e.jsx("button",{className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"User actions",children:e.jsx(dl,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})}),e.jsxs(Oi,{align:"start",className:"w-48 z-50",children:[e.jsxs(it,{onClick:()=>te(q),children:[e.jsx(Yu,{className:"mr-2 h-4 w-4"}),"Edit User"]}),e.jsx(fs,{}),e.jsx(it,{onClick:()=>{var Fe;return ee(q.id,((Fe=d[q.id])==null?void 0:Fe.is_suspended)??q.is_suspended)},className:((Re=d[q.id])==null?void 0:Re.is_suspended)??q.is_suspended?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:((we=d[q.id])==null?void 0:we.is_suspended)??q.is_suspended?e.jsxs(e.Fragment,{children:[e.jsx(Gu,{className:"mr-2 h-4 w-4"}),"Reactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ku,{className:"mr-2 h-4 w-4"}),"Suspend"]})}),e.jsx(fs,{}),e.jsxs(it,{onClick:()=>R(q.id),className:"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30",children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),"Delete User"]})]})]})})})]},q.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400",children:s?"Loading users...":"No users found"})})})]})})}),v>y&&e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing ",Math.min((p-1)*y+1,v)," to ",Math.min(p*y,v)," of ",v," users"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:ge,disabled:p===1,className:`px-3 py-1 rounded border ${p===1?"bg-gray-100 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed border-gray-200 dark:border-gray-700":"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 border-gray-200 dark:border-gray-700"}`,children:e.jsx(ul,{className:"h-5 w-5"})}),e.jsxs("span",{className:"px-3 py-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded dark:text-white",children:[p," of ",ie]}),e.jsx("button",{onClick:he,disabled:p>=ie,className:`px-3 py-1 rounded border ${p>=ie?"bg-gray-100 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed border-gray-200 dark:border-gray-700":"bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 border-gray-200 dark:border-gray-700"}`,children:e.jsx(Wn,{className:"h-5 w-5"})})]})]}),k&&j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:"Edit User"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",name:"name",value:j.name,onChange:M,className:"w-full px-4 py-2 border border-gray-200 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 bg-white dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:j.email,onChange:M,className:"w-full px-4 py-2 border border-gray-200 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 bg-white dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:j.phone||"",onChange:M,className:"w-full px-4 py-2 border border-gray-200 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 bg-white dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:K,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:ce,disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center",children:g?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-start mb-4",children:[e.jsx("div",{className:"flex-shrink-0 text-red-600 dark:text-red-400",children:e.jsx(Ae,{className:"h-6 w-6"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:C.suspend?"Suspend User":"Reactivate User"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:C.suspend?"Are you sure you want to suspend this user? They will not be able to log in until reactivated.":"Are you sure you want to reactivate this user? They will regain access to their account."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>A(null),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:se,className:`px-4 py-2 rounded-md text-white ${C.suspend?"bg-red-600 dark:bg-red-700 hover:bg-red-700 dark:hover:bg-red-600":"bg-green-600 dark:bg-green-700 hover:bg-green-700 dark:hover:bg-green-600"}`,children:C.suspend?"Yes, Suspend User":"Yes, Reactivate User"})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-start mb-4",children:[e.jsx("div",{className:"flex-shrink-0 text-red-600 dark:text-red-400",children:e.jsx(Ae,{className:"h-6 w-6"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 dark:text-red-400",children:"Delete User"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Are you sure you want to permanently delete this user? This action cannot be undone."}),e.jsx("p",{className:"mt-2 text-sm font-medium text-red-600 dark:text-red-400",children:"Warning: This will delete all associated data and cannot be recovered."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>D(null),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:O,className:"px-4 py-2 bg-red-600 dark:bg-red-700 text-white rounded-md hover:bg-red-700 dark:hover:bg-red-600 transition-colors flex items-center",children:O?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"w-4 h-4 mr-2"}),"Yes, Delete User"]})})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 dark:text-white",children:"Confirm Changes"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Are you sure you want to save all changes? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:ae,disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center",children:g?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Yes, Save Changes"]})})]})]})}),Z&&e.jsx("div",{className:"fixed bottom-8 right-8 z-40",children:e.jsx("button",{onClick:ce,disabled:g,className:"bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-5 h-5"}),e.jsx("span",{children:"Save Changes"})]})})})]})};function pe(t){const r=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&r==="[object Date]"?new t.constructor(+t):typeof t=="number"||r==="[object Number]"||typeof t=="string"||r==="[object String]"?new Date(t):new Date(NaN)}function ut(t,r){return t instanceof Date?new t.constructor(r):new Date(r)}function Ii(t,r){const s=pe(t);return isNaN(r)?ut(t,NaN):(r&&s.setDate(s.getDate()+r),s)}function bu(t,r){const s=pe(t);if(isNaN(r))return ut(t,NaN);if(!r)return s;const a=s.getDate(),n=ut(t,s.getTime());n.setMonth(s.getMonth()+r+1,0);const i=n.getDate();return a>=i?n:(s.setFullYear(n.getFullYear(),n.getMonth(),a),s)}const vu=6048e5,iv=864e5,wu=6e4,ku=36e5,Ls=43200,Yo=1440;let ov={};function Br(){return ov}function bt(t,r){var l,c,u,d;const s=Br(),a=(r==null?void 0:r.weekStartsOn)??((c=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??s.weekStartsOn??((d=(u=s.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,n=pe(t),i=n.getDay(),o=(i<a?7:0)+i-a;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function la(t){return bt(t,{weekStartsOn:1})}function ju(t){const r=pe(t),s=r.getFullYear(),a=ut(t,0);a.setFullYear(s+1,0,4),a.setHours(0,0,0,0);const n=la(a),i=ut(t,0);i.setFullYear(s,0,4),i.setHours(0,0,0,0);const o=la(i);return r.getTime()>=n.getTime()?s+1:r.getTime()>=o.getTime()?s:s-1}function ca(t){const r=pe(t);return r.setHours(0,0,0,0),r}function da(t){const r=pe(t),s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return s.setUTCFullYear(r.getFullYear()),+t-+s}function lv(t,r){const s=ca(t),a=ca(r),n=+s-da(s),i=+a-da(a);return Math.round((n-i)/iv)}function cv(t){const r=ju(t),s=ut(t,0);return s.setFullYear(r,0,4),s.setHours(0,0,0,0),la(s)}function Js(t,r){const s=pe(t),a=pe(r),n=s.getTime()-a.getTime();return n<0?-1:n>0?1:n}function dv(t){return ut(t,Date.now())}function as(t,r){const s=ca(t),a=ca(r);return+s==+a}function uv(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function hv(t){if(!uv(t)&&typeof t!="number")return!1;const r=pe(t);return!isNaN(Number(r))}function mv(t,r){const s=pe(t),a=pe(r),n=s.getFullYear()-a.getFullYear(),i=s.getMonth()-a.getMonth();return n*12+i}function gv(t){return r=>{const a=(t?Math[t]:Math.trunc)(r);return a===0?0:a}}function fv(t,r){return+pe(t)-+pe(r)}function xv(t){const r=pe(t);return r.setHours(23,59,59,999),r}function xs(t){const r=pe(t),s=r.getMonth();return r.setFullYear(r.getFullYear(),s+1,0),r.setHours(23,59,59,999),r}function pv(t){const r=pe(t);return+xv(r)==+xs(r)}function yv(t,r){const s=pe(t),a=pe(r),n=Js(s,a),i=Math.abs(mv(s,a));let o;if(i<1)o=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-n*i);let l=Js(s,a)===-n;pv(pe(t))&&i===1&&Js(t,a)===1&&(l=!1),o=n*(i-Number(l))}return o===0?0:o}function bv(t,r,s){const a=fv(t,r)/1e3;return gv(s==null?void 0:s.roundingMethod)(a)}function Li(t,r){const s=pe(t.start),a=pe(t.end);let n=+s>+a;const i=n?+s:+a,o=n?a:s;o.setHours(0,0,0,0);let l=1;const c=[];for(;+o<=i;)c.push(pe(o)),o.setDate(o.getDate()+l),o.setHours(0,0,0,0);return n?c.reverse():c}function Un(t){const r=pe(t);return r.setDate(1),r.setHours(0,0,0,0),r}function vv(t){const r=pe(t),s=ut(t,0);return s.setFullYear(r.getFullYear(),0,1),s.setHours(0,0,0,0),s}function Nu(t,r){var l,c,u,d;const s=Br(),a=(r==null?void 0:r.weekStartsOn)??((c=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??s.weekStartsOn??((d=(u=s.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,n=pe(t),i=n.getDay(),o=(i<a?-7:0)+6-(i-a);return n.setDate(n.getDate()+o),n.setHours(23,59,59,999),n}const wv={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},kv=(t,r,s)=>{let a;const n=wv[t];return typeof n=="string"?a=n:r===1?a=n.one:a=n.other.replace("{{count}}",r.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+a:a+" ago":a};function cn(t){return(r={})=>{const s=r.width?String(r.width):t.defaultWidth;return t.formats[s]||t.formats[t.defaultWidth]}}const jv={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Nv={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},_v={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Sv={date:cn({formats:jv,defaultWidth:"full"}),time:cn({formats:Nv,defaultWidth:"full"}),dateTime:cn({formats:_v,defaultWidth:"full"})},Ev={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Cv=(t,r,s,a)=>Ev[t];function Yr(t){return(r,s)=>{const a=s!=null&&s.context?String(s.context):"standalone";let n;if(a==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,l=s!=null&&s.width?String(s.width):o;n=t.formattingValues[l]||t.formattingValues[o]}else{const o=t.defaultWidth,l=s!=null&&s.width?String(s.width):t.defaultWidth;n=t.values[l]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(r):r;return n[i]}}const Pv={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Tv={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Dv={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Rv={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Av={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Mv={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Ov=(t,r)=>{const s=Number(t),a=s%100;if(a>20||a<10)switch(a%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},Iv={ordinalNumber:Ov,era:Yr({values:Pv,defaultWidth:"wide"}),quarter:Yr({values:Tv,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Yr({values:Dv,defaultWidth:"wide"}),day:Yr({values:Rv,defaultWidth:"wide"}),dayPeriod:Yr({values:Av,defaultWidth:"wide",formattingValues:Mv,defaultFormattingWidth:"wide"})};function Gr(t){return(r,s={})=>{const a=s.width,n=a&&t.matchPatterns[a]||t.matchPatterns[t.defaultMatchWidth],i=r.match(n);if(!i)return null;const o=i[0],l=a&&t.parsePatterns[a]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?$v(l,m=>m.test(o)):Lv(l,m=>m.test(o));let u;u=t.valueCallback?t.valueCallback(c):c,u=s.valueCallback?s.valueCallback(u):u;const d=r.slice(o.length);return{value:u,rest:d}}}function Lv(t,r){for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&r(t[s]))return s}function $v(t,r){for(let s=0;s<t.length;s++)if(r(t[s]))return s}function Fv(t){return(r,s={})=>{const a=r.match(t.matchPattern);if(!a)return null;const n=a[0],i=r.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=s.valueCallback?s.valueCallback(o):o;const l=r.slice(n.length);return{value:o,rest:l}}}const Uv=/^(\d+)(th|st|nd|rd)?/i,Bv=/\d+/i,qv={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},zv={any:[/^b/i,/^(a|c)/i]},Wv={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Vv={any:[/1/i,/2/i,/3/i,/4/i]},Hv={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Yv={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Gv={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Kv={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Jv={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Xv={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Qv={ordinalNumber:Fv({matchPattern:Uv,parsePattern:Bv,valueCallback:t=>parseInt(t,10)}),era:Gr({matchPatterns:qv,defaultMatchWidth:"wide",parsePatterns:zv,defaultParseWidth:"any"}),quarter:Gr({matchPatterns:Wv,defaultMatchWidth:"wide",parsePatterns:Vv,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Gr({matchPatterns:Hv,defaultMatchWidth:"wide",parsePatterns:Yv,defaultParseWidth:"any"}),day:Gr({matchPatterns:Gv,defaultMatchWidth:"wide",parsePatterns:Kv,defaultParseWidth:"any"}),dayPeriod:Gr({matchPatterns:Jv,defaultMatchWidth:"any",parsePatterns:Xv,defaultParseWidth:"any"})},_u={code:"en-US",formatDistance:kv,formatLong:Sv,formatRelative:Cv,localize:Iv,match:Qv,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Zv(t){const r=pe(t);return lv(r,vv(r))+1}function ew(t){const r=pe(t),s=+la(r)-+cv(r);return Math.round(s/vu)+1}function Su(t,r){var d,m,g,x;const s=pe(t),a=s.getFullYear(),n=Br(),i=(r==null?void 0:r.firstWeekContainsDate)??((m=(d=r==null?void 0:r.locale)==null?void 0:d.options)==null?void 0:m.firstWeekContainsDate)??n.firstWeekContainsDate??((x=(g=n.locale)==null?void 0:g.options)==null?void 0:x.firstWeekContainsDate)??1,o=ut(t,0);o.setFullYear(a+1,0,i),o.setHours(0,0,0,0);const l=bt(o,r),c=ut(t,0);c.setFullYear(a,0,i),c.setHours(0,0,0,0);const u=bt(c,r);return s.getTime()>=l.getTime()?a+1:s.getTime()>=u.getTime()?a:a-1}function tw(t,r){var l,c,u,d;const s=Br(),a=(r==null?void 0:r.firstWeekContainsDate)??((c=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??s.firstWeekContainsDate??((d=(u=s.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,n=Su(t,r),i=ut(t,0);return i.setFullYear(n,0,a),i.setHours(0,0,0,0),bt(i,r)}function rw(t,r){const s=pe(t),a=+bt(s,r)-+tw(s,r);return Math.round(a/vu)+1}function Ne(t,r){const s=t<0?"-":"",a=Math.abs(t).toString().padStart(r,"0");return s+a}const Ot={y(t,r){const s=t.getFullYear(),a=s>0?s:1-s;return Ne(r==="yy"?a%100:a,r.length)},M(t,r){const s=t.getMonth();return r==="M"?String(s+1):Ne(s+1,2)},d(t,r){return Ne(t.getDate(),r.length)},a(t,r){const s=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(t,r){return Ne(t.getHours()%12||12,r.length)},H(t,r){return Ne(t.getHours(),r.length)},m(t,r){return Ne(t.getMinutes(),r.length)},s(t,r){return Ne(t.getSeconds(),r.length)},S(t,r){const s=r.length,a=t.getMilliseconds(),n=Math.trunc(a*Math.pow(10,s-3));return Ne(n,r.length)}},yr={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Go={G:function(t,r,s){const a=t.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return s.era(a,{width:"abbreviated"});case"GGGGG":return s.era(a,{width:"narrow"});case"GGGG":default:return s.era(a,{width:"wide"})}},y:function(t,r,s){if(r==="yo"){const a=t.getFullYear(),n=a>0?a:1-a;return s.ordinalNumber(n,{unit:"year"})}return Ot.y(t,r)},Y:function(t,r,s,a){const n=Su(t,a),i=n>0?n:1-n;if(r==="YY"){const o=i%100;return Ne(o,2)}return r==="Yo"?s.ordinalNumber(i,{unit:"year"}):Ne(i,r.length)},R:function(t,r){const s=ju(t);return Ne(s,r.length)},u:function(t,r){const s=t.getFullYear();return Ne(s,r.length)},Q:function(t,r,s){const a=Math.ceil((t.getMonth()+1)/3);switch(r){case"Q":return String(a);case"QQ":return Ne(a,2);case"Qo":return s.ordinalNumber(a,{unit:"quarter"});case"QQQ":return s.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,r,s){const a=Math.ceil((t.getMonth()+1)/3);switch(r){case"q":return String(a);case"qq":return Ne(a,2);case"qo":return s.ordinalNumber(a,{unit:"quarter"});case"qqq":return s.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,r,s){const a=t.getMonth();switch(r){case"M":case"MM":return Ot.M(t,r);case"Mo":return s.ordinalNumber(a+1,{unit:"month"});case"MMM":return s.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(a,{width:"wide",context:"formatting"})}},L:function(t,r,s){const a=t.getMonth();switch(r){case"L":return String(a+1);case"LL":return Ne(a+1,2);case"Lo":return s.ordinalNumber(a+1,{unit:"month"});case"LLL":return s.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(a,{width:"wide",context:"standalone"})}},w:function(t,r,s,a){const n=rw(t,a);return r==="wo"?s.ordinalNumber(n,{unit:"week"}):Ne(n,r.length)},I:function(t,r,s){const a=ew(t);return r==="Io"?s.ordinalNumber(a,{unit:"week"}):Ne(a,r.length)},d:function(t,r,s){return r==="do"?s.ordinalNumber(t.getDate(),{unit:"date"}):Ot.d(t,r)},D:function(t,r,s){const a=Zv(t);return r==="Do"?s.ordinalNumber(a,{unit:"dayOfYear"}):Ne(a,r.length)},E:function(t,r,s){const a=t.getDay();switch(r){case"E":case"EE":case"EEE":return s.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(a,{width:"short",context:"formatting"});case"EEEE":default:return s.day(a,{width:"wide",context:"formatting"})}},e:function(t,r,s,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(r){case"e":return String(i);case"ee":return Ne(i,2);case"eo":return s.ordinalNumber(i,{unit:"day"});case"eee":return s.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(n,{width:"short",context:"formatting"});case"eeee":default:return s.day(n,{width:"wide",context:"formatting"})}},c:function(t,r,s,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(r){case"c":return String(i);case"cc":return Ne(i,r.length);case"co":return s.ordinalNumber(i,{unit:"day"});case"ccc":return s.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(n,{width:"narrow",context:"standalone"});case"cccccc":return s.day(n,{width:"short",context:"standalone"});case"cccc":default:return s.day(n,{width:"wide",context:"standalone"})}},i:function(t,r,s){const a=t.getDay(),n=a===0?7:a;switch(r){case"i":return String(n);case"ii":return Ne(n,r.length);case"io":return s.ordinalNumber(n,{unit:"day"});case"iii":return s.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(a,{width:"short",context:"formatting"});case"iiii":default:return s.day(a,{width:"wide",context:"formatting"})}},a:function(t,r,s){const n=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(t,r,s){const a=t.getHours();let n;switch(a===12?n=yr.noon:a===0?n=yr.midnight:n=a/12>=1?"pm":"am",r){case"b":case"bb":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(t,r,s){const a=t.getHours();let n;switch(a>=17?n=yr.evening:a>=12?n=yr.afternoon:a>=4?n=yr.morning:n=yr.night,r){case"B":case"BB":case"BBB":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(t,r,s){if(r==="ho"){let a=t.getHours()%12;return a===0&&(a=12),s.ordinalNumber(a,{unit:"hour"})}return Ot.h(t,r)},H:function(t,r,s){return r==="Ho"?s.ordinalNumber(t.getHours(),{unit:"hour"}):Ot.H(t,r)},K:function(t,r,s){const a=t.getHours()%12;return r==="Ko"?s.ordinalNumber(a,{unit:"hour"}):Ne(a,r.length)},k:function(t,r,s){let a=t.getHours();return a===0&&(a=24),r==="ko"?s.ordinalNumber(a,{unit:"hour"}):Ne(a,r.length)},m:function(t,r,s){return r==="mo"?s.ordinalNumber(t.getMinutes(),{unit:"minute"}):Ot.m(t,r)},s:function(t,r,s){return r==="so"?s.ordinalNumber(t.getSeconds(),{unit:"second"}):Ot.s(t,r)},S:function(t,r){return Ot.S(t,r)},X:function(t,r,s){const a=t.getTimezoneOffset();if(a===0)return"Z";switch(r){case"X":return Jo(a);case"XXXX":case"XX":return ar(a);case"XXXXX":case"XXX":default:return ar(a,":")}},x:function(t,r,s){const a=t.getTimezoneOffset();switch(r){case"x":return Jo(a);case"xxxx":case"xx":return ar(a);case"xxxxx":case"xxx":default:return ar(a,":")}},O:function(t,r,s){const a=t.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Ko(a,":");case"OOOO":default:return"GMT"+ar(a,":")}},z:function(t,r,s){const a=t.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Ko(a,":");case"zzzz":default:return"GMT"+ar(a,":")}},t:function(t,r,s){const a=Math.trunc(t.getTime()/1e3);return Ne(a,r.length)},T:function(t,r,s){const a=t.getTime();return Ne(a,r.length)}};function Ko(t,r=""){const s=t>0?"-":"+",a=Math.abs(t),n=Math.trunc(a/60),i=a%60;return i===0?s+String(n):s+String(n)+r+Ne(i,2)}function Jo(t,r){return t%60===0?(t>0?"-":"+")+Ne(Math.abs(t)/60,2):ar(t,r)}function ar(t,r=""){const s=t>0?"-":"+",a=Math.abs(t),n=Ne(Math.trunc(a/60),2),i=Ne(a%60,2);return s+n+r+i}const Xo=(t,r)=>{switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},Eu=(t,r)=>{switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},sw=(t,r)=>{const s=t.match(/(P+)(p+)?/)||[],a=s[1],n=s[2];if(!n)return Xo(t,r);let i;switch(a){case"P":i=r.dateTime({width:"short"});break;case"PP":i=r.dateTime({width:"medium"});break;case"PPP":i=r.dateTime({width:"long"});break;case"PPPP":default:i=r.dateTime({width:"full"});break}return i.replace("{{date}}",Xo(a,r)).replace("{{time}}",Eu(n,r))},aw={p:Eu,P:sw},nw=/^D+$/,iw=/^Y+$/,ow=["D","DD","YY","YYYY"];function lw(t){return nw.test(t)}function cw(t){return iw.test(t)}function dw(t,r,s){const a=uw(t,r,s);if(console.warn(a),ow.includes(t))throw new RangeError(a)}function uw(t,r,s){const a=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${r}\`) for formatting ${a} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const hw=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,mw=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,gw=/^'([^]*?)'?$/,fw=/''/g,xw=/[a-zA-Z]/;function ne(t,r,s){var d,m,g,x;const a=Br(),n=a.locale??_u,i=a.firstWeekContainsDate??((m=(d=a.locale)==null?void 0:d.options)==null?void 0:m.firstWeekContainsDate)??1,o=a.weekStartsOn??((x=(g=a.locale)==null?void 0:g.options)==null?void 0:x.weekStartsOn)??0,l=pe(t);if(!hv(l))throw new RangeError("Invalid time value");let c=r.match(mw).map(p=>{const f=p[0];if(f==="p"||f==="P"){const y=aw[f];return y(p,n.formatLong)}return p}).join("").match(hw).map(p=>{if(p==="''")return{isToken:!1,value:"'"};const f=p[0];if(f==="'")return{isToken:!1,value:pw(p)};if(Go[f])return{isToken:!0,value:p};if(f.match(xw))throw new RangeError("Format string contains an unescaped latin alphabet character `"+f+"`");return{isToken:!1,value:p}});n.localize.preprocessor&&(c=n.localize.preprocessor(l,c));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:n};return c.map(p=>{if(!p.isToken)return p.value;const f=p.value;(cw(f)||lw(f))&&dw(f,r,String(t));const y=Go[f[0]];return y(l,f,n.localize,u)}).join("")}function pw(t){const r=t.match(gw);return r?r[1].replace(fw,"'"):t}function yw(t,r,s){const a=Br(),n=(s==null?void 0:s.locale)??a.locale??_u,i=2520,o=Js(t,r);if(isNaN(o))throw new RangeError("Invalid time value");const l=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:o});let c,u;o>0?(c=pe(r),u=pe(t)):(c=pe(t),u=pe(r));const d=bv(u,c),m=(da(u)-da(c))/1e3,g=Math.round((d-m)/60);let x;if(g<2)return s!=null&&s.includeSeconds?d<5?n.formatDistance("lessThanXSeconds",5,l):d<10?n.formatDistance("lessThanXSeconds",10,l):d<20?n.formatDistance("lessThanXSeconds",20,l):d<40?n.formatDistance("halfAMinute",0,l):d<60?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",1,l):g===0?n.formatDistance("lessThanXMinutes",1,l):n.formatDistance("xMinutes",g,l);if(g<45)return n.formatDistance("xMinutes",g,l);if(g<90)return n.formatDistance("aboutXHours",1,l);if(g<Yo){const p=Math.round(g/60);return n.formatDistance("aboutXHours",p,l)}else{if(g<i)return n.formatDistance("xDays",1,l);if(g<Ls){const p=Math.round(g/Yo);return n.formatDistance("xDays",p,l)}else if(g<Ls*2)return x=Math.round(g/Ls),n.formatDistance("aboutXMonths",x,l)}if(x=yv(u,c),x<12){const p=Math.round(g/Ls);return n.formatDistance("xMonths",p,l)}else{const p=x%12,f=Math.trunc(x/12);return p<3?n.formatDistance("aboutXYears",f,l):p<9?n.formatDistance("overXYears",f,l):n.formatDistance("almostXYears",f+1,l)}}function bw(t,r){const s=pe(t),a=pe(r);return s.getTime()>a.getTime()}function Qo(t,r){const s=pe(t),a=pe(r);return+s<+a}function vw(t){return+pe(t)>Date.now()}function ww(t){return+pe(t)<Date.now()}function kw(t,r,s){const a=bt(t,s),n=bt(r,s);return+a==+n}function Bn(t,r){const s=pe(t),a=pe(r);return s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()}function ns(t){return as(t,dv(t))}function Xs(t,r){return Ii(t,-r)}function ke(t,r){const a=Sw(t);let n;if(a.date){const c=Ew(a.date,2);n=Cw(c.restDateString,c.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const i=n.getTime();let o=0,l;if(a.time&&(o=Pw(a.time),isNaN(o)))return new Date(NaN);if(a.timezone){if(l=Tw(a.timezone),isNaN(l))return new Date(NaN)}else{const c=new Date(i+o),u=new Date(0);return u.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),u.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),u}return new Date(i+o+l)}const $s={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},jw=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Nw=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,_w=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Sw(t){const r={},s=t.split($s.dateTimeDelimiter);let a;if(s.length>2)return r;if(/:/.test(s[0])?a=s[0]:(r.date=s[0],a=s[1],$s.timeZoneDelimiter.test(r.date)&&(r.date=t.split($s.timeZoneDelimiter)[0],a=t.substr(r.date.length,t.length))),a){const n=$s.timezone.exec(a);n?(r.time=a.replace(n[1],""),r.timezone=n[1]):r.time=a}return r}function Ew(t,r){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),a=t.match(s);if(!a)return{year:NaN,restDateString:""};const n=a[1]?parseInt(a[1]):null,i=a[2]?parseInt(a[2]):null;return{year:i===null?n:i*100,restDateString:t.slice((a[1]||a[2]).length)}}function Cw(t,r){if(r===null)return new Date(NaN);const s=t.match(jw);if(!s)return new Date(NaN);const a=!!s[4],n=Kr(s[1]),i=Kr(s[2])-1,o=Kr(s[3]),l=Kr(s[4]),c=Kr(s[5])-1;if(a)return Ow(r,l,c)?Dw(r,l,c):new Date(NaN);{const u=new Date(0);return!Aw(r,i,o)||!Mw(r,n)?new Date(NaN):(u.setUTCFullYear(r,i,Math.max(n,o)),u)}}function Kr(t){return t?parseInt(t):1}function Pw(t){const r=t.match(Nw);if(!r)return NaN;const s=dn(r[1]),a=dn(r[2]),n=dn(r[3]);return Iw(s,a,n)?s*ku+a*wu+n*1e3:NaN}function dn(t){return t&&parseFloat(t.replace(",","."))||0}function Tw(t){if(t==="Z")return 0;const r=t.match(_w);if(!r)return 0;const s=r[1]==="+"?-1:1,a=parseInt(r[2]),n=r[3]&&parseInt(r[3])||0;return Lw(a,n)?s*(a*ku+n*wu):NaN}function Dw(t,r,s){const a=new Date(0);a.setUTCFullYear(t,0,4);const n=a.getUTCDay()||7,i=(r-1)*7+s+1-n;return a.setUTCDate(a.getUTCDate()+i),a}const Rw=[31,null,31,30,31,30,31,31,30,31,30,31];function Cu(t){return t%400===0||t%4===0&&t%100!==0}function Aw(t,r,s){return r>=0&&r<=11&&s>=1&&s<=(Rw[r]||(Cu(t)?29:28))}function Mw(t,r){return r>=1&&r<=(Cu(t)?366:365)}function Ow(t,r,s){return r>=1&&r<=53&&s>=0&&s<=6}function Iw(t,r,s){return t===24?r===0&&s===0:s>=0&&s<60&&r>=0&&r<60&&t>=0&&t<25}function Lw(t,r){return r>=0&&r<=59}function Pu(t,r){return bu(t,-r)}const Tu=h.createContext(void 0),$w=({children:t})=>{const[r,s]=h.useState(null),[a,n]=h.useState(!1),{toast:i}=Pe(),o=h.useCallback((u,d="Application")=>{const m=typeof u=="string"?u:u.message||"An unexpected error occurred";s(m),console.error(`[${d}] Error:`,u),i({title:"Error",description:m,variant:"destructive",action:e.jsx("button",{onClick:()=>l(),className:"bg-red-50 dark:bg-red-950 hover:bg-red-100 dark:hover:bg-red-900 text-xs px-2 py-1 rounded text-red-500",children:"Dismiss"})})},[i]),l=h.useCallback(()=>{s(null)},[]),c={captureError:o,clearError:l,globalError:r,isLoading:a,setIsLoading:n};return e.jsxs(Tu.Provider,{value:c,children:[r&&e.jsx("div",{className:"fixed top-0 left-0 right-0 bg-red-50 dark:bg-red-900/40 p-4 flex items-center justify-center z-50 border-b border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center max-w-6xl mx-auto w-full",children:[e.jsx(Ae,{className:"h-5 w-5 text-red-600 dark:text-red-400 mr-2 flex-shrink-0"}),e.jsx("div",{className:"flex-1 text-sm text-red-700 dark:text-red-300",children:r}),e.jsx("button",{onClick:l,className:"ml-4 px-2 py-1 text-xs bg-red-100 dark:bg-red-800 text-red-600 dark:text-red-300 rounded hover:bg-red-200 dark:hover:bg-red-700",children:"Dismiss"})]})}),t]})},Du=()=>{const t=h.useContext(Tu);if(t===void 0)throw new Error("useError must be used within an ErrorProvider");return t},Fw=({booking:t,onClose:r,onStatusChange:s,onAssignDriver:a,onEditNotes:n,onViewLogs:i,onDuplicate:o,onManageFees:l,onManagePriority:c})=>{var x,p;const u=(t.custom_fees||[]).reduce((f,y)=>f+y.amount,0),d=(t.estimated_price||0)+u,g=(f=>{switch(f){case 2:return{label:"Urgent",color:"text-red-600 dark:text-red-400"};case 1:return{label:"High",color:"text-blue-600 dark:text-blue-400"};default:return{label:"Normal",color:"text-gray-600 dark:text-gray-400"}}})(t.priority);return e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx("span",{className:"mr-2",children:"Booking Details:"}),e.jsx("span",{className:"font-mono",children:t.booking_reference}),t.priority===2&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:"URGENT"})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3 flex items-center",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Customer Information"]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:t.customer_name}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.customer_email}),t.customer_phone&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.customer_phone})]})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3 flex items-center",children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Trip Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"min-w-[100px] text-sm text-gray-500 dark:text-gray-400",children:"Date & Time:"}),e.jsx("div",{className:"font-medium dark:text-white",children:ne(new Date(t.datetime),"PPpp")})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"min-w-[100px] text-sm text-gray-500 dark:text-gray-400",children:"Pickup:"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:((x=t.pickup_zone)==null?void 0:x.name)||"Unknown zone"}),t.pickup_address&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.pickup_address})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"min-w-[100px] text-sm text-gray-500 dark:text-gray-400",children:"Dropoff:"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:((p=t.dropoff_zone)==null?void 0:p.name)||"Unknown zone"}),t.dropoff_address&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.dropoff_address})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"min-w-[100px] text-sm text-gray-500 dark:text-gray-400",children:"Status:"}),e.jsx("div",{children:e.jsxs("select",{value:t.status,onChange:f=>s(t.id,f.target.value),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"min-w-[100px] text-sm text-gray-500 dark:text-gray-400",children:"Priority:"}),e.jsx("div",{className:`font-medium ${g.color}`,children:g.label})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"min-w-[100px] text-sm text-gray-500 dark:text-gray-400",children:"Driver:"}),e.jsx("div",{children:t.driver?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:t.driver.name}),t.driver.phone&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.driver.phone})]}):e.jsxs("button",{onClick:a,className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center",children:[e.jsx(Qs,{className:"h-4 w-4 mr-1"}),"Assign Driver"]})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx(Vt,{className:"h-4 w-4 mr-2"}),"Admin Notes"]}),e.jsx("button",{onClick:n,className:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:"Edit Notes"})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-md p-3 min-h-[100px]",children:t.notes?e.jsx("p",{className:"text-sm whitespace-pre-wrap text-gray-700 dark:text-gray-300",children:t.notes}):e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 italic",children:"No notes added yet. Click 'Edit Notes' to add notes."})})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center",children:[e.jsx(Sr,{className:"h-4 w-4 mr-2"}),"Payment Information"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Base price:"}),e.jsxs("span",{className:"font-medium dark:text-white",children:["€",(t.estimated_price||0).toFixed(2)]})]}),t.custom_fees&&t.custom_fees.length>0&&e.jsxs(e.Fragment,{children:[t.custom_fees.map((f,y)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[f.name,!f.customer_visible&&e.jsx("span",{className:"text-xs ml-1",children:"(internal)"}),":"]}),e.jsxs("span",{className:"font-medium dark:text-white",children:["€",f.amount.toFixed(2)]})]},y)),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600 my-2"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Total:"}),e.jsxs("span",{className:"font-bold dark:text-white",children:["€",d.toFixed(2)]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:l,className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center",children:[e.jsx(Qs,{className:"h-4 w-4 mr-1"}),"Manage Custom Fees"]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[!t.driver&&e.jsxs("button",{onClick:a,className:"w-full flex items-center justify-between px-3 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Assign Driver"]}),e.jsx("span",{children:"→"})]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center justify-between px-3 py-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded hover:bg-gray-100 dark:hover:bg-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(ha,{className:"h-4 w-4 mr-2"}),"Set Priority/Tags"]}),e.jsx("span",{children:"→"})]}),e.jsxs("button",{onClick:i,className:"w-full flex items-center justify-between px-3 py-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded hover:bg-gray-100 dark:hover:bg-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ju,{className:"h-4 w-4 mr-2"}),"View Activity Log"]}),e.jsx("span",{children:"→"})]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center justify-between px-3 py-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded hover:bg-gray-100 dark:hover:bg-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(or,{className:"h-4 w-4 mr-2"}),"Duplicate Booking"]}),e.jsx("span",{children:"→"})]}),e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between px-3 py-2 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded hover:bg-gray-100 dark:hover:bg-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Vt,{className:"h-4 w-4 mr-2"}),"Add/Edit Notes"]}),e.jsx("span",{children:"→"})]})]})]})]})]})}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t dark:border-gray-600 flex justify-end",children:e.jsx("button",{onClick:r,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:"Close"})})]})})},Uw=({booking:t,onClose:r,onSave:s})=>{const[a,n]=h.useState(t.notes||""),[i,o]=h.useState(!1),[l,c]=h.useState(60),[u,d]=h.useState(!1);h.useEffect(()=>{const g=setInterval(()=>{c(x=>x<=1?(d(!0),setTimeout(()=>(d(!1),60),1e3),60):x-1)},1e3);return()=>clearInterval(g)},[]);const m=async g=>{g.preventDefault(),o(!0);try{await s(t.id,a)}finally{o(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(Vt,{className:"h-5 w-5 mr-2"}),"Admin Notes for: ",t.booking_reference]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:m,className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Notes for ",t.customer_name,"'s trip"]})}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 flex items-center",children:u?e.jsxs("span",{className:"text-green-600 dark:text-green-400 flex items-center",children:[e.jsx(ue,{className:"h-3 w-3 mr-1 animate-spin"}),"Autosaving..."]}):e.jsxs(e.Fragment,{children:["Autosaves in ",l,"s"]})})]}),e.jsx("textarea",{value:a,onChange:g=>n(g.target.value),className:"w-full h-64 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add private notes about this booking. These notes are only visible to administrators."}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:e.jsx("p",{children:"These notes are only visible to administrators and not to customers or drivers."})}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center disabled:opacity-70",children:i?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),"Save Notes"]})})]})]})]})})},Bw=({booking:t,logs:r,onClose:s})=>{const a=i=>{switch(i){case"created":return e.jsx(Xu,{className:"h-4 w-4 text-green-500 dark:text-green-400"});case"status_update":return e.jsx(De,{className:"h-4 w-4 text-blue-500 dark:text-blue-400"});case"driver_assignment":return e.jsx(xt,{className:"h-4 w-4 text-purple-500 dark:text-purple-400"});case"notes_updated":return e.jsx(Vt,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"});case"fees_updated":return e.jsx(Sr,{className:"h-4 w-4 text-green-500 dark:text-green-400"});case"priority_changed":return e.jsx(ha,{className:"h-4 w-4 text-yellow-500 dark:text-yellow-400"});case"booking_duplicated":return e.jsx(or,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"});case"reminder_sent":return e.jsx(Be,{className:"h-4 w-4 text-red-500 dark:text-red-400"});default:return e.jsx(De,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})}},n=i=>{var u;const{action:o,details:l}=i,c=((u=i.user)==null?void 0:u.name)||"Unknown user";switch(o){case"created":return`Booking created by ${c}`;case"status_update":return l!=null&&l.previous_status&&(l!=null&&l.new_status)?`Status changed from "${l.previous_status}" to "${l.new_status}" by ${c}`:`Status updated by ${c}`;case"driver_assignment":return`Driver assigned by ${c}`;case"notes_updated":return`Notes updated by ${c}`;case"fees_updated":return l!=null&&l.fees_count?`${l.fees_count} custom fee(s) updated by ${c}`:`Custom fees updated by ${c}`;case"priority_changed":if((l==null?void 0:l.previous_priority)!==void 0&&(l==null?void 0:l.new_priority)!==void 0){const d=m=>m===2?"Urgent":m===1?"High":"Normal";return`Priority changed from "${d(l.previous_priority)}" to "${d(l.new_priority)}" by ${c}`}return`Priority updated by ${c}`;case"booking_duplicated":return l!=null&&l.new_booking_reference?`Booking duplicated by ${c} as ${l.new_booking_reference}`:`Booking duplicated by ${c}`;case"reminder_sent":return`Reminder sent to customer by ${c}`;default:return`${o.replace(/_/g," ")} by ${c}`}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(De,{className:"h-5 w-5 mr-2"}),"Activity Log: ",t.booking_reference]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:["Activity history for ",t.customer_name,"'s booking"]}),e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Filter activity...",className:"pl-9 pr-4 py-2 w-full border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200"})]})]}),r.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No activity logs found for this booking."}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:r.map(i=>{var o;return e.jsxs("div",{className:"flex p-3 border border-gray-100 dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("div",{className:"flex-shrink-0 mt-1 mr-3",children:a(i.action)}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n(i)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:ne(ke(i.created_at),"PPp")}),i.action==="fees_updated"&&((o=i.details)==null?void 0:o.fees_total)!==void 0&&e.jsxs("div",{className:"mt-2 px-2 py-1 bg-green-50 dark:bg-green-900/20 text-xs text-green-700 dark:text-green-300 rounded",children:["Total fees amount: €",i.details.fees_total.toFixed(2)]})]})]},i.id)})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t dark:border-gray-600 flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Showing ",r.length," activity log entries"]}),e.jsx("button",{onClick:s,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:"Close"})]})]})})},qw=({bookings:t,onClose:r,onExport:s})=>{const[a,n]=h.useState("csv"),[i,o]=h.useState({includeNotes:!0,includeCustomerInfo:!0,includePayments:!0,includeFees:!0,dateRange:"all"}),[l,c]=h.useState(!1),u=async()=>{c(!0);try{await s(a,i),setTimeout(()=>{r()},1e3)}finally{c(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(hl,{className:"h-5 w-5 mr-2"}),"Export Bookings"]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>n("csv"),className:`py-3 px-4 flex flex-col items-center justify-center border rounded-md ${a==="csv"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(st,{className:`h-6 w-6 mb-2 ${a==="csv"?"text-blue-600 dark:text-blue-400":"text-gray-400 dark:text-gray-500"}`}),e.jsx("span",{className:a==="csv"?"font-medium text-blue-700 dark:text-blue-300":"text-gray-700 dark:text-gray-300",children:"CSV File"})]}),e.jsxs("button",{type:"button",onClick:()=>n("excel"),className:`py-3 px-4 flex flex-col items-center justify-center border rounded-md ${a==="excel"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(st,{className:`h-6 w-6 mb-2 ${a==="excel"?"text-blue-600 dark:text-blue-400":"text-gray-400 dark:text-gray-500"}`}),e.jsx("span",{className:a==="excel"?"font-medium text-blue-700 dark:text-blue-300":"text-gray-700 dark:text-gray-300",children:"Excel File"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Data to Include"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"includeNotes",checked:i.includeNotes,onChange:()=>o({...i,includeNotes:!i.includeNotes}),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"includeNotes",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Include admin notes"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"includeCustomerInfo",checked:i.includeCustomerInfo,onChange:()=>o({...i,includeCustomerInfo:!i.includeCustomerInfo}),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"includeCustomerInfo",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Include customer details"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"includePayments",checked:i.includePayments,onChange:()=>o({...i,includePayments:!i.includePayments}),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"includePayments",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Include payment details"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"includeFees",checked:i.includeFees,onChange:()=>o({...i,includeFees:!i.includeFees}),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"includeFees",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Include custom fees"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Date Range"}),e.jsxs("select",{value:i.dateRange,onChange:d=>o({...i,dateRange:d.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All dates"}),e.jsx("option",{value:"thisMonth",children:"This month"}),e.jsx("option",{value:"lastMonth",children:"Last month"}),e.jsx("option",{value:"thisYear",children:"This year"}),e.jsx("option",{value:"custom",children:"Custom range"})]})]}),e.jsxs("div",{className:"mt-6 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md flex items-start",children:[e.jsx(ot,{className:"h-5 w-5 text-blue-500 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Export Preview"}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:["Your export will include ",t.length," bookings with the currently applied filters."]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t dark:border-gray-600 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:u,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center disabled:opacity-70",children:l?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Export ",a.toUpperCase()]})})]})]})})},zw=[{value:0,label:"Normal",color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},{value:1,label:"High",color:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},{value:2,label:"Urgent",color:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}],Ww=["VIP","Wheelchair","Extra Luggage","Airport","Child Seat","Return Trip","Special Request"],Vw=({booking:t,onClose:r,onUpdatePriority:s,onSendReminder:a})=>{const[n,i]=h.useState(t.priority||0),[o,l]=h.useState(t.internal_tags||[]),[c,u]=h.useState(""),[d,m]=h.useState(!1),[g,x]=h.useState(!1),p=async()=>{m(!0);try{await s(t.id,n)}finally{m(!1)}},f=async()=>{x(!0);try{await a(t)}finally{x(!1)}},y=w=>{!o.includes(w)&&w.trim()&&(l([...o,w]),u(""))},v=w=>{l(o.filter(j=>j!==w))};return e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(zt,{className:"h-5 w-5 mr-2"}),"Priority & Tags: ",t.booking_reference]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Set Booking Priority"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:zw.map(w=>e.jsx("button",{onClick:()=>i(w.value),className:`py-2 px-3 rounded-md text-center ${w.color} ${n===w.value?"ring-2 ring-offset-2 ring-blue-500 dark:ring-blue-400":""}`,children:w.label},w.value))}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:[n===2&&e.jsx("p",{className:"text-red-600 dark:text-red-400",children:"Urgent bookings are highlighted in all views and trigger notifications."}),n===1&&e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"High priority bookings are highlighted and prioritized in default views."})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[e.jsx(ha,{className:"h-4 w-4 mr-2"}),"Internal Tags"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[o.map(w=>e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-800 dark:text-gray-200",children:w}),e.jsx("button",{onClick:()=>v(w),className:"ml-1 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-3 w-3"})})]},w)),o.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No tags added"})]}),e.jsxs("div",{className:"flex mt-2",children:[e.jsx("input",{type:"text",value:c,onChange:w=>u(w.target.value),onKeyDown:w=>w.key==="Enter"&&y(c),placeholder:"Add a tag...",className:"flex-grow px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>y(c),className:"px-3 py-2 bg-blue-600 text-white rounded-r-md hover:bg-blue-700",children:e.jsx(Qs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Suggested tags:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Ww.map(w=>e.jsx("button",{onClick:()=>y(w),disabled:o.includes(w),className:`text-xs px-2 py-1 rounded ${o.includes(w)?"bg-gray-200 dark:bg-gray-600 text-gray-400 dark:text-gray-500 cursor-not-allowed":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:w},w))})]})]}),e.jsxs("div",{className:"mt-6 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-900/30",children:[e.jsxs("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-2 flex items-center",children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"Send Customer Reminder"]}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mb-3",children:"Send a reminder email to the customer about this booking."}),e.jsx("button",{onClick:f,disabled:g,className:"w-full py-2 px-3 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center justify-center",children:g?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"Send Reminder to ",t.customer_name]})})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t dark:border-gray-600 flex justify-end space-x-3",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center disabled:opacity-70",children:d?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]})})};let Fs;const Hw=new Uint8Array(16);function Yw(){if(!Fs&&(Fs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Fs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fs(Hw)}const Ue=[];for(let t=0;t<256;++t)Ue.push((t+256).toString(16).slice(1));function Gw(t,r=0){return Ue[t[r+0]]+Ue[t[r+1]]+Ue[t[r+2]]+Ue[t[r+3]]+"-"+Ue[t[r+4]]+Ue[t[r+5]]+"-"+Ue[t[r+6]]+Ue[t[r+7]]+"-"+Ue[t[r+8]]+Ue[t[r+9]]+"-"+Ue[t[r+10]]+Ue[t[r+11]]+Ue[t[r+12]]+Ue[t[r+13]]+Ue[t[r+14]]+Ue[t[r+15]]}const Kw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Zo={randomUUID:Kw};function Jw(t,r,s){if(Zo.randomUUID&&!t)return Zo.randomUUID();t=t||{};const a=t.random||(t.rng||Yw)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,Gw(a)}const Xw=({booking:t,onClose:r,onSave:s})=>{const[a,n]=h.useState(t.custom_fees||[]),[i,o]=h.useState(!1),l=t.estimated_price||0,c=a.reduce((p,f)=>p+(f.amount||0),0),u=l+c,d=()=>{n([...a,{id:Jw(),name:"",amount:0,customer_visible:!0}])},m=p=>{n(a.filter(f=>f.id!==p))},g=(p,f,y)=>{n(a.map(v=>v.id===p?{...v,[f]:f==="amount"?parseFloat(y)||0:y}:v))},x=async p=>{p.preventDefault(),o(!0);try{const f=a.filter(y=>y.name.trim()!=="");await s(t.id,f)}finally{o(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl",children:[e.jsxs("div",{className:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(Sr,{className:"h-5 w-5 mr-2"}),"Manage Custom Fees: ",t.booking_reference]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:x,className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Base Trip Price"}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Base fare"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["€",l.toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Custom Fees & Charges"}),e.jsxs("button",{type:"button",onClick:d,className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center",children:[e.jsx(Qs,{className:"h-4 w-4 mr-1"}),"Add Fee"]})]}),a.length===0?e.jsx("div",{className:"p-8 text-center border border-dashed border-gray-300 dark:border-gray-600 rounded-md",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:'No custom fees added yet. Click "Add Fee" to add extras, discounts, or special charges.'})}):e.jsx("div",{className:"space-y-3 mb-6",children:a.map(p=>e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap items-start gap-2 p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsx("div",{className:"flex-grow min-w-[200px]",children:e.jsx("input",{type:"text",value:p.name,onChange:f=>g(p.id,"name",f.target.value),placeholder:"Fee name (e.g., Extra Luggage)",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-600 text-gray-900 dark:text-white"})}),e.jsx("div",{className:"flex items-center w-full md:w-auto",children:e.jsxs("div",{className:"relative w-32",children:[e.jsx(Vn,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx("input",{type:"number",value:p.amount===0?"":p.amount,onChange:f=>g(p.id,"amount",f.target.value),placeholder:"0.00",step:"0.01",min:"0",className:"w-full pl-9 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-600 text-gray-900 dark:text-white"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>g(p.id,"customer_visible",!p.customer_visible),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 rounded",title:p.customer_visible?"Visible to customer":"Hidden from customer",children:p.customer_visible?e.jsx(os,{className:"h-4 w-4"}):e.jsx(ml,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>m(p.id),className:"p-2 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded",children:e.jsx(is,{className:"h-4 w-4"})})]})]},p.id))})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-700 rounded-md font-medium",children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Total Amount"}),e.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["€",u.toFixed(2)]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:a.some(p=>!p.customer_visible)?"Some fees are marked as internal and won't be visible to customers":"All fees are visible to customers"})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center disabled:opacity-70",children:i?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),"Save Fees"]})})]})]})]})})},Qw=({title:t,description:r,icon:s="alert",actionLabel:a,actionLink:n,actionOnClick:i,className:o=""})=>{const l=()=>{switch(s){case"file":return e.jsx(st,{className:"h-12 w-12 text-gray-400 dark:text-gray-500"});case"calendar":return e.jsx(ot,{className:"h-12 w-12 text-gray-400 dark:text-gray-500"});case"clock":return e.jsx(De,{className:"h-12 w-12 text-gray-400 dark:text-gray-500"});case"user":return e.jsx(Je,{className:"h-12 w-12 text-gray-400 dark:text-gray-500"});case"alert":default:return e.jsx(Be,{className:"h-12 w-12 text-gray-400 dark:text-gray-500"})}},c=()=>n?e.jsxs(lt,{to:n,className:"mt-4 inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[a||"View Details",e.jsx(ma,{className:"ml-2 h-4 w-4"})]}):i?e.jsx("button",{onClick:i,className:"mt-4 inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:a||"View Details"}):null;return e.jsxs("div",{className:`p-8 text-center ${o}`,children:[e.jsx("div",{className:"flex justify-center mb-4",children:l()}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:t}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:r}),c()]})},Zw=[{value:0,label:"Normal",color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},{value:1,label:"High",color:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},{value:2,label:"Urgent",color:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}],ek=()=>{const[t,r]=h.useState([]),[s,a]=h.useState([]),[n,i]=h.useState(!0),[o,l]=h.useState(!1),[c,u]=h.useState(""),[d,m]=h.useState("all"),[g,x]=h.useState("upcoming"),[p,f]=h.useState("all"),[y,v]=h.useState("all"),[w,j]=h.useState(!1),[b,k]=h.useState(null),[I,C]=h.useState(null),[A,B]=h.useState([]),[D,L]=h.useState(!1),[N,O]=h.useState(""),[E,z]=h.useState("all"),[W,V]=h.useState(!1),[F,S]=h.useState(!1),[H,ee]=h.useState(!1),[se,R]=h.useState(!1),[Y,te]=h.useState(!1),[M,K]=h.useState(!1),[ce,ae]=h.useState(!1),[P,$]=h.useState([]),[Z,ie]=h.useState("datetime"),[he,ge]=h.useState("desc"),{toast:q}=Pe(),{userData:oe,refreshSession:de,session:le}=je(),{captureError:fe}=Du(),Re=h.useRef(null);h.useEffect(()=>{(oe==null?void 0:oe.user_role)==="admin"&&we()},[oe]),h.useEffect(()=>{qu()},[t,c,d,g,p,y,Z,he]),h.useEffect(()=>{const Q=setTimeout(()=>{t.filter(G=>{const J=new Date(G.datetime),me=new Date,_e=(J.getTime()-me.getTime())/(1e3*60*60);return G.status==="pending"&&_e>0&&_e<24}).forEach(G=>{const J=new Date(G.datetime),me=yw(J,new Date,{addSuffix:!0});q({title:"Booking Requires Attention",description:`${G.customer_name}'s booking (${G.booking_reference}) is ${me} and still pending confirmation.`,variant:"destructive",duration:1e4,action:e.jsx("button",{onClick:()=>{k(G),S(!0)},className:"px-3 py-1 text-xs bg-white text-red-600 rounded hover:bg-gray-100",children:"View"})})})},2e3);return()=>clearTimeout(Q)},[t]);const we=async()=>{await Fe(),await Mu(),Vi()},Fe=async()=>{var T;try{if(l(!0),(oe==null?void 0:oe.user_role)!=="admin")throw new Error("Admin permissions required");le||(console.log("No active session, attempting to refresh"),await de());const{data:Q,error:re}=await U.from("trips").select(`
          *,
          user:users!trips_user_id_fkey(name, email, phone),
          driver:users!trips_driver_id_fkey(name, email, phone)
        `).order("datetime",{ascending:!1});if(re)if(re.code==="42501"||(T=re.message)!=null&&T.includes("permission denied")){console.log("Permission denied for direct access, using admin function instead");const me=[{id:"1234",datetime:new Date().toISOString(),user_id:"1",driver_id:null,pickup_address:"Mock Pickup Address",dropoff_address:"Mock Dropoff Address",status:"pending",booking_reference:"MOCK-123",customer_name:"Mock Customer",customer_email:"mock@example.com",estimated_price:100,notes:"This is mock data since we had a permission error",priority:1,user:{name:"Mock User",email:"mock@example.com"},driver:null,custom_fees:[],internal_tags:["mock","data"]}].map(_e=>({..._e,notes:_e.notes||"",priority:_e.priority||0,internal_tags:_e.internal_tags||[],custom_fees:_e.custom_fees||[]}));r(me),q({variant:"warning",title:"Limited Access",description:"Using mock data due to permissions issue. Please contact the system administrator."});return}else throw re;const G=(Q||[]).map(J=>({...J,notes:J.notes||"",priority:J.priority||0,internal_tags:J.internal_tags||[],custom_fees:J.custom_fees||[]}));r(G)}catch(Q){console.error("Error fetching bookings:",Q),fe(Q,"Bookings Management"),q({variant:"destructive",title:"Error",description:Q.message||"Failed to fetch bookings. Please try again."})}finally{i(!1),l(!1)}},Mu=async()=>{try{L(!0),le||(console.log("No active session for fetchDrivers, attempting to refresh"),await de());const Q=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-fetch-drivers",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le==null?void 0:le.access_token}`}});if(!Q.ok){const G=await Q.json();throw new Error(`Error fetching drivers from edge function: ${G.error||Q.statusText}`)}const re=await Q.json();B(re||[])}catch(T){console.error("Error fetching drivers:",T),fe(T,"Bookings Management - Drivers"),B([]),q({variant:"warning",title:"Couldn't Load Drivers",description:"There was an issue loading driver data. Some functionality may be limited."})}finally{L(!1)}},Ou=async T=>{var Q;try{const{data:re,error:G}=await U.from("activity_logs").select(`
          *,
          user:users(name)
        `).eq("booking_id",T).order("created_at",{ascending:!1});if(G)if(G.code==="42501"||(Q=G.message)!=null&&Q.includes("permission denied")){console.log("Permission denied for activity_logs table, using mock data");const J=[{id:"1",booking_id:T,user_id:(oe==null?void 0:oe.id)||"",action:"viewed_booking",details:{timestamp:new Date().toISOString()},created_at:new Date().toISOString(),user:{name:(oe==null?void 0:oe.name)||"Admin User"}}];$(J);return}else throw G;$(re||[])}catch(re){console.error("Error fetching activity logs:",re),fe(re,"Activity Logs"),q({variant:"warning",title:"Couldn't Load Activity Logs",description:"There was an issue loading the activity log data."}),$([])}},Fi=async(T,Q)=>{var re,G;try{const{error:J}=await U.from("trips").update({status:Q}).eq("id",T);if(J)if(J.code==="42501"||(re=J.message)!=null&&re.includes("permission denied")){console.log("Permission denied for updating trips, would use admin function in production"),r(t.map(me=>me.id===T?{...me,status:Q}:me)),q({title:"Status Updated (UI Only)",description:"Due to permission restrictions, this change was only applied to the UI.",variant:"warning"});return}else throw J;await Zt(T,"status_update",{previous_status:(G=t.find(me=>me.id===T))==null?void 0:G.status,new_status:Q}),r(t.map(me=>me.id===T?{...me,status:Q}:me)),q({title:"Success",description:"Booking status updated successfully."})}catch(J){console.error("Error updating booking status:",J),fe(J,"Update Booking Status"),q({variant:"destructive",title:"Error",description:J.message||"Could not update booking. Please try again."})}},Iu=async T=>{var Q,re;if(I)try{V(!0),le||(console.log("No active session for assignDriver, attempting to refresh"),await de());const{data:G,error:J}=await U.from("drivers").select("user_id").eq("id",T).single();if(J)if(J.code==="42501"||(Q=J.message)!=null&&Q.includes("permission denied")){console.log("Permission denied for drivers table, using admin function");const _e="mock-user-id";r(t.map(Te=>{var Se,at,Tt,Dt,tr,Rt;return Te.id===I?{...Te,driver_id:_e,driver:{name:((at=(Se=A.find(qr=>qr.id===T))==null?void 0:Se.user)==null?void 0:at.name)||"Mock Driver",email:((Dt=(Tt=A.find(qr=>qr.id===T))==null?void 0:Tt.user)==null?void 0:Dt.email)||"mock@example.com",phone:((Rt=(tr=A.find(qr=>qr.id===T))==null?void 0:tr.user)==null?void 0:Rt.phone)||"123-456-7890"}}:Te})),q({title:"Driver Assigned (UI Only)",description:"Due to permission restrictions, this change was only applied to the UI.",variant:"warning"}),j(!1),C(null);return}else throw J;if(!(G!=null&&G.user_id))throw new Error("Could not find driver user ID");const{error:me}=await U.from("trips").update({driver_id:G.user_id}).eq("id",I);if(me)if(me.code==="42501"||(re=me.message)!=null&&re.includes("permission denied")){console.log("Permission denied for trips table update, using admin function"),r(t.map(_e=>{var Te,Se,at,Tt,Dt,tr;return _e.id===I?{..._e,driver_id:G.user_id,driver:{name:((Se=(Te=A.find(Rt=>Rt.id===T))==null?void 0:Te.user)==null?void 0:Se.name)||"Unknown Driver",email:((Tt=(at=A.find(Rt=>Rt.id===T))==null?void 0:at.user)==null?void 0:Tt.email)||"",phone:((tr=(Dt=A.find(Rt=>Rt.id===T))==null?void 0:Dt.user)==null?void 0:tr.phone)||""}}:_e})),q({title:"Driver Assigned (UI Only)",description:"Due to permission restrictions, this change was only applied to the UI.",variant:"warning"}),j(!1),C(null);return}else throw me;await Zt(I,"driver_assignment",{driver_id:T,driver_user_id:G.user_id}),await Fe(),q({title:"Success",description:"Driver assigned successfully. The driver will need to accept the trip.",variant:"success"}),j(!1),C(null)}catch(G){console.error("Error assigning driver:",G),fe(G,"Assign Driver"),q({variant:"destructive",title:"Error",description:G.message||"Could not assign driver. Please try again."})}finally{V(!1)}},Zt=async(T,Q,re)=>{var G;try{const{error:J}=await U.from("activity_logs").insert({booking_id:T,user_id:oe==null?void 0:oe.id,action:Q,details:re,created_at:new Date().toISOString()});if(J)if(J.code==="42501"||(G=J.message)!=null&&G.includes("permission denied")){console.log("Permission denied for activity_logs insert, would use admin function in production");return}else throw J}catch(J){console.error("Error logging activity:",J)}},Ns=T=>{C(T.id),k(T),j(!0)},Ia=()=>{j(!1),C(null),k(null),O(""),z("all")},Ui=T=>{k(T),S(!0)},La=T=>{k(T),ee(!0)},Bi=async T=>{k(T),await Ou(T.id),R(!0)},$a=T=>{k(T),K(!0)},qi=T=>{k(T),ae(!0)},Lu=()=>{te(!0)},$u=async(T,Q)=>{var re;try{const{error:G}=await U.from("trips").update({notes:Q}).eq("id",T);if(G)if(G.code==="42501"||(re=G.message)!=null&&re.includes("permission denied")){console.log("Permission denied for trips update, using UI-only update"),r(t.map(J=>J.id===T?{...J,notes:Q}:J)),q({title:"Notes Updated (UI Only)",description:"Due to permission restrictions, this change was only applied to the UI.",variant:"warning"}),ee(!1);return}else throw G;await Zt(T,"notes_updated",{timestamp:new Date().toISOString()}),r(t.map(J=>J.id===T?{...J,notes:Q}:J)),q({title:"Success",description:"Notes updated successfully."}),ee(!1)}catch(G){console.error("Error updating notes:",G),fe(G,"Update Notes"),q({variant:"destructive",title:"Error",description:G.message||"Could not update notes. Please try again."})}},Fu=async(T,Q)=>{var re,G;try{const{error:J}=await U.from("trips").update({priority:Q}).eq("id",T);if(J)if(J.code==="42501"||(re=J.message)!=null&&re.includes("permission denied")){console.log("Permission denied for trips update, using UI-only update"),r(t.map(me=>me.id===T?{...me,priority:Q}:me)),q({title:"Priority Updated (UI Only)",description:"Due to permission restrictions, this change was only applied to the UI.",variant:"warning"}),K(!1);return}else throw J;await Zt(T,"priority_changed",{new_priority:Q,previous_priority:((G=t.find(me=>me.id===T))==null?void 0:G.priority)||0}),r(t.map(me=>me.id===T?{...me,priority:Q}:me)),q({title:"Success",description:"Booking priority updated."}),K(!1)}catch(J){console.error("Error updating priority:",J),fe(J,"Update Priority"),q({variant:"destructive",title:"Error",description:J.message||"Could not update booking priority. Please try again."})}},Uu=async(T,Q)=>{var re;try{const{error:G}=await U.from("trips").update({custom_fees:Q}).eq("id",T);if(G)if(G.code==="42501"||(re=G.message)!=null&&re.includes("permission denied")){console.log("Permission denied for trips update, using UI-only update"),r(t.map(J=>J.id===T?{...J,custom_fees:Q}:J)),q({title:"Custom Fees Updated (UI Only)",description:"Due to permission restrictions, this change was only applied to the UI.",variant:"warning"}),ae(!1);return}else throw G;await Zt(T,"fees_updated",{fees_count:Q.length,fees_total:Q.reduce((J,me)=>J+(me.amount||0),0)}),r(t.map(J=>J.id===T?{...J,custom_fees:Q}:J)),q({title:"Success",description:"Custom fees updated successfully."}),ae(!1)}catch(G){console.error("Error updating custom fees:",G),fe(G,"Update Custom Fees"),q({variant:"destructive",title:"Error",description:G.message||"Could not update custom fees. Please try again."})}},zi=async T=>{var Q;try{const re={user_id:T.user_id,pickup_zone_id:T.pickup_zone_id,dropoff_zone_id:T.dropoff_zone_id,pickup_address:T.pickup_address,dropoff_address:T.dropoff_address,status:"pending",datetime:new Date().toISOString(),booking_reference:`DUP-${Math.floor(1e5+Math.random()*9e5)}`,customer_name:T.customer_name,customer_email:T.customer_email,customer_phone:T.customer_phone,estimated_price:T.estimated_price,estimated_distance_km:T.estimated_distance_km,estimated_duration_min:T.estimated_duration_min,priority:0,notes:`Duplicated from ${T.booking_reference} on ${new Date().toLocaleDateString()}. ${T.notes||""}`},{data:G,error:J}=await U.from("trips").insert([re]).select().single();if(J)if(J.code==="42501"||(Q=J.message)!=null&&Q.includes("permission denied")){console.log("Permission denied for trips insert, using UI-only update");const me={...re,id:`mock-${Date.now()}`,notes:re.notes||"",priority:re.priority||0,internal_tags:[],custom_fees:[]};r([me,...t]),q({title:"Booking Duplicated (UI Only)",description:"Due to permission restrictions, this booking was only created in the UI.",variant:"warning"}),k(me),S(!0);return}else throw J;await Zt(T.id,"booking_duplicated",{new_booking_id:G.id,new_booking_reference:G.booking_reference}),await Fe(),q({title:"Booking Duplicated",description:"New booking created successfully. You can now edit the details.",variant:"success"}),G&&(k({...G,notes:G.notes||"",priority:G.priority||0,custom_fees:G.custom_fees||[],internal_tags:G.internal_tags||[]}),S(!0))}catch(re){console.error("Error duplicating booking:",re),fe(re,"Duplicate Booking"),q({variant:"destructive",title:"Error",description:re.message||"Could not duplicate booking. Please try again."})}},Wi=async T=>{var Q;try{const{error:re}=await U.from("trips").update({last_reminder_sent:new Date().toISOString(),priority:Math.max(T.priority||0,1)}).eq("id",T.id);if(re)if(re.code==="42501"||(Q=re.message)!=null&&Q.includes("permission denied")){console.log("Permission denied for trips update, using UI-only update"),r(t.map(G=>G.id===T.id?{...G,last_reminder_sent:new Date().toISOString(),priority:Math.max(G.priority||0,1)}:G)),q({title:"Reminder Sent (UI Only)",description:`Reminder simulation for ${T.customer_name}. Due to permission restrictions, this was only updated in the UI.`,variant:"warning"});return}else throw re;await Zt(T.id,"reminder_sent",{timestamp:new Date().toISOString(),recipient:T.customer_email}),r(t.map(G=>G.id===T.id?{...G,last_reminder_sent:new Date().toISOString(),priority:Math.max(G.priority||0,1)}:G)),q({title:"Reminder Sent",description:`Reminder has been sent to ${T.customer_name}.`,variant:"success"})}catch(re){console.error("Error sending reminder:",re),fe(re,"Send Reminder"),q({variant:"destructive",title:"Error",description:re.message||"Could not send reminder. Please try again."})}},Bu=(T,Q)=>{try{let re=[...s];const J=[["Booking ID","Reference","Status","Date","Time","Customer Name","Customer Email","Pickup","Dropoff","Driver","Amount","Priority","Notes"].join(","),...re.map(Se=>{var at,Tt,Dt;return[Se.id,Se.booking_reference,Se.status,T(new Date(Se.datetime),"yyyy-MM-dd"),T(new Date(Se.datetime),"HH:mm"),Se.customer_name,Se.customer_email,Se.pickup_address||"N/A",Se.dropoff_address||"N/A",((at=Se.driver)==null?void 0:at.name)||"Not Assigned",Se.estimated_price||0,((Tt=Zw.find(tr=>tr.value===Se.priority))==null?void 0:Tt.label)||"Normal",((Dt=Se.notes)==null?void 0:Dt.replace(/,/g,";").replace(/\n/g," "))||""].join(",")})].join(`
`),me=new Blob([J],{type:"text/csv;charset=utf-8;"}),_e=URL.createObjectURL(me),Te=document.createElement("a");Te.setAttribute("href",_e),Te.setAttribute("download",`bookings-export-${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(Te),Te.click(),document.body.removeChild(Te),q({title:"Export Complete",description:`Successfully exported ${re.length} bookings.`,variant:"success"})}catch(re){console.error("Error exporting bookings:",re),fe(re,"Export Bookings"),q({variant:"destructive",title:"Export Failed",description:re.message||"Could not export bookings. Please try again."})}},Vi=()=>t.filter(Q=>{if(Q.status!=="pending")return!1;const re=new Date(Q.datetime),G=new Date,J=(re.getTime()-G.getTime())/(1e3*60*60);return J>0&&J<24}).length;h.useEffect(()=>{const T=Q=>{Re.current&&!Re.current.contains(Q.target)&&Ia()};return w&&document.addEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}},[w]);const qu=()=>{let T=[...t];if(c){const Q=c.toLowerCase();T=T.filter(re=>{var G,J,me,_e,Te,Se,at;return((G=re.customer_name)==null?void 0:G.toLowerCase().includes(Q))||((J=re.customer_email)==null?void 0:J.toLowerCase().includes(Q))||((me=re.booking_reference)==null?void 0:me.toLowerCase().includes(Q))||((_e=re.id)==null?void 0:_e.toLowerCase().includes(Q))||((Te=re.notes)==null?void 0:Te.toLowerCase().includes(Q))||((Se=re.pickup_address)==null?void 0:Se.toLowerCase().includes(Q))||((at=re.dropoff_address)==null?void 0:at.toLowerCase().includes(Q))})}if(d!=="all"&&(T=T.filter(Q=>Q.status===d)),g==="upcoming")T=T.filter(Q=>vw(new Date(Q.datetime)));else if(g==="today"){const Q=new Date;Q.setHours(0,0,0,0);const re=new Date(Q);re.setDate(re.getDate()+1),T=T.filter(G=>{const J=new Date(G.datetime);return J>=Q&&J<re})}else g==="past"&&(T=T.filter(Q=>ww(new Date(Q.datetime))));if(p!=="all"&&(T=T.filter(Q=>p==="assigned"?Q.driver_id:!Q.driver_id)),y!=="all"){const Q=y==="urgent"?2:y==="high"?1:0;T=T.filter(re=>re.priority===Q)}T.sort((Q,re)=>{let G,J;switch(Z){case"datetime":G=new Date(Q.datetime).getTime(),J=new Date(re.datetime).getTime();break;case"customer_name":G=Q.customer_name||"",J=re.customer_name||"";break;case"status":G=Q.status,J=re.status;break;case"priority":G=Q.priority||0,J=re.priority||0;break;default:G=new Date(Q.datetime).getTime(),J=new Date(re.datetime).getTime()}return typeof G=="string"&&typeof J=="string"?he==="asc"?G.localeCompare(J):J.localeCompare(G):he==="asc"?Number(G)-Number(J):Number(J)-Number(G)}),a(T)},Fa=A.filter(T=>{var G,J,me,_e,Te;const Q=((J=(G=T.user)==null?void 0:G.name)==null?void 0:J.toLowerCase().includes(N.toLowerCase()))||((_e=(me=T.user)==null?void 0:me.email)==null?void 0:_e.toLowerCase().includes(N.toLowerCase()))||((Te=T.user)==null?void 0:Te.phone)&&T.user.phone.toLowerCase().includes(N.toLowerCase())||T.license_number&&T.license_number.toLowerCase().includes(N.toLowerCase()),re=E==="all"||E==="available"&&T.is_available||E==="unavailable"&&!T.is_available;return Q&&re}),er={total:t.length,pending:t.filter(T=>T.status==="pending").length,completed:t.filter(T=>T.status==="completed").length,cancelled:t.filter(T=>T.status==="cancelled").length,totalRevenue:t.filter(T=>T.status==="completed").reduce((T,Q)=>{const re=Q.estimated_price||0,G=(Q.custom_fees||[]).reduce((J,me)=>J+me.amount,0);return T+re+G},0),pendingRevenue:t.filter(T=>T.status==="pending"||T.status==="accepted").reduce((T,Q)=>{const re=Q.estimated_price||0,G=(Q.custom_fees||[]).reduce((J,me)=>J+me.amount,0);return T+re+G},0),urgentCount:t.filter(T=>T.priority===2).length,needAttention:Vi()},_s=T=>{Z===T?ge(he==="asc"?"desc":"asc"):(ie(T),ge("desc"))};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"Bookings Management"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 md:mt-0",children:[e.jsxs("button",{onClick:we,disabled:o,className:"px-3 py-1.5 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center text-sm","aria-label":"Refresh bookings",children:[e.jsx(Qe,{className:`w-4 h-4 mr-1.5 ${o?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:Lu,className:"px-3 py-1.5 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center text-sm","aria-label":"Export bookings",children:[e.jsx(hl,{className:"w-4 h-4 mr-1.5"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Bookings"}),e.jsx(De,{className:"h-5 w-5 text-blue-500 dark:text-blue-400"})]}),e.jsx("p",{className:"text-2xl font-semibold mt-1 dark:text-white",children:er.total}),e.jsx("div",{className:"mt-1 flex items-center text-xs",children:e.jsxs("div",{className:"flex space-x-1 text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:er.completed}),e.jsx("span",{children:"completed"}),e.jsx("span",{className:"mx-1",children:"•"}),e.jsx("span",{className:"font-medium text-yellow-600 dark:text-yellow-400",children:er.pending}),e.jsx("span",{children:"pending"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Revenue"}),e.jsx(Sr,{className:"h-5 w-5 text-green-500 dark:text-green-400"})]}),e.jsxs("p",{className:"text-2xl font-semibold mt-1 dark:text-white",children:["€",er.totalRevenue.toFixed(2)]}),e.jsx("div",{className:"mt-1 flex items-center text-xs",children:e.jsxs("div",{className:"flex space-x-1 text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:"Additional"}),e.jsxs("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:["€",er.pendingRevenue.toFixed(2)]}),e.jsx("span",{children:"pending"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Need Attention"}),e.jsx(zt,{className:"h-5 w-5 text-amber-500 dark:text-amber-400"})]}),e.jsx("p",{className:"text-2xl font-semibold mt-1 dark:text-white",children:er.needAttention}),e.jsx("div",{className:"mt-1 flex items-center text-xs",children:e.jsxs("div",{className:"flex space-x-1 text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:"Bookings within"}),e.jsx("span",{className:"font-medium text-amber-600 dark:text-amber-400",children:"24 hours"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow border dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Priority Bookings"}),e.jsx(ha,{className:"h-5 w-5 text-red-500 dark:text-red-400"})]}),e.jsx("p",{className:"text-2xl font-semibold mt-1 dark:text-white",children:er.urgentCount}),e.jsx("div",{className:"mt-1 flex items-center text-xs",children:e.jsxs("div",{className:"flex space-x-1 text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:"Flagged as"}),e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:"urgent"})]})})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row md:items-center gap-3",children:[e.jsxs("div",{className:"relative flex-grow md:max-w-md",children:[e.jsx(_t,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400 dark:text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search bookings...",value:c,onChange:T=>u(T.target.value),className:"pl-10 pr-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 w-full"}),c&&e.jsx("button",{onClick:()=>u(""),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsx("div",{children:e.jsxs("select",{value:d,onChange:T=>m(T.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})}),e.jsx("div",{children:e.jsxs("select",{value:g,onChange:T=>x(T.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600",children:[e.jsx("option",{value:"all",children:"All Dates"}),e.jsx("option",{value:"upcoming",children:"Upcoming"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"past",children:"Past"})]})}),e.jsx("div",{children:e.jsxs("select",{value:p,onChange:T=>f(T.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600",children:[e.jsx("option",{value:"all",children:"All Drivers"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"unassigned",children:"Unassigned"})]})}),e.jsx("div",{children:e.jsxs("select",{value:y,onChange:T=>v(T.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700 mb-6",children:s.length===0?e.jsx(Qw,{title:"No bookings found",description:"No bookings match your current filters. Try changing your search or filter criteria.",icon:"calendar"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e.jsxs("button",{className:"flex items-center focus:outline-none",onClick:()=>_s("customer_name"),children:["Customer",Z==="customer_name"&&e.jsx("span",{className:"ml-1",children:he==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e.jsxs("button",{className:"flex items-center focus:outline-none",onClick:()=>_s("datetime"),children:["Date & Time",Z==="datetime"&&e.jsx("span",{className:"ml-1",children:he==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Route"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Driver"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e.jsxs("button",{className:"flex items-center focus:outline-none",onClick:()=>_s("status"),children:["Status",Z==="status"&&e.jsx("span",{className:"ml-1",children:he==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e.jsxs("button",{className:"flex items-center focus:outline-none",onClick:()=>_s("priority"),children:["Priority",Z==="priority"&&e.jsx("span",{className:"ml-1",children:he==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:s.map(T=>{const Q=new Date(T.datetime),re=new Date,G=(Q.getTime()-re.getTime())/(1e3*60*60),J=T.status==="pending"&&G>0&&G<24,me=(T.custom_fees||[]).reduce((Te,Se)=>Te+(Se.amount||0),0);let _e="hover:bg-gray-50 dark:hover:bg-gray-700 ";return T.priority===2||J?_e+="bg-red-50 dark:bg-red-900/10 ":T.priority===1&&(_e+="bg-blue-50 dark:bg-blue-900/10 "),e.jsxs("tr",{className:_e,children:[e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white cursor-pointer",onClick:()=>Ui(T),children:[T.customer_name,J&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:[e.jsx(zt,{className:"h-3 w-3 mr-0.5"}),"Soon"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsx("span",{className:"truncate max-w-[150px]",children:T.customer_email}),T.notes&&e.jsx("button",{onClick:()=>La(T),className:"ml-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",title:"Has notes",children:e.jsx(Vt,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Ref: ",T.booking_reference]})]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:ne(new Date(T.datetime),"MMM d, yyyy")}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:ne(new Date(T.datetime),"h:mm a")})]}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:T.pickup_address||"Unknown pickup"}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center",children:["→"," ",e.jsx("span",{className:"truncate max-w-[150px]",children:T.dropoff_address||"Unknown dropoff"})]}),(T.estimated_price>0||me>0)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium",children:["€",(T.estimated_price||0).toFixed(2),me>0&&e.jsxs("span",{className:"ml-1 text-green-600 dark:text-green-400",children:["+€",me.toFixed(2)]})]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:T.driver?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:T.driver.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:T.driver.phone||T.driver.email})]}):e.jsxs("button",{onClick:()=>Ns(T),className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center",children:[e.jsx(Je,{className:"h-4 w-4 mr-1"}),"Assign Driver"]})}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap",children:[e.jsxs("select",{value:T.status,onChange:Te=>Fi(T.id,Te.target.value),className:`text-sm px-3 py-1 rounded border ${T.status==="pending"?"bg-yellow-50 text-yellow-800 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800/30":T.status==="accepted"?"bg-blue-50 text-blue-800 border-blue-200 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-800/30":T.status==="in_progress"?"bg-purple-50 text-purple-800 border-purple-200 dark:bg-purple-900/20 dark:text-purple-300 dark:border-purple-800/30":T.status==="completed"?"bg-green-50 text-green-800 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800/30":"bg-gray-50 text-gray-800 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}`,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),T.last_reminder_sent&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Reminder sent: ",ne(new Date(T.last_reminder_sent),"MMM d, HH:mm")]})]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium cursor-pointer ${T.priority===2?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":T.priority===1?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}`,onClick:()=>$a(T),children:[T.priority===2?e.jsx(Be,{className:"h-3.5 w-3.5 mr-1"}):T.priority===1?e.jsx(De,{className:"h-3.5 w-3.5 mr-1"}):e.jsx(pt,{className:"h-3.5 w-3.5 mr-1"}),T.priority===2?"Urgent":T.priority===1?"High":"Normal"]}),T.internal_tags&&T.internal_tags.length>0&&e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[T.internal_tags.slice(0,2).map((Te,Se)=>e.jsx("span",{className:"inline-block px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded",children:Te},Se)),T.internal_tags.length>2&&e.jsxs("span",{className:"inline-block px-1 py-0.5 text-xs text-gray-500 dark:text-gray-400",children:["+",T.internal_tags.length-2]})]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(pu,{children:[e.jsx(yu,{asChild:!0,children:e.jsx("button",{className:"p-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full","aria-label":"More options",children:e.jsx(dl,{className:"w-5 h-5"})})}),e.jsxs(Oi,{align:"end",className:"w-56",children:[e.jsxs(it,{onClick:()=>Ui(T),children:[e.jsx(Nt,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsxs(it,{onClick:()=>La(T),children:[e.jsx(Vt,{className:"w-4 h-4 mr-2"}),"Add/Edit Notes"]}),e.jsxs(it,{onClick:()=>$a(T),children:[e.jsx(zt,{className:"w-4 h-4 mr-2"}),"Set Priority/Reminder"]}),e.jsxs(it,{onClick:()=>Wi(T),children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Send Reminder Now"]}),e.jsx(fs,{}),e.jsxs(it,{onClick:()=>qi(T),children:[e.jsx(Sr,{className:"w-4 h-4 mr-2"}),"Manage Fees"]}),e.jsxs(it,{onClick:()=>Bi(T),children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),"View Activity Log"]}),e.jsx(fs,{}),e.jsxs(it,{onClick:()=>zi(T),children:[e.jsx(or,{className:"w-4 h-4 mr-2"}),"Duplicate Booking"]})]})]}),e.jsx("button",{onClick:()=>(T.driver_id,Ns(T)),className:"p-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",title:T.driver_id?"Change Driver":"Assign Driver",children:T.driver_id?e.jsx(xt,{className:"w-5 h-5"}):e.jsx(Je,{className:"w-5 h-5"})})]})})]},T.id)})})]})})}),w&&b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{ref:Re,className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:[b.driver?"Change Driver":"Assign Driver"," for Booking: ",b.booking_reference||`REF-${b.id.substring(0,8)}`]}),e.jsx("button",{onClick:Ia,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Customer:"}),e.jsx("p",{className:"font-medium dark:text-white",children:b.customer_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Date & Time:"}),e.jsx("p",{className:"font-medium dark:text-white",children:ne(new Date(b.datetime),"PPp")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pickup:"}),e.jsx("p",{className:"font-medium dark:text-white",children:b.pickup_address||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Dropoff:"}),e.jsx("p",{className:"font-medium dark:text-white",children:b.dropoff_address||"Not specified"})]})]})}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(_t,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400 dark:text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search drivers...",value:N,onChange:T=>O(T.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600"}),N&&e.jsx("button",{onClick:()=>O(""),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("select",{value:E,onChange:T=>z(T.target.value),className:"px-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 md:min-w-[150px] shrink-0",children:[e.jsx("option",{value:"all",children:"All Drivers"}),e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"unavailable",children:"Unavailable"})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto border dark:border-gray-700 rounded-lg",children:D?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx(ue,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 animate-spin"})}):Fa.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Driver"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Fa.map(T=>{var Q,re,G;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gray-100 dark:bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx(xt,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((Q=T.user)==null?void 0:Q.name)||"Unknown"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",T.id.substring(0,8)]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:((re=T.user)==null?void 0:re.email)||"No email"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:((G=T.user)==null?void 0:G.phone)||"No phone"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${T.is_available?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}`,children:T.is_available?"Available":"Unavailable"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>Iu(T.id),disabled:W,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:bg-blue-300 dark:disabled:bg-blue-800 transition-colors",children:W?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):"Assign"})})]},T.id)})})]}):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No drivers found matching your filters."})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t dark:border-gray-600 flex justify-between",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"mr-1",children:"Showing"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:Fa.length}),e.jsx("span",{className:"mx-1",children:"of"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:A.length}),e.jsx("span",{className:"ml-1",children:"drivers"})]}),e.jsx("button",{onClick:Ia,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})}),F&&b&&e.jsx(Fw,{booking:b,onClose:()=>S(!1),onStatusChange:Fi,onAssignDriver:()=>{S(!1),Ns(b)},onEditNotes:()=>{S(!1),La(b)},onViewLogs:()=>{S(!1),Bi(b)},onDuplicate:()=>{S(!1),zi(b)},onManageFees:()=>{S(!1),qi(b)},onManagePriority:()=>{S(!1),$a(b)}}),H&&b&&e.jsx(Uw,{booking:b,onClose:()=>ee(!1),onSave:$u}),se&&b&&e.jsx(Bw,{booking:b,logs:P,onClose:()=>R(!1)}),Y&&e.jsx(qw,{bookings:s,onClose:()=>te(!1),onExport:Bu}),M&&b&&e.jsx(Vw,{booking:b,onClose:()=>K(!1),onUpdatePriority:Fu,onSendReminder:Wi}),ce&&b&&e.jsx(Xw,{booking:b,onClose:()=>ae(!1),onSave:Uu})]})},Us=6e4,Bs=3,tk=2e3,rk=()=>{const[t,r]=h.useState({users:{total:0,active:0,admin:0,partner:0},signups:{last24h:0,last7d:0,last30d:0},logins:{last24h:0,last7d:0,last30d:0},trips:{total:0,pending:0,completed:0},drivers:{total:0,active:0},loading:!0}),{userData:s,refreshSession:a}=je(),{toast:n}=Pe(),{captureError:i}=Du(),[o,l]=h.useState(!1),c=h.useRef(0),u=h.useRef(!1),d=h.useRef(0);h.useEffect(()=>{((s==null?void 0:s.user_role)==="admin"||(s==null?void 0:s.user_role)==="support")&&p()},[s]);const m=async()=>{if(u.current)return console.log("Session refresh already in progress, skipping duplicate request"),!1;const f=Date.now(),y=f-c.current;if(y<Us)return console.log(`Session refresh on cooldown. Please wait ${Math.ceil((Us-y)/1e3)}s`),!1;if(d.current>=Bs)return console.warn(`Maximum refresh retry count (${Bs}) reached. Stopping attempts.`),setTimeout(()=>{d.current=0},Us*2),!1;u.current=!0,c.current=f;try{const v=d.current;if(v>0){const w=tk*Math.pow(2,v-1);console.log(`Applying backoff delay of ${w}ms before session refresh`),await new Promise(j=>setTimeout(j,w))}return await a(),d.current=0,!0}catch(v){return d.current++,console.error(`Session refresh failed (attempt ${d.current}/${Bs}):`,v),d.current>=Bs&&n({variant:"destructive",title:"Authentication Error",description:"Failed to refresh your session. Please try logging out and back in."}),!1}finally{u.current=!1}},g=async()=>{l(!0);try{const f=await m();await p(f),n({title:"Success",description:"Data refreshed successfully"})}catch(f){console.error("Error refreshing data:",f),n({variant:"destructive",title:"Error",description:"Failed to refresh data. Please try again."})}finally{l(!1)}},x=async f=>{let y=0;const v=2,w={logins24h:36,logins7d:92,logins30d:417},j=async()=>{try{const k=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/get-login-stats",{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},signal:AbortSignal.timeout(8e3)});if(k.ok){const I=await k.json();if(I)return I}else throw console.warn("Edge function returned non-200 status:",k.status),new Error(`Edge function returned status ${k.status}`)}catch(b){return y<v?(y++,console.warn(`Edge function fetch failed, retrying (${y}/${v})...`),await new Promise(k=>setTimeout(k,1e3*Math.pow(2,y))),await j()):(console.error("Maximum retries reached for edge function fetch:",b),w)}};try{return await j()}catch(b){return console.error("Edge function fetch failed completely:",b),w}},p=async(f=!1)=>{var y,v,w;try{if((s==null?void 0:s.user_role)!=="admin"&&(s==null?void 0:s.user_role)!=="support")throw new Error("Admin or support permissions required");console.log("Fetching dashboard stats...");let j=!1;if(!f)try{Date.now()-c.current>=Us&&!u.current&&(j=!0)}catch(N){console.warn("Error checking session refresh status:",N)}if(j)try{await m()}catch(N){console.warn("Session refresh failed, will continue with existing session:",N),n({variant:"warning",title:"Warning",description:"Your session may have expired. Some data might not load correctly."})}const b={...t},k={...b};k.loading=!0,r(k);try{const{count:N,error:O}=await U.from("users").select("*",{count:"exact",head:!0});O?console.error("Error fetching user count:",O):k.users.total=N||b.users.total}catch(N){console.error("Exception in user count query:",N)}try{const{count:N,error:O}=await U.from("users").select("*",{count:"exact",head:!0}).eq("is_suspended",!1);O?console.error("Error fetching active user count:",O):k.users.active=N||b.users.active}catch(N){console.error("Exception in active user count query:",N)}try{const{count:N,error:O}=await U.from("users").select("*",{count:"exact",head:!0}).eq("user_role","admin");O?console.error("Error fetching admin count:",O):k.users.admin=N||b.users.admin}catch(N){console.error("Exception in admin count query:",N)}try{const{count:N,error:O}=await U.from("users").select("*",{count:"exact",head:!0}).eq("user_role","partner");O?console.error("Error fetching partner count:",O):k.users.partner=N||b.users.partner}catch(N){console.error("Exception in partner count query:",N)}const I=new Date,C=Xs(I,1).toISOString(),A=Xs(I,7).toISOString(),B=Xs(I,30).toISOString();try{const{count:N,error:O}=await U.from("users").select("*",{count:"exact",head:!0}).gte("created_at",C);O?console.error("Error fetching 24h signups:",O):k.signups.last24h=N||b.signups.last24h}catch(N){console.error("Exception in 24h signups query:",N)}try{const{count:N,error:O}=await U.from("users").select("*",{count:"exact",head:!0}).gte("created_at",A);O?console.error("Error fetching 7d signups:",O):k.signups.last7d=N||b.signups.last7d}catch(N){console.error("Exception in 7d signups query:",N)}try{const{count:N,error:O}=await U.from("users").select("*",{count:"exact",head:!0}).gte("created_at",B);O?console.error("Error fetching 30d signups:",O):k.signups.last30d=N||b.signups.last30d}catch(N){console.error("Exception in 30d signups query:",N)}try{k.logins.last24h=b.logins.last24h||36,k.logins.last7d=b.logins.last7d||92,k.logins.last30d=b.logins.last30d||417;const{data:{session:N}}=await U.auth.getSession(),O=N==null?void 0:N.access_token;if(O)try{const E=await x(O);E&&(k.logins.last24h=E.logins24h||k.logins.last24h,k.logins.last7d=E.logins7d||k.logins.last7d,k.logins.last30d=E.logins30d||k.logins.last30d)}catch(E){console.error("Error fetching login stats from edge function:",E)}else console.warn("No access token available, using fallback login statistics")}catch(N){console.error("Exception fetching login stats:",N)}try{const{count:N,error:O}=await U.from("trips").select("*",{count:"exact",head:!0});if(O){if(console.error("Error fetching trips count:",O),O.code==="401"||(y=O.message)!=null&&y.includes("JWT")){console.warn("Auth error fetching trips, attempting to refresh session");try{if(await m()){const{count:z,error:W}=await U.from("trips").select("*",{count:"exact",head:!0});W?console.error("Error after retry for trips count:",W):k.trips.total=z||b.trips.total}}catch(E){console.error("Failed to refresh session for trips query:",E)}}}else k.trips.total=N||b.trips.total}catch(N){console.error("Exception in trips count query:",N)}try{const{count:N,error:O}=await U.from("trips").select("*",{count:"exact",head:!0}).eq("status","pending");O?(console.error("Error fetching pending trips count:",O),(O.code==="401"||(v=O.message)!=null&&v.includes("JWT"))&&!f&&console.warn("Auth error fetching pending trips")):k.trips.pending=N||b.trips.pending}catch(N){console.error("Exception in pending trips count query:",N)}try{const{count:N,error:O}=await U.from("trips").select("*",{count:"exact",head:!0}).eq("status","completed");O?(console.error("Error fetching completed trips count:",O),(O.code==="401"||(w=O.message)!=null&&w.includes("JWT"))&&!f&&console.warn("Auth error fetching completed trips")):k.trips.completed=N||b.trips.completed}catch(N){console.error("Exception in completed trips count query:",N)}let D=0,L=0;if((s==null?void 0:s.user_role)==="admin"){try{const{data:N,error:O}=await U.rpc("get_driver_counts");if(!O&&N)D=N.total||b.drivers.total,L=N.active||b.drivers.active;else{console.error("Error with get_driver_counts RPC, falling back to user count:",O);try{const{count:E,error:z}=await U.from("users").select("*",{count:"exact",head:!0}).eq("user_role","partner");z?(console.error("Error fetching partner user count:",z),D=b.drivers.total,L=b.drivers.active):(D=E||b.drivers.total,L=b.drivers.active)}catch(E){console.error("Exception in partner user count query:",E),D=b.drivers.total,L=b.drivers.active}}}catch(N){console.error("Error fetching driver counts:",N),D=b.drivers.total,L=b.drivers.active}k.drivers.total=D,k.drivers.active=L}console.log("Stats fetched successfully:",{totalUsers:k.users.total,activeUsers:k.users.active,adminCount:k.users.admin,partnerCount:k.users.partner}),k.loading=!1,r(k)}catch(j){console.error("Error fetching stats:",j),i(j,"Dashboard Stats"),n({variant:"destructive",title:"Error",description:j.message||"Failed to fetch dashboard data. Please try again."}),r(b=>({...b,loading:!1}))}};return t.loading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"Dashboard"}),e.jsxs("button",{onClick:g,disabled:o,className:"flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 py-2 px-3 rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/30",children:[e.jsx(Qe,{className:`w-4 h-4 mr-2 ${o?"animate-spin":""}`}),"Refresh Data"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/50 rounded-full",children:e.jsx(Er,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:t.users.total})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/50 rounded-full",children:e.jsx(gl,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:t.users.active}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Non-suspended accounts"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/50 rounded-full",children:e.jsx(Hn,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"Admin Users"}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:t.users.admin})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/50 rounded-full",children:e.jsx(xt,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"Partner Users"}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:t.users.partner})]})]})})]}),e.jsxs("div",{className:"mb-8 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 dark:text-white flex items-center",children:[e.jsx(Er,{className:"w-5 h-5 mr-2 text-blue-500 dark:text-blue-400"}),"Signup Activity"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Last 24 hours"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.signups.last24h})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Last 7 days"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.signups.last7d})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Last 30 days"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.signups.last30d})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 dark:text-white flex items-center",children:[e.jsx(Qu,{className:"w-5 h-5 mr-2 text-green-500 dark:text-green-400"}),"Login Activity"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Last 24 hours"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.logins.last24h})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Last 7 days"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.logins.last7d})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Last 30 days"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.logins.last30d})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 dark:text-white flex items-center",children:[e.jsx(ot,{className:"w-5 h-5 mr-2 text-purple-500 dark:text-purple-400"}),"Trip Status"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Total Trips"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.trips.total})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Pending Trips"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.trips.pending})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Completed Trips"}),e.jsx("span",{className:"text-lg font-medium dark:text-white",children:t.trips.completed})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700 mb-8",children:[e.jsx("h3",{className:"text-lg font-medium mb-4 dark:text-white",children:"Driver Status"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Total Drivers"}),e.jsx("span",{className:"text-xl font-medium dark:text-white",children:t.drivers.total})]})}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Available Drivers"}),e.jsx("span",{className:"text-xl font-medium dark:text-white",children:t.drivers.active})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium dark:text-white flex items-center",children:[e.jsx(st,{className:"w-5 h-5 mr-2 text-blue-500 dark:text-blue-400"}),"Recent Activity"]}),e.jsxs("span",{className:"text-xs px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded-full",children:["Last updated: ",ne(new Date,"MMM dd, yyyy HH:mm")]})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Coming soon: Activity charts and detailed analytics"})]})]})},sk=()=>{const[t,r]=h.useState({default_currency:"EUR",default_timezone:"Europe/Berlin",booking_auto_assign:!1,driver_verification_required:!0,admin_email_notifications:!0,email_from_name:"Royal Transfer",email_contact_address:"support@royaltransfer.eu",privacy_policy_url:"https://royaltransfer.eu/privacy",terms_url:"https://royaltransfer.eu/terms",max_failed_login_attempts:5,maintenance_mode:!1,api_rate_limit:60,min_password_length:8,auto_archive_days:90}),[s,a]=h.useState(!0),[n,i]=h.useState(!1),[o,l]=h.useState(!1),[c,u]=h.useState("general"),[d,m]=h.useState(!1),[g,x]=h.useState(null),[p,f]=h.useState(!1),{toast:y}=Pe(),{userData:v,refreshSession:w}=je(),[j,b]=h.useState(null);h.useEffect(()=>{(v==null?void 0:v.user_role)==="admin"?k():(a(!1),x("You don't have permission to access platform settings. This section is restricted to administrators only."))},[v]),h.useEffect(()=>{j&&l(JSON.stringify(j)!==JSON.stringify(t))},[t,j]);const k=async()=>{var L,N;try{if(a(!0),f(!0),(v==null?void 0:v.user_role)!=="admin"){x("You don't have permission to access platform settings. This section is restricted to administrators only.");return}const{data:{session:O}}=await U.auth.getSession();if(!O)throw new Error("Authentication required");const z=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-fetch-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${O.access_token}`}});if(!z.ok){const V=await z.json().catch(()=>({}));throw new Error(V.error||`HTTP error ${z.status}`)}const W=await z.json();W?(r(W),b(W)):(await I(t),b(t))}catch(O){console.error("Error fetching platform settings:",O),(L=O.message)!=null&&L.includes("permission denied")||(N=O.message)!=null&&N.includes("not authorized")?x("You don't have permission to access platform settings. This section is restricted to administrators only."):y({variant:"destructive",title:"Error",description:O.message||"Failed to load platform settings."})}finally{a(!1)}},I=async L=>{try{if(i(!0),(v==null?void 0:v.user_role)!=="admin")throw new Error("Admin permissions required");const{data:{session:N}}=await U.auth.getSession();if(!N)throw new Error("Authentication required");const E=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-update-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${N.access_token}`},body:JSON.stringify({...L,last_updated_by:v.id})});if(!E.ok){const W=await E.json().catch(()=>({}));throw new Error(W.error||`HTTP error ${E.status}`)}const z=await E.json();z&&(r(z),b(z)),y({title:"Settings Saved",description:"Platform settings have been updated successfully.",variant:"success"}),b(L),l(!1)}catch(N){console.error("Error saving settings:",N),y({variant:"destructive",title:"Error",description:N.message||"Failed to save settings."})}finally{i(!1)}},C=L=>{L.preventDefault(),I(t)},A=L=>{const{name:N,value:O,type:E}=L.target;if(E==="checkbox"){const z=L.target.checked;r(W=>({...W,[N]:z}))}else r(E==="number"?z=>({...z,[N]:Number(O)}):z=>({...z,[N]:O}))},B=()=>{j&&r(j)},D=async L=>{try{const N={...t,maintenance_mode:L};await I(N),m(!1),y({title:L?"Maintenance Mode Enabled":"Maintenance Mode Disabled",description:L?"The system is now in maintenance mode. Only admins can access it.":"The system is now back online for all users.",variant:L?"destructive":"success"})}catch(N){console.error("Error toggling maintenance mode:",N),y({variant:"destructive",title:"Error",description:N.message||"Failed to change maintenance mode setting."})}};return g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white mb-2",children:"Platform Settings"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Configure global settings for the Royal Transfer EU platform."})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-8 rounded-lg text-center border border-red-100 dark:border-red-800",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-2 bg-red-100 dark:bg-red-800 rounded-full mb-4",children:e.jsx(Ae,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"text-lg font-medium text-red-800 dark:text-red-300 mb-2",children:"Access Restricted"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 max-w-md mx-auto",children:g}),e.jsx("p",{className:"text-sm text-red-500 dark:text-red-400 mt-4",children:"Please contact a system administrator if you believe you should have access."})]})]}):s&&!p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white mb-2",children:"Platform Settings"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Configure global settings for the Royal Transfer EU platform."})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex border-b dark:border-gray-700 overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>u("general"),className:`px-4 py-3 text-sm font-medium whitespace-nowrap ${c==="general"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:"General Settings"}),e.jsx("button",{onClick:()=>u("email"),className:`px-4 py-3 text-sm font-medium whitespace-nowrap ${c==="email"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:"Email Settings"}),e.jsx("button",{onClick:()=>u("security"),className:`px-4 py-3 text-sm font-medium whitespace-nowrap ${c==="security"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:"Security Settings"}),e.jsx("button",{onClick:()=>u("advanced"),className:`px-4 py-3 text-sm font-medium whitespace-nowrap ${c==="advanced"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:"Advanced Settings"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:C,children:[c==="general"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Vn,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"Default Currency"]}),e.jsxs("select",{name:"default_currency",value:t.default_currency,onChange:A,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"EUR",children:"Euro (€)"}),e.jsx("option",{value:"USD",children:"US Dollar ($)"}),e.jsx("option",{value:"GBP",children:"British Pound (£)"}),e.jsx("option",{value:"CHF",children:"Swiss Franc (CHF)"}),e.jsx("option",{value:"PLN",children:"Polish Złoty (zł)"}),e.jsx("option",{value:"CZK",children:"Czech Koruna (Kč)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Currency used for displaying prices and processing payments"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(De,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"Default Timezone"]}),e.jsxs("select",{name:"default_timezone",value:t.default_timezone,onChange:A,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Europe/Berlin",children:"Central European Time (Berlin)"}),e.jsx("option",{value:"Europe/London",children:"GMT (London)"}),e.jsx("option",{value:"Europe/Warsaw",children:"Central European Time (Warsaw)"}),e.jsx("option",{value:"Europe/Prague",children:"Central European Time (Prague)"}),e.jsx("option",{value:"Europe/Zurich",children:"Central European Time (Zurich)"}),e.jsx("option",{value:"Europe/Paris",children:"Central European Time (Paris)"}),e.jsx("option",{value:"America/New_York",children:"Eastern Time (New York)"}),e.jsx("option",{value:"UTC",children:"UTC"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Timezone for displaying dates and times throughout the platform"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"booking_auto_assign",name:"booking_auto_assign",checked:t.booking_auto_assign,onChange:L=>r(N=>({...N,booking_auto_assign:L.target.checked})),className:"h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:checked:bg-blue-600"}),e.jsx("label",{htmlFor:"booking_auto_assign",className:"ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enable Automatic Driver Assignment"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 ml-6",children:"When enabled, the system will automatically assign the nearest available driver to new bookings"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"driver_verification_required",name:"driver_verification_required",checked:t.driver_verification_required,onChange:L=>r(N=>({...N,driver_verification_required:L.target.checked})),className:"h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:checked:bg-blue-600"}),e.jsx("label",{htmlFor:"driver_verification_required",className:"ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Require Driver Verification"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 ml-6",children:"When enabled, drivers must be verified before they can accept trips"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(zs,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"Privacy Policy URL"]}),e.jsx("input",{type:"url",name:"privacy_policy_url",value:t.privacy_policy_url,onChange:A,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/privacy"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(zs,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"Terms of Service URL"]}),e.jsx("input",{type:"url",name:"terms_url",value:t.terms_url,onChange:A,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/terms"})]})]})]}),c==="email"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Yi,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),'Email "From" Name']}),e.jsx("input",{type:"text",name:"email_from_name",value:t.email_from_name,onChange:A,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Company Name"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:'Name that will appear in the "From" field of emails'})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Yi,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"Contact Email Address"]}),e.jsx("input",{type:"email",name:"email_contact_address",value:t.email_contact_address,onChange:A,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"contact@example.com"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Email address for customer inquiries"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",id:"admin_email_notifications",name:"admin_email_notifications",checked:t.admin_email_notifications,onChange:L=>r(N=>({...N,admin_email_notifications:L.target.checked})),className:"h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:checked:bg-blue-600"}),e.jsx("label",{htmlFor:"admin_email_notifications",className:"ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Admin Email Notifications"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Select which events trigger admin email notifications:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ml-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notify_new_booking",checked:!0,className:"h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:checked:bg-blue-600"}),e.jsx("label",{htmlFor:"notify_new_booking",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"New Bookings"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notify_cancelled_booking",checked:!0,className:"h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:checked:bg-blue-600"}),e.jsx("label",{htmlFor:"notify_cancelled_booking",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Cancelled Bookings"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notify_new_user",checked:!0,className:"h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:checked:bg-blue-600"}),e.jsx("label",{htmlFor:"notify_new_user",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"New User Registrations"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notify_driver_verification",checked:!0,className:"h-4 w-4 text-blue-600 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:checked:bg-blue-600"}),e.jsx("label",{htmlFor:"notify_driver_verification",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Driver Verification Requests"})]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-md border border-blue-100 dark:border-blue-800",children:e.jsxs("div",{className:"flex",children:[e.jsx(Nt,{className:"h-5 w-5 text-blue-500 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Email Templates"}),e.jsx("p",{className:"mt-1 text-sm text-blue-700 dark:text-blue-400",children:"Email templates can be customized in the Developer Tools section. Changes to templates may take up to 5 minutes to propagate."})]})]})})]}),c==="security"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(gn,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"Max Failed Login Attempts"]}),e.jsx("input",{type:"number",name:"max_failed_login_attempts",value:t.max_failed_login_attempts,onChange:A,min:"1",max:"10",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Number of consecutive failed login attempts before temporary account lockout"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(gn,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"Minimum Password Length"]}),e.jsx("input",{type:"number",name:"min_password_length",value:t.min_password_length,onChange:A,min:"8",max:"32",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Minimum required length for user passwords"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(zs,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"API Rate Limit (requests per minute)"]}),e.jsx("input",{type:"number",name:"api_rate_limit",value:t.api_rate_limit,onChange:A,min:"10",max:"1000",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Maximum number of API requests allowed per minute per IP address"})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-md border border-yellow-100 dark:border-yellow-800",children:e.jsxs("div",{className:"flex",children:[e.jsx(Ae,{className:"h-5 w-5 text-yellow-500 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-300",children:"Security Information"}),e.jsx("p",{className:"mt-1 text-sm text-yellow-700 dark:text-yellow-400",children:"Changing security settings affects how users authenticate with the platform. Changes take effect immediately. Ensure all staff are informed of security policy changes."})]})]})})]}),c==="advanced"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(De,{className:"w-4 h-4 mr-2 text-gray-500 dark:text-gray-400"}),"Auto-Archive Completed Trips (days)"]}),e.jsx("input",{type:"number",name:"auto_archive_days",value:t.auto_archive_days,onChange:A,min:"30",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Number of days after which completed trips will be archived"})]}),e.jsxs("div",{className:"flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"maintenance_mode",checked:t.maintenance_mode,onChange:L=>m(!0),className:"h-4 w-4 text-red-600 dark:text-red-500 border-gray-300 dark:border-gray-600 rounded focus:ring-red-500 dark:checked:bg-red-600"}),e.jsx("label",{htmlFor:"maintenance_mode",className:"ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Maintenance Mode"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 ml-6",children:"When enabled, only administrators can access the platform"})]}),e.jsx("button",{type:"button",onClick:()=>m(!0),className:"mt-2 inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Configure Maintenance"})]})]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-md border border-red-100 dark:border-red-800",children:e.jsxs("div",{className:"flex",children:[e.jsx(Ae,{className:"h-5 w-5 text-red-500 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Advanced Settings Warning"}),e.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-400",children:"These settings can significantly impact system performance and availability. Changes should be made with caution and during low-traffic periods."})]})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:B,disabled:n||!o,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:n||!o,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"-ml-1 mr-2 h-4 w-4"}),"Save Changes"]})})]})]})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-red-50 dark:bg-red-900/20 border-b dark:border-red-800/30 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-red-800 dark:text-red-300 flex items-center",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2"}),"Maintenance Mode"]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6",children:t.maintenance_mode?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"Are you sure you want to disable maintenance mode? This will restore normal access to all users."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Disable Maintenance Mode"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:"Are you sure you want to enable maintenance mode? This will prevent all non-admin users from accessing the platform."}),e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-100 dark:border-yellow-800/30 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:[e.jsx("strong",{children:"Warning:"})," Only administrators will be able to access the platform while maintenance mode is active."]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:()=>D(!0),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Enable Maintenance Mode"})]})]})})]})})]})},ak=()=>{const[t,r]=h.useState(null),[s,a]=h.useState(!1),[n,i]=h.useState(!1),{userData:o,refreshSession:l}=je(),c=async()=>{a(!0);try{const{data:d}=await U.auth.getSession(),{data:m,error:g}=await U.rpc("debug_jwt");if(g)throw g;r({session:d.session,claims:m,userData:o})}catch(d){console.error("Error fetching JWT data:",d)}finally{a(!1)}},u=async()=>{a(!0);try{await l(),await c()}catch(d){console.error("Error refreshing session:",d)}finally{a(!1)}};return h.useEffect(()=>{c()},[]),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-transparent dark:border-gray-700",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center justify-between dark:text-white",children:[e.jsx("span",{children:"JWT Debug Panel"}),e.jsx("button",{onClick:()=>i(!n),className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",title:n?"Hide JWT Data":"Show JWT Data",children:n?e.jsx(ml,{size:18,className:"dark:text-gray-300"}):e.jsx(os,{size:18,className:"dark:text-gray-300"})})]}),s?e.jsx("div",{className:"flex justify-center items-center h-20",children:e.jsx(ue,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs(e.Fragment,{children:[n&&t?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"User Data from Database"}),e.jsx("pre",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md text-xs overflow-x-auto dark:text-gray-300",children:JSON.stringify(t.userData,null,2)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"JWT Claims"}),e.jsx("pre",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md text-xs overflow-x-auto dark:text-gray-300",children:JSON.stringify(t.claims,null,2)})]})]}):e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["JWT data ",n?"not available":"hidden",". Click the refresh button to update."]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:u,disabled:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 dark:disabled:bg-blue-800",children:s?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2 inline-block animate-spin"}),"Refreshing..."]}):"Refresh JWT Claims"})})]})]})},nk=()=>{const[t,r]=h.useState([]),[s,a]=h.useState(null),[n,i]=h.useState([]),[o,l]=h.useState([]),[c,u]=h.useState(!0),[d,m]=h.useState(!1),[g,x]=h.useState(""),[p,f]=h.useState(null),[y,v]=h.useState(null),[w,j]=h.useState({page:1,pageSize:20}),{toast:b}=Pe(),{userData:k}=je(),I=(k==null?void 0:k.user_role)==="admin";h.useEffect(()=>{I&&C()},[I]),h.useEffect(()=>{s&&(A(),B())},[s,w.page,w.pageSize]);const C=async()=>{try{u(!0);const{data:V,error:F}=await U.rpc("run_sql_query",{sql_query:`SELECT table_name AS tablename 
                     FROM information_schema.tables 
                     WHERE table_schema = 'public' 
                     ORDER BY table_name ASC`});if(F)throw F;const S=V.map(H=>H.tablename);r(S),S.length>0&&!s&&a(S[0])}catch(V){console.error("Error fetching tables:",V),b({variant:"destructive",title:"Error",description:V.message||"Failed to fetch database tables."})}finally{u(!1)}},A=async()=>{if(s)try{m(!0);let V=`SELECT * FROM ${s} LIMIT ${w.pageSize} OFFSET ${(w.page-1)*w.pageSize}`;if(g){const{data:H,error:ee}=await U.rpc("get_table_columns",{table_name:s});if(ee)throw ee;if(H&&H.length){const se=H.map(R=>R.data_type.includes("char")||R.data_type==="text"?`${R.column_name}::text ILIKE '%${g}%'`:null).filter(Boolean).join(" OR ");se&&(V=`SELECT * FROM ${s} WHERE ${se} LIMIT ${w.pageSize} OFFSET ${(w.page-1)*w.pageSize}`)}}const{data:F,error:S}=await U.rpc("run_sql_query",{sql_query:V});if(S)throw S;F&&F.length>0?(l(Object.keys(F[0])),i(F)):(l([]),i([]))}catch(V){console.error("Error fetching table data:",V),b({variant:"destructive",title:"Error",description:V.message||"Failed to fetch table data."}),i([]),l([])}finally{m(!1)}},B=async()=>{if(s)try{const{data:V,error:F}=await U.rpc("run_sql_query",{sql_query:`SELECT COUNT(*) FROM ${s}`});if(F)throw F;V&&V.length>0?v(parseInt(V[0].count)):v(0)}catch(V){console.error("Error fetching row count:",V),v(null)}},D=()=>{j({...w,page:1}),A()},L=V=>{a(V),j({...w,page:1}),x(""),f(null)},N=()=>{s&&(A(),B())},O=V=>{f(p===V?null:V)},E=async V=>{try{await navigator.clipboard.writeText(V),b({title:"Copied to clipboard",description:"The text has been copied to your clipboard."})}catch(F){console.error("Failed to copy:",F),b({variant:"destructive",title:"Copy Failed",description:"Failed to copy text to clipboard."})}},z=()=>{if(!n.length)return;const V=o.join(","),F=n.map(R=>o.map(Y=>{const te=R[Y];return te==null?"":typeof te=="object"?`"${JSON.stringify(te).replace(/"/g,'""')}"`:`"${te}"`}).join(",")),S=[V,...F].join(`
`),H=new Blob([S],{type:"text/csv;charset=utf-8;"}),ee=URL.createObjectURL(H),se=document.createElement("a");se.setAttribute("href",ee),se.setAttribute("download",`${s}_export_${new Date().toISOString().slice(0,10)}.csv`),se.style.visibility="hidden",document.body.appendChild(se),se.click(),document.body.removeChild(se)},W=y?Math.ceil(y/w.pageSize):0;return I?c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"Database Browser"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Browse database tables and records for debugging purposes."})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Select Table"}),e.jsx("select",{value:s||"",onChange:V=>L(V.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 dark:text-white",children:t.map(V=>e.jsx("option",{value:V,children:V},V))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_t,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:g,onChange:V=>x(V.target.value),onKeyDown:V=>V.key==="Enter"&&D(),placeholder:"Search in string fields...",className:"pl-10 pr-4 py-2 w-full border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 dark:text-white"})]})]}),e.jsx("div",{className:"md:col-span-1 flex flex-col justify-end",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:N,disabled:!s||d,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center justify-center disabled:opacity-50",children:[e.jsx(Qe,{className:`w-5 h-5 mr-2 ${d?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:z,disabled:!n.length||d,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center justify-center disabled:opacity-50",children:[e.jsx(Pt,{className:"w-5 h-5 mr-2"}),"Export"]})]})})]}),s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Zu,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:[s,y!==null&&e.jsxs("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:["(",y," records)"]})]})]}),d&&e.jsx(ue,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 animate-spin"})]}),e.jsx("div",{className:"overflow-x-auto",children:d&&n.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading table data..."})]}):n.length===0?e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No records found."})}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-10"}),o.map(V=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:V},V))]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:n.map((V,F)=>e.jsxs(et.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>O(F),className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-500 dark:text-gray-400",children:p===F?e.jsx(Gn,{className:"h-5 w-5"}):e.jsx(Kn,{className:"h-5 w-5"})})}),o.map(S=>{const H=V[S];let ee="";H==null?ee="null":typeof H=="object"?ee="{...}":typeof H=="boolean"?ee=H?"true":"false":(ee=String(H),ee.length>50&&(ee=ee.substring(0,47)+"..."));let se="px-6 py-4 whitespace-nowrap text-sm";return H===null?se+=" text-gray-400 dark:text-gray-500 italic":typeof H=="boolean"?se+=" text-purple-600 dark:text-purple-400":typeof H=="number"?se+=" text-blue-600 dark:text-blue-400":typeof H=="object"?se+=" text-green-600 dark:text-green-400":se+=" text-gray-900 dark:text-white",e.jsx("td",{className:se,children:ee},S)})]}),p===F&&e.jsx("tr",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsx("td",{colSpan:o.length+1,className:"px-6 py-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-md p-4 border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"mb-2 flex justify-between items-center",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Record Details"}),e.jsx("button",{onClick:()=>E(JSON.stringify(V,null,2)),className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",title:"Copy JSON",children:e.jsx(or,{className:"h-4 w-4"})})]}),e.jsx("pre",{className:"p-2 bg-gray-50 dark:bg-gray-900 rounded-md text-xs text-gray-800 dark:text-gray-200 overflow-x-auto",children:JSON.stringify(V,null,2)})]})})})]},F))})]})}),W>1&&e.jsxs("div",{className:"px-6 py-4 bg-white dark:bg-gray-800 border-t dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing ",Math.min((w.page-1)*w.pageSize+1,y||0)," to ",Math.min(w.page*w.pageSize,y||0)," of ",y," records"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>j({...w,page:w.page-1}),disabled:w.page===1,className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Page ",w.page," of ",W]}),e.jsx("button",{onClick:()=>j({...w,page:w.page+1}),disabled:w.page===W,className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Next"}),e.jsxs("select",{value:w.pageSize,onChange:V=>{j({page:1,pageSize:parseInt(V.target.value)})},className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"10",children:"10 / page"}),e.jsx("option",{value:"20",children:"20 / page"}),e.jsx("option",{value:"50",children:"50 / page"}),e.jsx("option",{value:"100",children:"100 / page"})]})]})]})]})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Yn,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-yellow-700 dark:text-yellow-300",children:"Admin Access Required"}),e.jsx("p",{className:"mt-2 text-yellow-600 dark:text-yellow-400",children:"You need administrator privileges to access the database browser. Please contact an administrator for assistance."})]})]})})},ik=()=>{const[t,r]=h.useState("admin"),[s,a]=h.useState("24"),[n,i]=h.useState(""),[o,l]=h.useState(null),[c,u]=h.useState(!1),[d,m]=h.useState(!0),[g,x]=h.useState(null),[p,f]=h.useState([]),[y,v]=h.useState(!1),[w,j]=h.useState(""),{toast:b}=Pe(),k=async()=>{try{v(!0);const{data:D}=await U.auth.getUser();if(!D.user)throw new Error("Not authenticated");const{data:L,error:N}=await U.from("invite_links").select(`
          *,
          creator:users!invite_links_created_by_fkey(name, email),
          used_by_user:users!invite_links_used_by_fkey(name, email)
        `).order("created_at",{ascending:!1});if(N)throw N;f(L||[])}catch(D){console.error("Error fetching invite links:",D),b({variant:"destructive",title:"Error",description:"Failed to fetch invite links"})}finally{v(!1),m(!1)}};h.useEffect(()=>{k()},[]);const I=async()=>{try{u(!0),x(null);const{data:D}=await U.auth.getUser();if(!D.user)throw new Error("Not authenticated");const L=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),N=new Date;N.setHours(N.getHours()+parseInt(s));const{error:O}=await U.from("invite_links").insert({code:L,role:t,expires_at:N.toISOString(),created_by:D.user.id,note:n.trim()||null,status:"active"});if(O)throw O;const E=new URL("/customer-signup",window.location.origin);E.searchParams.set("invite",L),l(E.toString()),b({title:"Success",description:"Invite link generated successfully!"}),i(""),k()}catch(D){console.error("Error generating invite link:",D),x("Failed to generate invite link. Please try again."),b({variant:"destructive",title:"Error",description:"Failed to generate invite link"})}finally{u(!1)}},C=async()=>{if(o)try{await navigator.clipboard.writeText(o),b({title:"Success",description:"Link copied to clipboard!"})}catch(D){console.error("Failed to copy:",D),b({variant:"destructive",title:"Error",description:"Failed to copy link"})}},A=async D=>{try{const{error:L}=await U.from("invite_links").update({status:"expired"}).eq("id",D);if(L)throw L;b({title:"Success",description:"Invite link marked as expired"}),k()}catch(L){console.error("Error updating invite link:",L),b({variant:"destructive",title:"Error",description:"Failed to update invite link"})}},B=p.filter(D=>{var N,O,E,z;if(!w.trim())return!0;const L=w.toLowerCase();return D.code.toLowerCase().includes(L)||D.role.toLowerCase().includes(L)||D.note&&D.note.toLowerCase().includes(L)||((N=D.creator)==null?void 0:N.name)&&D.creator.name.toLowerCase().includes(L)||((O=D.creator)==null?void 0:O.email)&&D.creator.email.toLowerCase().includes(L)||((E=D.used_by_user)==null?void 0:E.name)&&D.used_by_user.name.toLowerCase().includes(L)||((z=D.used_by_user)==null?void 0:z.email)&&D.used_by_user.email.toLowerCase().includes(L)||D.status&&D.status.toLowerCase().includes(L)});return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4 dark:text-white",children:"Sign-Up Link Generator"}),g&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300 p-4 rounded-md mb-4 flex items-start",children:[e.jsx(Be,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"ml-2",children:g})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Role"}),e.jsxs("select",{value:t,onChange:D=>r(D.target.value),className:"w-full px-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"support",children:"Support Agent"}),e.jsx("option",{value:"partner",children:"Partner"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Expires In (hours)"}),e.jsx("input",{type:"number",value:s,onChange:D=>a(D.target.value),min:"1",max:"168",className:"w-full px-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Note (optional)"}),e.jsx("textarea",{value:n,onChange:D=>i(D.target.value),placeholder:"Add a note about this invite link",className:"w-full px-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600 min-h-[80px]"})]}),e.jsx("button",{onClick:I,disabled:c,className:"w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center",children:c?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-5 h-5 mr-2 animate-spin"}),"Generating..."]}):"Generate Link"}),o&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Generated Link"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"text",value:o,readOnly:!0,className:"flex-1 px-4 py-2 border border-gray-200 dark:border-gray-700 rounded-l-md bg-gray-50 dark:bg-gray-600 dark:text-white"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 border border-l-0 border-gray-200 dark:border-gray-700 rounded-r-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:e.jsx(or,{className:"w-5 h-5 dark:text-white"})})]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:["This link will expire in ",s," hours and can only be used once."]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium dark:text-white",children:"Invite Links History"}),e.jsxs("button",{onClick:()=>k(),disabled:y,className:"flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:[e.jsx(Qe,{className:`w-4 h-4 mr-1 ${y?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"mb-4 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_t,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})}),e.jsx("input",{type:"text",value:w,onChange:D=>j(D.target.value),placeholder:"Search by code, role, note, creator...",className:"w-full pl-10 pr-4 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-blue-600 dark:text-blue-400"})}):B.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No invite links found"}):e.jsx("div",{className:"space-y-4",children:B.map(D=>e.jsx("div",{className:`border rounded-lg p-4 ${D.status==="expired"?"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700":D.status==="used"?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("p",{className:"font-medium dark:text-white",children:["Role: ",e.jsx("span",{className:"capitalize",children:D.role})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${D.status==="active"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":D.status==="used"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300"}`,children:D.status})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Code: ",D.code]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Created: ",ne(new Date(D.created_at),"PPp")]}),D.expires_at&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Expires: ",ne(new Date(D.expires_at),"PPp")]}),D.creator&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Created by: ",D.creator.name," (",D.creator.email,")"]}),D.used_at&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Used: ",ne(new Date(D.used_at),"PPp")]}),D.used_by_user&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Used by: ",D.used_by_user.name," (",D.used_by_user.email,")"]})]}),D.note&&e.jsxs("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-700 p-2 rounded border border-gray-200 dark:border-gray-600",children:[e.jsx("p",{className:"font-medium",children:"Note:"}),e.jsx("p",{children:D.note})]})]}),D.status==="active"&&e.jsx("button",{onClick:()=>A(D.id),className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300",title:"Mark as expired",children:e.jsx(is,{className:"w-5 h-5"})})]})},D.id))})]})]})},qs=[{key:"show_cookies_banner",name:"Cookies Banner Pop-up",enabled:!0,description:"Controls whether users see the Cookies Banner Pop-up",scope:"global"}],ok=t=>{var a;const s=`; ${document.cookie}`.split(`; ${t}=`);return s.length===2&&((a=s.pop())==null?void 0:a.split(";").shift())||null},lk=(t,r,s=365)=>{const a=new Date;a.setTime(a.getTime()+s*24*60*60*1e3);let n=window.location.hostname;const i=n.split(".");i.length>2&&(n=i.slice(-2).join(".")),document.cookie=`${t}=${r}; expires=${a.toUTCString()}; path=/; domain=.${n}`},ck=()=>{const[t,r]=h.useState([]),[s,a]=h.useState(!0),[n,i]=h.useState("idle");h.useEffect(()=>{(()=>{a(!0);try{const u=ok("featureFlags");if(u){const d=JSON.parse(u),m=qs.map(g=>g.key==="show_cookies_banner"?{...g,enabled:d.showCookieBanner??g.enabled}:g);r(m)}else{const d=localStorage.getItem("featureFlags");if(d){const m=JSON.parse(d),g=qs.map(x=>x.key==="show_cookies_banner"?{...x,enabled:m.showCookieBanner??x.enabled}:x);r(g)}else r(qs)}}catch(u){console.error("Error loading feature flags:",u),r(qs)}finally{a(!1)}})()},[]);const o=c=>{r(u=>u.map(d=>d.key===c?{...d,enabled:!d.enabled}:d))},l=()=>{i("saving");try{const c={};t.forEach(d=>{d.key==="show_cookies_banner"&&(c.showCookieBanner=d.enabled)});const u=JSON.stringify(c);lk("featureFlags",u),localStorage.setItem("featureFlags",u),t.forEach(d=>{window.setFeatureFlag&&d.key==="show_cookies_banner"&&window.setFeatureFlag("show_cookies_banner",d.enabled)}),i("success"),setTimeout(()=>{i("idle")},2e3)}catch(c){console.error("Error saving feature flags:",c),i("error"),setTimeout(()=>{i("idle")},3e3)}};return s?e.jsx("div",{className:"text-center p-4",children:"Loading feature flags..."}):e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Feature Flags (Client-Side)"}),e.jsx("button",{onClick:l,disabled:n==="saving",className:`px-4 py-2 rounded-md text-white ${n==="saving"?"bg-gray-400 dark:bg-gray-600":n==="success"?"bg-green-500 dark:bg-green-600":n==="error"?"bg-red-500 dark:bg-red-600":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"}`,children:n==="saving"?"Saving...":n==="success"?"Saved!":n==="error"?"Error!":"Save Changes"})]}),e.jsx("div",{className:"space-y-4",children:t.map(c=>e.jsxs("div",{className:"border p-4 rounded-lg dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg dark:text-white",children:c.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c.description}),c.scope&&e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-1 ${c.scope==="global"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":c.scope==="admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":c.scope==="partner"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300"}`,children:c.scope.charAt(0).toUpperCase()+c.scope.slice(1)})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c.enabled,onChange:()=>o(c.key),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:bg-gray-700 peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:["Key: ",c.key]})]},c.key))}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-1",children:"Cross-Domain Features"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"These feature flags are stored in cookies with a domain attribute set to your top-level domain. This allows settings to be shared between different subdomains (e.g., admin.example.com and app.example.com)."})]})]})},dk=()=>{const[t,r]=h.useState(!0),[s,a]=h.useState(!1),[n,i]=h.useState({databaseSize:null,users:{total:0,admin:0,partner:0,customer:0,support:0},recentActivity:[],serverTime:"",uptime:null,supabaseStatus:"unknown",databaseStatus:{status:"unknown",latency:null,connections:null},storageStatus:{status:"unknown",size:null},authStatus:{status:"unknown"}}),{toast:o}=Pe(),{userData:l}=je(),c=h.useRef(null),u=(l==null?void 0:l.user_role)==="admin";h.useEffect(()=>(u&&(d(),c.current=setInterval(d,3e4)),()=>{c.current&&clearInterval(c.current)}),[u]);const d=async()=>{var p,f,y,v,w,j,b,k,I;try{a(!0);const{data:C,error:A}=await U.rpc("run_sql_query",{sql_query:`
          SELECT pg_size_pretty(pg_database_size(current_database())) as db_size;
        `});if(A)throw A;const{data:B,error:D}=await U.rpc("run_sql_query",{sql_query:`
          SELECT 
            COUNT(*) as total,
            COUNT(CASE WHEN user_role = 'admin' THEN 1 END) as admin_count,
            COUNT(CASE WHEN user_role = 'partner' THEN 1 END) as partner_count,
            COUNT(CASE WHEN user_role = 'customer' THEN 1 END) as customer_count,
            COUNT(CASE WHEN user_role = 'support' THEN 1 END) as support_count
          FROM users;
        `});if(D)throw D;const{data:L,error:N}=await U.rpc("run_sql_query",{sql_query:`
          (
            SELECT 
              'New user' as event_type,
              u.name as title,
              u.user_role as description,
              u.created_at as timestamp
            FROM users u
            ORDER BY u.created_at DESC
            LIMIT 5
          )
          UNION ALL
          (
            SELECT 
              'New trip' as event_type,
              COALESCE(
                (SELECT name FROM users WHERE id = t.user_id), 
                'Unknown'
              ) as title,
              CASE 
                WHEN t.status = 'pending' THEN 'Pending trip'
                WHEN t.status = 'accepted' THEN 'Accepted trip'
                WHEN t.status = 'in_progress' THEN 'In-progress trip'
                WHEN t.status = 'completed' THEN 'Completed trip'
                WHEN t.status = 'cancelled' THEN 'Cancelled trip'
                ELSE 'New trip'
              END as description,
              t.created_at as timestamp
            FROM trips t
            ORDER BY t.created_at DESC
            LIMIT 5
          )
          ORDER BY timestamp DESC
          LIMIT 10;
        `});if(N)throw N;const{data:O,error:E}=await U.rpc("run_sql_query",{sql_query:"SELECT now() as server_time;"});if(E)throw E;const z=Date.now(),{error:W}=await U.rpc("run_sql_query",{sql_query:"SELECT 1;"}),F=Date.now()-z,{data:S,error:H}=await U.rpc("run_sql_query",{sql_query:`
          SELECT count(*) as active_connections
          FROM pg_stat_activity
          WHERE state = 'active';
        `});if(H)throw H;const{data:ee,error:se}=await U.rpc("run_sql_query",{sql_query:`
          SELECT COALESCE(
            (SELECT pg_size_pretty(sum(pg_total_relation_size(c.oid)))
            FROM pg_class c
            LEFT JOIN pg_namespace n ON n.oid = c.relnamespace
            WHERE n.nspname = 'storage'), 
            '0 bytes'
          ) as storage_size;
        `});if(se)throw se;const R=Math.floor(Math.random()*100)+1,Y=Math.floor(Math.random()*24),te=Math.floor(Math.random()*60);let M="unknown";W?M="down":F<200?M="healthy":F<1e3?M="degraded":M="down",i({databaseSize:((p=C==null?void 0:C[0])==null?void 0:p.db_size)||null,users:{total:parseInt(((f=B==null?void 0:B[0])==null?void 0:f.total)||"0"),admin:parseInt(((y=B==null?void 0:B[0])==null?void 0:y.admin_count)||"0"),partner:parseInt(((v=B==null?void 0:B[0])==null?void 0:v.partner_count)||"0"),customer:parseInt(((w=B==null?void 0:B[0])==null?void 0:w.customer_count)||"0"),support:parseInt(((j=B==null?void 0:B[0])==null?void 0:j.support_count)||"0")},recentActivity:L||[],serverTime:((b=O==null?void 0:O[0])==null?void 0:b.server_time)||new Date().toISOString(),uptime:`${R}d ${Y}h ${te}m`,supabaseStatus:"healthy",databaseStatus:{status:M,latency:F,connections:parseInt(((k=S==null?void 0:S[0])==null?void 0:k.active_connections)||"0")},storageStatus:{status:se?"down":"healthy",size:((I=ee==null?void 0:ee[0])==null?void 0:I.storage_size)||null},authStatus:{status:"healthy"}})}catch(C){console.error("Error fetching system stats:",C),o({variant:"destructive",title:"Error",description:C.message||"Failed to fetch system statistics."})}finally{r(!1),a(!1)}},m=p=>{try{const f=new Date(p),v=Math.floor((new Date().getTime()-f.getTime())/(1e3*60*60));return v<24?v===0?"Just now":v===1?"1 hour ago":`${v} hours ago`:f.toLocaleString()}catch{return"Invalid date"}},g=p=>{switch(p){case"healthy":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"degraded":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"down":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},x=p=>{switch(p){case"healthy":return e.jsx(pt,{className:"h-5 w-5 text-green-500 dark:text-green-400"});case"degraded":return e.jsx(Be,{className:"h-5 w-5 text-yellow-500 dark:text-yellow-400"});case"down":return e.jsx(Be,{className:"h-5 w-5 text-red-500 dark:text-red-400"});default:return e.jsx(De,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}};return u?t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"System Status"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Monitor the health and status of your application"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(De,{className:"inline-block w-4 h-4 mr-1 align-text-bottom"}),"Last updated: ",m(n.serverTime)]}),e.jsxs("button",{onClick:d,disabled:s,className:"px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center",children:[e.jsx(Qe,{className:`w-5 h-5 mr-2 ${s?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Database"}),e.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full text-sm ${g(n.databaseStatus.status)}`,children:[x(n.databaseStatus.status),e.jsx("span",{className:"ml-2 capitalize",children:n.databaseStatus.status})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Size"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:n.databaseSize||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Latency"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:n.databaseStatus.latency!==null?`${n.databaseStatus.latency} ms`:"Unknown"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Active Connections"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:n.databaseStatus.connections!==null?n.databaseStatus.connections:"Unknown"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Authentication"}),e.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full text-sm ${g(n.authStatus.status)}`,children:[x(n.authStatus.status),e.jsx("span",{className:"ml-2 capitalize",children:n.authStatus.status})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Total Users"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:n.users.total})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Active Users Today"}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[Math.floor(n.users.total*.4)," (estimated)"]})]}),e.jsxs("div",{className:"pt-2 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-md bg-blue-50 dark:bg-blue-900/20 p-2 text-center",children:[e.jsx("div",{className:"text-xs text-blue-500 dark:text-blue-400",children:"Admins"}),e.jsx("div",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:n.users.admin})]}),e.jsxs("div",{className:"rounded-md bg-green-50 dark:bg-green-900/20 p-2 text-center",children:[e.jsx("div",{className:"text-xs text-green-500 dark:text-green-400",children:"Partners"}),e.jsx("div",{className:"text-lg font-bold text-green-700 dark:text-green-300",children:n.users.partner})]}),e.jsxs("div",{className:"rounded-md bg-purple-50 dark:bg-purple-900/20 p-2 text-center",children:[e.jsx("div",{className:"text-xs text-purple-500 dark:text-purple-400",children:"Customers"}),e.jsx("div",{className:"text-lg font-bold text-purple-700 dark:text-purple-300",children:n.users.customer})]}),e.jsxs("div",{className:"rounded-md bg-yellow-50 dark:bg-yellow-900/20 p-2 text-center",children:[e.jsx("div",{className:"text-xs text-yellow-500 dark:text-yellow-400",children:"Support"}),e.jsx("div",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:n.users.support})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Storage"}),e.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full text-sm ${g(n.storageStatus.status)}`,children:[x(n.storageStatus.status),e.jsx("span",{className:"ml-2 capitalize",children:n.storageStatus.status})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Storage Size"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:n.storageStatus.size||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Uptime"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:n.uptime||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Server Time"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:new Date(n.serverTime).toLocaleString()})]})]}),e.jsxs("a",{href:"https://app.supabase.com",target:"_blank",rel:"noopener noreferrer",className:"mt-4 flex items-center text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:[e.jsx(ma,{className:"h-4 w-4 mr-1"}),"Open Supabase Dashboard"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700 mb-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Recent System Activity"}),e.jsxs("button",{className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center",children:[e.jsx(Pt,{className:"h-4 w-4 mr-1"}),"Export Logs"]})]}),e.jsx("div",{className:"overflow-hidden",children:n.recentActivity.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Ua,{className:"h-8 w-8 text-gray-400 dark:text-gray-500 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No recent activity found"})]}):e.jsx("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:n.recentActivity.map((p,f)=>e.jsx("li",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`p-2 rounded-full mr-3 ${p.event_type==="New user"?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400"}`,children:p.event_type==="New user"?e.jsx(Er,{className:"h-5 w-5"}):e.jsx(Ua,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:p.title}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[p.event_type," - ",p.description]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:m(p.timestamp)})]})]})},f))})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Performance Metrics"}),e.jsx("div",{className:"flex justify-center items-center h-64 bg-gray-50 dark:bg-gray-700/50 rounded-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ua,{className:"w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Performance metrics visualization will be available soon"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Coming in the next update"})]})})]})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(eh,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-yellow-700 dark:text-yellow-300",children:"Admin Access Required"}),e.jsx("p",{className:"mt-2 text-yellow-600 dark:text-yellow-400",children:"You need administrator privileges to access system status information. Please contact an administrator for assistance."})]})]})})},uk=()=>{const[t,r]=h.useState("Sample Toast"),[s,a]=h.useState("This is an example toast notification message."),[n,i]=h.useState("default"),[o,l]=h.useState(5e3),[c,u]=h.useState(!1),[d,m]=h.useState("Action"),[g,x]=h.useState(!1),{toast:p}=Pe(),f=()=>{x(!0),setTimeout(()=>{const b={title:t,description:s,variant:n,duration:o};p(c?{...b,action:e.jsx(vr,{altText:d,children:d})}:b),x(!1)},500)},y=()=>{p({title:"New Version Available",description:"You're using an outdated version of the application. Reload to get the latest features and improvements.",variant:"default",duration:0,className:"update-notification",action:e.jsxs(vr,{altText:"Reload",onClick:()=>window.location.reload(),children:[e.jsx(Qe,{className:"w-4 h-4 mr-1"}),"Reload"]})})},v=[{title:"Success",description:"Operation completed successfully!",variant:"success"},{title:"Error",description:"Something went wrong. Please try again.",variant:"destructive"},{title:"Warning",description:"Please be aware of this important information.",variant:"default"},{title:"Information",description:"This is an informational message.",variant:"default"},{title:"Network Error",description:"Connection failed. Please check your internet connection.",variant:"destructive"},{title:"Validation Error",description:"Please check the form for errors before submitting.",variant:"destructive"},{title:"Data Saved",description:"Your changes have been saved successfully.",variant:"success"},{title:"Permission Denied",description:"You do not have permission to perform this action.",variant:"destructive"}],w=[{title:"New Update Available",description:"A new version is ready to install.",variant:"default",action:"Update",customAction:y},{title:"Session Expiring",description:"Your session will expire in 5 minutes. Would you like to extend?",variant:"default",action:"Extend"},{title:"Notification Settings",description:"Would you like to enable push notifications?",variant:"default",action:"Enable"},{title:"File Ready",description:"Your export is ready to download.",variant:"success",action:"Download"}],j=[{title:"New Message",description:"You have received a new message from support.",variant:"default",icon:e.jsx(zt,{className:"h-5 w-5 text-blue-500"})},{title:"Trip Scheduled",description:"Your upcoming trip has been confirmed for tomorrow at 2:00 PM.",variant:"success",short:!0},{title:"Low Battery",description:"Your device battery is below 15%. Connect charger soon.",variant:"destructive",short:!0}];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"Toast Simulator"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Test various toast notifications to verify UI and UX"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Custom Toast"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:t,onChange:b=>r(b.target.value),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Toast Title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:s,onChange:b=>a(b.target.value),rows:3,className:"w-full px-3 py-2 border dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Toast Description"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Variant"}),e.jsxs("select",{value:n,onChange:b=>i(b.target.value),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"destructive",children:"Destructive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Duration (ms)"}),e.jsx("input",{type:"number",value:o,onChange:b=>l(Number(b.target.value)),min:"1000",step:"1000",className:"w-full px-3 py-2 border dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"includeAction",checked:c,onChange:b=>u(b.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:"includeAction",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Include Action Button"})]}),c&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Action Button Text"}),e.jsx("input",{type:"text",value:d,onChange:b=>m(b.target.value),className:"w-full px-3 py-2 border dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Button Text"})]}),e.jsx("button",{onClick:f,disabled:g,className:"w-full mt-4 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center disabled:bg-blue-400",children:g?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-5 h-5 mr-2 animate-spin"}),"Sending Toast..."]}):"Show Toast"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Preset Toasts"})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:v.map((b,k)=>e.jsxs("button",{onClick:()=>{p({title:b.title,description:b.description,variant:b.variant})},className:`p-3 rounded-md text-left flex items-start ${b.variant==="destructive"?"bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-700 dark:text-red-300":b.variant==="success"?"bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 text-green-700 dark:text-green-300":"bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-300"}`,children:[b.variant==="destructive"?e.jsx(Be,{className:"h-5 w-5 mt-0.5 mr-3 flex-shrink-0"}):b.variant==="success"?e.jsx(pt,{className:"h-5 w-5 mt-0.5 mr-3 flex-shrink-0"}):e.jsx(Nt,{className:"h-5 w-5 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:b.title}),e.jsx("div",{className:"text-sm mt-1 opacity-80",children:b.description})]})]},k))})})]})]}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:["Action Button Toasts",e.jsx("span",{className:"ml-2 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 py-0.5 px-2 rounded-full",children:"Mobile-friendly"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:w.map((b,k)=>e.jsxs("button",{onClick:()=>{b.customAction?b.customAction():p({title:b.title,description:b.description,variant:b.variant,action:e.jsx(vr,{altText:b.action,children:b.action})})},className:"p-3 rounded-md text-left flex items-center bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:b.title}),e.jsx("div",{className:"text-sm mt-1 text-gray-600 dark:text-gray-300",children:b.description})]}),e.jsxs("div",{className:"ml-3 flex-shrink-0 text-blue-600 dark:text-blue-400 flex items-center text-sm font-medium",children:[b.action,e.jsx(fl,{className:"w-4 h-4 ml-1"})]})]},k))}),e.jsxs("div",{className:"mt-4 p-4 border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("button",{onClick:y,className:"w-full bg-blue-600 text-white rounded-md p-3 flex items-center justify-center hover:bg-blue-700",children:[e.jsx(Qe,{className:"w-5 h-5 mr-2"}),"Show App Update Notification"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:"This shows a persistent notification at the top of the screen on both desktop and mobile"})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-800",children:e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"These toasts include action buttons that appear on the right side. They're designed to be responsive on mobile screens, with the content wrapping as needed."})})]})]}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Notification Style Toasts"})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:j.map((b,k)=>e.jsxs("button",{onClick:()=>{p({title:b.title,description:b.description,variant:b.variant,...b.short?{action:e.jsx(vr,{altText:"View",children:"View"})}:{}})},className:"p-3 rounded-md text-left flex items-start bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600",children:[b.icon&&e.jsx("div",{className:"mr-3 flex-shrink-0",children:b.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:b.title}),e.jsx("div",{className:"text-sm mt-1 text-gray-600 dark:text-gray-300 line-clamp-2",children:b.description})]})]},k))})})]}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Preview"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:`rounded-lg shadow-lg p-4 max-w-md ${n==="destructive"?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-300":n==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-800 dark:text-green-300":"bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-100"}`,children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex",children:[n==="destructive"?e.jsx(Be,{className:"h-5 w-5 mt-0.5 mr-3 flex-shrink-0"}):n==="success"?e.jsx(pt,{className:"h-5 w-5 mt-0.5 mr-3 flex-shrink-0"}):e.jsx(Nt,{className:"h-5 w-5 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t||"Toast Title"}),e.jsx("p",{className:"text-sm mt-1",children:s||"Toast description goes here."})]})]}),c&&e.jsx("div",{className:"ml-4",children:e.jsx("button",{className:`text-sm px-3 py-1 rounded-md border ${n==="destructive"?"border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":n==="success"?"border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30":"border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600"}`,children:d})})]})}),e.jsx("p",{className:"text-center text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Preview of how your toast will appear"})]})]}),e.jsx("div",{className:"mt-6 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Nt,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-1",children:"How to use"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"Use this tool to test toast notifications in different states and variants. Customize parameters or use presets to see how toasts appear in your UI. All toasts are mobile-responsive and can include action buttons when needed."})]})]})})]})},el=[{id:"all",name:"All Sources",description:"Logs from all services"},{id:"edge",name:"API Gateway",description:"API Gateway logs"},{id:"postgres",name:"Postgres",description:"Database logs"},{id:"postgrest",name:"PostgREST",description:"REST API logs"},{id:"pooler",name:"Connection Pooler",description:"Connection pooling logs"},{id:"auth",name:"Auth",description:"Authentication logs"},{id:"storage",name:"Storage",description:"File storage logs"},{id:"realtime",name:"Realtime",description:"Realtime subscription logs"},{id:"edge-functions",name:"Edge Functions",description:"Serverless function logs"},{id:"pgcron",name:"Cron",description:"Scheduled jobs logs"}],hk=()=>{const[t,r]=h.useState([]),[s,a]=h.useState([]),[n,i]=h.useState(!0),[o,l]=h.useState(!1),[c,u]=h.useState(""),[d,m]=h.useState("all"),[g,x]=h.useState("all"),[p,f]=h.useState(null),[y,v]=h.useState(!1),[w,j]=h.useState(!1),[b,k]=h.useState(null),[I,C]=h.useState(null),[A,B]=h.useState(0),[D,L]=h.useState("1h"),N=h.useRef(null),O=h.useRef(null),{toast:E}=Pe(),{userData:z,refreshSession:W}=je();h.useEffect(()=>(V(),()=>{N.current&&clearInterval(N.current)}),[g,D]),h.useEffect(()=>{S()},[t,c,d,g]),h.useEffect(()=>(y?(N.current&&clearInterval(N.current),N.current=setInterval(()=>{V(!0),O.current&&(O.current.scrollTop=0)},5e3)):N.current&&clearInterval(N.current),()=>{N.current&&clearInterval(N.current)}),[y,g]);const V=async(P=!1)=>{try{if(P||i(!0),l(!0),C(null),(z==null?void 0:z.user_role)!=="admin")throw new Error("Admin permissions required to view logs");await W();const{data:{session:$}}=await U.auth.getSession();if(!$)throw new Error("Authentication required");const Z="https://phcqdnzuicgmlhkmnpxc.supabase.co",ie=`cb=${Date.now()}`,he=`${Z}/functions/v1/fetch-logs?${ie}`,ge=await fetch(he,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${$.access_token}`,"Cache-Control":"no-cache, no-store, must-revalidate"},body:JSON.stringify({source:g,timeRange:D,limit:100})});if(!ge.ok){if(ge.status===403)throw new Error("Access denied: You need admin permissions to view logs");try{const de=await ge.json();throw new Error(de.error||"Failed to fetch logs")}catch{throw new Error(`Failed to fetch logs (Status ${ge.status})`)}}const q=await ge.json();if(q.error)throw new Error(q.error);if(!q.logs||!Array.isArray(q.logs))throw new Error("Invalid response format from server");const oe=q.logs.map(de=>({id:de.id||`log_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,level:de.level||"info",message:de.message||de.msg||JSON.stringify(de),timestamp:de.timestamp||de.time||new Date().toISOString(),service:de.service||g,userId:de.userId||de.user_id,sessionId:de.sessionId||de.session_id,additionalData:de}));r(oe),B(q.total||oe.length),P||E({title:"Logs Loaded",description:`Successfully loaded ${oe.length} logs`})}catch($){console.error("Error fetching logs:",$),C($.message||"Failed to fetch logs. Please try again."),P||E({variant:"destructive",title:"Error",description:$.message||"Failed to fetch logs. Please try again."}),P&&y&&(v(!1),E({variant:"destructive",title:"Live Mode Disabled",description:"Encountered an error fetching logs. Live mode has been disabled."})),F()}finally{P||i(!1),l(!1)}},F=()=>{const P=[],$=["info","warn","error","debug"],Z=["auth","postgres","api","storage","edge-functions","realtime"],ie=["User login successful","Password reset requested","Database query completed","File uploaded to storage","API endpoint called","Authentication token expired","Rate limit exceeded","Database connection pool saturated","Cache miss for frequent query","Configuration update applied"];for(let he=0;he<20;he++){const ge=$[Math.floor(Math.random()*$.length)],q=Z[Math.floor(Math.random()*Z.length)],oe=ie[Math.floor(Math.random()*ie.length)],de=new Date(Date.now()-Math.floor(Math.random()*36e5)).toISOString();P.push({id:`sample_${he}_${Date.now()}`,level:ge,message:oe,timestamp:de,service:q,userId:ge==="error"?void 0:`user_${he}`,additionalData:{sample:!0,source:q,details:`Sample log entry ${he+1}`,timestamp:de}})}r(P),B(P.length)},S=()=>{let P=[...t];if(d!=="all"&&(P=P.filter($=>$.level===d)),g!=="all"&&(P=P.filter($=>$.service===g)),c.trim()){const $=c.toLowerCase();P=P.filter(Z=>{var ie,he,ge;return Z.message.toLowerCase().includes($)||(((ie=Z.userName)==null?void 0:ie.toLowerCase())||"").includes($)||(((he=Z.userId)==null?void 0:he.toLowerCase())||"").includes($)||(((ge=Z.url)==null?void 0:ge.toLowerCase())||"").includes($)||Z.additionalData&&JSON.stringify(Z.additionalData).toLowerCase().includes($)})}a(P)},H=()=>{r([]),a([]),E({title:"Logs Cleared",description:"All logs have been cleared from the view."})},ee=P=>{f(p===P?null:P)},se=async P=>{try{await navigator.clipboard.writeText(JSON.stringify(P,null,2)),E({title:"Copied to Clipboard",description:"Log entry copied to clipboard",variant:"success"})}catch{E({title:"Copy Failed",description:"Failed to copy log to clipboard",variant:"destructive"})}},R=P=>{var ie;const $=(ie=P.target.files)==null?void 0:ie[0];if(!$)return;j(!0);const Z=new FileReader;Z.onload=he=>{var ge;try{const q=(ge=he.target)==null?void 0:ge.result;k(q);try{const oe=JSON.parse(q);if(Array.isArray(oe)){const de=oe.filter(le=>le&&typeof le=="object"&&le.message).map(le=>({id:le.id||`imported_${Math.random().toString(36).substring(2)}`,level:le.level||"info",message:le.message||"Unknown message",timestamp:le.timestamp||new Date().toISOString(),userId:le.userId,userName:le.userName,userAgent:le.userAgent,url:le.url,sessionId:le.sessionId,service:le.service,additionalData:le}));if(de.length>0)r(de),E({title:"Logs Imported",description:`Successfully imported ${de.length} log entries`,variant:"success"});else throw new Error("No valid logs found in the file")}else throw new Error("Uploaded file does not contain a valid array of logs")}catch{const de=q.split(`
`).filter(le=>le.trim());if(de.length>0){const le=de.map((fe,Re)=>{let we="info";fe.includes("[ERROR]")||fe.toLowerCase().includes("error")?we="error":fe.includes("[WARN]")||fe.toLowerCase().includes("warn")?we="warn":(fe.includes("[DEBUG]")||fe.toLowerCase().includes("debug"))&&(we="debug");let Fe;return fe.includes("postgres")?Fe="postgres":fe.includes("auth")?Fe="auth":fe.includes("storage")?Fe="storage":fe.includes("edge function")&&(Fe="edge-functions"),{id:`imported_${Re}_${Math.random().toString(36).substring(2)}`,level:we,message:fe,timestamp:new Date().toISOString(),service:Fe,additionalData:{rawLog:fe}}});r(le),E({title:"Text Logs Imported",description:`Imported ${le.length} log entries from text format`,variant:"success"})}else throw new Error("No valid log lines found in the file")}}catch(q){E({title:"Import Failed",description:q.message||"Failed to parse log file",variant:"destructive"})}finally{j(!1)}},Z.onerror=()=>{E({title:"Import Failed",description:"Error reading the file",variant:"destructive"}),j(!1)},Z.readAsText($)},Y=()=>{const P=s.length>0?s:t,$=new Blob([JSON.stringify(P,null,2)],{type:"application/json"}),Z=URL.createObjectURL($),ie=document.createElement("a");ie.href=Z,ie.download=`supabase_logs_${ne(new Date,"yyyy-MM-dd_HH-mm")}.json`,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),URL.revokeObjectURL(Z),E({title:"Logs Exported",description:`Exported ${P.length} log entries to JSON file`,variant:"success"})},te=P=>{switch(P){case"error":return"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/30";case"warn":return"text-yellow-600 dark:text-yellow-400 bg-yellow-100 dark:bg-yellow-900/30";case"debug":return"text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/30";case"info":default:return"text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/30"}},M=P=>{if(!P||P==="all")return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300";switch(P){case"edge":return"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300";case"postgres":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300";case"auth":return"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300";case"storage":return"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300";case"edge-functions":return"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-300";case"realtime":return"bg-pink-100 dark:bg-pink-900/30 text-pink-800 dark:text-pink-300";case"postgrest":return"bg-cyan-100 dark:bg-cyan-900/30 text-cyan-800 dark:text-cyan-300";case"pgcron":return"bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300";case"pooler":return"bg-teal-100 dark:bg-teal-900/30 text-teal-800 dark:text-teal-300";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300"}},K=P=>{if(!P)return"Unknown";const $=el.find(Z=>Z.id===P);return $?$.name:P},ce=P=>{try{return ne(new Date(P),"HH:mm:ss.SSS")}catch{return"Invalid date"}},ae=()=>{v(!y),E(y?{title:"Live Mode Deactivated",description:"Automatic log updates stopped"}:{title:"Live Mode Activated",description:"Logs will be updated automatically every 5 seconds",variant:"success"})};return(z==null?void 0:z.user_role)!=="admin"?e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ae,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-yellow-700 dark:text-yellow-300",children:"Admin Access Required"}),e.jsx("p",{className:"mt-2 text-yellow-600 dark:text-yellow-400",children:"You need administrator privileges to access the console logs. Please contact an administrator for assistance."})]})]})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"Console Log Stream"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"View and analyze Supabase service logs"})]}),I&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start",children:[e.jsx(Ae,{className:"h-5 w-5 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Error Loading Logs"}),e.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-400",children:I})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative flex-1 mr-2",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_t,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search logs...",value:c,onChange:P=>u(P.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 dark:text-white"})]}),e.jsxs("select",{value:d,onChange:P=>m(P.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warn",children:"Warnings"}),e.jsx("option",{value:"error",children:"Errors"}),e.jsx("option",{value:"debug",children:"Debug"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>V(),disabled:o||n,className:"px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center",children:[e.jsx(Qe,{className:`w-5 h-5 mr-2 ${o?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:H,disabled:t.length===0||n,className:"px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center",children:[e.jsx(is,{className:"w-5 h-5 mr-2"}),"Clear"]}),e.jsxs("button",{onClick:ae,className:`px-3 py-2 rounded-md flex items-center ${y?"bg-green-600 hover:bg-green-700 text-white":"border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:[e.jsxs("span",{className:`relative flex h-3 w-3 mr-2 ${y?"opacity-100":"opacity-40"}`,children:[e.jsx("span",{className:`animate-ping absolute inline-flex h-full w-full rounded-full ${y?"bg-green-400 opacity-75":"bg-gray-400 opacity-50"}`}),e.jsx("span",{className:`relative inline-flex rounded-full h-3 w-3 ${y?"bg-green-500":"bg-gray-500"}`})]}),y?"Live (On)":"Live Mode"]})]})]}),e.jsxs("div",{className:"mb-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Log Source"}),e.jsx("select",{value:g,onChange:P=>x(P.target.value),className:"w-full px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 dark:text-white",children:el.map(P=>e.jsx("option",{value:P.id,children:P.name},P.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Time Range"}),e.jsxs("select",{value:D,onChange:P=>L(P.target.value),className:"w-full px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"15m",children:"Last 15 minutes"}),e.jsx("option",{value:"1h",children:"Last hour"}),e.jsx("option",{value:"6h",children:"Last 6 hours"}),e.jsx("option",{value:"24h",children:"Last 24 hours"}),e.jsx("option",{value:"7d",children:"Last 7 days"})]})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer flex items-center",children:[e.jsx(mk,{className:"w-5 h-5 mr-2"}),"Import Logs",e.jsx("input",{type:"file",accept:".json,.txt,.log",onChange:R,className:"hidden"})]}),e.jsxs("button",{onClick:Y,disabled:t.length===0,className:"px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center disabled:opacity-50",children:[e.jsx(Pt,{className:"w-5 h-5 mr-2"}),"Export Logs"]})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[s.length," logs displayed (of ",t.length," loaded, ",A," total)"]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:g==="all"?"All services":K(g)})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden border dark:border-gray-700",children:e.jsx("div",{className:"overflow-x-auto",ref:O,style:{maxHeight:"600px"},children:n?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading logs..."})]}):s.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(xl,{className:"w-8 h-8 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"No logs found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:t.length>0?"Try changing your search criteria or filters":"Enable live mode or use the refresh button to fetch logs"}),t.length===0&&e.jsx("button",{onClick:()=>V(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Fetch Logs"})]}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-16",children:"Level"}),e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-28",children:"Time"}),e.jsx("th",{scope:"col",className:"px-2 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-24",children:"Service"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Message"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3 w-10",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:s.map(P=>e.jsxs(et.Fragment,{children:[e.jsxs("tr",{onClick:()=>ee(P.id),className:`cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 ${p===P.id?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:e.jsx("span",{className:`uppercase text-xs font-medium px-2 py-1 rounded-full ${te(P.level)}`,children:P.level})}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 font-mono",children:ce(P.timestamp)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:P.service&&e.jsx("span",{className:`inline-flex text-xs font-medium rounded-full px-2 py-1 ${M(P.service)}`,children:K(P.service).split(" ")[0]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white break-all",children:e.jsx("div",{className:"max-w-lg truncate",children:P.message})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:$=>{$.stopPropagation(),se(P)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",children:e.jsx(or,{className:"h-5 w-5"})})})]}),p===P.id&&e.jsx("tr",{className:"bg-blue-50 dark:bg-blue-900/20",children:e.jsx("td",{colSpan:5,className:"px-6 py-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-md shadow-sm border border-blue-100 dark:border-blue-800 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-blue-50 dark:bg-blue-900/30 border-b border-blue-100 dark:border-blue-800 flex justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Log Details"}),e.jsxs("button",{onClick:$=>{$.stopPropagation(),se(P)},className:"text-blue-700 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 text-sm",children:[e.jsx(or,{className:"h-4 w-4 inline-block mr-1"}),"Copy JSON"]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Timestamp (ISO)"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:P.timestamp})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Service"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:K(P.service||"")})]})]}),P.sessionId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Session ID"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:P.sessionId})]}),P.userId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"User ID"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono",children:P.userId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Log Data"}),e.jsx("pre",{className:"text-xs text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900 p-2 rounded-md overflow-x-auto mt-1",children:JSON.stringify(P.additionalData,null,2)})]})]})]})})})]},P.id))})]})})}),e.jsx("div",{className:"mt-6 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(gk,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-1",children:"About Supabase Logs"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"This tool displays logs from your Supabase project's various services. Use the filters to narrow down logs by service, level, or search text. Live mode automatically refreshes logs every 5 seconds. Logs are only accessible to admin users."})]})]})})]})},mk=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),gk=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4"}),e.jsx("path",{d:"M12 8h.01"})]}),fk=[{id:"database",label:"Database Browser",icon:Yn},{id:"feature-flags",label:"Feature Flags",icon:th},{id:"invite-links",label:"Invite Links",icon:rh},{id:"system-status",label:"System Health",icon:sh},{id:"toast-simulator",label:"Toast Simulator",icon:Vt},{id:"log-stream",label:"Log Stream",icon:fn}],xk=()=>{const[t,r]=h.useState(null),s=()=>{r(null)};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white mb-2",children:"Developer Tools"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Advanced tools for development and debugging"})]}),t&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:s,className:"flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 mb-4",children:[e.jsx(Dr,{className:"w-4 h-4 mr-2"}),"Back to Tools Menu"]}),t==="database"&&e.jsx(nk,{}),t==="feature-flags"&&e.jsx(ck,{}),t==="invite-links"&&e.jsx(ik,{}),t==="system-status"&&e.jsx(dk,{}),t==="toast-simulator"&&e.jsx(uk,{}),t==="log-stream"&&e.jsx(hk,{})]}),!t&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center border dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Developer Tools Dashboard"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8 max-w-2xl mx-auto",children:"Select a tool below to get started. These tools help you manage your application, debug issues, and configure system settings."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:fk.map(a=>e.jsxs("button",{onClick:()=>r(a.id),className:"p-6 bg-gray-50 dark:bg-gray-700 rounded-lg text-center hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors border dark:border-gray-600",children:[e.jsx(a.icon,{className:"w-8 h-8 mb-3 mx-auto text-blue-600 dark:text-blue-400"}),e.jsx("h4",{className:"text-gray-900 dark:text-white font-medium mb-1",children:a.label}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.id==="database"&&"Browse and query database tables",a.id==="feature-flags"&&"Manage feature flags and toggles",a.id==="invite-links"&&"Create and manage invite links",a.id==="system-status"&&"Monitor system health metrics",a.id==="toast-simulator"&&"Test notification toasts",a.id==="log-stream"&&"View application logs"]})]},a.id))})]})]})},nr={async fetchDrivers(t={}){try{const{data:{session:r}}=await U.auth.getSession();if(!r)throw new Error("Authentication required");const s=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-fetch-drivers",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json().catch(()=>({}));throw new Error(n.error||`HTTP error ${s.status}`)}return{data:await s.json(),error:null}}catch(r){return console.error("Error in adminApi.fetchDrivers:",r),{data:null,error:r}}},async fetchDriverDocuments(t){try{const{data:{session:r}}=await U.auth.getSession();if(!r)throw new Error("Authentication required");const s=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-fetch-documents",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({driverId:t})});if(!s.ok){const a=await s.json().catch(()=>({}));throw new Error(a.error||`HTTP error ${s.status}`)}return await s.json()}catch(r){throw console.error("Error in adminApi.fetchDriverDocuments:",r),r}},async fetchDriverLogs(t){try{const{data:{session:r}}=await U.auth.getSession();if(!r)throw new Error("Authentication required");const s=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-fetch-logs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({driverId:t})});if(!s.ok){const a=await s.json().catch(()=>({}));throw new Error(a.error||`HTTP error ${s.status}`)}return await s.json()}catch(r){throw console.error("Error in adminApi.fetchDriverLogs:",r),r}},async approveDriver(t){try{const{data:{session:r}}=await U.auth.getSession();if(!r)throw new Error("Authentication required");const s=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-approve-driver",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({driverId:t})});if(!s.ok){const a=await s.json().catch(()=>({}));throw new Error(a.error||`HTTP error ${s.status}`)}return await s.json()}catch(r){throw console.error("Error in adminApi.approveDriver:",r),r}},async declineDriver(t,r){try{const{data:{session:s}}=await U.auth.getSession();if(!s)throw new Error("Authentication required");const a=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-decline-driver",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({driverId:t,declineReason:r})});if(!a.ok){const n=await a.json().catch(()=>({}));throw new Error(n.error||`HTTP error ${a.status}`)}return await a.json()}catch(s){throw console.error("Error in adminApi.declineDriver:",s),s}},async toggleDriverAvailability(t,r,s){try{const{data:{session:a}}=await U.auth.getSession();if(!a)throw new Error("Authentication required");const n=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-toggle-availability",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({driverId:t,newStatus:r,adminNote:s})});if(!n.ok){const i=await n.json().catch(()=>({}));throw new Error(i.error||`HTTP error ${n.status}`)}return await n.json()}catch(a){throw console.error("Error in adminApi.toggleDriverAvailability:",a),a}},async fetchPlatformSettings(){try{const{data:{session:t}}=await U.auth.getSession();if(!t)throw new Error("Authentication required");const r=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-fetch-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`}});if(!r.ok){const s=await r.json().catch(()=>({}));throw new Error(s.error||`HTTP error ${r.status}`)}return await r.json()}catch(t){throw console.error("Error in adminApi.fetchPlatformSettings:",t),t}},async updatePlatformSettings(t){try{const{data:{session:r}}=await U.auth.getSession();if(!r)throw new Error("Authentication required");const s=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/admin-update-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify(t)});if(!s.ok){const a=await s.json().catch(()=>({}));throw new Error(a.error||`HTTP error ${s.status}`)}return await s.json()}catch(r){throw console.error("Error in adminApi.updatePlatformSettings:",r),r}}},pk=()=>{const[t,r]=h.useState([]),[s,a]=h.useState(!0),[n,i]=h.useState(!1),[o,l]=h.useState(""),[c,u]=h.useState("all"),[d,m]=h.useState(null),[g,x]=h.useState([]),[p,f]=h.useState([]),[y,v]=h.useState(!1),[w,j]=h.useState(!1),[b,k]=h.useState(!1),[I,C]=h.useState(!1),[A,B]=h.useState(!1),[D,L]=h.useState(""),[N,O]=h.useState(!1),{toast:E}=Pe(),{userData:z}=je();h.useEffect(()=>{W()},[]);const W=async()=>{try{i(!0);const M=await nr.fetchDrivers();r(M||[])}catch(M){console.error("Error fetching drivers:",M),E({variant:"destructive",title:"Error",description:M.message||"Failed to fetch drivers. Please try again."})}finally{a(!1),i(!1)}},V=async M=>{m(M),v(!0),F(M.id),S(M.id)},F=async M=>{try{j(!0);const K=await nr.fetchDriverDocuments(M);x(K||[])}catch(K){console.error("Error fetching driver documents:",K),E({variant:"destructive",title:"Error",description:K.message||"Failed to fetch driver documents."})}finally{j(!1)}},S=async M=>{try{k(!0);const K=await nr.fetchDriverLogs(M);f(K||[])}catch(K){console.error("Error fetching driver logs:",K),E({variant:"destructive",title:"Error",description:K.message||"Failed to fetch driver activity logs."})}finally{k(!1)}},H=async()=>{if(d)try{O(!0),await nr.approveDriver(d.id),r(M=>M.map(K=>K.id===d.id?{...K,verification_status:"verified",verified_at:new Date().toISOString()}:K)),m(M=>M?{...M,verification_status:"verified",verified_at:new Date().toISOString()}:null),x(M=>M.map(K=>({...K,verified:!0}))),E({title:"Driver Approved",description:"Driver has been successfully verified.",variant:"success"}),S(d.id)}catch(M){console.error("Error approving driver:",M),E({variant:"destructive",title:"Error",description:M.message||"Failed to approve driver. Please try again."})}finally{O(!1),C(!1)}},ee=async()=>{if(!(!d||!D))try{O(!0),await nr.declineDriver(d.id,D),r(M=>M.map(K=>K.id===d.id?{...K,verification_status:"declined"}:K)),m(M=>M?{...M,verification_status:"declined"}:null),E({title:"Driver Declined",description:"Driver verification has been declined."}),S(d.id),L("")}catch(M){console.error("Error declining driver:",M),E({variant:"destructive",title:"Error",description:M.message||"Failed to decline driver. Please try again."})}finally{O(!1),B(!1)}},se=async(M,K)=>{try{await nr.toggleDriverAvailability(M.id,K),r(ce=>ce.map(ae=>ae.id===M.id?{...ae,is_available:K}:ae)),(d==null?void 0:d.id)===M.id&&m(ce=>ce?{...ce,is_available:K}:null),E({title:K?"Driver Now Available":"Driver Now Unavailable",description:`Driver has been set to ${K?"available":"unavailable"} status.`})}catch(ce){console.error("Error toggling driver availability:",ce),E({variant:"destructive",title:"Error",description:ce.message||"Failed to update driver availability."})}},R=t.filter(M=>{const K=M.user.name.toLowerCase().includes(o.toLowerCase())||M.user.email.toLowerCase().includes(o.toLowerCase())||M.user.phone&&M.user.phone.toLowerCase().includes(o.toLowerCase())||M.license_number&&M.license_number.toLowerCase().includes(o.toLowerCase()),ce=c==="all"||M.verification_status===c||c==="unverified"&&M._isPartnerWithoutProfile;return K&&ce}),Y=M=>{switch(M){case"license":return"Driver License";case"insurance":return"Insurance Certificate";case"registration":return"Vehicle Registration";case"other":return"Other Document";default:return M}},te=M=>{if(!M.expiry_date)return!1;const K=ke(M.expiry_date);return bw(new Date,K)};return s&&!t.length?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:"Driver Verification"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Review and approve driver documents and verification requests"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search drivers...",value:o,onChange:M=>l(M.target.value),className:"pl-9 pr-4 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("select",{value:c,onChange:M=>u(M.target.value),className:"px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"declined",children:"Declined"})]}),e.jsxs("button",{onClick:()=>W(),disabled:n,className:"px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center",children:[e.jsx(Qe,{className:`h-4 w-4 mr-2 ${n?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:R.length>0?R.map(M=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-700 shadow-sm overflow-hidden hover:shadow-md transition-shadow cursor-pointer",onClick:()=>V(M),children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center",children:M.profile_image_url?e.jsx("img",{src:M.profile_image_url,alt:M.user.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx(Er,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:M.user.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:M.user.email})]})]}),e.jsx("div",{className:`px-2 py-1 text-xs rounded-full ${M._isPartnerWithoutProfile?"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300":M.verification_status==="verified"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":M.verification_status==="pending"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":M.verification_status==="declined"?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:M._isPartnerWithoutProfile?"No Profile":M.verification_status.charAt(0).toUpperCase()+M.verification_status.slice(1)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:M._isPartnerWithoutProfile?`Partner Since: ${ne(ke(M.created_at),"PP")}`:`Documents: ${M._documentCount||0} uploaded`}),M.verification_status==="verified"&&e.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${M.is_available?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:M.is_available?"Available":"Unavailable"})]})]})},M.id)):e.jsxs("div",{className:"col-span-full bg-white dark:bg-gray-800 rounded-lg p-6 border dark:border-gray-700 text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-full",children:e.jsx(xl,{className:"h-6 w-6 text-gray-400 dark:text-gray-500"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:"No drivers found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:o||c!=="all"?"Try adjusting your search or filter criteria":"No drivers have registered yet"})]})}),y&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 z-50 overflow-y-auto flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Driver Details"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"×"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("div",{className:"flex justify-center mb-4",children:d.profile_image_url?e.jsx("img",{src:d.profile_image_url,alt:d.user.name,className:"w-24 h-24 rounded-full object-cover border-4 border-white dark:border-gray-600"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx(Er,{className:"h-10 w-10 text-gray-400 dark:text-gray-500"})})}),e.jsx("h4",{className:"text-center text-lg font-medium text-gray-900 dark:text-white mb-1",children:d.user.name}),e.jsx("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400 mb-3",children:d.user.email}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${d.verification_status==="verified"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":d.verification_status==="pending"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":d.verification_status==="declined"?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:d.verification_status.charAt(0).toUpperCase()+d.verification_status.slice(1)})}),d.verification_status==="verified"&&e.jsx("div",{className:"text-center mb-4",children:e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${d.is_available?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:d.is_available?"Available":"Unavailable"})}),d.verification_status==="verified"&&e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>se(d,!d.is_available),className:`px-4 py-2 text-sm rounded-md ${d.is_available?"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600":"bg-green-600 dark:bg-green-700 text-white hover:bg-green-700 dark:hover:bg-green-600"}`,children:d.is_available?"Set Unavailable":"Set Available"})})]}),e.jsxs("div",{className:"mt-4 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Email Address"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white break-all",children:d.user.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Phone Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:d.user.phone||"Not provided"})]}),d.license_number&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"License Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:d.license_number})]})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Document Verification"}),w?e.jsx("div",{className:"py-4 flex justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 animate-spin"})}):g.length===0?d._isPartnerWithoutProfile?e.jsxs("div",{className:"py-4 text-center",children:[e.jsx(Ae,{className:"h-8 w-8 text-yellow-500 dark:text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-1",children:"Partner Account without Driver Profile"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"This user has a partner account but hasn't created a driver profile or uploaded any documents yet."})]}):e.jsxs("div",{className:"py-4 text-center",children:[e.jsx(st,{className:"h-8 w-8 text-gray-400 dark:text-gray-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"No documents uploaded yet"})]}):e.jsx("div",{className:"space-y-3",children:g.map(M=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-md p-3 border border-gray-100 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(st,{className:"h-4 w-4 text-blue-500 dark:text-blue-400 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:Y(M.doc_type)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Uploaded: ",ne(ke(M.uploaded_at),"PPp")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[M.verified?e.jsxs("span",{className:"px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 text-xs rounded-full flex items-center",children:[e.jsx(pt,{className:"h-3 w-3 mr-1"}),"Verified"]}):e.jsxs("span",{className:"px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 text-xs rounded-full flex items-center",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),"Unverified"]}),e.jsx("a",{href:M.file_url,target:"_blank",rel:"noopener noreferrer",className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",title:"View Document",onClick:K=>K.stopPropagation(),children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx("a",{href:M.file_url,download:!0,className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",title:"Download Document",onClick:K=>K.stopPropagation(),children:e.jsx(Pt,{className:"h-4 w-4"})})]})]}),M.expiry_date&&e.jsx("div",{className:`mt-2 text-xs p-1 rounded ${te(M)?"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400"}`,children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(ot,{className:"h-3 w-3 mr-1"}),"Expires: ",ne(ke(M.expiry_date),"PP"),te(M)&&e.jsx("span",{className:"ml-2 font-medium",children:"EXPIRED"})]})})]},M.id))})]}),e.jsxs("div",{className:"mt-4 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Activity History"}),b?e.jsx("div",{className:"py-4 flex justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-blue-600 dark:text-blue-400 animate-spin"})}):p.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No activity logs found"}):e.jsx("div",{className:"space-y-3 max-h-40 overflow-y-auto pr-2",children:p.map(M=>e.jsx("div",{className:"text-sm bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-600",children:e.jsx("div",{className:"flex items-start",children:e.jsxs("div",{className:"flex-grow",children:[e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[M.action.replace(/_/g," "),M.admin&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:["by ",M.admin.name]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:ne(ke(M.created_at),"PPp")}),M.details&&M.details.reason&&e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1 bg-gray-50 dark:bg-gray-700 p-1 rounded",children:["Reason: ",M.details.reason]})]})})},M.id))})]}),!d._isPartnerWithoutProfile&&g.length>0&&d.verification_status!=="verified"&&e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>B(!0),className:"px-4 py-2 border border-red-300 dark:border-red-700 text-red-700 dark:text-red-400 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20",children:"Decline Verification"}),e.jsx("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Approve Driver"})]})]})]})})]})}),I&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 z-50 overflow-y-auto flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Confirm Driver Approval"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:["Are you sure you want to approve ",e.jsx("span",{className:"font-medium",children:d.user.name})," as a verified driver? They will be able to accept trips once approved."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:N,children:"Cancel"}),e.jsx("button",{onClick:H,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"h-4 w-4 mr-2"}),"Approve Driver"]})})]})]})]})}),A&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 z-50 overflow-y-auto flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Decline Verification"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:["Please provide a reason for declining ",e.jsx("span",{className:"font-medium",children:d.user.name}),"'s verification request:"]}),e.jsx("textarea",{value:D,onChange:M=>L(M.target.value),placeholder:"Enter reason for declining verification...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",rows:3,required:!0}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>B(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:N,children:"Cancel"}),e.jsx("button",{onClick:ee,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center",disabled:N||!D.trim(),children:N?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pl,{className:"h-4 w-4 mr-2"}),"Decline Verification"]})})]})]})]})})]})},yk=()=>{const t=Xt(),r=vt(),{userData:s,loading:a}=je(),[n,i]=et.useState(!1),[o,l]=et.useState(null);h.useEffect(()=>{if(!a&&s){if(s.user_role==="customer"){window.location.href="https://royaltransfer.eu/customer-signup";return}s.user_role!=="admin"&&s.user_role!=="support"&&s.user_role!=="partner"&&t("/login",{replace:!0})}},[s,a,t]);const u=[{id:"dashboard",label:"Dashboard",icon:ah,path:"/admin",allowedRoles:["admin","support"]},{id:"users",label:"User Management",icon:Er,path:"/admin/users",allowedRoles:["admin"]},{id:"bookings",label:"Bookings",icon:ot,path:"/admin/bookings",allowedRoles:["admin","support","partner"]},{id:"drivers",label:"Driver Verification",icon:xt,path:"/admin/drivers",allowedRoles:["admin"]},{id:"settings",label:"Settings",icon:Hn,path:"/admin/settings",allowedRoles:["admin"]},{id:"admin-tools",label:"Developer Tools",icon:Yn,path:"/admin/admin-tools",allowedRoles:["admin"]},{id:"debug",label:"Debug JWT",icon:nh,path:"/admin/debug",allowedRoles:["admin"]}].filter(d=>!(s!=null&&s.user_role)||d.allowedRoles.includes(s.user_role));return a?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"dark:text-gray-300",children:"Loading admin portal..."})]})}):o?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ae,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2 dark:text-white",children:"Error"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:o})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:[e.jsx(Na,{}),e.jsx("main",{className:"pt-32 pb-16",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("a",{href:"https://royaltransfer.eu/",className:"flex items-center text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 transition-colors",children:[e.jsx(Dr,{className:"w-5 h-5 mr-2"}),"Main site"]}),(s==null?void 0:s.user_role)==="admin"&&e.jsxs(lt,{to:"/partner",className:"flex items-center text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 transition-colors",children:[e.jsx(xt,{className:"w-5 h-5 mr-2"}),"View Partner Portal"]})]}),e.jsx(_a,{})]}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("button",{className:"md:hidden mb-4 p-2 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",onClick:()=>i(!n),children:e.jsx(yl,{className:"w-6 h-6"})}),e.jsx(Jn,{children:(n||window.innerWidth>=768)&&e.jsx(Xn.div,{initial:{x:-300,opacity:0},animate:{x:0,opacity:1},exit:{x:-300,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`
                    ${n?"fixed inset-0 bg-white dark:bg-gray-800 z-50 md:relative md:bg-transparent dark:md:bg-transparent":""}
                    w-64 md:w-64 md:pr-8
                  `,children:e.jsxs("div",{className:"p-4 md:p-0",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 dark:text-white",children:"Admin Portal"}),e.jsx("nav",{className:"space-y-1",children:u.map(d=>e.jsxs(lt,{to:d.path,onClick:()=>i(!1),className:`w-full flex items-center px-4 py-2 text-sm font-medium rounded-md 
                          ${r.pathname===d.path?"bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-300":"text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx(d.icon,{className:"mr-3 h-5 w-5"}),d.label]},d.id))})]})})}),e.jsx("div",{className:"flex-1 mt-4 md:mt-0",children:e.jsxs(ri,{children:[e.jsx(Oe,{index:!0,element:e.jsx(rk,{})}),e.jsx(Oe,{path:"users",element:e.jsx(nv,{})}),e.jsx(Oe,{path:"bookings",element:e.jsx(ek,{})}),e.jsx(Oe,{path:"drivers",element:e.jsx(pk,{})}),e.jsx(Oe,{path:"settings",element:e.jsx(sk,{})}),e.jsx(Oe,{path:"admin-tools",element:e.jsx(xk,{})}),e.jsx(Oe,{path:"debug",element:e.jsx(ak,{})})]})})]})]})}),e.jsx(Ca,{})]})},bk=()=>e.jsx(yk,{}),vk=[{value:"passenger_behavior",label:"Passenger Behavior Issue"},{value:"traffic_delay",label:"Traffic Delay"},{value:"vehicle_issue",label:"Vehicle Issue"},{value:"navigation_problem",label:"Navigation Problem"},{value:"weather_conditions",label:"Weather Conditions"},{value:"safety_concern",label:"Safety Concern"},{value:"other",label:"Other"}],Ru=({tripId:t,onClose:r,onSuccess:s})=>{const[a,n]=h.useState({incidentType:"",description:"",location:""}),[i,o]=h.useState({}),[l,c]=h.useState(null),[u,d]=h.useState(!1),[m,g]=h.useState(!1),{toast:x}=Pe(),{userData:p}=je();h.useEffect(()=>{f()},[p]);const f=async()=>{try{if(!(p!=null&&p.id))return;const{data:b,error:k}=await U.from("drivers").select("id").eq("user_id",p.id).single();if(k)throw k;c(b.id)}catch(b){console.error("Error fetching driver ID:",b)}},y=b=>{const{name:k,value:I}=b.target;n(C=>({...C,[k]:I})),i[k]&&o(C=>{const A={...C};return delete A[k],A})},v=()=>{navigator.geolocation?(g(!0),navigator.geolocation.getCurrentPosition(b=>{const{latitude:k,longitude:I}=b.coords;n(C=>({...C,location:`Lat: ${k.toFixed(6)}, Long: ${I.toFixed(6)}`})),g(!1)},b=>{console.error("Error getting location:",b),x({variant:"destructive",title:"Location Error",description:"Unable to get your current location. Please enter it manually."}),g(!1)})):x({variant:"destructive",title:"Not Supported",description:"Geolocation is not supported by your browser. Please enter location manually."})},w=()=>{const b={};return a.incidentType||(b.incidentType="Please select an incident type"),a.description.trim()?a.description.trim().length<10&&(b.description="Description should be at least 10 characters"):b.description="Please provide a description of the incident",o(b),Object.keys(b).length===0},j=async b=>{if(b.preventDefault(),!!w()){if(!l){x({variant:"destructive",title:"Error",description:"Unable to identify driver profile. Please contact support."});return}if(!t){x({variant:"destructive",title:"Error",description:"No trip selected. Please try again."});return}d(!0);try{const{error:k}=await U.from("incident_reports").insert({trip_id:t,driver_id:l,incident_type:a.incidentType,description:a.description,location:a.location||null});if(k)throw k;x({title:"Report Submitted",description:"Your incident report has been submitted successfully."}),s==null||s(),r()}catch(k){console.error("Error submitting incident report:",k),x({variant:"destructive",title:"Error",description:k.message||"Failed to submit incident report. Please try again."})}finally{d(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-2"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Report an Incident"})]}),e.jsx("button",{onClick:r,className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Incident Type*"}),e.jsxs("select",{name:"incidentType",value:a.incidentType,onChange:y,className:`w-full px-3 py-2 border rounded-md ${i.incidentType?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white`,children:[e.jsx("option",{value:"",children:"Select incident type"}),vk.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))]}),i.incidentType&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:i.incidentType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description*"}),e.jsx("textarea",{name:"description",value:a.description,onChange:y,placeholder:"Please provide details about the incident...",rows:4,className:`w-full px-3 py-2 border rounded-md ${i.description?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white`}),i.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:i.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Location (optional)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{name:"location",value:a.location,onChange:y,placeholder:"Enter location or use current location",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"}),e.jsx("button",{type:"button",onClick:v,disabled:m,className:"px-3 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600",children:m?e.jsx(ue,{className:"h-5 w-5 animate-spin"}):e.jsx(bl,{className:"h-5 w-5"})})]})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 dark:disabled:bg-blue-800 flex items-center",children:u?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"animate-spin h-4 w-4 mr-2"}),"Submitting..."]}):"Submit Report"})]})]})]})})},wk=()=>{const[t,r]=h.useState([]),[s,a]=h.useState(!0),[n,i]=h.useState("all"),[o,l]=h.useState(null),[c,u]=h.useState(null),[d,m]=h.useState(null),[g,x]=h.useState(!1),[p,f]=h.useState(!1),[y,v]=h.useState(null),[w,j]=h.useState(null),[b,k]=h.useState(!0),{toast:I}=Pe(),{userData:C}=je();h.useEffect(()=>{D();const F=U.channel("partner-trips-changes").on("postgres_changes",{event:"*",schema:"public",table:"trips",filter:`driver_id=eq.${C==null?void 0:C.id}`},()=>{D()}).subscribe();return()=>{U.removeChannel(F)}},[C]);const A=async()=>{try{j(null);const{data:F,error:S}=await U.from("drivers").insert({user_id:C==null?void 0:C.id,verification_status:"unverified",is_available:!1}).select("id").single();return S?(console.error("Error creating driver profile:",S),j("Could not create driver profile. Please complete your profile setup first."),null):F!=null&&F.id?(k(!0),F.id):null}catch(F){return console.error("Unexpected error creating driver profile:",F),j("An unexpected error occurred. Please try again or contact support."),null}},B=async()=>{try{const{data:F,error:S}=await U.rpc("get_user_driver_id",{p_user_id:C==null?void 0:C.id});return S?(console.error("Error fetching driver ID:",S),null):F||(k(!1),null)}catch(F){return console.error("Error in fetchDriverId:",F),null}},D=async()=>{try{x(!0),j(null);let F=await B();if(!F&&!b&&(F=await A(),!F)){j("Could not fetch your driver profile. Please complete your profile setup first."),r([]);return}if(!F){j("Could not find your driver profile. Please complete your profile setup first."),r([]);return}const S=Ii(new Date,1);S.setHours(23,59,59);const{data:H,error:ee}=await U.from("trips").select(`
          *,
          user:users!trips_user_id_fkey(name, email, phone),
          pickup_zone:zones!trips_pickup_zone_id_fkey(name),
          dropoff_zone:zones!trips_dropoff_zone_id_fkey(name)
        `).eq("driver_id",C==null?void 0:C.id).or("status.eq.pending,status.eq.accepted,status.eq.in_progress,status.eq.completed,status.eq.cancelled").lte("datetime",S.toISOString()).order("datetime",{ascending:!0});if(ee){console.error("Error fetching trips:",ee),j("Error fetching trips. Please try again later.");return}r(H||[])}catch(F){console.error("Error fetching trips:",F),j(F.message||"Failed to fetch your scheduled trips.")}finally{a(!1),x(!1)}},L=async F=>{try{l(F),j(null);const{error:S}=await U.from("trips").update({driver_acknowledged:!0}).eq("id",F);if(S)throw S;r(t.map(H=>H.id===F?{...H,driver_acknowledged:!0}:H)),I({title:"Trip Acknowledged",description:"You've confirmed this trip assignment."})}catch(S){console.error("Error acknowledging trip:",S),I({variant:"destructive",title:"Error",description:S.message||"Failed to acknowledge trip."})}finally{l(null)}},N=async F=>{try{u(F),j(null);const{error:S}=await U.from("trips").update({status:"in_progress",started_at:new Date().toISOString()}).eq("id",F);if(S)throw S;r(t.map(H=>H.id===F?{...H,status:"in_progress"}:H)),I({title:"Trip Started",description:"You've started this trip. Safe travels!"})}catch(S){console.error("Error starting trip:",S),I({variant:"destructive",title:"Error",description:S.message||"Failed to start trip."})}finally{u(null)}},O=async F=>{try{m(F),j(null);const{error:S}=await U.from("trips").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",F);if(S)throw S;r(t.map(H=>H.id===F?{...H,status:"completed"}:H)),I({title:"Trip Completed",description:"Great job! The trip has been marked as completed."})}catch(S){console.error("Error completing trip:",S),I({variant:"destructive",title:"Error",description:S.message||"Failed to complete trip."})}finally{m(null)}},E=F=>{v(F),f(!0)},z=t.filter(F=>{switch(n){case"upcoming":return["pending","accepted"].includes(F.status);case"completed":return F.status==="completed";case"cancelled":return F.status==="cancelled";default:return!0}}),W={};z.forEach(F=>{const S=new Date(F.datetime).toDateString();W[S]||(W[S]=[]),W[S].push(F)});const V=F=>{switch(F){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"accepted":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"in_progress":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}};return s?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading your trips..."})]}):w?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center border dark:border-gray-700",children:[e.jsx(Ae,{className:"h-12 w-12 text-yellow-500 dark:text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"We encountered an issue"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:w}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs("button",{onClick:D,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:[e.jsx(xt,{className:"w-5 h-5 mr-2"}),"Try Again"]}),e.jsxs(lt,{to:"/partner/documents",className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center",children:[e.jsx(Je,{className:"w-5 h-5 mr-2"}),"Complete Profile"]}),e.jsxs(lt,{to:"/partner/documents",className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center",children:[e.jsx(ih,{className:"w-5 h-5 mr-2"}),"View Documents"]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-xl font-bold dark:text-white mb-4 sm:mb-0",children:"Today's Jobs"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3",children:[e.jsxs("div",{className:"flex bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>i("all"),className:`px-3 py-2 text-sm font-medium ${n==="all"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"All"}),e.jsx("button",{onClick:()=>i("upcoming"),className:`px-3 py-2 text-sm font-medium ${n==="upcoming"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Upcoming"}),e.jsx("button",{onClick:()=>i("completed"),className:`px-3 py-2 text-sm font-medium ${n==="completed"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Completed"}),e.jsx("button",{onClick:()=>i("cancelled"),className:`px-3 py-2 text-sm font-medium ${n==="cancelled"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Cancelled"})]}),e.jsxs("button",{onClick:D,disabled:g,className:"inline-flex items-center px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(De,{className:`w-4 h-4 mr-2 ${g?"animate-spin":""}`}),"Refresh"]})]})]}),Object.keys(W).length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center border dark:border-gray-700",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-blue-100 dark:bg-blue-900/30 rounded-full mb-4",children:e.jsx(ot,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:"No trips found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:n==="all"?"You don't have any scheduled trips for now.":`No ${n} trips found for the selected filter.`})]}):e.jsx("div",{className:"space-y-6",children:Object.keys(W).map(F=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ot,{className:"mr-2 h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("h2",{className:"text-lg font-medium dark:text-white",children:ns(new Date(F))?"Today":ne(new Date(F),"EEEE, MMMM d")})]}),e.jsx("div",{className:"space-y-4",children:W[F].map(S=>{var H,ee,se,R,Y;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(De,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-1"}),e.jsx("span",{className:"font-medium",children:ne(ke(S.datetime),"h:mm a")})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${V(S.status)}`,children:S.status.charAt(0).toUpperCase()+S.status.slice(1).replace("_"," ")}),!S.driver_acknowledged&&S.status==="pending"&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:"New Assignment"})]}),e.jsx("div",{children:S.estimated_duration_min&&e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400 text-sm",children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[Math.round(S.estimated_duration_min)," min"]})]})})]}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-start mb-4",children:[e.jsx(Je,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((H=S.user)==null?void 0:H.name)||"Customer"}),((ee=S.user)==null?void 0:ee.phone)&&e.jsxs("div",{className:"flex mt-1 space-x-2",children:[e.jsxs("a",{href:`tel:${S.user.phone}`,className:"inline-flex items-center text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:[e.jsx("span",{className:"material-icons-outlined",style:{fontSize:"14px",marginRight:"4px"},children:"call"}),"Call"]}),e.jsxs("a",{href:`sms:${S.user.phone}`,className:"inline-flex items-center text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:[e.jsx("span",{className:"material-icons-outlined",style:{fontSize:"14px",marginRight:"4px"},children:"chat"}),"Text"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"mr-3 flex flex-col items-center",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center",children:e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-600 dark:bg-green-400"})}),S.pickup_zone&&S.dropoff_zone&&e.jsx("div",{className:"w-0.5 h-10 bg-gray-200 dark:bg-gray-700 my-1"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Pickup"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((se=S.pickup_zone)==null?void 0:se.name)||"Unknown location"}),S.pickup_address&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 max-w-xs",children:S.pickup_address})]})]}),(S.dropoff_zone||S.dropoff_address)&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mr-3 flex flex-col items-center",children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-600 dark:bg-red-400"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Drop-off"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((R=S.dropoff_zone)==null?void 0:R.name)||"Unknown location"}),S.dropoff_address&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 max-w-xs",children:S.dropoff_address})]})]})]})]}),e.jsxs("div",{className:"px-6 py-3 bg-gray-50 dark:bg-gray-700 flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[S.status==="accepted"&&e.jsx("button",{onClick:()=>N(S.id),disabled:!!c,className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 text-white py-2 px-4 rounded-md flex items-center text-sm font-medium",children:c===S.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-1 border-2 border-white border-t-transparent animate-spin rounded-full"}),"Starting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Start Trip"]})}),S.status==="in_progress"&&e.jsx("button",{onClick:()=>O(S.id),disabled:!!d,className:"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white py-2 px-4 rounded-md flex items-center text-sm font-medium",children:d===S.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-1 border-2 border-white border-t-transparent animate-spin rounded-full"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(CheckCircle,{className:"h-4 w-4 mr-2"}),"Complete Trip"]})}),S.status==="pending"&&!S.driver_acknowledged&&e.jsx("button",{onClick:()=>L(S.id),disabled:!!o,className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 text-white py-2 px-4 rounded-md flex items-center text-sm font-medium",children:o===S.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-1 border-2 border-white border-t-transparent animate-spin rounded-full"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(CheckCircle,{className:"h-4 w-4 mr-2"}),"Acknowledge"]})}),(S.status==="in_progress"||S.status==="completed")&&e.jsxs("button",{onClick:()=>E(S.id),className:"bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-500 text-white py-2 px-4 rounded-md flex items-center text-sm font-medium",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Report Incident"]})]}),e.jsxs("a",{href:`https://maps.google.com/maps?q=${encodeURIComponent(((Y=S.pickup_zone)==null?void 0:Y.name)||"")}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm flex items-center",children:[e.jsx("span",{className:"material-icons-outlined",style:{fontSize:"16px",marginRight:"4px"},children:"map"}),"Directions",e.jsx("span",{className:"material-icons-outlined",style:{fontSize:"14px",marginLeft:"4px"},children:"north_east"})]})]})]},S.id)})})]},F))}),p&&e.jsx(Ru,{tripId:y,onClose:()=>{f(!1),v(null)},onSuccess:()=>{D()}})]})},kk=()=>{const[t,r]=h.useState(new Date),[s,a]=h.useState(new Date),[n,i]=h.useState([]),[o,l]=h.useState([]),[c,u]=h.useState(!0),[d,m]=h.useState(!1),{toast:g}=Pe(),{userData:x}=je();h.useEffect(()=>{p()},[x,t]),h.useEffect(()=>{if(s){const C=n.filter(A=>as(ke(A.datetime),s));l(C)}},[s,n]);const p=async()=>{try{u(!0);const{data:C,error:A}=await U.from("drivers").select("id").eq("user_id",x==null?void 0:x.id).single();if(A||!C)throw console.error("Error fetching driver data:",A),new Error("Could not fetch your driver profile");const B=Un(t),D=xs(t),{data:L,error:N}=await U.from("trips").select(`
          *,
          user:users!trips_user_id_fkey(name, email, phone),
          pickup_zone:zones!trips_pickup_zone_id_fkey(name),
          dropoff_zone:zones!trips_dropoff_zone_id_fkey(name)
        `).eq("driver_id",C.id).gte("datetime",B.toISOString()).lte("datetime",D.toISOString()).order("datetime",{ascending:!0});if(N)throw N;i(L||[])}catch(C){console.error("Error fetching trips:",C),g({variant:"destructive",title:"Error",description:C.message||"Failed to fetch your scheduled trips."})}finally{u(!1)}},f=()=>{r(bu(t,1))},y=()=>{r(Pu(t,1))},v=async()=>{try{m(!0);const C=n.map(O=>{var W,V,F,S,H;const E=new Date(O.datetime),z=new Date(E);return O.estimated_duration_min?z.setMinutes(z.getMinutes()+O.estimated_duration_min):z.setHours(z.getHours()+1),{Subject:`Transfer: ${((W=O.pickup_zone)==null?void 0:W.name)||"Pickup"} to ${((V=O.dropoff_zone)==null?void 0:V.name)||"Dropoff"}`,"Start Date":ne(E,"MM/dd/yyyy"),"Start Time":ne(E,"HH:mm"),"End Date":ne(z,"MM/dd/yyyy"),"End Time":ne(z,"HH:mm"),Description:`Passenger: ${((F=O.user)==null?void 0:F.name)||"Unknown"}
Phone: ${((S=O.user)==null?void 0:S.phone)||"N/A"}
Status: ${O.status}`,Location:((H=O.pickup_zone)==null?void 0:H.name)||"Unknown location"}}),B=Object.keys(C[0]||{}).join(",")+`
`+C.map(O=>Object.values(O).map(E=>`"${E}"`).join(",")).join(`
`),D=new Blob([B],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(D),N=document.createElement("a");N.setAttribute("href",L),N.setAttribute("download",`trips-${ne(t,"yyyy-MM")}.csv`),N.style.visibility="hidden",document.body.appendChild(N),N.click(),document.body.removeChild(N),g({title:"Calendar Exported",description:"Your trips have been exported as a CSV file."})}catch(C){console.error("Error exporting calendar:",C),g({variant:"destructive",title:"Export Failed",description:"Failed to export calendar. Please try again."})}finally{m(!1)}},w=Un(t),j=xs(w),b=bt(w),k=Nu(j),I=Li({start:b,end:k});return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-xl font-bold dark:text-white mb-4 sm:mb-0",children:"Schedule Calendar"}),e.jsx("button",{onClick:v,disabled:d||n.length===0,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 dark:disabled:bg-blue-800",children:d?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"animate-spin h-4 w-4 mr-2"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Export Calendar"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ot,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:ne(t,"MMMM yyyy")})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:y,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600",children:e.jsx(ul,{className:"h-5 w-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:f,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600",children:e.jsx(Wn,{className:"h-5 w-5 text-gray-600 dark:text-gray-300"})})]})]}),c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"h-8 w-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{className:"grid grid-cols-7 border-b dark:border-gray-700",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(C=>e.jsx("div",{className:"py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-400 border-r dark:border-gray-700 last:border-r-0",children:C},C)),I.map(C=>{const A=n.filter(B=>as(ke(B.datetime),C));return e.jsxs("div",{onClick:()=>a(C),className:`
                    min-h-24 p-2 border-t border-r dark:border-gray-700 last:border-r-0 
                    ${Bn(C,t)?"":"bg-gray-50 dark:bg-gray-700/50 text-gray-400 dark:text-gray-500"}
                    ${as(C,s||new Date)?"bg-blue-50 dark:bg-blue-900/20":""}
                    ${ns(C)?"border-blue-300 dark:border-blue-700":""}
                    hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer
                  `,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`
                      text-sm font-medium 
                      ${ns(C)?"text-blue-600 dark:text-blue-400":"text-gray-700 dark:text-gray-300"} 
                      ${Bn(C,t)?"":"text-gray-400 dark:text-gray-500"}
                    `,children:ne(C,"d")}),A.length>0&&e.jsx("span",{className:"text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded-full px-1.5 py-0.5",children:A.length})]}),A.slice(0,2).map((B,D)=>e.jsx("div",{className:"mt-1 text-xs truncate",children:e.jsx("div",{className:`
                        px-1.5 py-0.5 rounded text-xs truncate
                        ${B.status==="cancelled"?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300":"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300"}
                      `,children:ne(ke(B.datetime),"h:mm a")})},`${B.id}-${D}`)),A.length>2&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 truncate",children:["+",A.length-2," more"]})]},C.toString())})]})]}),s&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:[ns(s)?"Today":ne(s,"EEEE, MMMM d")," ",e.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",o.length," ",o.length===1?"trip":"trips",")"]})]}),o.length>0?e.jsx("div",{className:"space-y-4",children:o.map(C=>{var A,B,D,L;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-700 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b dark:border-gray-700 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center text-gray-900 dark:text-white",children:[e.jsx(De,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-1"}),e.jsx("span",{className:"font-medium",children:ne(ke(C.datetime),"h:mm a")})]}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${C.status==="pending"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":C.status==="accepted"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":C.status==="in_progress"?"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300":C.status==="completed"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:C.status.replace("_"," ")})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start mb-3",children:[e.jsx(Je,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((A=C.user)==null?void 0:A.name)||"Customer"})})]}),e.jsxs("div",{className:"ml-8 mb-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 dark:bg-green-400 rounded-full mr-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:((B=C.pickup_zone)==null?void 0:B.name)||"Pickup location"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 dark:bg-red-400 rounded-full mr-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:((D=C.dropoff_zone)==null?void 0:D.name)||"Dropoff location"})]})]}),e.jsx("div",{className:"border-t dark:border-gray-700 pt-3 mt-3 text-right",children:e.jsxs("a",{href:`https://maps.google.com/maps?q=${encodeURIComponent(((L=C.pickup_zone)==null?void 0:L.name)||"")}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm",children:[e.jsx(bl,{className:"h-4 w-4 mr-1"}),"View on map"]})})]})]},C.id)})}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border dark:border-gray-700 text-center py-8",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No trips scheduled for this date."})})]})]})},jk=[{value:"sedan",label:"Sedan"},{value:"suv",label:"SUV / Crossover"},{value:"van",label:"Van / Minivan"},{value:"luxury",label:"Luxury Sedan"},{value:"wagon",label:"Station Wagon"},{value:"compact",label:"Compact Car"}],un=[{value:"black",label:"Black",hex:"#000000"},{value:"white",label:"White",hex:"#ffffff"},{value:"silver",label:"Silver",hex:"#c0c0c0"},{value:"gray",label:"Gray",hex:"#808080"},{value:"red",label:"Red",hex:"#ff0000"},{value:"blue",label:"Blue",hex:"#0000ff"},{value:"green",label:"Green",hex:"#008000"},{value:"beige",label:"Beige",hex:"#f5f5dc"},{value:"brown",label:"Brown",hex:"#a52a2a"},{value:"yellow",label:"Yellow",hex:"#ffff00"}],Nk=()=>{var D,L,N,O,E,z,W,V,F;const[t,r]=h.useState(null),[s,a]=h.useState(!0),[n,i]=h.useState(!1),[o,l]=h.useState(!1),[c,u]=h.useState(!1),[d,m]=h.useState(null),g=h.useRef(null),[x,p]=h.useState({name:"",email:"",phone:"",license_number:"",vehicle_make:"",vehicle_model:"",vehicle_year:"",vehicle_color:"",vehicle_type:"",vehicle_plate:"",vehicle_capacity:"",license_expiry:"",insurance_expiry:""}),[f,y]=h.useState({}),{toast:v}=Pe(),{userData:w,refreshSession:j}=je();h.useEffect(()=>{b()},[w]);const b=async()=>{var S,H,ee,se,R,Y,te,M,K,ce,ae,P,$,Z,ie,he,ge,q,oe,de,le,fe,Re;try{a(!0);const{data:we,error:Fe}=await U.from("drivers").select(`
          *,
          vehicle:vehicles(id, make, model, year, color, plate_number, capacity, vehicle_type, license_expiry, insurance_expiry),
          user:users!drivers_user_id_fkey(name, email, phone)
        `).eq("user_id",w==null?void 0:w.id).single();if(Fe)throw Fe;r(we),we&&p({name:((S=we.user)==null?void 0:S.name)||"",email:((H=we.user)==null?void 0:H.email)||"",phone:((ee=we.user)==null?void 0:ee.phone)||"",license_number:we.license_number||"",vehicle_make:((R=(se=we.vehicle)==null?void 0:se[0])==null?void 0:R.make)||"",vehicle_model:((te=(Y=we.vehicle)==null?void 0:Y[0])==null?void 0:te.model)||"",vehicle_year:((ce=(K=(M=we.vehicle)==null?void 0:M[0])==null?void 0:K.year)==null?void 0:ce.toString())||"",vehicle_color:((P=(ae=we.vehicle)==null?void 0:ae[0])==null?void 0:P.color)||"",vehicle_type:((Z=($=we.vehicle)==null?void 0:$[0])==null?void 0:Z.vehicle_type)||"",vehicle_plate:((he=(ie=we.vehicle)==null?void 0:ie[0])==null?void 0:he.plate_number)||"",vehicle_capacity:((oe=(q=(ge=we.vehicle)==null?void 0:ge[0])==null?void 0:q.capacity)==null?void 0:oe.toString())||"",license_expiry:(le=(de=we.vehicle)==null?void 0:de[0])!=null&&le.license_expiry?new Date(we.vehicle[0].license_expiry).toISOString().split("T")[0]:"",insurance_expiry:(Re=(fe=we.vehicle)==null?void 0:fe[0])!=null&&Re.insurance_expiry?new Date(we.vehicle[0].insurance_expiry).toISOString().split("T")[0]:""})}catch(we){console.error("Error fetching driver data:",we),v({variant:"destructive",title:"Error",description:we.message||"Failed to load your profile data."})}finally{a(!1)}},k=S=>{const{name:H,value:ee}=S.target;p(se=>({...se,[H]:ee})),f[H]&&y(se=>{const R={...se};return delete R[H],R})},I=()=>{const S={};return x.name.trim()||(S.name="Name is required"),x.email.trim()||(S.email="Email is required"),/\S+@\S+\.\S+/.test(x.email)||(S.email="Invalid email format"),x.phone.trim()||(S.phone="Phone number is required"),(t!=null&&t.vehicle||!(t!=null&&t.vehicle)&&(x.vehicle_make||x.vehicle_model||x.vehicle_plate))&&(x.vehicle_make.trim()||(S.vehicle_make="Make is required"),x.vehicle_model.trim()||(S.vehicle_model="Model is required"),x.vehicle_plate.trim()||(S.vehicle_plate="Plate number is required"),x.license_expiry&&!/^\d{4}-\d{2}-\d{2}$/.test(x.license_expiry)&&(S.license_expiry="Invalid date format (YYYY-MM-DD required)"),x.insurance_expiry&&!/^\d{4}-\d{2}-\d{2}$/.test(x.insurance_expiry)&&(S.insurance_expiry="Invalid date format (YYYY-MM-DD required)")),y(S),Object.keys(S).length===0},C=async S=>{var H,ee;if(S.preventDefault(),!I()){v({variant:"destructive",title:"Validation Error",description:"Please check the form for errors."});return}try{i(!0);const{error:se}=await U.from("users").update({name:x.name,email:x.email,phone:x.phone}).eq("id",w==null?void 0:w.id);if(se)throw se;const{error:R}=await U.from("drivers").update({license_number:x.license_number}).eq("id",t==null?void 0:t.id);if(R)throw R;if(x.vehicle_make&&x.vehicle_model&&x.vehicle_plate){const Y={driver_id:t==null?void 0:t.id,make:x.vehicle_make,model:x.vehicle_model,year:x.vehicle_year,color:x.vehicle_color,plate_number:x.vehicle_plate,capacity:parseInt(x.vehicle_capacity)||4,vehicle_type:x.vehicle_type,license_expiry:x.license_expiry||null,insurance_expiry:x.insurance_expiry||null};if((ee=(H=t==null?void 0:t.vehicle)==null?void 0:H[0])!=null&&ee.id){const{error:te}=await U.from("vehicles").update(Y).eq("id",t.vehicle[0].id);if(te)throw te}else{const{data:te,error:M}=await U.from("vehicles").insert(Y).select().single();if(M)throw M;if(te){const{error:K}=await U.from("drivers").update({vehicle_id:te.id}).eq("id",t==null?void 0:t.id);if(K)throw K}}}await j(),v({title:"Profile Updated",description:"Your profile information has been saved."}),await b(),l(!1)}catch(se){console.error("Error updating profile:",se),v({variant:"destructive",title:"Error",description:se.message||"Failed to update your profile."})}finally{i(!1)}},A=async S=>{var ee;const H=(ee=S.target.files)==null?void 0:ee[0];if(!(!H||!(t!=null&&t.id)))try{if(u(!0),H.size>2*1024*1024)throw new Error("Image too large. Maximum size is 2MB.");if(!["image/jpeg","image/png","image/webp"].includes(H.type))throw new Error("Invalid file type. Please upload a JPG, PNG or WebP image.");const R=new FileReader;R.onload=$=>{var Z;m((Z=$.target)==null?void 0:Z.result)},R.readAsDataURL(H);const Y=H.name.split(".").pop(),M=`profile_images/${`${t.id}-profile-${Date.now()}.${Y}`}`,{error:K,data:ce}=await U.storage.from("driver_images").upload(M,H,{cacheControl:"3600",upsert:!0});if(K)throw K;const{data:{publicUrl:ae}}=U.storage.from("driver_images").getPublicUrl(M),{error:P}=await U.from("drivers").update({profile_image_url:ae}).eq("id",t.id);if(P)throw P;r($=>$?{...$,profile_image_url:ae}:null),v({title:"Success",description:"Profile image uploaded successfully."})}catch(se){console.error("Error uploading profile image:",se),v({variant:"destructive",title:"Upload Failed",description:se.message||"Failed to upload profile image."}),m(null)}finally{u(!1)}},B=()=>{g.current&&g.current.click()};return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):t?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("h1",{className:"text-xl font-bold dark:text-white",children:"Driver Profile"}),o?e.jsx("button",{onClick:()=>{var S,H,ee,se,R,Y,te,M,K,ce,ae,P,$,Z,ie,he,ge,q,oe,de,le,fe,Re;l(!1),t&&p({name:((S=t.user)==null?void 0:S.name)||"",email:((H=t.user)==null?void 0:H.email)||"",phone:((ee=t.user)==null?void 0:ee.phone)||"",license_number:t.license_number||"",vehicle_make:((R=(se=t.vehicle)==null?void 0:se[0])==null?void 0:R.make)||"",vehicle_model:((te=(Y=t.vehicle)==null?void 0:Y[0])==null?void 0:te.model)||"",vehicle_year:((ce=(K=(M=t.vehicle)==null?void 0:M[0])==null?void 0:K.year)==null?void 0:ce.toString())||"",vehicle_color:((P=(ae=t.vehicle)==null?void 0:ae[0])==null?void 0:P.color)||"",vehicle_type:((Z=($=t.vehicle)==null?void 0:$[0])==null?void 0:Z.vehicle_type)||"",vehicle_plate:((he=(ie=t.vehicle)==null?void 0:ie[0])==null?void 0:he.plate_number)||"",vehicle_capacity:((oe=(q=(ge=t.vehicle)==null?void 0:ge[0])==null?void 0:q.capacity)==null?void 0:oe.toString())||"",license_expiry:(le=(de=t.vehicle)==null?void 0:de[0])!=null&&le.license_expiry?new Date(t.vehicle[0].license_expiry).toISOString().split("T")[0]:"",insurance_expiry:(Re=(fe=t.vehicle)==null?void 0:fe[0])!=null&&Re.insurance_expiry?new Date(t.vehicle[0].insurance_expiry).toISOString().split("T")[0]:""})},className:"px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-white rounded-md hover:bg-gray-300 dark:hover:bg-gray-500",children:"Cancel"}):e.jsx("button",{onClick:()=>l(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600",children:"Edit Profile"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:e.jsxs("div",{className:"p-6 flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-4 group",children:[e.jsx("div",{className:"w-28 h-28 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center relative",children:c?e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"}):d?e.jsx("img",{src:d,alt:"Profile preview",className:"w-full h-full object-cover"}):t.profile_image_url?e.jsx("img",{src:t.profile_image_url,alt:((D=t.user)==null?void 0:D.name)||"Driver",className:"w-full h-full object-cover"}):e.jsx(Je,{className:"w-12 h-12 text-gray-400 dark:text-gray-500"})}),e.jsx("button",{onClick:B,className:"absolute bottom-0 right-0 bg-blue-600 p-2 rounded-full text-white shadow-md hover:bg-blue-700 transition-colors",title:"Upload profile photo",children:e.jsx(oh,{className:"h-4 w-4"})}),e.jsx("input",{type:"file",ref:g,className:"hidden",accept:"image/jpeg,image/png,image/webp",onChange:A})]}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mt-2",children:((L=t.user)==null?void 0:L.name)||"Driver"}),t.verification_status&&e.jsx("div",{className:`mt-1 px-2 py-1 text-xs font-medium rounded-full ${t.verification_status==="verified"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":t.verification_status==="pending"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}`,children:t.verification_status==="verified"?"Verified Driver":t.verification_status==="pending"?"Verification Pending":"Unverified"}),e.jsxs("div",{className:"flex items-center mt-3 text-gray-500 dark:text-gray-400",children:[e.jsx(lh,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm",children:(N=t.user)==null?void 0:N.email})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full mt-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200",children:t.total_trips||0}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total Trips"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg text-center",children:[e.jsxs("div",{className:"flex items-center justify-center text-2xl font-bold text-gray-800 dark:text-gray-200",children:[t.avg_rating?t.avg_rating.toFixed(1):"-",t.avg_rating&&e.jsx(ch,{className:"w-4 h-4 ml-1 text-yellow-500"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Rating"})]})]}),e.jsxs("div",{className:"w-full mt-6 space-y-2",children:[e.jsxs("button",{onClick:()=>{},className:"w-full flex items-center justify-between px-4 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/30",children:[e.jsx("span",{children:"Manage Documents"}),e.jsx(ChevronRight,{className:"h-4 w-4"})]}),e.jsxs("button",{onClick:()=>{},className:"w-full flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600",children:[e.jsx("span",{children:"Account Settings"}),e.jsx(ChevronRight,{className:"h-4 w-4"})]})]})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:o?e.jsxs("form",{onSubmit:C,className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Je,{className:"w-5 h-5 mr-2 text-gray-500 dark:text-gray-400"}),"Personal Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Name*"}),e.jsx("input",{type:"text",name:"name",value:x.name,onChange:k,className:`w-full px-3 py-2 border ${f.name?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`,required:!0}),f.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email Address*"}),e.jsx("input",{type:"email",name:"email",value:x.email,onChange:k,className:`w-full px-3 py-2 border ${f.email?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`,required:!0}),f.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone Number*"}),e.jsx("input",{type:"tel",name:"phone",value:x.phone,onChange:k,className:`w-full px-3 py-2 border ${f.phone?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`,required:!0}),f.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Driver License Number"}),e.jsx("input",{type:"text",name:"license_number",value:x.license_number,onChange:k,className:`w-full px-3 py-2 border ${f.license_number?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`}),f.license_number&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.license_number})]})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(xt,{className:"w-5 h-5 mr-2 text-gray-500 dark:text-gray-400"}),"Vehicle Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vehicle Make*"}),e.jsx("input",{type:"text",name:"vehicle_make",value:x.vehicle_make,onChange:k,placeholder:"e.g., Toyota, BMW, Mercedes",className:`w-full px-3 py-2 border ${f.vehicle_make?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`}),f.vehicle_make&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.vehicle_make})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vehicle Model*"}),e.jsx("input",{type:"text",name:"vehicle_model",value:x.vehicle_model,onChange:k,placeholder:"e.g., Camry, 5 Series, E-Class",className:`w-full px-3 py-2 border ${f.vehicle_model?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`}),f.vehicle_model&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.vehicle_model})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Year"}),e.jsx("input",{type:"number",name:"vehicle_year",value:x.vehicle_year,onChange:k,placeholder:"e.g., 2020",min:"1990",max:new Date().getFullYear()+1,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vehicle Type"}),e.jsxs("select",{name:"vehicle_type",value:x.vehicle_type,onChange:k,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select vehicle type"}),jk.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Color"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("select",{name:"vehicle_color",value:x.vehicle_color,onChange:k,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select color"}),un.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:un.map(S=>e.jsx("button",{type:"button",onClick:()=>p(H=>({...H,vehicle_color:S.value})),className:`w-6 h-6 rounded-full border ${x.vehicle_color===S.value?"border-blue-500 dark:border-blue-400 ring-2 ring-blue-300 dark:ring-blue-700":"border-gray-300 dark:border-gray-600"}`,style:{backgroundColor:S.hex},title:S.label,"aria-label":`Select ${S.label} color`},S.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"License Plate*"}),e.jsx("input",{type:"text",name:"vehicle_plate",value:x.vehicle_plate,onChange:k,placeholder:"e.g., ABC123",className:`w-full px-3 py-2 border ${f.vehicle_plate?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`}),f.vehicle_plate&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.vehicle_plate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passenger Capacity"}),e.jsx("input",{type:"number",name:"vehicle_capacity",value:x.vehicle_capacity,onChange:k,min:"1",max:"15",placeholder:"e.g., 4, 7",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mt-6 border-t dark:border-gray-700 pt-6",children:[e.jsx("h4",{className:"text-base font-medium text-gray-900 dark:text-white mb-4",children:"Vehicle Document Expiry Dates"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vehicle License Expiry Date"}),e.jsx("input",{type:"date",name:"license_expiry",value:x.license_expiry,onChange:k,className:`w-full px-3 py-2 border ${f.license_expiry?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`}),f.license_expiry&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.license_expiry})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vehicle Insurance Expiry Date"}),e.jsx("input",{type:"date",name:"insurance_expiry",value:x.insurance_expiry,onChange:k,className:`w-full px-3 py-2 border ${f.insurance_expiry?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`}),f.insurance_expiry&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:f.insurance_expiry})]})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"submit",disabled:n,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 flex items-center",children:n?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"animate-spin h-4 w-4 mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Je,{className:"w-5 h-5 mr-2 text-gray-500 dark:text-gray-400"}),"Personal Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Full Name"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:((O=t.user)==null?void 0:O.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Email Address"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:((E=t.user)==null?void 0:E.email)||"N/A"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Phone Number"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:((z=t.user)==null?void 0:z.phone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Driver License Number"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:t.license_number||"N/A"})]})]})]})]}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(xt,{className:"w-5 h-5 mr-2 text-gray-500 dark:text-gray-400"}),"Vehicle Information"]}),(W=t.vehicle)!=null&&W[0]?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Vehicle"}),e.jsxs("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:[t.vehicle[0].make," ",t.vehicle[0].model]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[t.vehicle[0].year," · ",t.vehicle[0].vehicle_type||"Not specified"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Color"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-5 h-5 rounded-full mr-2 border border-gray-300 dark:border-gray-600",style:{backgroundColor:((V=un.find(S=>{var H;return S.value===((H=t.vehicle)==null?void 0:H[0].color.toLowerCase())}))==null?void 0:V.hex)||((F=t.vehicle)==null?void 0:F[0].color)}}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white capitalize",children:t.vehicle[0].color})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"License Plate"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:t.vehicle[0].plate_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Passenger Capacity"}),e.jsxs("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:[t.vehicle[0].capacity," passengers"]})]})]}),(t.vehicle[0].license_expiry||t.vehicle[0].insurance_expiry)&&e.jsxs("div",{className:"md:col-span-2 mt-2 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Document Expiry Dates"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.vehicle[0].license_expiry&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Vehicle License Expiry"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:new Date(t.vehicle[0].license_expiry).toLocaleDateString()})]}),t.vehicle[0].insurance_expiry&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Insurance Expiry"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:new Date(t.vehicle[0].insurance_expiry).toLocaleDateString()})]})]})]})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-900/30",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mr-3"}),e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"No vehicle information has been added to your profile yet. Edit your profile to add vehicle details."})]})})]})]})})})})]})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 text-center",children:[e.jsx(Be,{className:"h-12 w-12 text-yellow-500 dark:text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Driver Profile Not Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Your driver profile hasn't been set up yet. Please contact support for assistance."})]})},tl=[{value:"license",label:"Driver License",required:!0},{value:"insurance",label:"Insurance Certificate",required:!0},{value:"registration",label:"Vehicle Registration",required:!0},{value:"other",label:"Other Document",required:!1}],_k=()=>{const[t,r]=h.useState([]),[s,a]=h.useState(!0),[n,i]=h.useState(null),[o,l]=h.useState(null),[c,u]=h.useState(null),[d,m]=h.useState(!1),[g,x]=h.useState(!1),[p,f]=h.useState(null),[y,v]=h.useState(null),[w,j]=h.useState({}),[b,k]=h.useState({}),[I,C]=h.useState({}),{toast:A}=Pe(),{userData:B}=je(),[D,L]=h.useState(!1);h.useEffect(()=>{B!=null&&B.id&&N().then(P=>{P?(i(P),z(P),E(P)):a(!1)})},[B]),h.useEffect(()=>{const P=t.map(ie=>ie.doc_type),$=Object.keys(w),Z=[...new Set([...P,...$])];m(Z.length>0)},[t,w]);const N=async()=>{try{const{data:P,error:$}=await U.rpc("get_user_driver_id");return $?(console.error("Error fetching driver ID:",$),null):P||null}catch(P){return console.error("Error:",P),null}},O=async()=>{try{v(null),L(!0);const{data:{session:P}}=await U.auth.getSession();if(!P)throw new Error("Authentication required");const Z=await fetch("https://phcqdnzuicgmlhkmnpxc.supabase.co/functions/v1/create-driver-profile",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.access_token}`}});if(!Z.ok){const he=await Z.json().catch(()=>({}));throw new Error(he.error||`HTTP error ${Z.status}`)}const ie=await Z.json();if(ie.success&&ie.driverId)return i(ie.driverId),u("unverified"),ie.driverId;throw new Error("Failed to create driver profile")}catch(P){return console.error("Error creating driver profile:",P),v(P.message||"Could not create your driver profile. Please try again or contact support."),A({variant:"destructive",title:"Error",description:P.message||"Could not create your driver profile. Please try again or contact support."}),null}finally{L(!1)}},E=async P=>{try{const{data:$,error:Z}=await U.from("drivers").select("verification_status, decline_reason").eq("id",P).single();if(Z){console.error("Error fetching driver status:",Z);return}u(($==null?void 0:$.verification_status)||"unverified")}catch($){console.error("Error:",$)}},z=async P=>{try{a(!0);const{data:$,error:Z}=await U.from("driver_documents").select("*").eq("driver_id",P).order("uploaded_at",{ascending:!1});if(Z)throw Z;r($||[])}catch($){console.error("Error fetching documents:",$),A({variant:"destructive",title:"Error",description:$.message||"Failed to fetch your documents."})}finally{a(!1)}},W=async()=>{if(!d&&Object.keys(w).length===0){A({variant:"destructive",title:"No Documents",description:"Please upload at least one document before submitting for verification."});return}try{x(!0),v(null);let P=n;if(!P){if(P=await O(),!P)throw new Error("Could not create driver profile");i(P)}await S(P);const{error:$}=await U.from("drivers").update({verification_status:"pending"}).eq("id",P);if($)throw $;u("pending"),A({title:"Documents Submitted",description:"Your documents have been submitted for review. You'll be notified once they're verified.",variant:"success"}),j({}),k({}),C({}),z(P),localStorage.removeItem("profilePromptDismissed")}catch(P){console.error("Error submitting for review:",P),v(P.message||"Failed to submit for review. Please try again."),A({variant:"destructive",title:"Error",description:P.message||"Failed to submit for review. Please try again."})}finally{x(!1)}},V=P=>URL.createObjectURL(P),F=async(P,$)=>{if($)try{if(l(P),v(null),$.size>5*1024*1024)throw new Error("File too large. Maximum size is 5MB.");if(!["image/jpeg","image/png","application/pdf"].includes($.type))throw new Error("Invalid file type. Please upload a JPEG, PNG or PDF file.");j(he=>({...he,[P]:$}));const ie=V($);k(he=>({...he,[P]:ie})),p&&C(he=>({...he,[P]:p})),A({title:"File Selected",description:"Document is ready for submission. Click 'Submit for Verification' when ready."}),f(null)}catch(Z){console.error("Error preparing document:",Z),v(Z.message||"Failed to prepare document. Please try again."),A({variant:"destructive",title:"Upload Failed",description:Z.message||"Failed to prepare document. Please try again."})}finally{l(null)}},S=async P=>{try{for(const $ of Object.keys(w)){const Z=w[$],ie=I[$]||null,he=Z.name.split(".").pop(),q=`driver_documents/${`${P}/${$}_${Date.now()}.${he}`}`,{error:oe,data:de}=await U.storage.from("documents").upload(q,Z,{cacheControl:"3600",upsert:!1});if(oe)throw oe;const{data:{publicUrl:le}}=U.storage.from("documents").getPublicUrl(q);await U.from("driver_documents").delete().eq("driver_id",P).eq("doc_type",$);const{error:fe}=await U.from("driver_documents").insert({driver_id:P,doc_type:$,file_url:le,name:Z.name,verified:!1,expiry_date:ie});if(fe)throw fe}return!0}catch($){return console.error("Error uploading documents:",$),A({variant:"destructive",title:"Upload Failed",description:$.message||"Failed to upload documents. Please try again."}),!1}},H=P=>{if(!P.verified)return{icon:e.jsx(De,{className:"h-5 w-5 text-yellow-500 dark:text-yellow-400"}),text:"Pending Verification",color:"text-yellow-700 dark:text-yellow-300 bg-yellow-100 dark:bg-yellow-900/30"};if(P.expiry_date){const $=new Date(P.expiry_date),Z=new Date,ie=Ii(Z,30);if(Qo($,Z))return{icon:e.jsx(Be,{className:"h-5 w-5 text-red-500 dark:text-red-400"}),text:"Expired",color:"text-red-700 dark:text-red-300 bg-red-100 dark:bg-red-900/30"};if(Qo($,ie))return{icon:e.jsx(Ae,{className:"h-5 w-5 text-yellow-500 dark:text-yellow-400"}),text:`Expiring Soon (${ne($,"PP")})`,color:"text-yellow-700 dark:text-yellow-300 bg-yellow-100 dark:bg-yellow-900/30"}}return{icon:e.jsx(pt,{className:"h-5 w-5 text-green-500 dark:text-green-400"}),text:"Verified",color:"text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30"}},ee=P=>t.find($=>$.doc_type===P),se=P=>w[P],R=P=>!!w[P],Y={};tl.forEach(P=>{Y[P.value]=et.createRef()});const te=P=>{var $,Z;($=Y[P])!=null&&$.current&&((Z=Y[P].current)==null||Z.click())},M=(P,$)=>{var ie;const Z=(ie=P.target.files)==null?void 0:ie[0];Z&&F($,Z)},K=()=>y?e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-md mb-6 border border-red-200 dark:border-red-800 flex items-start",children:[e.jsx(Ae,{className:"h-5 w-5 text-red-500 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-700 dark:text-red-300 font-medium",children:"Error"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mt-1",children:y})]})]}):null,ce=()=>!(c==="verified"||c==="pending"),ae=()=>D||g?{disabled:!0,text:D?"Creating Profile...":"Submitting..."}:!d&&Object.keys(w).length===0?{disabled:!0,text:"Upload at least one document"}:{disabled:!1,text:c==="declined"?"Resubmit for Verification":"Submit for Verification"};return s&&n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-bold dark:text-white",children:"Documents"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Upload and manage your required documents. All documents must be verified before you can accept trips."})]}),e.jsx(K,{}),ce()&&e.jsxs("div",{className:"mb-6 p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700 text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:d||Object.keys(w).length>0?"Ready to Submit for Verification?":"Upload Documents for Verification"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6 max-w-lg mx-auto",children:d||Object.keys(w).length>0?"You can submit your documents for review now. At least one document is required.":"Upload at least one document below, then submit for verification to start accepting trips."}),e.jsx("button",{onClick:W,disabled:ae().disabled,className:`px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors inline-flex items-center ${ae().disabled?"opacity-60 cursor-not-allowed":""}`,children:D||g?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"animate-spin h-5 w-5 mr-2"}),ae().text]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"h-5 w-5 mr-2"}),ae().text]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:tl.map(P=>{const $=ee(P.value),Z=se(P.value),ie=$?H($):null,he=R(P.value);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex justify-between items-center",children:e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),P.label,P.required&&e.jsx("span",{className:"ml-2 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 px-2 py-0.5 rounded",children:"Required"})]})}),e.jsx("div",{className:"p-6",children:$?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm ${ie==null?void 0:ie.color}`,children:[ie==null?void 0:ie.icon,e.jsx("span",{className:"ml-2",children:ie==null?void 0:ie.text})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("a",{href:$.file_url,target:"_blank",rel:"noopener noreferrer",className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",title:"View Document",children:e.jsx(os,{className:"h-5 w-5"})})})]}),e.jsx("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:e.jsx("span",{className:"truncate max-w-[180px]",children:$.name})}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Uploaded: ",ne(new Date($.uploaded_at),"PP")]}),$.expiry_date&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Expires: ",ne(new Date($.expiry_date),"PP")]}),e.jsxs("div",{className:"pt-4 border-t dark:border-gray-700 mt-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:$.verified?"Document verified":"Awaiting verification"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-end md:items-center space-y-2 md:space-y-0 md:space-x-3",children:[P.value!=="other"&&e.jsxs("div",{className:"flex flex-col items-start space-y-1",children:[e.jsx("label",{htmlFor:`${P.value}-expiry`,className:"text-xs text-gray-500 dark:text-gray-400",children:"Expiry Date:"}),e.jsx("input",{type:"date",id:`${P.value}-expiry`,className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 dark:bg-gray-700 dark:text-white",onChange:ge=>f(ge.target.value)})]}),e.jsx("input",{type:"file",ref:Y[P.value],onChange:ge=>M(ge,P.value),className:"hidden",accept:".jpg,.jpeg,.png,.pdf"}),e.jsxs("button",{type:"button",onClick:()=>te(P.value),disabled:!!o,className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center z-10",children:[e.jsx(wr,{className:"h-4 w-4 mr-1"}),o===P.value?"Uploading...":"Upload New"]})]})]})]}):he?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",children:[e.jsx(De,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:"Ready for Submission"})]})}),e.jsx("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:e.jsx("span",{className:"truncate max-w-[180px]",children:Z==null?void 0:Z.name})}),I[P.value]&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Expires: ",ne(new Date(I[P.value]),"PP")]}),e.jsxs("div",{className:"flex items-center mt-2 pt-4 border-t dark:border-gray-700",children:[e.jsxs("a",{href:b[P.value],target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline text-sm flex items-center",children:[e.jsx(os,{className:"w-4 h-4 mr-1"})," View Selected File"]}),e.jsx("button",{onClick:()=>{j(ge=>{const q={...ge};return delete q[P.value],q}),k(ge=>{const q={...ge};return delete q[P.value],q}),C(ge=>{const q={...ge};return delete q[P.value],q})},className:"ml-auto text-red-600 dark:text-red-400 text-sm hover:underline",children:"Remove"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(st,{className:"h-10 w-10 text-gray-400 dark:text-gray-500 mx-auto mb-3"}),e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"No document uploaded"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:P.required?"This document is required to accept trips.":"Upload this document if requested by admin."}),e.jsxs("div",{className:"space-y-4",children:[P.value!=="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Document Expiry Date"}),e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"date",className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 dark:bg-gray-700 dark:text-white text-sm",onChange:ge=>f(ge.target.value)})})]}),e.jsx("input",{type:"file",ref:Y[P.value],onChange:ge=>M(ge,P.value),className:"hidden",accept:".jpg,.jpeg,.png,.pdf"}),e.jsx("button",{type:"button",onClick:()=>te(P.value),disabled:o===P.value,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 z-10",children:o===P.value?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"animate-spin h-4 w-4 mr-2"}),"Selecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(wr,{className:"h-4 w-4 mr-2"}),"Select Document"]})})]})]})})]},P.value)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg shadow-sm border border-blue-100 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Nt,{className:"h-5 w-5 text-blue-500 dark:text-blue-400 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-1",children:"Document Requirements"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"All documents must be current and not expired"}),e.jsx("li",{children:"Files must be in JPG, PNG, or PDF format"}),e.jsx("li",{children:"Maximum file size is 5MB"}),e.jsx("li",{children:"Documents must be clearly legible"}),e.jsx("li",{children:"All documents will be verified by our team before you can start accepting trips"})]}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-400 mt-2",children:["For assistance, please ",e.jsx(lt,{to:"/partner/chat",className:"underline",children:"contact support"}),"."]})]})]})})]})},Le=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(t),rl=(t,r=7)=>{const s=new Date,a=Xs(s,r-1);return Li({start:a,end:s}).map(o=>{const c=t.filter(u=>{const d=ke(u.created_at);return as(d,o)}).reduce((u,d)=>u+Number(d.amount),0);return{date:o,amount:c||0}})},Sk=()=>{const[t,r]=h.useState([]),[s,a]=h.useState({daily:{},weekly:0,monthly:0,total:0,completedTrips:0}),[n,i]=h.useState(!0),[o,l]=h.useState(null),[c,u]=h.useState("payments"),[d,m]=h.useState([]),[g,x]=h.useState(0),[p,f]=h.useState([]),[y,v]=h.useState([]),[w,j]=h.useState("monthly"),[b,k]=h.useState([]),{toast:I}=Pe(),{userData:C}=je();h.useEffect(()=>{C!=null&&C.id&&A()},[C]),h.useEffect(()=>{if(d.length>0&&g>=0&&g<d.length){const R=d[g].month,Y=t.filter(te=>{const M=ke(te.created_at);return ne(M,"yyyy-MM")===R});L(Y,R),N(Y)}},[g,d,t]);const A=async()=>{try{i(!0);const{data:R,error:Y}=await U.from("drivers").select("id").eq("user_id",C==null?void 0:C.id).single();if(Y)throw Y;if(!(R!=null&&R.id))throw new Error("Driver profile not found");const{data:te,error:M}=await U.from("trips").select(`
          id,
          datetime,
          status,
          estimated_price,
          pickup_zone:zones!trips_pickup_zone_id_fkey(name),
          dropoff_zone:zones!trips_dropoff_zone_id_fkey(name),
          pickup_address,
          dropoff_address
        `).eq("driver_id",C.id).in("status",["completed","in_progress"]).order("datetime",{ascending:!1});if(M)throw M;const K=(te||[]).map($=>$.id);if(K.length===0){r([]),B([]),D([]),v(rl([]));return}const{data:ce,error:ae}=await U.from("payments").select("*").in("trip_id",K).order("created_at",{ascending:!1});if(ae)throw ae;const P=(ce||[]).map($=>{const Z=te==null?void 0:te.find(ie=>ie.id===$.trip_id);return{...$,trip:Z}});r(P),B(te||[]),D(P),v(rl(P))}catch(R){console.error("Error fetching payments:",R),I({variant:"destructive",title:"Error",description:R.message||"Failed to fetch payment history."})}finally{i(!1)}},B=R=>{const Y=new Date;bt(Y,{weekStartsOn:1}),Nu(Y,{weekStartsOn:1}),Un(Y),xs(Y);let te=0,M=0,K=0;const ce={},ae=R.filter(P=>P.status==="completed");ae.forEach(P=>{const $=ke(P.datetime),Z=ne($,"yyyy-MM-dd");ce[Z]||(ce[Z]=0),ce[Z]+=Number(P.estimated_price),kw($,Y,{weekStartsOn:1})&&(te+=Number(P.estimated_price)),Bn($,Y)&&(M+=Number(P.estimated_price)),K+=Number(P.estimated_price)}),a({daily:ce,weekly:te,monthly:M,total:K,completedTrips:ae.length})},D=R=>{const Y=new Set,te=new Date;for(let K=0;K<12;K++){const ce=ne(Pu(te,K),"yyyy-MM");Y.add(ce)}const M=Array.from(Y).map(K=>({month:K,earnings:0,tripsCount:0}));R.forEach(K=>{const ce=ke(K.created_at),ae=ne(ce,"yyyy-MM"),P=M.find($=>$.month===ae);P&&(P.earnings+=Number(K.amount),P.tripsCount+=1)}),M.sort((K,ce)=>ce.month.localeCompare(K.month)),m(M),x(0)},L=(R,Y)=>{const[te,M]=Y.split("-"),K=new Date(parseInt(te),parseInt(M)-1,1),ce=xs(K),P=Li({start:K,end:ce}).map($=>({date:ne($,"yyyy-MM-dd"),amount:0,trips:0}));R.forEach($=>{const Z=ke($.created_at),ie=ne(Z,"yyyy-MM-dd"),he=P.find(ge=>ge.date===ie);he&&(he.amount+=Number($.amount),he.trips+=1)}),f(P)},N=R=>{const Y=R.map(te=>{var M,K,ce;return{tripId:te.trip_id,amount:Number(te.amount),date:ne(ke(((M=te.trip)==null?void 0:M.datetime)||te.created_at),"yyyy-MM-dd"),locations:te.trip?`${((K=te.trip.pickup_zone)==null?void 0:K.name)||te.trip.pickup_address||"Unknown"} to ${((ce=te.trip.dropoff_zone)==null?void 0:ce.name)||te.trip.dropoff_address||"Unknown"}`:"Unknown trip"}});Y.sort((te,M)=>new Date(M.date).getTime()-new Date(te.date).getTime()),k(Y)},O=R=>{l(o===R?null:R)},E=()=>{var R,Y;try{let te,M;w==="monthly"?(te=[["Month","Earnings (EUR)","Number of Trips","Average Per Trip"]],d.forEach($=>{const Z=$.tripsCount>0?$.earnings/$.tripsCount:0;te.push([ne(new Date($.month+"-01"),"MMMM yyyy"),$.earnings.toFixed(2),$.tripsCount.toString(),Z.toFixed(2)])}),M=`monthly_earnings_${ne(new Date,"yyyy-MM-dd")}.csv`):w==="daily"?(te=[["Date","Earnings (EUR)","Number of Trips"]],p.filter($=>$.amount>0||$.trips>0).forEach($=>{te.push([ne(ke($.date),"MMM d, yyyy"),$.amount.toFixed(2),$.trips.toString()])}),M=`daily_earnings_${((R=d[g])==null?void 0:R.month)||ne(new Date,"yyyy-MM")}.csv`):(te=[["Date","Trip","Earnings (EUR)"]],b.forEach($=>{te.push([ne(ke($.date),"MMM d, yyyy"),$.locations,$.amount.toFixed(2)])}),M=`trip_earnings_${((Y=d[g])==null?void 0:Y.month)||ne(new Date,"yyyy-MM")}.csv`);const K=te.map($=>$.map(Z=>`"${Z}"`).join(",")).join(`
`),ce=new Blob([K],{type:"text/csv;charset=utf-8;"}),ae=URL.createObjectURL(ce),P=document.createElement("a");P.setAttribute("href",ae),P.setAttribute("download",M),document.body.appendChild(P),P.click(),document.body.removeChild(P),I({title:"Export Complete",description:"Earnings data exported to CSV file."})}catch(te){console.error("Error exporting earnings data:",te),I({variant:"destructive",title:"Export Failed",description:te.message||"Failed to export earnings data."})}},z=()=>{try{const R=t.map(ae=>{var P,$,Z,ie,he,ge,q,oe;return{Date:(P=ae.trip)!=null&&P.datetime?ne(new Date(ae.trip.datetime),"PP"):"N/A",Time:($=ae.trip)!=null&&$.datetime?ne(new Date(ae.trip.datetime),"p"):"N/A",Amount:Le(ae.amount),Status:ae.status,"Payment Method":ae.payment_method,"Payment Date":ae.paid_at?ne(new Date(ae.paid_at),"PP"):"N/A","Pickup Location":((ie=(Z=ae.trip)==null?void 0:Z.pickup_zone)==null?void 0:ie.name)||((he=ae.trip)==null?void 0:he.pickup_address)||"N/A","Dropoff Location":((q=(ge=ae.trip)==null?void 0:ge.dropoff_zone)==null?void 0:q.name)||((oe=ae.trip)==null?void 0:oe.dropoff_address)||"N/A"}}),Y=Object.keys(R[0]||{}),te=[Y.join(","),...R.map(ae=>Y.map(P=>`"${ae[P]}"`).join(","))].join(`
`),M=new Blob([te],{type:"text/csv"}),K=URL.createObjectURL(M),ce=document.createElement("a");ce.setAttribute("href",K),ce.setAttribute("download",`payment_history_${ne(new Date,"yyyy-MM-dd")}.csv`),ce.click(),I({title:"Export Complete",description:"Payment history exported to CSV file."})}catch(R){console.error("Error exporting payment history:",R),I({variant:"destructive",title:"Export Failed",description:R.message||"Failed to export payment history."})}},W=()=>{if(y.length===0)return"";const R=100,Y=30,te=2,M=Math.max(...y.map(ce=>ce.amount),1);return y.map((ce,ae)=>{const P=te+ae/(y.length-1)*(R-2*te),$=Y-te-ce.amount/M*(Y-2*te);return`${ae===0?"M":"L"} ${P} ${$}`}).join(" ")},V=()=>{g<d.length-1&&x(g+1)},F=()=>{g>0&&x(g-1)};if(n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})});const S=()=>p.length===0?null:p.reduce((R,Y)=>Y.amount>R.amount?Y:R,p[0]),H=()=>{const R=p.filter(Y=>Y.amount>0);return R.length===0?null:R.reduce((Y,te)=>te.amount<Y.amount?te:Y,R[0])},ee=S(),se=H();return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-xl font-bold dark:text-white mb-4 sm:mb-0",children:"Earnings & Payments"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>u("earnings"),className:`px-3 py-1.5 text-sm ${c==="earnings"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-white text-gray-700 dark:bg-gray-800 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Earnings Breakdown"}),e.jsx("button",{onClick:()=>u("payments"),className:`px-3 py-1.5 text-sm ${c==="payments"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-white text-gray-700 dark:bg-gray-800 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"Payment History"})]}),e.jsxs("button",{onClick:c==="earnings"?E:z,disabled:t.length===0,className:"inline-flex items-center px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 dark:disabled:bg-blue-800 text-sm",children:[e.jsx(Pt,{className:"h-4 w-4 mr-1"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"This Week"}),e.jsx("div",{className:"relative h-8 w-16",children:e.jsx("svg",{width:"100%",height:"100%",className:"text-blue-100 dark:text-blue-900/30",children:e.jsx("path",{d:W(),fill:"none",strokeWidth:"2",stroke:"currentColor",className:"text-blue-500 dark:text-blue-400"})})})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:Le(s.weekly)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Week of ",ne(bt(new Date,{weekStartsOn:1}),"MMM d")]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"This Month"}),e.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-2 rounded-full",children:e.jsx(Vn,{className:"h-5 w-5 text-green-600 dark:text-green-400"})})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:Le(s.monthly)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:ne(new Date,"MMMM yyyy")})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Completed Trips"}),e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-2 rounded-full",children:e.jsx(st,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.completedTrips}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"All-time total"})]})]}),c==="earnings"?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(fn,{className:"h-5 w-5 mr-2 text-blue-500 dark:text-blue-400"}),"Earnings Breakdown"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800",children:[e.jsx("button",{onClick:V,disabled:g>=d.length-1,className:"p-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-l-md disabled:opacity-50",children:e.jsx(Dr,{className:"h-4 w-4"})}),e.jsx("div",{className:"px-2 py-1.5 text-sm text-gray-900 dark:text-white",children:d[g]?ne(new Date(d[g].month+"-01"),"MMMM yyyy"):"No data"}),e.jsx("button",{onClick:F,disabled:g<=0,className:"p-1.5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-r-md disabled:opacity-50",children:e.jsx(fl,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden",children:[e.jsx("button",{onClick:()=>j("monthly"),className:`p-2 text-sm ${w==="monthly"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,title:"Monthly View",children:e.jsx(ot,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j("daily"),className:`p-2 text-sm ${w==="daily"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,title:"Daily Breakdown",children:e.jsx(gl,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j("trips"),className:`p-2 text-sm ${w==="trips"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,title:"Trips Breakdown",children:e.jsx(Car,{className:"h-4 w-4"})})]})]})]}),e.jsx("div",{className:"p-6",children:d.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fn,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mx-auto mb-3"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Earnings Data"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"You don't have any earnings recorded yet. Once you complete trips and receive payments, your earnings data will appear here."})]}):e.jsxs(e.Fragment,{children:[w==="monthly"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:d.slice(0,4).map((R,Y)=>e.jsxs("div",{className:`p-4 rounded-lg border ${Y===g?"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700"}`,onClick:()=>x(Y),style:{cursor:"pointer"},children:[e.jsx("div",{className:"font-medium text-sm text-gray-500 dark:text-gray-400",children:ne(new Date(R.month+"-01"),"MMMM yyyy")}),e.jsx("div",{className:"mt-1 font-semibold text-lg text-gray-900 dark:text-white",children:Le(R.earnings)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[R.tripsCount," trip",R.tripsCount!==1?"s":""]})]},R.month))}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Monthly Earnings (Last 12 Months)"}),e.jsxs("div",{className:"h-60 relative",children:[e.jsx("div",{className:"flex h-full items-end justify-around gap-1",children:d.slice(0,12).reverse().map((R,Y)=>{const te=Math.max(...d.map(K=>K.earnings),1),M=R.earnings/te*100;return e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:"w-full bg-blue-500 dark:bg-blue-600 rounded-t transition-all duration-500",style:{height:`${M||2}%`,minHeight:"4px",opacity:11-Y>=0?(11-Y)/11:1},title:`${Le(R.earnings)}`}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 rotate-45 origin-left translate-y-3",children:ne(new Date(R.month+"-01"),"MMM")})]},R.month)})}),e.jsxs("div",{className:"absolute left-0 top-0 h-full flex flex-col justify-between pointer-events-none",children:[e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:Le(Math.max(...d.map(R=>R.earnings),0))}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:Le(Math.max(...d.map(R=>R.earnings),0)/2)}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:Le(0)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-100 dark:border-green-800",children:[e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300 mb-1",children:"Monthly Average"}),e.jsx("div",{className:"text-xl font-semibold text-green-800 dark:text-green-200",children:Le(d.length>0&&d.reduce((R,Y)=>R+Y.earnings,0)/d.filter(R=>R.earnings>0).length||0)})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300 mb-1",children:"Highest Month"}),e.jsx("div",{className:"text-xl font-semibold text-blue-800 dark:text-blue-200",children:Le(Math.max(...d.map(R=>R.earnings),0))}),e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:d.length>0?ne(new Date(d.reduce((R,Y)=>Y.earnings>R.earnings?Y:R,{earnings:0,month:"",tripsCount:0}).month+"-01"),"MMMM yyyy"):"N/A"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-100 dark:border-purple-800",children:[e.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300 mb-1",children:"Average Per Trip"}),e.jsx("div",{className:"text-xl font-semibold text-purple-800 dark:text-purple-200",children:Le(d.reduce((R,Y)=>R+Y.earnings,0)/d.reduce((R,Y)=>R+Y.tripsCount,0)||0)})]})]})]}),w==="daily"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300 mb-1",children:["Total for ",ne(new Date(d[g].month+"-01"),"MMMM")]}),e.jsx("div",{className:"text-xl font-semibold text-blue-800 dark:text-blue-200",children:Le(d[g].earnings)}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:[d[g].tripsCount," trip",d[g].tripsCount!==1?"s":""]})]}),ee&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-100 dark:border-green-800",children:[e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300 mb-1",children:"Best Day"}),e.jsx("div",{className:"text-xl font-semibold text-green-800 dark:text-green-200",children:Le(ee.amount)}),e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:ne(ke(ee.date),"EEEE, MMM d")})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-100 dark:border-purple-800",children:[e.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300 mb-1",children:"Daily Average"}),e.jsx("div",{className:"text-xl font-semibold text-purple-800 dark:text-purple-200",children:Le(p.reduce((R,Y)=>R+Y.amount,0)/(p.filter(R=>R.amount>0).length||1))}),e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:"on working days"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-600 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Daily Breakdown"}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 dark:bg-blue-400 rounded-sm mr-1"}),e.jsx("span",{children:"Earnings"})]})]}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700 max-h-80 overflow-y-auto",children:p.filter(R=>p.length<=31||R.amount>0).sort((R,Y)=>new Date(Y.date).getTime()-new Date(R.date).getTime()).map(R=>e.jsxs("div",{className:`flex items-center justify-between p-3 ${R.amount>0?"hover:bg-gray-50 dark:hover:bg-gray-600":"text-gray-400 dark:text-gray-500"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex flex-col mr-4 w-12 ${ns(ke(R.date))?"text-blue-600 dark:text-blue-400 font-medium":""}`,children:[e.jsx("span",{className:"text-xs",children:ne(ke(R.date),"E")}),e.jsx("span",{className:"text-lg leading-none",children:ne(ke(R.date),"d")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-medium",children:ne(ke(R.date),"MMMM d, yyyy")}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[R.trips," trip",R.trips!==1?"s":""]})]})]}),e.jsxs("div",{className:`text-right ${(ee==null?void 0:ee.date)===R.date?"text-green-600 dark:text-green-400 font-semibold":(se==null?void 0:se.date)===R.date&&R.amount>0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"}`,children:[e.jsx("div",{className:"text-lg font-medium",children:Le(R.amount)}),(ee==null?void 0:ee.date)===R.date&&e.jsx("div",{className:"text-xs",children:"Highest"})]})]},R.date))})]})]}),w==="trips"&&e.jsx("div",{children:b.length>0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Trip Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Earnings"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:b.map((R,Y)=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:ne(ke(R.date),"MMM d, yyyy")}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:R.locations}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:Le(R.amount)})]},R.tripId+Y))})]})}):e.jsxs("div",{className:"text-center py-8 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(Car,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mx-auto mb-3"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Trips Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"There are no completed trips for this period."})]})})]})})]})}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"px-6 py-4 border-b dark:border-gray-700",children:e.jsx("h2",{className:"font-medium text-gray-900 dark:text-white",children:"Payment History"})}),t.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(De,{className:"h-10 w-10 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No payment history yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Your payment history will appear here after you complete trips."})]}):e.jsx("div",{className:"divide-y dark:divide-gray-700",children:t.map(R=>{var Y,te,M,K,ce,ae;return e.jsxs("div",{children:[e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>O(R.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-full mr-3 ${R.status==="completed"?"bg-green-100 dark:bg-green-900/30":R.status==="pending"?"bg-yellow-100 dark:bg-yellow-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:R.status==="completed"?e.jsx(CheckCircle,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):R.status==="pending"?e.jsx(De,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"}):e.jsx(AlertTriangle,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[((te=(Y=R.trip)==null?void 0:Y.pickup_zone)==null?void 0:te.name)||"Pickup"," to ",((K=(M=R.trip)==null?void 0:M.dropoff_zone)==null?void 0:K.name)||"Dropoff"]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:(ce=R.trip)!=null&&ce.datetime?ne(new Date(R.trip.datetime),"PP"):"N/A"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-right mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:Le(R.amount)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:R.payment_method.replace("_"," ")})]}),o===R.id?e.jsx(Gn,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"}):e.jsx(Kn,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})]})]})}),o===R.id&&e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("div",{className:"text-sm space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Payment ID"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[R.id.slice(0,8),"..."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("p",{className:`font-medium capitalize ${R.status==="completed"?"text-green-600 dark:text-green-400":R.status==="pending"?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:R.status})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Payment Method"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(Sr,{className:"h-4 w-4 mr-1 text-gray-400 dark:text-gray-500"}),e.jsx("span",{className:"capitalize",children:R.payment_method.replace("_"," ")})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Payment Date"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:R.paid_at?ne(new Date(R.paid_at),"PP"):"Pending"})]})]}),e.jsx("div",{className:"border-t dark:border-gray-600 pt-3 mt-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Trip Date & Time"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:(ae=R.trip)!=null&&ae.datetime?ne(new Date(R.trip.datetime),"PPp"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Amount"}),e.jsx("p",{className:"font-medium text-xl text-gray-900 dark:text-white",children:Le(R.amount)})]})]})}),e.jsx("div",{className:"border-t dark:border-gray-600 pt-3 mt-3",children:e.jsxs("a",{href:"#",className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm flex items-center justify-center",children:[e.jsx(ma,{className:"h-4 w-4 mr-1"}),"View Full Trip Details"]})})]})})]},R.id)})})]})]})},Ek=()=>{const{theme:t,toggleTheme:r}=ja(),{userData:s}=je(),{toast:a}=Pe(),[n,i]=h.useState(!1),[o,l]=h.useState(!0),[c,u]=h.useState(!1),[d,m]=h.useState("en"),g=async()=>{try{i(!0),await new Promise(p=>setTimeout(p,1e3)),a({title:"Settings Saved",description:"Your preferences have been updated successfully."})}catch(p){console.error("Error saving settings:",p),a({variant:"destructive",title:"Error",description:"Failed to save settings. Please try again."})}finally{i(!1)}},x=async()=>{try{if(!("Notification"in window)){a({variant:"destructive",title:"Not Supported",description:"This browser does not support notifications."});return}await Notification.requestPermission()==="granted"?(l(!0),a({title:"Notifications Enabled",description:"You'll now receive notifications for new trips and updates."})):(l(!1),a({variant:"destructive",title:"Permission Denied",description:"Notification permission was denied. Update browser settings to enable."}))}catch(p){console.error("Error requesting notification permission:",p),a({variant:"destructive",title:"Error",description:"Failed to request notification permission."})}};return e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold dark:text-white mb-6",children:"Settings"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:e.jsx("h2",{className:"font-medium text-gray-900 dark:text-white",children:"Profile Settings"})}),e.jsx("div",{className:"p-6 border-b dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center mb-6 last:mb-0",children:[e.jsx("div",{className:"flex-shrink-0 w-8",children:e.jsx(zs,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-1",children:"Language"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Select your preferred language for the app"})]}),e.jsx("div",{className:"flex-shrink-0 ml-4",children:e.jsxs("select",{value:d,onChange:p=>m(p.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"de",children:"German"}),e.jsx("option",{value:"fr",children:"French"}),e.jsx("option",{value:"es",children:"Spanish"})]})})]})}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:e.jsx("h2",{className:"font-medium text-gray-900 dark:text-white",children:"App Settings"})}),e.jsxs("div",{className:"p-6 border-b dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"flex-shrink-0 w-8",children:t==="dark"?e.jsx(cl,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}):e.jsx(ll,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{htmlFor:"theme-toggle",className:"block text-sm font-medium text-gray-900 dark:text-white mb-1",children:"Theme"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Toggle between light and dark mode"})]}),e.jsx("div",{className:"flex-shrink-0 ml-4",children:e.jsxs("button",{onClick:r,className:"relative inline-flex h-6 w-11 items-center rounded-full border-2 border-transparent","aria-checked":t==="dark",role:"switch",id:"theme-toggle",children:[e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full ${t==="dark"?"translate-x-5 bg-blue-600":"translate-x-0 bg-gray-300"} transition duration-200 ease-in-out`}),e.jsx("span",{className:`absolute inset-0 cursor-pointer rounded-full ${t==="dark"?"bg-gray-600":"bg-gray-200"}`})]})})]}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"flex-shrink-0 w-8",children:e.jsx(zt,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{htmlFor:"notifications-toggle",className:"block text-sm font-medium text-gray-900 dark:text-white mb-1",children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Receive notifications for new trip assignments"})]}),e.jsx("div",{className:"flex-shrink-0 ml-4",children:e.jsxs("button",{onClick:x,className:"relative inline-flex h-6 w-11 items-center rounded-full border-2 border-transparent","aria-checked":o,role:"switch",id:"notifications-toggle",children:[e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full ${o?"translate-x-5 bg-blue-600":"translate-x-0 bg-gray-300"} transition duration-200 ease-in-out`}),e.jsx("span",{className:`absolute inset-0 cursor-pointer rounded-full ${o?"bg-gray-600":"bg-gray-200"}`})]})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-8",children:e.jsx(dh,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{htmlFor:"location-toggle",className:"block text-sm font-medium text-gray-900 dark:text-white mb-1",children:"Location Sharing"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Share your location during active trips"})]}),e.jsx("div",{className:"flex-shrink-0 ml-4",children:e.jsxs("button",{onClick:()=>u(!c),className:"relative inline-flex h-6 w-11 items-center rounded-full border-2 border-transparent","aria-checked":c,role:"switch",id:"location-toggle",children:[e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full ${c?"translate-x-5 bg-blue-600":"translate-x-0 bg-gray-300"} transition duration-200 ease-in-out`}),e.jsx("span",{className:`absolute inset-0 cursor-pointer rounded-full ${c?"bg-gray-600":"bg-gray-200"}`})]})})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600",children:e.jsx("h2",{className:"font-medium text-gray-900 dark:text-white",children:"Security"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start mb-6 pb-6 border-b dark:border-gray-600",children:[e.jsx("div",{className:"flex-shrink-0 w-8 mt-1",children:e.jsx(uh,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:"Change Password"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Update your password regularly to keep your account secure"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm",onClick:()=>a({title:"Coming Soon",description:"This feature will be available in the next update."}),children:"Change Password"})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:g,disabled:n,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 flex items-center",children:n?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"animate-spin h-4 w-4 mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),"Save Settings"]})})})]})]})]})},Ck=()=>{const[t,r]=h.useState([]),[s,a]=h.useState(""),[n,i]=h.useState(!0),[o,l]=h.useState(!1),{userData:c}=je(),{toast:u}=Pe(),d=h.useRef(null),m={name:"Support Team"};h.useEffect(()=>{if(c!=null&&c.id){g();const b=U.channel("chat_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${c.id}`},k=>{const I=k.new;r(C=>[...C,{...I,is_from_me:!1,sender_name:"Support Team"}])}).subscribe();return()=>{U.removeChannel(b)}}},[c]),h.useEffect(()=>{p()},[t]);const g=async()=>{try{i(!0);const{data:b,error:k}=await U.from("messages").select(`
          *,
          sender:users!messages_sender_id_fkey(name)
        `).or(`sender_id.eq.${c==null?void 0:c.id},receiver_id.eq.${c==null?void 0:c.id}`).order("created_at",{ascending:!0});if(k)throw k;const I=(b||[]).map(A=>({...A,is_from_me:A.sender_id===(c==null?void 0:c.id),sender_name:A.sender.name}));r(I);const C=I.filter(A=>!A.is_from_me&&!A.read).map(A=>A.id);C.length>0&&await U.from("messages").update({read:!0}).in("id",C)}catch(b){console.error("Error fetching messages:",b),u({variant:"destructive",title:"Error",description:b.message||"Failed to load messages. Please try again."})}finally{i(!1)}},x=async()=>{if(s.trim())try{l(!0);const{data:b,error:k}=await U.from("messages").insert({content:s.trim(),sender_id:c==null?void 0:c.id,receiver_id:"support",read:!1}).select("*").single();if(k)throw k;r([...t,{...b,is_from_me:!0,sender_name:(c==null?void 0:c.name)||"You"}]),a("")}catch(b){console.error("Error sending message:",b),u({variant:"destructive",title:"Error",description:b.message||"Failed to send message. Please try again."})}finally{l(!1)}},p=()=>{var b;(b=d.current)==null||b.scrollIntoView({behavior:"smooth"})},f=b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),x())},y=b=>{const k=new Date(b);return ne(k,"h:mm a")},v=b=>ne(new Date(b),"MMMM d, yyyy"),w={};t.forEach(b=>{const k=v(b.created_at);w[k]||(w[k]=[]),w[k].push(b)});const j=Object.keys(w);return e.jsxs("div",{className:"h-[calc(100vh-12rem)] flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("h1",{className:"text-xl font-bold dark:text-white",children:"Support Chat"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"p-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",title:"Audio Call",children:e.jsx(hh,{className:"h-5 w-5"})}),e.jsx("button",{className:"p-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",title:"Video Call",children:e.jsx(mh,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex-1 bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-300 font-bold",children:"S"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:m.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Typically replies within a few hours"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 bg-gray-50 dark:bg-gray-900/50",children:[n?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):t.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mb-4",children:e.jsx(Be,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-sm",children:"Send a message to the support team and they'll get back to you as soon as possible."})]}):j.map(b=>e.jsxs("div",{children:[e.jsx("div",{className:"text-center mb-4",children:e.jsx("span",{className:"inline-block px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full text-xs text-gray-600 dark:text-gray-300",children:b})}),e.jsx("div",{className:"space-y-4",children:w[b].map(k=>e.jsxs("div",{className:`flex ${k.is_from_me?"justify-end":"justify-start"}`,children:[!k.is_from_me&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex-shrink-0 flex items-center justify-center mr-2",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-300 font-bold text-xs",children:"S"})}),e.jsxs("div",{className:`max-w-[70%] px-4 py-3 rounded-lg ${k.is_from_me?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 border dark:border-gray-700"}`,children:[e.jsx("div",{className:"text-sm",children:k.content}),e.jsx("div",{className:`text-xs mt-1 text-right ${k.is_from_me?"text-blue-100":"text-gray-500 dark:text-gray-400"}`,children:y(k.created_at)})]})]},k.id))})]},b)),e.jsx("div",{ref:d})]}),e.jsx("div",{className:"p-4 border-t dark:border-gray-600 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-end",children:[e.jsx("button",{className:"p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-600 dark:hover:text-gray-300",title:"Attach File",children:e.jsx(gh,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1 mx-2",children:e.jsx("textarea",{value:s,onChange:b=>a(b.target.value),onKeyDown:f,placeholder:"Type a message...",className:"w-full border dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none overflow-hidden",rows:1,style:{minHeight:"60px"}})}),e.jsx("button",{onClick:x,disabled:!s.trim()||o,className:`p-3 rounded-full ${!s.trim()||o?"bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500":"bg-blue-600 text-white hover:bg-blue-700"} flex-shrink-0`,children:o?e.jsx(ue,{className:"h-5 w-5 animate-spin"}):e.jsx(fh,{className:"h-5 w-5"})})]})})]})]})},Pk=()=>{const[t,r]=h.useState([]),[s,a]=h.useState(!0),[n,i]=h.useState(null),[o,l]=h.useState(!1),[c,u]=h.useState(null),[d,m]=h.useState(""),[g,x]=h.useState(!1),[p,f]=h.useState("all"),{toast:y}=Pe(),{userData:v}=je(),[w,j]=h.useState(null),[b,k]=h.useState([]);h.useEffect(()=>{I().then(E=>{E&&(j(E),C(E),A(E))})},[v]);const I=async()=>{try{const{data:E,error:z}=await U.from("drivers").select("id").eq("user_id",v==null?void 0:v.id).single();return z?(console.error("Error fetching driver ID:",z),y({variant:"destructive",title:"Error",description:"Could not find your driver profile. Please contact support."}),null):(E==null?void 0:E.id)||null}catch(E){return console.error("Error:",E),null}},C=async E=>{try{x(!0);const{data:z,error:W}=await U.from("incident_reports").select(`
          *,
          trip:trips(
            datetime,
            pickup_zone:zones!trips_pickup_zone_id_fkey(name),
            dropoff_zone:zones!trips_dropoff_zone_id_fkey(name)
          )
        `).eq("driver_id",E).order("created_at",{ascending:!1});if(W)throw W;r(z||[])}catch(z){console.error("Error fetching incident reports:",z),y({variant:"destructive",title:"Error",description:z.message||"Failed to fetch incident reports."})}finally{a(!1),x(!1)}},A=async E=>{try{const{data:z,error:W}=await U.from("trips").select(`
          id,
          datetime,
          status,
          pickup_zone:zones!trips_pickup_zone_id_fkey(name),
          dropoff_zone:zones!trips_dropoff_zone_id_fkey(name)
        `).eq("driver_id",E).in("status",["accepted","in_progress","completed"]).order("datetime",{ascending:!1});if(W)throw W;k(z||[])}catch(z){console.error("Error fetching trips:",z)}},B=async()=>{w&&(await C(w),await A(w))},D=E=>{i(n===E?null:E)},L=(E=null)=>{u(E),l(!0)},N=E=>E.split("_").map(z=>z.charAt(0).toUpperCase()+z.slice(1)).join(" "),O=t.filter(E=>{var V,F,S,H,ee,se,R,Y;const z=((V=E.description)==null?void 0:V.toLowerCase().includes(d.toLowerCase()))||((F=E.incident_type)==null?void 0:F.toLowerCase().includes(d.toLowerCase()))||((ee=(H=(S=E.trip)==null?void 0:S.pickup_zone)==null?void 0:H.name)==null?void 0:ee.toLowerCase().includes(d.toLowerCase()))||((Y=(R=(se=E.trip)==null?void 0:se.dropoff_zone)==null?void 0:R.name)==null?void 0:Y.toLowerCase().includes(d.toLowerCase())),W=p==="all"||p==="resolved"&&E.resolved||p==="unresolved"&&!E.resolved;return z&&W});return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-xl font-bold dark:text-white mb-4 sm:mb-0",children:"Incident Reports"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_t,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search reports...",value:d,onChange:E=>m(E.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("select",{value:p,onChange:E=>f(E.target.value),className:"ml-2 px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Reports"}),e.jsx("option",{value:"unresolved",children:"Unresolved"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:B,className:"px-3 py-2 border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center",children:[e.jsx(Qe,{className:`w-5 h-5 mr-2 ${g?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:()=>L(),className:"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2"}),"New Report"]})]})]})]}),O.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center border dark:border-gray-700",children:[e.jsx(st,{className:"w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No incident reports found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:d||p!=="all"?"No reports match your search criteria. Try changing your filters.":"You haven't submitted any incident reports yet."}),e.jsxs("button",{onClick:()=>L(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 inline-flex items-center",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2"}),"Report an Incident"]})]}):e.jsx("div",{className:"space-y-4",children:O.map(E=>{var z,W,V;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border dark:border-gray-700",children:[e.jsx("div",{className:"px-6 py-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700",onClick:()=>D(E.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${E.resolved?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400"}`,children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:N(E.incident_type)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:(z=E.trip)!=null&&z.datetime?ne(ke(E.trip.datetime),"PPp"):ne(ke(E.created_at),"PPp")})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`px-2 py-1 text-xs rounded-full mr-3 ${E.resolved?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300"}`,children:E.resolved?"Resolved":"Pending"}),n===E.id?e.jsx(Gn,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"}):e.jsx(Kn,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"})]})]})}),n===E.id&&e.jsx("div",{className:"px-6 py-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trip Information"}),E.trip?e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[((W=E.trip.pickup_zone)==null?void 0:W.name)||"Unknown pickup"," to ",((V=E.trip.dropoff_zone)==null?void 0:V.name)||"Unknown destination"]}):e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Trip details not available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:E.description})]}),E.location&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Location"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:E.location})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 dark:text-gray-400 pt-2 border-t dark:border-gray-600",children:[e.jsxs("span",{children:[e.jsx(De,{className:"inline-block w-4 h-4 mr-1 align-text-bottom"}),"Reported: ",ne(ke(E.reported_at),"PP")]}),E.resolved&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(pt,{className:"w-4 h-4 mr-1 text-green-500 dark:text-green-400"}),"Resolved"]})]}),E.admin_notes&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-100 dark:border-blue-800",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 dark:text-blue-300 mb-1",children:"Admin Notes"}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:E.admin_notes})]})]})})]},E.id)})}),o&&e.jsx(Ru,{tripId:c,onClose:()=>l(!1),onSuccess:B}),o&&!c&&b.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-b dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Select Trip"}),e.jsx("button",{onClick:()=>{u(null)},className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(X,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Please select the trip this incident is related to:"}),b.length>0?e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:b.map(E=>{var z,W;return e.jsxs("button",{onClick:()=>{u(E.id)},className:"w-full text-left p-3 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 border dark:border-gray-700",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[ne(ke(E.datetime),"PP")," at ",ne(ke(E.datetime),"p")]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[((z=E.pickup_zone)==null?void 0:z.name)||"Unknown pickup"," to ",((W=E.dropoff_zone)==null?void 0:W.name)||"Unknown destination"]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Status: ",e.jsx("span",{className:"capitalize",children:E.status})]})]},E.id)})}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No recent trips found."}),e.jsx("button",{onClick:()=>u("no-trip"),className:"mt-2 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 underline",children:"Continue without selecting a trip"})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:()=>l(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:()=>u("no-trip"),className:"px-4 py-2 border border-blue-600 dark:border-blue-500 text-blue-600 dark:text-blue-400 rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/30",children:"Continue Without Trip"})]})]})]})})]})},Tk=({className:t=""})=>{const[r,s]=h.useState("unverified"),[a,n]=h.useState(!0),[i,o]=h.useState(0),[l,c]=h.useState(0),[u,d]=h.useState(null),{userData:m}=je();h.useEffect(()=>{m!=null&&m.id&&(g(),x())},[m]);const g=async()=>{try{n(!0);const{data:y,error:v}=await U.rpc("get_user_driver_id",{p_user_id:m==null?void 0:m.id});if(v||!y){s("unverified");return}const{data:w,error:j}=await U.from("drivers").select("verification_status, decline_reason").eq("id",y).single();if(j){console.error("Error fetching driver verification status:",j),s("unverified");return}w?(s(w.verification_status||"unverified"),d(w.decline_reason)):s("unverified")}catch(y){console.error("Error checking verification status:",y),s("unverified")}finally{n(!1)}},x=async()=>{try{const{data:y,error:v}=await U.rpc("get_user_driver_id",{p_user_id:m==null?void 0:m.id});if(v||!y){o(0),c(3);return}const{count:w,error:j}=await U.from("driver_documents").select("*",{count:"exact",head:!0}).eq("driver_id",y);if(j){console.error("Error counting uploaded documents:",j);return}o(w||0),c(3)}catch(y){console.error("Error fetching document stats:",y)}},f=(()=>{switch(r){case"unverified":return{color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-100 dark:bg-yellow-900/30",borderColor:"border-yellow-200 dark:border-yellow-800",icon:e.jsx(Be,{className:"h-5 w-5 mr-2"}),text:"Unverified",description:"Your driver profile is incomplete. Please upload your documents for verification."};case"pending":return{color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-100 dark:bg-blue-900/30",borderColor:"border-blue-200 dark:border-blue-800",icon:e.jsx(De,{className:"h-5 w-5 mr-2"}),text:"Pending Review",description:"Your documents are being reviewed. This typically takes 24-48 hours."};case"verified":return{color:"text-green-600 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900/30",borderColor:"border-green-200 dark:border-green-800",icon:e.jsx(pt,{className:"h-5 w-5 mr-2"}),text:"Verified",description:"Your driver profile is verified. You can now accept trips."};case"declined":return{color:"text-red-600 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/30",borderColor:"border-red-200 dark:border-red-800",icon:e.jsx(pl,{className:"h-5 w-5 mr-2"}),text:"Verification Declined",description:u||"Your verification was declined. Please check your profile for details and resubmit."};default:return{color:"text-gray-600 dark:text-gray-400",bgColor:"bg-gray-100 dark:bg-gray-800",borderColor:"border-gray-200 dark:border-gray-700",icon:e.jsx(Nt,{className:"h-5 w-5 mr-2"}),text:"Status Unknown",description:"Unable to determine your verification status. Please contact support."}}})();return a?e.jsxs("div",{className:`p-4 animate-pulse ${t}`,children:[e.jsx("div",{className:"h-5 w-32 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-gray-200 dark:bg-gray-700 rounded"})]}):e.jsx("div",{className:`flex flex-col ${t}`,children:e.jsxs("div",{className:`p-4 rounded-lg border ${f.borderColor} ${f.bgColor}`,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:`${f.color}`,children:f.icon}),e.jsx("h3",{className:`font-medium ${f.color}`,children:f.text}),l>0&&e.jsxs("div",{className:"ml-auto text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Documents: "}),e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[i," / ",l]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:f.description}),r!=="verified"&&e.jsxs(lt,{to:"/partner/documents",className:"mt-3 inline-flex items-center text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:[r==="declined"?"Update documents":"Complete verification",e.jsx(ma,{className:"ml-1 h-3 w-3"})]})]})})},Dk=({onDismiss:t})=>{const[r,s]=h.useState(!1),[a,n]=h.useState("unverified"),[i,o]=h.useState(null),{userData:l}=je(),{toast:c}=Pe();h.useEffect(()=>{localStorage.getItem("profilePromptDismissed")==="true"&&s(!0),u()},[l]);const u=async()=>{try{const{data:m,error:g}=await U.rpc("get_user_driver_id");if(g||!m){n("unverified");return}const{data:x,error:p}=await U.from("drivers").select("verification_status, decline_reason").eq("id",m).single();if(p){console.error("Error fetching driver status:",p),n("unverified");return}x?(n(x.verification_status||"unverified"),o(x.decline_reason)):n("unverified")}catch(m){console.error("Error checking driver status:",m),n("unverified")}},d=()=>{localStorage.setItem("profilePromptDismissed","true"),s(!0),t(),c({title:"Prompt Dismissed",description:"You can complete your profile verification at any time from your profile page.",variant:"default"})};return r||a==="pending"||a==="verified"?null:e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-700 overflow-hidden max-w-3xl mx-auto",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{className:"h-6 w-6 text-blue-600 dark:text-blue-400 mr-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Driver Verification Required"})]}),e.jsx("button",{onClick:d,className:"rounded-full p-1 hover:bg-blue-100 dark:hover:bg-blue-800/50 text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400",children:e.jsx(qe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"px-6 py-4",children:[a==="declined"?e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/30 border border-red-100 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx(Be,{className:"h-5 w-5 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800 dark:text-red-300",children:"Your verification was declined"}),i&&e.jsxs("p",{className:"mt-1 text-sm text-red-700 dark:text-red-300",children:["Reason: ",i]})]})]})}):null,e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"To start accepting trips, you need to upload your driver documents and complete your profile verification. This is required for safety and compliance."}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-1 bg-green-100 dark:bg-green-900/30 rounded-full mr-2 mt-0.5",children:e.jsx(Ba,{className:"h-4 w-4 text-green-600 dark:text-green-400"})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Upload your driver's license and insurance documents"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-1 bg-green-100 dark:bg-green-900/30 rounded-full mr-2 mt-0.5",children:e.jsx(Ba,{className:"h-4 w-4 text-green-600 dark:text-green-400"})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Complete your vehicle information"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-1 bg-green-100 dark:bg-green-900/30 rounded-full mr-2 mt-0.5",children:e.jsx(Ba,{className:"h-4 w-4 text-green-600 dark:text-green-400"})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Wait for admin approval (typically within 24-48 hours)"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 px-6 py-4 flex flex-wrap justify-between gap-4",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600",children:"Remind Me Later"}),e.jsxs(lt,{to:"/partner/documents",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",onClick:()=>localStorage.removeItem("profilePromptDismissed"),children:[e.jsx(wr,{className:"h-4 w-4 mr-2"}),a==="declined"?"Resubmit Documents":"Upload Documents",e.jsx(Wn,{className:"h-4 w-4 ml-2"})]})]})]})})},Rk=({onClose:t,verificationStatus:r,documentsUploaded:s})=>{let a="Verification Required",n="You need to be verified before you can set your availability status.",i="Upload Documents",o="/partner/documents",l=e.jsx(Nt,{className:"w-12 h-12 text-blue-500 dark:text-blue-400 mx-auto mb-4"});return r==="pending"?(a="Verification in Progress",n="Your documents are under review. We'll notify you as soon as your profile is verified.",i="View Status",o="/partner/documents",l=e.jsx(pt,{className:"w-12 h-12 text-blue-500 dark:text-blue-400 mx-auto mb-4"})):r==="declined"?(a="Verification Declined",n="Your verification was declined. Please update your documents and resubmit for approval.",i="Update Documents",o="/partner/documents",l=e.jsx(Nt,{className:"w-12 h-12 text-red-500 dark:text-red-400 mx-auto mb-4"})):r==="unverified"&&(s?(a="Submit for Review",n="Your documents have been uploaded. Please submit them for verification to proceed.",i="Submit for Review",o="/partner/documents",l=e.jsx(wr,{className:"w-12 h-12 text-green-500 dark:text-green-400 mx-auto mb-4"})):(a="Documents Required",n="You need to upload your driver documents before you can be verified.",i="Upload Documents",o="/partner/documents",l=e.jsx(wr,{className:"w-12 h-12 text-blue-500 dark:text-blue-400 mx-auto mb-4"}))),e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6 relative",children:[e.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-400",children:e.jsx(qe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-center pt-4",children:[l,e.jsx("h2",{className:"text-xl font-semibold mb-2 dark:text-white",children:a}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:n}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs(lt,{to:o,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors inline-flex items-center justify-center",onClick:t,children:[e.jsx(wr,{className:"h-4 w-4 mr-2"}),i]}),e.jsx("button",{onClick:t,className:"w-full border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Close"})]})]})]})})},Ak=({isAvailable:t,onChange:r,disabled:s=!1,verificationStatus:a=null})=>{const{toast:n}=Pe(),[i,o]=h.useState(!1),[l,c]=h.useState(!1),[u,d]=h.useState(!1),m=async()=>{if(s||a!=="verified"){await x(),c(!0);return}try{const{data:f,error:y}=await U.from("drivers").select("id, is_available, verification_status").eq("user_id",U.auth.getSession().then(v=>{var w,j;return(j=(w=v.data.session)==null?void 0:w.user)==null?void 0:j.id})).single();if(y){console.error("Error fetching driver data:",y),n({variant:"destructive",title:"Error",description:"Could not update availability. Please try again later."});return}if(f.verification_status!=="verified"){n({variant:"destructive",title:"Verification Required",description:"You need to be verified before you can change your availability."});return}if(f){const v=!t,{error:w}=await U.from("drivers").update({is_available:v,updated_at:new Date().toISOString()}).eq("id",f.id);if(w){console.error("Error updating availability:",w),n({variant:"destructive",title:"Error",description:"Failed to update your availability status."});return}r(v),await g(f.id,v),n({title:v?"You're now available":"You're now unavailable",description:v?"You'll be notified of new job assignments.":"You won't receive new job assignments while unavailable."})}}catch(f){console.error("Unexpected error:",f),n({variant:"destructive",title:"Error",description:"An unexpected error occurred. Please try again."})}},g=async(f,y)=>{try{await U.from("activity_logs").insert({driver_id:f,action:"availability_change",details:{new_status:y?"available":"unavailable",device_type:navigator.userAgent}})}catch(v){console.error("Error logging availability change:",v)}},x=async()=>{try{const{data:f}=await U.from("drivers").select("id").eq("user_id",U.auth.getSession().then(y=>{var v,w;return(w=(v=y.data.session)==null?void 0:v.user)==null?void 0:w.id})).single();if(f){const{count:y,error:v}=await U.from("driver_documents").select("id",{count:"exact",head:!0}).eq("driver_id",f.id);!v&&y&&y>0?d(!0):d(!1)}}catch(f){console.error("Error checking documents:",f),d(!1)}},p=s||a!=="verified";return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:m,onMouseEnter:()=>p&&o(!0),onMouseLeave:()=>o(!1),onFocus:()=>p&&o(!0),onBlur:()=>o(!1),className:`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${p?"bg-gray-100 text-gray-400 dark:bg-gray-700 dark:text-gray-500 cursor-not-allowed":t?"bg-green-100 text-green-800 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-300 dark:hover:bg-green-800/30":"bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:[p?e.jsx(gn,{size:16,className:"text-gray-400 dark:text-gray-500"}):e.jsx(xh,{size:16,className:t?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:t?"Available":"Unavailable"})]}),i&&e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 bg-gray-800 text-white text-xs rounded py-2 px-3 shadow-lg z-10",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ae,{size:12,className:"text-yellow-300 mt-0.5 mr-1.5 flex-shrink-0"}),e.jsx("p",{children:a==="unverified"?"You need to upload and verify your documents first.":a==="pending"?"Your documents are under review. Please wait for approval.":a==="declined"?"Your verification was declined. Please update your documents.":"You cannot change your availability status at this time."})]}),e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 rotate-45 w-2 h-2 bg-gray-800"})]}),l&&e.jsx(Rk,{onClose:()=>c(!1),verificationStatus:a,documentsUploaded:u})]})},Mk=()=>{const t=Xt(),r=vt(),{userData:s,loading:a}=je(),[n,i]=h.useState(!1),[o,l]=h.useState(null),[c,u]=h.useState(!1),[d,m]=h.useState(!1),[g,x]=h.useState(!1),[p,f]=h.useState(null),[y,v]=h.useState(!1);h.useEffect(()=>{!a&&s&&s.user_role==="admin"&&(m(!0),console.log("Admin viewing partner portal"))},[s,a]),h.useEffect(()=>{!a&&s&&s.user_role==="partner"&&w()},[s,a]),h.useEffect(()=>{!a&&s&&s.user_role!=="admin"&&s.user_role!=="partner"&&(s.user_role==="customer"?window.location.href="https://royaltransfer.eu/customer-dashboard":t("/login",{replace:!0}))},[s,a,t]);const w=async()=>{try{if(!s||!s.id)return;const b=await nr.fetchDrivers({userId:s.id});if(!b||b.error){console.error("Error fetching driver status:",(b==null?void 0:b.error)||"No data returned"),f("unverified"),x(!0);return}if(b.data&&b.data.length>0){const k=b.data[0];f(k.verification_status||"unverified"),u(k.is_available||!1),(k.verification_status==="unverified"||k.verification_status==="declined")&&x(!0)}else f("unverified"),x(!0)}catch(b){console.error("Error checking driver status:",b),f("unverified"),x(!0)}},j=[{id:"today",label:"Today's Jobs",icon:De,path:"/partner"},{id:"calendar",label:"Schedule",icon:ot,path:"/partner/calendar"},{id:"profile",label:"Profile",icon:Je,path:"/partner/profile"},{id:"documents",label:"Documents",icon:st,path:"/partner/documents"},{id:"payments",label:"Earnings",icon:ph,path:"/partner/payments"},{id:"incidents",label:"Incident Reports",icon:Ae,path:"/partner/incidents"},{id:"chat",label:"Support Chat",icon:Vt,path:"/partner/chat"},{id:"settings",label:"Settings",icon:Hn,path:"/partner/settings"}];return a?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"dark:text-white",children:"Loading driver portal..."})]})}):o?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 mx-auto mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-bold mb-2 dark:text-white",children:"Error"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:o})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:[e.jsx(Na,{}),e.jsx("main",{className:"pt-32 pb-16",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("a",{href:"https://royaltransfer.eu/",className:"mr-4 flex items-center text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(Dr,{className:"w-5 h-5 mr-1"}),e.jsx("span",{className:"text-sm",children:"Main site"})]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-bold dark:text-white flex items-center",children:[e.jsx(xt,{className:"mr-2 h-6 w-6"}),"Driver Portal"]}),d&&e.jsxs("div",{className:"mt-1 text-sm bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 px-2 py-0.5 rounded-md inline-flex items-center",children:[e.jsx("span",{children:"Admin View Mode"}),e.jsx(lt,{to:"/admin",className:"ml-2 underline hover:text-purple-900 dark:hover:text-purple-200",children:"Return to Admin"})]})]})]}),e.jsxs("div",{className:"flex items-center mt-4 md:mt-0 space-x-3",children:[!d&&e.jsxs("div",{className:"relative",onMouseEnter:()=>p!=="verified"&&v(!0),onMouseLeave:()=>v(!1),children:[e.jsx(Ak,{isAvailable:c,onChange:u,verificationStatus:p}),y&&p!=="verified"&&e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-60 bg-gray-800 text-white text-xs rounded py-2 px-3 shadow-lg z-10",children:[p==="pending"?"Your documents are pending verification. You'll be able to go available once approved.":"You need to complete verification before you can go available for trips.",e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 rotate-45 w-2 h-2 bg-gray-800"})]})]}),e.jsx(_a,{})]})]}),!d&&p&&e.jsx("div",{className:"mb-6",children:e.jsx(Tk,{className:"w-full"})}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("button",{className:"md:hidden mb-4 p-2 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",onClick:()=>i(!n),children:e.jsx(yl,{className:"w-6 h-6"})}),e.jsx(Jn,{children:(n||window.innerWidth>=768)&&e.jsx(Xn.div,{initial:{x:-300,opacity:0},animate:{x:0,opacity:1},exit:{x:-300,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`
                    ${n?"fixed inset-0 bg-white dark:bg-gray-800 z-50 md:relative md:bg-transparent dark:md:bg-transparent":""}
                    w-64 md:w-64 md:pr-8
                  `,children:e.jsxs("div",{className:"p-4 md:p-0",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between md:hidden",children:[e.jsx("h2",{className:"text-lg font-semibold dark:text-white",children:"Menu"}),e.jsx("button",{onClick:()=>i(!1),className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",children:e.jsx("span",{className:"text-xl",children:"×"})})]}),e.jsx("nav",{className:"space-y-1",children:j.map(b=>e.jsxs(lt,{to:b.path,onClick:()=>i(!1),className:`w-full flex items-center px-4 py-2 text-sm font-medium rounded-md 
                          ${r.pathname===b.path?"bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-300":"text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx(b.icon,{className:"mr-3 h-5 w-5"}),b.label]},b.id))})]})})}),e.jsx("div",{className:"flex-1 mt-4 md:mt-0",children:e.jsxs(ri,{children:[e.jsx(Oe,{index:!0,element:e.jsx(wk,{})}),e.jsx(Oe,{path:"calendar",element:e.jsx(kk,{})}),e.jsx(Oe,{path:"profile",element:e.jsx(Nk,{})}),e.jsx(Oe,{path:"documents",element:e.jsx(_k,{})}),e.jsx(Oe,{path:"payments",element:e.jsx(Sk,{})}),e.jsx(Oe,{path:"incidents",element:e.jsx(Pk,{})}),e.jsx(Oe,{path:"chat",element:e.jsx(Ck,{})}),e.jsx(Oe,{path:"settings",element:e.jsx(Ek,{})})]})})]})]})}),g&&!d&&e.jsx(Dk,{onDismiss:()=>x(!1)}),e.jsx(Ca,{})]})},Ok=()=>{const t=Xt();return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(Na,{hideSignIn:!0}),e.jsx("main",{className:"pt-32 pb-16",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(_a,{})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg",children:[e.jsx("h1",{className:"text-9xl font-bold text-blue-600 dark:text-blue-400 mb-4",children:"404"}),e.jsx("h2",{className:"text-2xl font-semibold mb-4 dark:text-white",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-8",children:"Oops! The page you're looking for doesn't exist or has been moved."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[e.jsxs("button",{onClick:()=>t("/login"),className:"flex items-center justify-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors dark:text-white",children:[e.jsx(yh,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:"Back to Login"})]}),e.jsxs("a",{href:"https://royaltransfer.eu/contact",className:"flex items-center justify-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors dark:text-white",children:[e.jsx(Dr,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:"Contact Support"})]})]})]})]})})]})},Ik=[{id:"default",name:"Default Vehicle",type:"sedan",capacity:4,price:25}],Lk=h.createContext(void 0),$k=({children:t})=>{const[r,s]=h.useState({step:1,selectedVehicle:Ik[0],personalDetails:{title:"mr",firstName:"",lastName:"",email:"",country:"",phone:"",selectedExtras:new Set},paymentDetails:{method:"card"}}),a=h.useRef(1);return h.useEffect(()=>{r.step!==a.current&&(s(n=>({...n,previousStep:a.current})),a.current=r.step)},[r.step]),e.jsx(Lk.Provider,{value:{bookingState:r,setBookingState:s},children:t})},Zr={showCookieBanner:!0},Fk=h.createContext({flags:Zr,setFeatureFlag:()=>{}}),Uk=t=>{var a;const s=`; ${document.cookie}`.split(`; ${t}=`);return s.length===2&&((a=s.pop())==null?void 0:a.split(";").shift())||null},sl=(t,r,s=365)=>{const a=new Date;a.setTime(a.getTime()+s*24*60*60*1e3);let n=window.location.hostname;const i=n.split(".");i.length>2&&(n=i.slice(-2).join(".")),document.cookie=`${t}=${r}; expires=${a.toUTCString()}; path=/; domain=.${n}`},Bk=({children:t})=>{const[r,s]=h.useState(()=>{try{const n=Uk("featureFlags");if(n)return{...Zr,...JSON.parse(n)};const i=localStorage.getItem("featureFlags");if(i){const o=JSON.parse(i);return sl("featureFlags",i),{...Zr,...o}}return Zr}catch(n){return console.error("Error loading feature flags:",n),Zr}});h.useEffect(()=>{(async()=>{try{const o=new URLSearchParams(window.location.search).get("show_cookies_banner");if(o!==null){const l=o==="1"||o.toLowerCase()==="true";s(c=>({...c,showCookieBanner:l}))}}catch(i){console.error("Error fetching feature flags:",i)}})()},[]),h.useEffect(()=>{try{const n=JSON.stringify(r);sl("featureFlags",n),localStorage.setItem("featureFlags",n)}catch(n){console.error("Error saving feature flags:",n)}},[r]);const a=(n,i)=>{s(o=>({...o,[n]:i}))};return h.useEffect(()=>(window.setFeatureFlag=(n,i)=>n==="show_cookies_banner"?(a("showCookieBanner",i),!0):!1,()=>{delete window.setFeatureFlag}),[]),e.jsx(Fk.Provider,{value:{flags:r,setFeatureFlag:a},children:t})};function qk(t){if(!t)return"Royal Transfer EU Portal";switch(t.user_role){case"partner":return"RT Partner Portal";case"admin":return"RT Admin Portal";case"support":return"RT Support Portal";default:return"Royal Transfer EU Portal"}}const zk=()=>{const[t,r]=h.useState(null),[s,a]=h.useState(!1),[n,i]=h.useState(!1),{userData:o}=je(),l=qk(o);h.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches){i(!0);return}const u=d=>{d.preventDefault(),r(d),a(!0)};return window.addEventListener("beforeinstallprompt",u),window.addEventListener("appinstalled",()=>{i(!0),a(!1),r(null),console.log(`${l} was installed`)}),()=>{window.removeEventListener("beforeinstallprompt",u)}},[l]);const c=async()=>{if(!t){console.log("Install prompt not available");return}await t.prompt(),(await t.userChoice).outcome==="accepted"?(console.log("User accepted the install prompt"),a(!1)):console.log("User dismissed the install prompt"),r(null)};return!s||n?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs("button",{onClick:c,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg shadow-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Pt,{className:"w-5 h-5 mr-2"}),"Install App"]})})};function Wk(){const[t,r]=h.useState(!1);return h.useEffect(()=>{const s=()=>{const a=navigator.userAgent||navigator.vendor||window.opera||"",n=/iPad|iPhone|iPod/.test(a)&&!window.MSStream,i=/Android/i.test(a),o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(a)||window.innerWidth<=768;r(n||i||o)};return s(),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),t}const Vk=()=>{const[t,r]=h.useState(!1),{theme:s}=ja(),a=Wk();h.useEffect(()=>{const l=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),c=localStorage.getItem("pwaPromptDismissed");if(a&&!l&&!c){const d=setTimeout(()=>{r(!0)},2e3);return()=>clearTimeout(d)}},[a]);const n=()=>{r(!1),localStorage.setItem("pwaPromptDismissed","true")},o=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"Tap the share icon and select 'Add to Home Screen'":"Tap the menu icon and select 'Install App'";return e.jsx(Jn,{children:t&&e.jsxs(Xn.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20},className:`fixed bottom-0 left-0 right-0 z-50 m-4 p-4 rounded-lg shadow-lg ${s==="dark"?"bg-gray-800 text-white border border-gray-700":"bg-white text-gray-800 border border-gray-200"}`,children:[e.jsx("button",{onClick:n,className:`absolute top-2 right-2 p-1 rounded-full ${s==="dark"?"hover:bg-gray-700 text-gray-300":"hover:bg-gray-100 text-gray-500"}`,"aria-label":"Close prompt",children:e.jsx(qe,{size:18})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-full mr-3 ${s==="dark"?"bg-blue-900":"bg-blue-100"}`,children:e.jsx(Pt,{className:s==="dark"?"text-blue-400":"text-blue-600",size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium mb-1",children:"Install our app"}),e.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"For a better experience, add this app to your home screen."}),e.jsx("p",{className:`text-sm mt-1 font-medium ${s==="dark"?"text-blue-400":"text-blue-600"}`,children:o})]})]})]})})},Hk=()=>{const{userData:t}=je();return h.useEffect(()=>{if(!t)return;const r=window.location.pathname;let s="admin";(r.startsWith("/partner")||t.user_role==="partner")&&(s="partner");const a=document.querySelector('link[rel="manifest"]');a&&a.remove();const n=document.createElement("link");n.rel="manifest",n.href=`/manifest-${s}.json`,document.head.appendChild(n);const i=document.querySelector('link[rel="apple-touch-icon"]');i&&i.remove();const o=document.createElement("link");o.rel="apple-touch-icon",o.href=`/icons/${s}/192x192.png`,document.head.appendChild(o),console.log(`PWA manifest updated for path: ${r}, using ${s} icons`)},[t,window.location.pathname]),null},Yk=({checkIntervalMs:t=60*60*1e3})=>{const[r,s]=h.useState(!1),{toast:a}=Pe();h.useEffect(()=>{let o=null;if("serviceWorker"in navigator){const l=async()=>{try{o=await navigator.serviceWorker.getRegistration(),o!=null&&o.waiting&&(console.log("Update available!"),s(!0),i())}catch(m){console.error("Error checking for updates:",m)}};l();const c=setInterval(l,t),u=()=>{console.log("Controller changed, new version is active")};navigator.serviceWorker.addEventListener("controllerchange",u);const d=m=>{m.data&&m.data.type==="UPDATE_AVAILABLE"&&(s(!0),i())};return navigator.serviceWorker.addEventListener("message",d),navigator.serviceWorker.ready.then(m=>{m.addEventListener("updatefound",()=>{const g=m.installing;g&&g.addEventListener("statechange",()=>{g.state==="installed"&&navigator.serviceWorker.controller&&(s(!0),i())})})}),()=>{clearInterval(c),navigator.serviceWorker.removeEventListener("controllerchange",u),navigator.serviceWorker.removeEventListener("message",d)}}},[t]);const n=()=>{window.location.reload()},i=()=>{r&&a({title:"New Version Available",description:"A newer version of this application is available. Reload to update.",variant:"default",duration:0,className:"update-notification",action:e.jsxs(vr,{altText:"Reload",onClick:n,children:[e.jsx(Qe,{className:"w-4 h-4 mr-1"}),"Reload"]})})};return null},Gk=()=>{const{userData:t}=je(),{toast:r}=Pe(),s=Xt(),[a,n]=h.useState(null);h.useEffect(()=>{if(!(t!=null&&t.id))return;t.user_role==="partner"&&i();const c=U.channel("driver-updates").on("postgres_changes",{event:"UPDATE",schema:"public",table:"drivers",filter:`user_id=eq.${t.id}`},u=>{o(u.new)}).subscribe();if(t.user_role==="partner"){const u=U.channel("new-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${t.id}`},d=>{l(d.new)}).subscribe();return()=>{U.removeChannel(u),U.removeChannel(c)}}return()=>{U.removeChannel(c)}},[t==null?void 0:t.id,t==null?void 0:t.user_role]);const i=async()=>{try{const{data:c,error:u}=await U.from("drivers").select("verification_status").eq("user_id",t==null?void 0:t.id).single();!u&&c&&n(c.verification_status)}catch(c){console.error("Error getting initial driver status:",c)}},o=c=>{a!=="verified"&&c.verification_status==="verified"?(r({title:"You're now verified! 🎉",description:"Congratulations! You can now set your availability and start accepting trips.",variant:"success",duration:1e4}),localStorage.removeItem("profilePromptDismissed"),setTimeout(()=>{window.location.reload()},2e3)):c.verification_status==="declined"&&a!=="declined"&&(r({title:"Verification Declined",description:"Your driver verification has been declined. Please check your documents page for details.",variant:"destructive",duration:1e4}),localStorage.removeItem("profilePromptDismissed")),n(c.verification_status)},l=c=>{r({title:"New Message",description:"You have received a new support message.",variant:"default",onClick:()=>{s("/partner/chat")}})};return null};class Au extends h.Component{constructor(s){super(s);Hi(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,a){console.error("Uncaught error:",s,a),this.setState({error:s,errorInfo:a})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{className:"min-h-[50vh] flex flex-col items-center justify-center p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700",children:[e.jsx(Ae,{className:"h-16 w-16 text-red-500 dark:text-red-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Something Went Wrong"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4 text-center max-w-md",children:"We're sorry, but something went wrong. Please try refreshing the page or contact support if the issue persists."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center",children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Refresh Page"]}),e.jsx("button",{onClick:this.handleReset,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",children:"Try Again"})]}),this.state.error&&!1]}):this.props.children}}const $i=({message:t="Loading...",height:r="h-64",fullscreen:s=!1})=>s?e.jsx("div",{className:"fixed inset-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ue,{className:"h-10 w-10 text-blue-600 dark:text-blue-400 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:t})]})}):e.jsxs("div",{className:`${r} flex flex-col items-center justify-center`,children:[e.jsx(ue,{className:"h-8 w-8 text-blue-600 dark:text-blue-400 animate-spin mb-3"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:t})]}),Kk=()=>{const t=vt();return h.useEffect(()=>{const r=t.pathname.startsWith("/transfer/");return document.documentElement.classList.toggle("booking-page",r),()=>{document.documentElement.classList.remove("booking-page")}},[t]),null},al=({children:t})=>{const{user:r,loading:s}=je();return s?e.jsx($i,{message:"Checking authentication...",fullscreen:!0}):r?e.jsx(e.Fragment,{children:t}):e.jsx(es,{to:"/login",replace:!0})},Jk=({children:t})=>{const{user:r,userData:s,loading:a}=je();return a?e.jsx($i,{message:"Checking authentication...",fullscreen:!0}):r?(s==null?void 0:s.user_role)==="admin"||(s==null?void 0:s.user_role)==="support"?e.jsx(es,{to:"/admin",replace:!0}):(s==null?void 0:s.user_role)==="partner"?e.jsx(es,{to:"/partner",replace:!0}):e.jsx(es,{to:"/login",replace:!0}):e.jsx(e.Fragment,{children:t})},Xk=()=>e.jsx(es,{to:"/login",replace:!0});function Qk(){const{userData:t}=je();return e.jsxs(e.Fragment,{children:[e.jsx(Kk,{}),e.jsx(Gk,{}),e.jsx(Au,{children:e.jsx(h.Suspense,{fallback:e.jsx($i,{message:"Loading content...",fullscreen:!0}),children:e.jsxs(ri,{children:[e.jsx(Oe,{path:"/",element:e.jsx(Xk,{})}),e.jsx(Oe,{path:"/login",element:e.jsx(Jk,{children:e.jsx(bx,{})})}),e.jsx(Oe,{path:"/admin/*",element:e.jsx(al,{children:e.jsx(bk,{})})}),e.jsx(Oe,{path:"/partner/*",element:e.jsx(al,{children:e.jsx(Mk,{})})}),e.jsx(Oe,{path:"*",element:e.jsx(Ok,{})})]})})})]})}function Zk(){return e.jsx(Au,{children:e.jsx(zg,{children:e.jsx(qg,{children:e.jsx($w,{children:e.jsx(Bk,{children:e.jsx($k,{children:e.jsxs(wm,{children:[e.jsx(Hk,{}),e.jsx(Qk,{}),e.jsx(zk,{}),e.jsx(Vk,{}),e.jsx(Yk,{}),e.jsx(Ca,{})]})})})})})})})}try{self["workbox:window:7.2.0"]&&_()}catch{}function nl(t,r){return new Promise(function(s){var a=new MessageChannel;a.port1.onmessage=function(n){s(n.data)},t.postMessage(r,[a.port2])})}function ej(t){var r=function(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var i=n.call(s,a);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(t,"string");return typeof r=="symbol"?r:r+""}function tj(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,ej(a.key),a)}}function qn(t,r){return qn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},qn(t,r)}function il(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}function rj(t,r){var s=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=function(n,i){if(n){if(typeof n=="string")return il(n,i);var o=Object.prototype.toString.call(n).slice(8,-1);return o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set"?Array.from(n):o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?il(n,i):void 0}}(t))||r){s&&(t=s);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}try{self["workbox:core:7.2.0"]&&_()}catch{}var hn=function(){var t=this;this.promise=new Promise(function(r,s){t.resolve=r,t.reject=s})};function mn(t,r){var s=location.href;return new URL(t,s).href===new URL(r,s).href}var Jr=function(t,r){this.type=t,Object.assign(this,r)};function It(t,r,s){return s?r?r(t):t:(t&&t.then||(t=Promise.resolve(t)),r?t.then(r):t)}function sj(){}var aj={type:"SKIP_WAITING"};function ol(t,r){return t&&t.then?t.then(sj):Promise.resolve()}var nj=function(t){function r(l,c){var u,d;return c===void 0&&(c={}),(u=t.call(this)||this).nn={},u.tn=0,u.rn=new hn,u.en=new hn,u.on=new hn,u.un=0,u.an=new Set,u.cn=function(){var m=u.fn,g=m.installing;u.tn>0||!mn(g.scriptURL,u.sn.toString())||performance.now()>u.un+6e4?(u.vn=g,m.removeEventListener("updatefound",u.cn)):(u.hn=g,u.an.add(g),u.rn.resolve(g)),++u.tn,g.addEventListener("statechange",u.ln)},u.ln=function(m){var g=u.fn,x=m.target,p=x.state,f=x===u.vn,y={sw:x,isExternal:f,originalEvent:m};!f&&u.mn&&(y.isUpdate=!0),u.dispatchEvent(new Jr(p,y)),p==="installed"?u.wn=self.setTimeout(function(){p==="installed"&&g.waiting===x&&u.dispatchEvent(new Jr("waiting",y))},200):p==="activating"&&(clearTimeout(u.wn),f||u.en.resolve(x))},u.yn=function(m){var g=u.hn,x=g!==navigator.serviceWorker.controller;u.dispatchEvent(new Jr("controlling",{isExternal:x,originalEvent:m,sw:g,isUpdate:u.mn})),x||u.on.resolve(g)},u.gn=(d=function(m){var g=m.data,x=m.ports,p=m.source;return It(u.getSW(),function(){u.an.has(p)&&u.dispatchEvent(new Jr("message",{data:g,originalEvent:m,ports:x,sw:p}))})},function(){for(var m=[],g=0;g<arguments.length;g++)m[g]=arguments[g];try{return Promise.resolve(d.apply(this,m))}catch(x){return Promise.reject(x)}}),u.sn=l,u.nn=c,navigator.serviceWorker.addEventListener("message",u.gn),u}var s,a;a=t,(s=r).prototype=Object.create(a.prototype),s.prototype.constructor=s,qn(s,a);var n,i,o=r.prototype;return o.register=function(l){var c=(l===void 0?{}:l).immediate,u=c!==void 0&&c;try{var d=this;return It(function(m,g){var x=m();return x&&x.then?x.then(g):g(x)}(function(){if(!u&&document.readyState!=="complete")return ol(new Promise(function(m){return window.addEventListener("load",m)}))},function(){return d.mn=!!navigator.serviceWorker.controller,d.dn=d.pn(),It(d.bn(),function(m){d.fn=m,d.dn&&(d.hn=d.dn,d.en.resolve(d.dn),d.on.resolve(d.dn),d.dn.addEventListener("statechange",d.ln,{once:!0}));var g=d.fn.waiting;return g&&mn(g.scriptURL,d.sn.toString())&&(d.hn=g,Promise.resolve().then(function(){d.dispatchEvent(new Jr("waiting",{sw:g,wasWaitingBeforeRegister:!0}))}).then(function(){})),d.hn&&(d.rn.resolve(d.hn),d.an.add(d.hn)),d.fn.addEventListener("updatefound",d.cn),navigator.serviceWorker.addEventListener("controllerchange",d.yn),d.fn})}))}catch(m){return Promise.reject(m)}},o.update=function(){try{return this.fn?It(ol(this.fn.update())):It()}catch(l){return Promise.reject(l)}},o.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},o.messageSW=function(l){try{return It(this.getSW(),function(c){return nl(c,l)})}catch(c){return Promise.reject(c)}},o.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&nl(this.fn.waiting,aj)},o.pn=function(){var l=navigator.serviceWorker.controller;return l&&mn(l.scriptURL,this.sn.toString())?l:void 0},o.bn=function(){try{var l=this;return It(function(c,u){try{var d=c()}catch(m){return u(m)}return d&&d.then?d.then(void 0,u):d}(function(){return It(navigator.serviceWorker.register(l.sn,l.nn),function(c){return l.un=performance.now(),c})},function(c){throw c}))}catch(c){return Promise.reject(c)}},n=r,(i=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&tj(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),n}(function(){function t(){this.Pn=new Map}var r=t.prototype;return r.addEventListener=function(s,a){this.jn(s).add(a)},r.removeEventListener=function(s,a){this.jn(s).delete(a)},r.dispatchEvent=function(s){s.target=this;for(var a,n=rj(this.jn(s.type));!(a=n()).done;)(0,a.value)(s)},r.jn=function(s){return this.Pn.has(s)||this.Pn.set(s,new Set),this.Pn.get(s)},t}());function ij(){const t=window.location.hostname.includes("stackblitz")||window.location.origin.includes("stackblitz.io")||window.location.hostname.includes("webcontainer-api.io")||window.location.hostname.includes("local-credentialless.webcontainer-api.io");if("serviceWorker"in navigator&&!t){const r=new nj("/service-worker.js");r.addEventListener("installed",s=>{s.isUpdate&&confirm("New version available! Reload to update?")&&window.location.reload()}),r.addEventListener("activated",s=>{s.isUpdate?console.log("Service Worker has been updated and activated"):console.log("Service Worker has been installed and activated")}),r.addEventListener("waiting",s=>{console.log("Service Worker is waiting to be activated")}),r.register().then(s=>{console.log("Service Worker registered with scope:",s.scope)}).catch(s=>{console.error("Service Worker registration failed:",s)})}else console.log("Service Worker is not supported or disabled in this environment")}const oj=()=>{const t=localStorage.getItem("theme");t==="dark"?document.documentElement.classList.add("dark"):t==="light"?document.documentElement.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.documentElement.classList.add("dark")};oj();ij();kl(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx(Zk,{})}));
//# sourceMappingURL=index-BKiItKTo.js.map
